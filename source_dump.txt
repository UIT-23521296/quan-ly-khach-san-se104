# ==================================================
# Path: D:\Github\quan-ly-khach-san-se104
# Detected tech: docker, javascript, python, react, typescript
# ==================================================

## DIRECTORY STRUCTURE
```
quan-ly-khach-san-se104/
‚îú‚îÄ‚îÄ .git/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ baocaoController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboardController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ khachhangController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phongController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quidinhController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userController.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roleMiddleware.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonModel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ khachhangModel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachModel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueModel.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ phongModel.js
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ baocaoRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chatbot.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboardRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ khachhangRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaiphongRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phongRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ quidinhRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ thamSoRoutes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userRoutes.js
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chatbot.service.js
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ createAdmin.js
‚îÇ   ‚îú‚îÄ‚îÄ package-lock.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vite.svg
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ react.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatBot.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatBot.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomerManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InvoiceManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReportManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoomSearch.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Settings.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StaffManagement.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ eslint.config.js
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ package-lock.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.js
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ package-lock.json
‚îî‚îÄ‚îÄ source_dump.txt
```

## FILE CONTENTS

### backend\createAdmin.js
```js
// createAdmin.js
const bcrypt = require("bcryptjs");
const db = require("./config/db");

(async () => {
  const username = "admin";
  const password = "admin123";
  const hoTen = "Qu·∫£n Tr·ªã H·ªá Th·ªëng";
  const vaiTro = "Admin";

  const hashedPassword = await bcrypt.hash(password, 10);

  db.query(
    "INSERT INTO Users (Username, Password, HoTen, VaiTro) VALUES (?, ?, ?, ?)",
    [username, hashedPassword, hoTen, vaiTro],
    (err, result) => {
      if (err) {
        console.error("‚ùå L·ªói t·∫°o admin:", err);
        process.exit();
      }

      console.log("‚úÖ T·∫°o t√†i kho·∫£n admin th√†nh c√¥ng!");
      process.exit();
    }
  );
})();
```

### backend\server.js
```js
// backend/server.js
require("dotenv").config(); // ƒê·ªçc file .env

const express = require("express");
const cors = require("cors");

const app = express();
const PORT = process.env.PORT || 9999;

// Middleware
app.use(cors());
app.use(express.json());

// K·∫øt n·ªëi DB
require("./config/db");

// ==== ROUTES ====
const authRoutes = require("./routes/authRoutes");
const phongRoutes = require("./routes/phongRoutes");
const thamSoRoutes = require("./routes/thamSoRoutes");
const loaiphongRoutes = require("./routes/loaiphongRoutes");
const phieuthueRoutes = require("./routes/phieuthueRoutes");
const loaikhachRoutes = require("./routes/loaikhachRoutes");
const hoadonRoutes = require("./routes/hoadonRoutes");
const baocaoRoutes = require("./routes/baocaoRoutes");
const khachhangRoutes = require("./routes/khachhangRoutes");

// ==== S·ª¨ D·ª§NG ROUTES ====
app.use("/api/auth", authRoutes);
app.use("/api/phong", phongRoutes);
app.use("/api/thamso", thamSoRoutes);
app.use("/api/loaiphong", loaiphongRoutes);
app.use("/api/phieuthue", phieuthueRoutes);
app.use("/api/loaikhach", loaikhachRoutes);
app.use("/api/hoadon", hoadonRoutes);
app.use("/api/baocao", baocaoRoutes);
app.use("/api/quidinh", require("./routes/quidinhRoutes"));
app.use("/api/khachhang", khachhangRoutes);
app.use("/api/dashboard", require("./routes/dashboardRoutes"));
app.use("/api/users", require("./routes/userRoutes"));
app.use("/api/chatbot", require("./routes/chatbot.routes"));

// Test API
app.get("/api/test", (req, res) => {
  res.json({ message: "Backend ƒëang ch·∫°y!" });
});

// Start server
app.listen(PORT, () => {
  console.log(`üöÄ Server ch·∫°y t·∫°i http://localhost:${PORT}`);
});

```

### backend\config\db.js
```js
const mysql = require("mysql2");

const pool = mysql.createPool({
  host: process.env.DB_HOST || "localhost",
  user: process.env.DB_USER || "root",
  password: process.env.DB_PASS || "",
  database: process.env.DB_NAME || "quanlykhachsan",
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
});

pool.getConnection((err, conn) => {
  if (err) {
    console.error("‚ùå L·ªói k·∫øt n·ªëi MySQL:", err);
  } else {
    console.log("‚úÖ K·∫øt n·ªëi MySQL th√†nh c√¥ng!");
    conn.release();
  }
});

module.exports = pool;

```

### backend\controllers\baocaoController.js
```js
const db = require("../config/db");
const { v4: uuidv4 } = require("uuid");

// 1. T√≠nh to√°n doanh thu 
const calculateRevenue = async (thang, nam) => {
    let whereClause = "YEAR(hd.NgayLap) = ?";
    let params = [nam];
    if (thang && thang !== 'ALL') {
        whereClause += " AND MONTH(hd.NgayLap) = ?";
        params.push(thang);
    }
    const sql = `
      SELECT lp.MaLoaiPhong, lp.TenLoaiPhong, COALESCE(SUM(thuc_te.ThanhTien), 0) as DoanhThu
      FROM loaiphong lp
      LEFT JOIN (
          SELECT p.MaLoaiPhong, ct.ThanhTien
          FROM ct_hoadon ct
          JOIN hoadon hd ON ct.SoHoaDon = hd.SoHoaDon
          JOIN phong p ON ct.MaPhong = p.MaPhong
          WHERE ${whereClause}
      ) thuc_te ON lp.MaLoaiPhong = thuc_te.MaLoaiPhong
      GROUP BY lp.MaLoaiPhong, lp.TenLoaiPhong
    `;
    const [rows] = await db.promise().query(sql, params);
    return rows;
};

// API: L·∫•y d·ªØ li·ªáu Live ƒë·ªÉ preview
exports.getDoanhThuThang = async (req, res) => {
  const { thang, nam } = req.query;
  try {
    const rows = await calculateRevenue(thang, nam);
    res.json(rows);
  } catch (err) { res.status(500).json({ message: err.message }); }
};

// --- API: L∆ØU B√ÅO C√ÅO  ---
exports.saveReport = async (req, res) => {
    const { thang, nam } = req.body;
    const conn = await db.promise().getConnection();
    
    try {
        await conn.beginTransaction();

        // 1. T·∫°o Header B√°o C√°o
        const maBaoCao = uuidv4();
        const dbThang = (thang && thang !== 'ALL') ? thang : null;
        const tenBaoCao = dbThang 
            ? `B√°o c√°o doanh thu Th√°ng ${dbThang}/${nam}` 
            : `B√°o c√°o doanh thu NƒÉm ${nam}`;

        await conn.query(
            "INSERT INTO baocao (MaBaoCao, TenBaoCao, Thang, Nam) VALUES (?, ?, ?, ?)",
            [maBaoCao, tenBaoCao, dbThang, nam]
        );

        // 2. T√≠nh to√°n & L∆∞u Chi Ti·∫øt
        const data = await calculateRevenue(thang, nam);
        const totalRevenue = data.reduce((sum, item) => sum + Number(item.DoanhThu), 0);

        for (const item of data) {
            const tile = totalRevenue > 0 ? (item.DoanhThu / totalRevenue) : 0;
            const maChiTiet = uuidv4();
            
            await conn.query(
                `INSERT INTO ct_baocao (MaCTBC, MaBaoCao, MaLoaiPhong, TenLoaiPhong, DoanhThu, TiLe) 
                 VALUES (?, ?, ?, ?, ?, ?)`,
                [maChiTiet, maBaoCao, item.MaLoaiPhong, item.TenLoaiPhong, item.DoanhThu, tile]
            );
        }

        await conn.commit();
        res.json({ message: "L∆∞u b√°o c√°o th√†nh c√¥ng!" });
    } catch (err) {
        await conn.rollback();
        res.status(500).json({ message: err.message });
    } finally { conn.release(); }
};

// --- API: L·∫§Y DANH S√ÅCH B√ÅO C√ÅO ƒê√É L∆ØU ---
exports.getSavedReportsList = async (req, res) => {
    try {
        // L·∫•y danh s√°ch c√°c b√°o c√°o (Header), s·∫Øp x·∫øp m·ªõi nh·∫•t l√™n ƒë·∫ßu
        const [rows] = await db.promise().query("SELECT * FROM baocao ORDER BY NgayTao DESC");
        res.json(rows);
    } catch (err) { res.status(500).json({ message: err.message }); }
};

// --- API: XEM CHI TI·∫æT 1 B√ÅO C√ÅO ---
exports.getReportDetail = async (req, res) => {
    const { id } = req.params; // id l√† MaBaoCao
    try {
        const [rows] = await db.promise().query("SELECT * FROM ct_baocao WHERE MaBaoCao = ?", [id]);
        res.json(rows);
    } catch (err) { res.status(500).json({ message: err.message }); }
};

// --- API: X√ìA B√ÅO C√ÅO ---
exports.deleteReport = async (req, res) => {
    const { id } = req.params;
    try {
        // Nh·ªù ON DELETE CASCADE trong SQL, ch·ªâ c·∫ßn x√≥a b·∫£ng cha l√† b·∫£ng con t·ª± bay m√†u
        await db.promise().query("DELETE FROM baocao WHERE MaBaoCao = ?", [id]);
        res.json({ message: "ƒê√£ x√≥a b√°o c√°o" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};

// --- API: L·∫§Y DANH S√ÅCH B√ÅO C√ÅO ---
exports.getSavedReportsList = async (req, res) => {
    try {
        const { thang, nam, type } = req.query; // Th√™m tham s·ªë 'type'
        
        let sql = "SELECT * FROM baocao WHERE 1=1";
        const params = [];

        if (nam) {
            sql += " AND Nam = ?";
            params.push(nam);
        }

        // LOGIC L·ªåC M·ªöI:
        if (type === 'year') {
            // N·∫øu xem theo NƒÉm -> Ch·ªâ l·∫•y b√°o c√°o NƒÉm (Thang IS NULL)
            sql += " AND Thang IS NULL";
        } else {
            // N·∫øu xem theo Th√°ng -> L·∫•y b√°o c√°o th√°ng c·ª• th·ªÉ
            if (thang && thang !== 'ALL') {
                sql += " AND Thang = ?";
                params.push(thang);
            } else {
                // N·∫øu ch·ªçn "T·∫•t c·∫£ th√°ng" -> L·∫•y t·∫•t c·∫£ b√°o c√°o c√≥ Thang kh√°c NULL
                sql += " AND Thang IS NOT NULL";
            }
        }

        sql += " ORDER BY NgayTao DESC";

        const [rows] = await db.promise().query(sql, params);
        res.json(rows);
    } catch (err) { 
        res.status(500).json({ message: err.message }); 
    }
};
```

### backend\controllers\dashboardController.js
```js
const db = require("../config/db");

exports.getDashboardStats = async (req, res) => {
    try {
        // 1. Th·ªëng k√™ s·ªë l∆∞·ª£ng ph√≤ng theo t√¨nh tr·∫°ng
        // D·ª±a v√†o b·∫£ng 'phong'
        const [roomStats] = await db.promise().query(`
            SELECT TinhTrang, COUNT(*) as SoLuong 
            FROM phong 
            GROUP BY TinhTrang
        `);

        // 2. Th·ªëng k√™ Doanh thu (H√¥m nay & Th√°ng n√†y)
        // D·ª±a v√†o b·∫£ng 'hoadon'
        const [revenueStats] = await db.promise().query(`
            SELECT 
                SUM(CASE WHEN NgayLap = CURDATE() THEN TriGia ELSE 0 END) as DoanhThuNgay,
                SUM(CASE WHEN MONTH(NgayLap) = MONTH(CURRENT_DATE()) AND YEAR(NgayLap) = YEAR(CURRENT_DATE()) THEN TriGia ELSE 0 END) as DoanhThuThang
            FROM hoadon
        `);

        // 3. T·ªïng s·ªë kh√°ch h√†ng
        // D·ª±a v√†o b·∫£ng 'khachhang'
        const [custStats] = await db.promise().query("SELECT COUNT(*) as TongKhach FROM khachhang");

        // 4. L·∫•y 5 h√≥a ƒë∆°n m·ªõi nh·∫•t
        const [recentInvoices] = await db.promise().query(`
            SELECT SoHoaDon, TenKhachHangCoQuan, NgayLap, TriGia 
            FROM hoadon 
            ORDER BY NgayLap DESC, SoHoaDon DESC 
            LIMIT 5
        `);

        // Chu·∫©n h√≥a d·ªØ li·ªáu ph√≤ng (ƒë·∫£m b·∫£o lu√¥n c√≥ ƒë·ªß key d√π DB ch∆∞a c√≥ d·ªØ li·ªáu)
        const statusMap = { 'Tr·ªëng': 0, 'ƒê√£ thu√™': 0, 'B·∫£o tr√¨': 0, 'Ng∆∞ng kinh doanh': 0 };
        roomStats.forEach(item => {
            if (statusMap.hasOwnProperty(item.TinhTrang)) {
                statusMap[item.TinhTrang] = item.SoLuong;
            }
        });

        // Tr·∫£ v·ªÅ JSON t·ªïng h·ª£p
        res.json({
            rooms: statusMap,
            revenue: {
                today: revenueStats[0].DoanhThuNgay || 0,
                month: revenueStats[0].DoanhThuThang || 0
            },
            totalCustomers: custStats[0].TongKhach,
            recentInvoices
        });

    } catch (err) {
        console.error("Dashboard Error:", err);
        res.status(500).json({ message: "L·ªói l·∫•y d·ªØ li·ªáu th·ªëng k√™" });
    }
};
```

### backend\controllers\hoadonController.js
```js
const db = require("../config/db");
const hoadonModel = require("../models/hoadonModel");
const { v4: uuidv4 } = require("uuid");

// --- H√ÄM LOGIC T√çNH TI·ªÄN TRUNG T√ÇM ---
const calculateBill = async (soPhieu) => {
    // 1. L·∫•y th√¥ng tin phi·∫øu & Tham s·ªë quy ƒë·ªãnh (Gi·ªØ nguy√™n)
    const sqlBase = `
        SELECT pt.SoPhieu, pt.MaPhong, pt.NgayBatDauThue, pt.NgayDuKienTra, 
               p.TenPhong, lp.DonGia, lp.TenLoaiPhong,
               ts.SoKhachKhongTinhPhuThu, -- VD: 2
               (SELECT HoTen FROM khachhang WHERE MaKH = (SELECT MaKH FROM ct_phieuthue WHERE SoPhieu = pt.SoPhieu LIMIT 1)) as TenKhachDaiDien,
               (SELECT DiaChi FROM khachhang WHERE MaKH = (SELECT MaKH FROM ct_phieuthue WHERE SoPhieu = pt.SoPhieu LIMIT 1)) as DiaChi
        FROM phieuthue pt
        JOIN phong p ON pt.MaPhong = p.MaPhong
        JOIN loaiphong lp ON p.MaLoaiPhong = lp.MaLoaiPhong
        CROSS JOIN thamso ts 
        WHERE pt.SoPhieu = ?
    `;
    
    const [rows] = await db.promise().query(sqlBase, [soPhieu]);
    if (rows.length === 0) throw new Error("Phi·∫øu thu√™ kh√¥ng t·ªìn t·∫°i");
    const data = rows[0];

    // 2. ƒê·∫øm s·ªë kh√°ch th·ª±c t·∫ø
    const sqlKhach = `
        SELECT lk.MaLoaiKhach, lk.HeSoPhuThu 
        FROM ct_phieuthue ct
        JOIN khachhang kh ON ct.MaKH = kh.MaKH
        JOIN loaikhach lk ON kh.MaLoaiKhach = lk.MaLoaiKhach
        WHERE ct.SoPhieu = ?
    `;
    const [dsKhach] = await db.promise().query(sqlKhach, [soPhieu]);
    const soLuongKhach = dsKhach.length;

    // 3. T√≠nh s·ªë ng√†y
    const ngayBatDau = new Date(data.NgayBatDauThue);
    const ngayKetThuc = data.NgayDuKienTra ? new Date(data.NgayDuKienTra) : new Date(); 
    let soNgay = Math.ceil((Math.abs(ngayKetThuc - ngayBatDau)) / (1000 * 60 * 60 * 24));
    if (soNgay <= 0) soNgay = 1;

    // --- 4. T√≠nh ti·ªÅn ---
    
    // A. H·ªá s·ªë kh√°ch n∆∞·ªõc ngo√†i
    let heSoKhach = 1.0;
    if (dsKhach.length > 0) {
        heSoKhach = Math.max(...dsKhach.map(k => k.HeSoPhuThu));
    }

    // B. Ph·ª• thu s·ªë l∆∞·ª£ng kh√°ch (TRA B·∫¢NG TR·ª∞C TI·∫æP)
    let tiLePhuThu = 0;
    const soKhachMienPhi = data.SoKhachKhongTinhPhuThu; // VD: 2
    const soKhachDuRa = soLuongKhach - soKhachMienPhi;  // VD: 4 - 2 = 2 kh√°ch d∆∞

    if (soKhachDuRa > 0) {
        // Query tr·ª±c ti·∫øp: "N·∫øu d∆∞ X ng∆∞·ªùi th√¨ t·ªâ l·ªá l√† bao nhi√™u?"
        const [resTiLe] = await db.promise().query(
            "SELECT TiLePhuThu FROM tilephuthu WHERE KhachThu = ?", 
            [soKhachDuRa]
        );
        
        if (resTiLe.length > 0) {
            // Tr∆∞·ªùng h·ª£p 1: C√≥ trong b·∫£ng (VD: d∆∞ 1 ho·∫∑c 2 ng∆∞·ªùi)
            tiLePhuThu = parseFloat(resTiLe[0].TiLePhuThu);
        } else {
            // Tr∆∞·ªùng h·ª£p 2: S·ªë kh√°ch d∆∞ v∆∞·ª£t qu√° b·∫£ng (VD: d∆∞ 5 ng∆∞·ªùi m√† b·∫£ng ch·ªâ c√≥ 2 d√≤ng)
            // L·∫•y d√≤ng c√≥ KhachThu l·ªõn nh·∫•t l√†m m·ªëc (ho·∫∑c b·∫°n c√≥ th·ªÉ return l·ªói)
            const [maxRes] = await db.promise().query(
                "SELECT TiLePhuThu FROM tilephuthu ORDER BY KhachThu DESC LIMIT 1"
            );
            if (maxRes.length > 0) {
                tiLePhuThu = parseFloat(maxRes[0].TiLePhuThu);
            }
        }
    }

    // 5. T√≠nh t·ªïng ti·ªÅn
    const donGia = parseFloat(data.DonGia);
    const thanhTien = (donGia * soNgay * (1 + tiLePhuThu)) * heSoKhach;

    return {
        ...data,
        SoNgay: soNgay,
        SoKhach: soLuongKhach,
        TiLePhuThu: tiLePhuThu, 
        HeSoKhach: heSoKhach,
        ThanhTien: Math.round(thanhTien)
    };
};

// API 1: Preview h√≥a ƒë∆°n (ƒê·ªÉ hi·ªán l√™n Modal)
exports.previewHoaDon = async (req, res) => {
    try {
        const bill = await calculateBill(req.params.soPhieu);
        res.json(bill);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
};

// API 2: Thanh to√°n & L∆∞u DB
exports.createAndPay = async (req, res) => {
    const { soPhieu, tienKhachDua } = req.body; // Ch·ªâ c·∫ßn nh·∫≠n ti·ªÅn kh√°ch ƒë∆∞a
    const conn = await db.promise().getConnection();
    
    try {
        await conn.beginTransaction();

        // T√≠nh l·∫°i l·∫ßn cu·ªëi ƒë·ªÉ ch·ªët s·ªë li·ªáu
        const bill = await calculateBill(soPhieu);
        
        // T·∫°o m√£ h√≥a ƒë∆°n
        const soHoaDon = "HD" + Date.now();

        // 1. Insert H√≥a ƒê∆°n
        await conn.query(
            `INSERT INTO hoadon (SoHoaDon, NgayLap, TenKhachHangCoQuan, DiaChi, TriGia, SoPhieu, TrangThaiThanhToan)
             VALUES (?, NOW(), ?, ?, ?, ?, 'DA_THANH_TOAN')`,
            [soHoaDon, bill.TenKhachDaiDien, bill.DiaChi, bill.ThanhTien, soPhieu]
        );

        // 2. Insert Chi Ti·∫øt H√≥a ƒê∆°n
        const maCTHD = uuidv4();
        await conn.query(
            `INSERT INTO ct_hoadon (MaCTHD, SoHoaDon, MaPhong, SoNgayThue, DonGia, SoKhach, KhachNuocNgoai, PhuThu, ThanhTien)
             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,
            [
                maCTHD, 
                soHoaDon, 
                bill.MaPhong, 
                bill.SoNgay, 
                bill.DonGia, 
                bill.SoKhach, 
                bill.HeSoKhach > 1 ? 1 : 0, // 1 l√† c√≥ kh√°ch NN, 0 l√† kh√¥ng
                bill.TiLePhuThu, 
                bill.ThanhTien
            ]
        );

        // 3. Update Phi·∫øu Thu√™ -> ƒê√£ thanh to√°n, set ng√†y tr·∫£ th·ª±c t·∫ø l√† NOW()
        await conn.query(
            "UPDATE phieuthue SET TrangThaiLuuTru = 'DA_THANH_TOAN', NgayDuKienTra = NOW() WHERE SoPhieu = ?", 
            [soPhieu]
        );

        // 4. Update Ph√≤ng -> Tr·ªëng
        await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [bill.MaPhong]);

        await conn.commit();
        res.json({ message: "Thanh to√°n th√†nh c√¥ng!", soHoaDon });

    } catch (err) {
        await conn.rollback();
        res.status(500).json({ message: "L·ªói thanh to√°n: " + err.message });
    } finally {
        conn.release();
    }
};

// API 3: L·∫•y danh s√°ch h√≥a ƒë∆°n
exports.getAllHoaDon = async (req, res) => {
    try {
        const [rows] = await hoadonModel.getAll();
        res.json(rows);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
};

// API 4: L·∫•y chi ti·∫øt h√≥a ƒë∆°n theo S·ªë H√≥a ƒê∆°n
exports.getHoaDonDetail = async (req, res) => {
  try {
    const { soHoaDon } = req.params;
    const [rows] = await hoadonModel.getById(soHoaDon);
    
    if (rows.length === 0) {
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n" });
    }
    
    res.json(rows[0]);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

// API 5: X√≥a h√≥a ƒë∆°n (X√≥a chi ti·∫øt tr∆∞·ªõc -> X√≥a h√≥a ƒë∆°n sau)
exports.deleteHoaDon = async (req, res) => {
    const { soHoaDon } = req.params;
    const conn = await db.promise().getConnection();

    try {
        await conn.beginTransaction();

        // 1. X√≥a Chi Ti·∫øt H√≥a ƒê∆°n tr∆∞·ªõc (Do r√†ng bu·ªôc kh√≥a ngo·∫°i)
        await conn.query("DELETE FROM ct_hoadon WHERE SoHoaDon = ?", [soHoaDon]);

        // 2. X√≥a H√≥a ƒê∆°n
        const [result] = await conn.query("DELETE FROM hoadon WHERE SoHoaDon = ?", [soHoaDon]);

        if (result.affectedRows === 0) {
            // N·∫øu kh√¥ng x√≥a ƒë∆∞·ª£c d√≤ng n√†o (ID kh√¥ng t·ªìn t·∫°i)
            await conn.rollback();
            return res.status(404).json({ message: "H√≥a ƒë∆°n kh√¥ng t·ªìn t·∫°i" });
        }

        await conn.commit();
        res.json({ message: "X√≥a h√≥a ƒë∆°n th√†nh c√¥ng!" });

    } catch (err) {
        await conn.rollback();
        console.error("L·ªói x√≥a h√≥a ƒë∆°n:", err);
        res.status(500).json({ message: "L·ªói server: " + err.message });
    } finally {
        conn.release();
    }
};
```

### backend\controllers\khachhangController.js
```js
const khachhangModel = require("../models/khachhangModel");

exports.getAllCustomers = async (req, res) => {
  try {
    const [rows] = await khachhangModel.getAll();
    res.json(rows);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

exports.updateCustomer = async (req, res) => {
  const { id } = req.params;
  const { HoTen, CMND, SDT, DiaChi, MaLoaiKhach } = req.body;
  try {
    await khachhangModel.update(id, HoTen, CMND, SDT, DiaChi, MaLoaiKhach);
    res.json({ message: "C·∫≠p nh·∫≠t th√†nh c√¥ng!" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

exports.deleteCustomer = async (req, res) => {
  const { id } = req.params;
  try {
    await khachhangModel.delete(id);
    res.json({ message: "X√≥a kh√°ch h√†ng th√†nh c√¥ng!" });
  } catch (err) {
    // --- B·∫ÆT L·ªñI R√ÄNG BU·ªòC KH√ìA NGO·∫†I ---
    if (err.errno === 1451) {
        return res.status(400).json({ 
            message: "‚õî KH√îNG TH·ªÇ X√ìA: Kh√°ch h√†ng n√†y ƒë√£ c√≥ l·ªãch s·ª≠ thu√™ ph√≤ng/h√≥a ƒë∆°n trong h·ªá th·ªëng. B·∫°n ch·ªâ c√≥ th·ªÉ s·ª≠a th√¥ng tin." 
        });
    }
    // C√°c l·ªói kh√°c
    res.status(500).json({ message: "L·ªói Server: " + err.message });
  }
};
```

### backend\controllers\loaikhachController.js
```js
const loaikhachModel = require("../models/loaikhachModel");

exports.getAllLoaiKhach = async (req, res) => {
  try {
    const [rows] = await loaikhachModel.getAll();
    res.json(rows);
  } catch (err) {
    console.error("‚ùå L·ªói l·∫•y lo·∫°i kh√°ch:", err);
    res.status(500).json({ message: "Kh√¥ng l·∫•y ƒë∆∞·ª£c lo·∫°i kh√°ch" });
  }
};

```

### backend\controllers\phieuthueController.js
```js
const phieuThueModel = require("../models/phieuthueModel");
const db = require("../config/db");
const { v4: uuidv4 } = require("uuid");

// 1Ô∏è‚É£ T·∫†O PHI·∫æU
exports.createPhieuThue = async (req, res) => {
  const { MaPhong, NgayBatDauThue, NgayDuKienTra, GhiChu, danhSachKhach } = req.body;
  const conn = await db.promise().getConnection();

  try {
    await conn.beginTransaction();

    // --- B·ªî SUNG: L·∫•y t√™n ph√≤ng hi·ªán t·∫°i tr∆∞·ªõc khi t·∫°o phi·∫øu ---
    const [rooms] = await conn.query("SELECT TenPhong FROM phong WHERE MaPhong = ?", [MaPhong]);
    if (rooms.length === 0) {
        throw new Error("Ph√≤ng kh√¥ng t·ªìn t·∫°i!");
    }
    const tenPhongSnapshot = rooms[0].TenPhong; // ƒê√¢y l√† t√™n ph√≤ng t·∫°i th·ªùi ƒëi·ªÉm t·∫°o
    // ----------------------------------------------------------

    const SoPhieu = "PT" + Date.now();
    
    // S·ª¨A: Truy·ªÅn th√™m tenPhongSnapshot v√†o v·ªã tr√≠ tham s·ªë th·ª© 3
    await phieuThueModel.insertPhieuThue([
        SoPhieu, 
        MaPhong, 
        tenPhongSnapshot, // <--- L∆∞u t√™n ph√≤ng v√†o ƒë√¢y
        NgayBatDauThue, 
        NgayDuKienTra, 
        'DANG_THUE', 
        GhiChu || ''
    ]);

    // Insert Kh√°ch
    for (const k of danhSachKhach) {
      const MaKH = uuidv4();
      await phieuThueModel.insertKhachHang([MaKH, k.HoTen, k.MaLoaiKhach, k.CMND, k.DiaChi, k.SDT]);
      await phieuThueModel.insertCTPhieuThue([SoPhieu, MaKH]);
    }

    // C·∫≠p nh·∫≠t ph√≤ng -> ƒê√£ thu√™
    await conn.query("UPDATE phong SET TinhTrang = 'ƒê√£ thu√™' WHERE MaPhong = ?", [MaPhong]);

    await conn.commit();
    res.json({ message: "T·∫°o phi·∫øu th√†nh c√¥ng (ƒêang thu√™)", SoPhieu });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

// 2Ô∏è‚É£ S·ª¨A PHI·∫æU (Ch·ªâ s·ª≠a Ng√†y tr·∫£, Ghi ch√∫, Th√¥ng tin kh√°ch)
// =======================
exports.updatePhieuThue = async (req, res) => {
  const { soPhieu } = req.params;
  const { NgayDuKienTra, GhiChu, danhSachKhach } = req.body;
  
  try {
    // 1. C·∫≠p nh·∫≠t th√¥ng tin chung c·ªßa phi·∫øu
    await phieuThueModel.updatePhieu(soPhieu, NgayDuKienTra, GhiChu);

    // 2. --- X·ª¨ L√ù X√ìA KH√ÅCH H√ÄNG (M·ªöI) ---
    // L·∫•y danh s√°ch MaKH c·ªßa nh·ªØng ng∆∞·ªùi C√íN L·∫†I trong danh s√°ch (nh·ªØng ng∆∞·ªùi kh√¥ng b·ªã x√≥a)
    const currentMaKHs = danhSachKhach
        .filter(k => k.MaKH) // Ch·ªâ l·∫•y nh·ªØng ng∆∞·ªùi ƒë√£ c√≥ MaKH (kh√°ch c≈©)
        .map(k => k.MaKH);

    if (currentMaKHs.length > 0) {
        // X√≥a nh·ªØng kh√°ch trong DB m√† KH√îNG n·∫±m trong danh s√°ch g·ª≠i l√™n
        // (Nghƒ©a l√† h·ªç ƒë√£ b·ªã x√≥a ·ªü frontend)
        await db.promise().query(
            `DELETE FROM ct_phieuthue WHERE SoPhieu = ? AND MaKH NOT IN (?)`,
            [soPhieu, currentMaKHs]
        );
    } else {
        // N·∫øu danh s√°ch kh√°ch c≈© r·ªóng (nghƒ©a l√† x√≥a h·∫øt kh√°ch c≈©, ch·ªâ c√≤n kh√°ch m·ªõi ho·∫∑c kh√¥ng c√≤n ai)
        // Th√¨ x√≥a s·∫°ch li√™n k·∫øt c≈© c·ªßa phi·∫øu n√†y ƒëi
        await db.promise().query(
            `DELETE FROM ct_phieuthue WHERE SoPhieu = ?`,
            [soPhieu]
        );
    }

    // 3. --- C·∫¨P NH·∫¨T HO·∫∂C TH√äM M·ªöI ---
    if (danhSachKhach && danhSachKhach.length > 0) {
      for (const k of danhSachKhach) {
        if (k.MaKH) {
           // Kh√°ch c≈© -> C·∫≠p nh·∫≠t th√¥ng tin
           await phieuThueModel.updateKhachHang(k.MaKH, k.HoTen, k.CMND, k.SDT, k.DiaChi, k.MaLoaiKhach);
        } else {
           // Kh√°ch m·ªõi (Ch∆∞a c√≥ MaKH) -> T·∫°o m·ªõi & G·∫Øn v√†o phi·∫øu
           const newMaKH = uuidv4();
           await phieuThueModel.insertKhachHang([newMaKH, k.HoTen, k.MaLoaiKhach, k.CMND, k.DiaChi, k.SDT]);
           await phieuThueModel.insertCTPhieuThue([soPhieu, newMaKH]);
        }
      }
    }
    res.json({ message: "C·∫≠p nh·∫≠t phi·∫øu th√†nh c√¥ng" });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "L·ªói c·∫≠p nh·∫≠t: " + error.message });
  }
};

// 3Ô∏è‚É£ TR·∫¢ PH√íNG (DANG_THUE -> DA_TRA_PHONG, Ph√≤ng -> Tr·ªëng)
exports.checkOut = async (req, res) => {
  const { soPhieu } = req.params;
  const conn = await db.promise().getConnection();
  try {
    await conn.beginTransaction();
    
    // Update phi·∫øu
    await conn.query("UPDATE phieuthue SET TrangThaiLuuTru = 'DA_TRA_PHONG' WHERE SoPhieu = ?", [soPhieu]);
    
    // Update ph√≤ng -> Tr·ªëng
    const [rows] = await conn.query("SELECT MaPhong FROM phieuthue WHERE SoPhieu = ?", [soPhieu]);
    if (rows.length > 0) {
      await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [rows[0].MaPhong]);
    }

    await conn.commit();
    res.json({ message: "Tr·∫£ ph√≤ng th√†nh c√¥ng" });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

// 4Ô∏è‚É£ H·ª¶Y PHI·∫æU (DANG_THUE -> DA_HUY, Ph√≤ng -> Tr·ªëng)
exports.huyPhieu = async (req, res) => {
  const { soPhieu } = req.params;
  const conn = await db.promise().getConnection();
  try {
    await conn.beginTransaction();

    await conn.query("UPDATE phieuthue SET TrangThaiLuuTru = 'DA_HUY' WHERE SoPhieu = ?", [soPhieu]);
    
    const [rows] = await conn.query("SELECT MaPhong FROM phieuthue WHERE SoPhieu = ?", [soPhieu]);
    if (rows.length > 0) {
      await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [rows[0].MaPhong]);
    }

    await conn.commit();
    res.json({ message: "ƒê√£ h·ªßy phi·∫øu" });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

// 5Ô∏è‚É£ X√ìA PHI·∫æU THU√ä
exports.deletePhieu = async (req, res) => {
    const { id } = req.params; // id l√† SoPhieu
    const conn = await db.promise().getConnection(); // L·∫•y connection ƒë·ªÉ d√πng transaction

    try {
        await conn.beginTransaction();

        // 1. X√≥a chi ti·∫øt phi·∫øu thu√™ tr∆∞·ªõc (B·∫£ng con ct_phieuthue)
        await conn.query("DELETE FROM ct_phieuthue WHERE SoPhieu = ?", [id]);

        // 2. X√≥a phi·∫øu thu√™ (B·∫£ng cha phieuthue)
        // N·∫øu phi·∫øu n√†y ƒë√£ c√≥ H√≥a ƒë∆°n, d√≤ng l·ªánh n√†y x·∫Ω g√¢y ra l·ªói Constraint v√† nh·∫£y xu·ªëng catch
        await conn.query("DELETE FROM phieuthue WHERE SoPhieu = ?", [id]);

        await conn.commit();
        res.json({ message: "X√≥a phi·∫øu thu√™ th√†nh c√¥ng!" });

    } catch (err) {
        await conn.rollback(); // Ho√†n t√°c n·∫øu c√≥ l·ªói

        // M√£ l·ªói 1451: Cannot delete or update a parent row: a foreign key constraint fails
        if (err.errno === 1451) {
            return res.status(400).json({ 
                message: "Kh√¥ng th·ªÉ x√≥a: Phi·∫øu thu√™ n√†y ƒê√É C√ì H√ìA ƒê∆†N. Vui l√≤ng x√≥a h√≥a ƒë∆°n tr∆∞·ªõc n·∫øu mu·ªën x√≥a phi·∫øu." 
            });
        }

        console.error(err);
        res.status(500).json({ message: "L·ªói server: " + err.message });
    } finally {
        conn.release(); // Tr·∫£ l·∫°i connection
    }
};


exports.getAllPhieuThue = async (req, res) => {
  try {
    const [rows] = await phieuThueModel.getAll();
    res.json(rows);
  } catch (error) {
    res.status(500).json({ message: "L·ªói server" });
  }
};

```

### backend\controllers\phongController.js
```js
const phongModel = require("../models/phongModel");
const db = require("../config/db");

exports.getAllRooms = async (req, res) => {
  try {
    const [rows] = await phongModel.getAll();
    res.json(rows);
  } catch (err) {
    res.status(500).json({ error: err });
  }
};

// 1Ô∏è‚É£ CREATE: M·∫∑c ƒë·ªãnh TinhTrang l√† 'Tr·ªëng'
exports.createRoom = async (req, res) => {
  const { TenPhong, MaLoaiPhong, GhiChu } = req.body; // B·ªè TinhTrang kh·ªèi req.body

  const soPhong = TenPhong?.match(/\d+/);
  if (!soPhong) return res.status(400).json({ message: "T√™n ph√≤ng ph·∫£i c√≥ s·ªë" });

  const MaPhong = "P" + soPhong[0];

  try {
    const [exist] = await phongModel.findByMaPhong(MaPhong);
    if (exist.length > 0) return res.status(400).json({ message: "Ph√≤ng ƒë√£ t·ªìn t·∫°i" });

    // ‚úÖ FORCE STATUS = 'Tr·ªëng'
    await phongModel.create([MaPhong, TenPhong, MaLoaiPhong, 'Tr·ªëng', GhiChu]);
    res.json({ message: "Th√™m ph√≤ng th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

// 2Ô∏è‚É£ UPDATE: Ch·ªâ s·ª≠a Lo·∫°i v√† Ghi ch√∫
exports.updateRoom = async (req, res) => {
  const { id } = req.params; // id l√† MaPhong
  const { TenPhong, MaLoaiPhong, GhiChu } = req.body; 
  
  try {
    // B∆Ø·ªöC 1: L·∫•y th√¥ng tin c≈© c·ªßa ph√≤ng ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i
    const [rows] = await db.promise().query("SELECT * FROM PHONG WHERE MaPhong = ?", [id]);
    
    if (rows.length === 0) {
        return res.status(404).json({ message: "Ph√≤ng kh√¥ng t·ªìn t·∫°i" });
    }
    const phongCu = rows[0];

    // B∆Ø·ªöC 2: Ki·ªÉm tra logic nghi·ªáp v·ª•
    // N·∫øu ph√≤ng ƒëang c√≥ kh√°ch ('ƒê√£ thu√™'), ki·ªÉm tra xem user c√≥ c·ªë s·ª≠a T√™n ho·∫∑c Lo·∫°i kh√¥ng
    if (phongCu.TinhTrang === 'ƒê√£ thu√™') {
        if (TenPhong !== phongCu.TenPhong) {
            return res.status(400).json({ message: "Ph√≤ng ƒëang c√≥ kh√°ch thu√™, KH√îNG ƒë∆∞·ª£c ƒë·ªïi T√™n ph√≤ng!" });
        }
        if (MaLoaiPhong !== phongCu.MaLoaiPhong) {
             return res.status(400).json({ message: "Ph√≤ng ƒëang c√≥ kh√°ch thu√™, KH√îNG ƒë∆∞·ª£c ƒë·ªïi Lo·∫°i ph√≤ng!" });
        }
    }

    // B∆Ø·ªöC 3: N·∫øu h·ª£p l·ªá (ho·∫∑c ch·ªâ s·ª≠a Ghi ch√∫), ti·∫øn h√†nh Update
    await phongModel.updateInfo(TenPhong, MaLoaiPhong, GhiChu, id);
    res.json({ message: "C·∫≠p nh·∫≠t th√¥ng tin ph√≤ng th√†nh c√¥ng" });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
};

// B·∫£o tr√¨ ph√≤ng
exports.toggleMaintenance = async (req, res) => {
  const { id } = req.params; // id l√† MaPhong
  const { status } = req.body; // 'B·∫£o tr√¨' ho·∫∑c 'Tr·ªëng'

  try {
    await phongModel.updateStatus(status, id);
    res.json({ message: `ƒê√£ chuy·ªÉn ph√≤ng sang tr·∫°ng th√°i: ${status}` });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// Ng∆∞ng / K√≠ch ho·∫°t kinh doanh
exports.toggleBusinessStatus = async (req, res) => {
  const { id } = req.params;
  const { action } = req.body; // 'stop' ho·∫∑c 'active'

  try {
    // --- B∆Ø·ªöC 1: KI·ªÇM TRA TR·∫†NG TH√ÅI HI·ªÜN T·∫†I ---
    const [check] = await db.promise().query("SELECT TinhTrang FROM phong WHERE MaPhong = ?", [id]);
    if (check.length === 0) return res.status(404).json({ message: "Ph√≤ng kh√¥ng t·ªìn t·∫°i" });
    
    const currentStatus = check[0].TinhTrang;

    // N·∫øu mu·ªën Ng∆∞ng kinh doanh m√† ph√≤ng ƒëang c√≥ kh√°ch -> CH·∫∂N
    if (action === 'stop' && currentStatus === 'ƒê√£ thu√™') {
        return res.status(400).json({ message: "Kh√¥ng th·ªÉ ng∆∞ng kinh doanh: Ph√≤ng ƒëang c√≥ kh√°ch thu√™!" });
    }
    // -------------------------------------------------------

    const newStatus = action === 'stop' ? 'Ng∆∞ng kinh doanh' : 'Tr·ªëng';
    await phongModel.updateStatus(newStatus, id);
    res.json({ message: "C·∫≠p nh·∫≠t tr·∫°ng th√°i kinh doanh th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// X√≥a ph√≤ng
exports.deleteRoom = async (req, res) => {
  const { id } = req.params;
  try {
    // --- B∆Ø·ªöC 1: KI·ªÇM TRA TR·∫†NG TH√ÅI  ---
    const [check] = await db.promise().query("SELECT TinhTrang FROM phong WHERE MaPhong = ?", [id]);
    if (check.length > 0 && check[0].TinhTrang === 'ƒê√£ thu√™') {
        return res.status(400).json({ message: "Kh√¥ng th·ªÉ x√≥a: Ph√≤ng ƒëang c√≥ kh√°ch thu√™!" });
    }
    // ------------------------------------------------

    await phongModel.delete(id);
    res.json({ message: "X√≥a ph√≤ng th√†nh c√¥ng" });
  } catch (err) {
    // Check l·ªói kh√≥a ngo·∫°i (n·∫øu ph√≤ng ƒë√£ c√≥ l·ªãch s·ª≠ c≈©)
    if (err.errno === 1451) {
         return res.status(400).json({ message: "Kh√¥ng th·ªÉ x√≥a ph√≤ng ƒë√£ c√≥ l·ªãch s·ª≠ thu√™. H√£y ch·ªçn 'Ng∆∞ng kinh doanh'." });
    }
    res.status(500).json({ error: err.message });
  }
};

exports.getRoomById = async (req, res) => {
  const { id } = req.params; // id ch√≠nh l√† MaPhong (VD: P101)

  try {
    // D√πng l·∫°i h√†m b·∫°n ƒë√£ c√≥ trong model
    const [rows] = await phongModel.findByMaPhong(id);

    if (!rows || rows.length === 0) {
      return res.status(404).json({ message: "Ph√≤ng kh√¥ng t·ªìn t·∫°i" });
    }

    // Tr·∫£ v·ªÅ 1 ph√≤ng
    res.json(rows[0]);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};
```

### backend\controllers\quidinhController.js
```js
const db = require("../config/db");

// --- 1. LO·∫†I PH√íNG ---
exports.getLoaiPhong = async (req, res) => {
    try {
        const [rows] = await db.promise().query("SELECT * FROM loaiphong ORDER BY MaLoaiPhong");
        res.json(rows);
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.createLoaiPhong = async (req, res) => {
    try {
        const { maLoai, tenLoai, donGia } = req.body;
        // --- S·ª¨A: B·ªè c·ªôt DangSuDung trong c√¢u INSERT ---
        await db.promise().query(
            "INSERT INTO loaiphong (MaLoaiPhong, TenLoaiPhong, DonGia) VALUES (?, ?, ?)", 
            [maLoai, tenLoai, donGia]
        );
        res.json({ message: "Th√™m th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: "L·ªói: M√£ lo·∫°i ph√≤ng c√≥ th·ªÉ ƒë√£ t·ªìn t·∫°i" }); }
};

// ... (H√†m updateLoaiPhong, deleteLoaiPhong GI·ªÆ NGUY√äN) ...
exports.updateLoaiPhong = async (req, res) => {
    try {
        const { id } = req.params;
        const { tenLoai, donGia } = req.body;
        await db.promise().query("UPDATE loaiphong SET TenLoaiPhong = ?, DonGia = ? WHERE MaLoaiPhong = ?", [tenLoai, donGia, id]);
        res.json({ message: "C·∫≠p nh·∫≠t th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.deleteLoaiPhong = async (req, res) => {
    try {
        const { id } = req.params;
        const [check] = await db.promise().query("SELECT COUNT(*) as count FROM phong WHERE MaLoaiPhong = ?", [id]);
        if (check[0].count > 0) return res.status(400).json({ message: `Kh√¥ng th·ªÉ x√≥a: ƒêang c√≥ ${check[0].count} ph√≤ng thu·ªôc lo·∫°i n√†y.` });
        await db.promise().query("DELETE FROM loaiphong WHERE MaLoaiPhong = ?", [id]);
        res.json({ message: "X√≥a th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};


// --- 2. LO·∫†I KH√ÅCH ---
exports.getLoaiKhach = async (req, res) => {
    try {
        const [rows] = await db.promise().query("SELECT * FROM loaikhach ORDER BY MaLoaiKhach");
        res.json(rows);
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.createLoaiKhach = async (req, res) => {
    try {
        const { maLoai, tenLoai, heSo } = req.body;
        // --- S·ª¨A: B·ªè c·ªôt DangSuDung ---
        await db.promise().query(
            "INSERT INTO loaikhach (MaLoaiKhach, TenLoaiKhach, HeSoPhuThu) VALUES (?, ?, ?)", 
            [maLoai, tenLoai, heSo]
        );
        res.json({ message: "Th√™m th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: "L·ªói: M√£ lo·∫°i kh√°ch c√≥ th·ªÉ ƒë√£ t·ªìn t·∫°i" }); }
};

// ... (H√†m updateLoaiKhach, deleteLoaiKhach GI·ªÆ NGUY√äN) ...
exports.updateLoaiKhach = async (req, res) => {
    try {
        const { id } = req.params;
        const { tenLoai, heSo } = req.body;
        await db.promise().query("UPDATE loaikhach SET TenLoaiKhach = ?, HeSoPhuThu = ? WHERE MaLoaiKhach = ?", [tenLoai, heSo, id]);
        res.json({ message: "C·∫≠p nh·∫≠t th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.deleteLoaiKhach = async (req, res) => {
    try {
        const { id } = req.params;
        const [check] = await db.promise().query("SELECT COUNT(*) as count FROM khachhang WHERE MaLoaiKhach = ?", [id]);
        if (check[0].count > 0) return res.status(400).json({ message: `Kh√¥ng th·ªÉ x√≥a: ƒêang c√≥ kh√°ch h√†ng thu·ªôc lo·∫°i n√†y.` });
        await db.promise().query("DELETE FROM loaikhach WHERE MaLoaiKhach = ?", [id]);
        res.json({ message: "X√≥a th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};


// --- 3. PH·ª§ THU ---
exports.getPhuThu = async (req, res) => {
    try {
        const [rows] = await db.promise().query("SELECT * FROM tilephuthu ORDER BY KhachThu");
        res.json(rows);
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.updatePhuThu = async (req, res) => {
    try {
        const { khachThu, tiLe } = req.body;
        // --- S·ª¨A: B·ªè c·ªôt DangSuDung ---
        const sql = `INSERT INTO tilephuthu (KhachThu, TiLePhuThu) VALUES (?, ?) 
                     ON DUPLICATE KEY UPDATE TiLePhuThu = ?`;
        await db.promise().query(sql, [khachThu, tiLe, tiLe]);
        res.json({ message: "L∆∞u th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};

exports.deletePhuThu = async (req, res) => {
    try {
        const { id } = req.params;
        await db.promise().query("DELETE FROM tilephuthu WHERE KhachThu = ?", [id]);
        res.json({ message: "X√≥a th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};

// --- 4. THAM S·ªê (GI·ªÆ NGUY√äN) ---
exports.getThamSo = async (req, res) => {
    try { const [rows] = await db.promise().query("SELECT * FROM thamso LIMIT 1"); res.json(rows[0]); } 
    catch (err) { res.status(500).json({ message: err.message }); }
};
exports.updateThamSo = async (req, res) => {
    try {
        const { SoKhachToiDa, SoKhachKhongTinhPhuThu } = req.body;
        await db.promise().query("UPDATE thamso SET SoKhachToiDa = ?, SoKhachKhongTinhPhuThu = ?", [SoKhachToiDa, SoKhachKhongTinhPhuThu]);
        res.json({ message: "C·∫≠p nh·∫≠t tham s·ªë th√†nh c√¥ng" });
    } catch (err) { res.status(500).json({ message: err.message }); }
};
```

### backend\controllers\userController.js
```js
// backend/controllers/userController.js
const bcrypt = require("bcryptjs"); // ho·∫∑c bcrypt ƒë·ªÅu ƒë∆∞·ª£c n·∫øu b·∫°n c√†i bcrypt
const User = require("../models/User");

const ALLOWED_ROLES = ["Admin", "User"];

// GET /api/users
exports.getAllUsers = async (req, res) => {
  try {
    const rows = await User.getAllAsync();
    res.json(rows);
  } catch (err) {
    res.status(500).json({ message: "L·ªói l·∫•y danh s√°ch nh√¢n vi√™n", error: err.message });
  }
};

// POST /api/users
exports.createUser = async (req, res) => {
  try {
    const { username, password, hoTen, vaiTro } = req.body;

    if (!username || !password || !hoTen || !vaiTro) {
      return res.status(400).json({ message: "Thi·∫øu d·ªØ li·ªáu t·∫°o nh√¢n vi√™n" });
    }
    if (!ALLOWED_ROLES.includes(vaiTro)) {
      return res.status(400).json({ message: "Vai tr√≤ kh√¥ng h·ª£p l·ªá (Admin/User)" });
    }

    const exists = await User.existsUsernameAsync(username);
    if (exists) return res.status(409).json({ message: "Username ƒë√£ t·ªìn t·∫°i" });

    const hashed = await bcrypt.hash(password, Number(process.env.SALT_ROUNDS || 10));

    // d√πng callback create theo model c·ªßa b·∫°n
    User.create({ username, password: hashed, hoTen, vaiTro }, (err) => {
      if (err) return res.status(500).json({ message: "L·ªói t·∫°o nh√¢n vi√™n", error: err.message || err });
      res.json({ message: "T·∫°o nh√¢n vi√™n th√†nh c√¥ng" });
    });
  } catch (err) {
    res.status(500).json({ message: "L·ªói t·∫°o nh√¢n vi√™n", error: err.message });
  }
};

// PUT /api/users/:id
exports.updateUser = async (req, res) => {
  try {
    const { id } = req.params;
    const { hoTen, vaiTro } = req.body;

    if (!hoTen || !vaiTro) {
      return res.status(400).json({ message: "Thi·∫øu d·ªØ li·ªáu c·∫≠p nh·∫≠t (hoTen, vaiTro)" });
    }
    if (!ALLOWED_ROLES.includes(vaiTro)) {
      return res.status(400).json({ message: "Vai tr√≤ kh√¥ng h·ª£p l·ªá (Admin/User)" });
    }

    // ch·∫∑n t·ª± h·∫° quy·ªÅn b·∫£n th√¢n
    if (String(req.user?.id) === String(id) && req.user?.vaiTro === "Admin" && vaiTro === "User") {
      return res.status(400).json({ message: "Kh√¥ng ƒë∆∞·ª£c t·ª± h·∫° quy·ªÅn Admin c·ªßa ch√≠nh m√¨nh" });
    }

    const result = await User.updateInfoAsync(id, { hoTen, vaiTro });
    if (!result?.affectedRows) return res.status(404).json({ message: "Nh√¢n vi√™n kh√¥ng t·ªìn t·∫°i" });

    res.json({ message: "C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ message: "L·ªói c·∫≠p nh·∫≠t nh√¢n vi√™n", error: err.message });
  }
};

// DELETE /api/users/:id
exports.deleteUser = async (req, res) => {
  try {
    const { id } = req.params;

    // ch·∫∑n t·ª± x√≥a b·∫£n th√¢n
    if (String(req.user?.id) === String(id)) {
      return res.status(400).json({ message: "Kh√¥ng ƒë∆∞·ª£c t·ª± x√≥a t√†i kho·∫£n ƒëang ƒëƒÉng nh·∫≠p" });
    }

    // ‚úÖ ch·∫∑n x√≥a Admin (n·∫øu b·∫°n mu·ªën)
    const target = await User.findByIdAsync?.(id);
    if (target && (target.VaiTro === "Admin" || target.vaiTro === "Admin")) {
      return res.status(400).json({ message: "Kh√¥ng ƒë∆∞·ª£c x√≥a t√†i kho·∫£n Admin" });
    }

    const result = await User.deleteByIdAsync(id);
    if (!result?.affectedRows) return res.status(404).json({ message: "Nh√¢n vi√™n kh√¥ng t·ªìn t·∫°i" });

    res.json({ message: "X√≥a nh√¢n vi√™n th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ message: "L·ªói x√≥a nh√¢n vi√™n", error: err.message });
  }
};

```

### backend\middleware\authMiddleware.js
```js
// backend/middleware/authMiddleware.js
const jwt = require("jsonwebtoken");

module.exports = (req, res, next) => {
  const header = req.headers["authorization"] || req.headers["Authorization"];
  if (!header) return res.status(401).json({ message: "Thi·∫øu token" });

  const [type, token] = String(header).split(" ");
  if (type !== "Bearer" || !token) {
    return res.status(401).json({ message: "Authorization ph·∫£i d·∫°ng: Bearer <token>" });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);

    // Chu·∫©n h√≥a ƒë·ªÉ roleMiddleware lu√¥n ch·∫°y ƒë√∫ng
    req.user = {
      id: decoded.id ?? decoded.MaNV ?? decoded.userId,
      username: decoded.username ?? decoded.Username,
      hoTen: decoded.hoTen ?? decoded.HoTen,
      vaiTro: decoded.vaiTro ?? decoded.VaiTro,
    };

    return next();
  } catch (err) {
    return res.status(401).json({ message: "Token h·∫øt h·∫°n ho·∫∑c kh√¥ng h·ª£p l·ªá" });
  }
};

```

### backend\middleware\roleMiddleware.js
```js
module.exports = (...allowedRoles) => {
  return (req, res, next) => {
    if (!req.user) {
      return res.status(401).json({ error: "Ch∆∞a ƒëƒÉng nh·∫≠p" });
    }
    if (!allowedRoles.includes(req.user.vaiTro)) {
      return res.status(403).json({ error: "Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p" });
    }
    next();
  };
};

```

### backend\models\hoadonModel.js
```js
const db = require("../config/db");


// --- H√ìA ƒê∆†N MODEL ---
exports.createHoaDon = (data) => {
  const sql = `
    INSERT INTO hoadon (SoHoaDon, NgayLap, TenKhachHangCoQuan, DiaChi, TriGia, SoPhieu, TrangThaiThanhToan)
    VALUES (?, NOW(), ?, ?, ?, ?, 'DA_THANH_TOAN')
  `;
  return db.promise().query(sql, data);
};

// --- CHI TI·∫æT H√ìA ƒê∆†N MODEL ---
exports.createCT_HoaDon = (data) => {
  const sql = `
    INSERT INTO ct_hoadon (MaCTHD, SoHoaDon, MaPhong, SoNgayThue, DonGia, SoKhach, KhachNuocNgoai, PhuThu, ThanhTien)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// --- TRUY V·∫§N H√ìA ƒê∆†N ---
exports.getById = (soHoaDon) => {
  const sql = `
    SELECT 
      hd.SoHoaDon, hd.NgayLap, hd.TenKhachHangCoQuan, hd.DiaChi, hd.TriGia,
      ct.SoNgayThue, ct.DonGia, ct.SoKhach, ct.KhachNuocNgoai, ct.PhuThu, ct.ThanhTien,
      pt.TenPhong_LuuTru, pt.SoPhieu, pt.NgayBatDauThue, pt.NgayDuKienTra,
      lp.TenLoaiPhong -- L·∫•y th√™m t√™n lo·∫°i ph√≤ng ƒë·ªÉ hi·ªÉn th·ªã cho ƒë·∫πp
    FROM hoadon hd
    JOIN ct_hoadon ct ON hd.SoHoaDon = ct.SoHoaDon
    JOIN phieuthue pt ON hd.SoPhieu = pt.SoPhieu
    JOIN phong p ON pt.MaPhong = p.MaPhong
    LEFT JOIN loaiphong lp ON p.MaLoaiPhong = lp.MaLoaiPhong
    WHERE hd.SoHoaDon = ?
  `;
  return db.promise().query(sql, [soHoaDon]);
};

// --- TRUY V·∫§N T·∫§T C·∫¢ H√ìA ƒê∆†N ---
exports.getAll = () => {
  const sql = `
    SELECT hd.*, pt.TenPhong_LuuTru,
      (SELECT kh.SDT FROM khachhang kh JOIN ct_phieuthue ct ON kh.MaKH = ct.MaKH WHERE ct.SoPhieu = hd.SoPhieu LIMIT 1) AS SDT
    FROM hoadon hd
    LEFT JOIN phieuthue pt ON hd.SoPhieu = pt.SoPhieu
    ORDER BY hd.NgayLap DESC
  `;
  return db.promise().query(sql);
};
```

### backend\models\khachhangModel.js
```js
const db = require("../config/db");

exports.getAll = () => {
  // L·∫•y danh s√°ch kh√°ch k√®m t√™n lo·∫°i kh√°ch v√† ƒë·∫øm xem h·ªç ƒëang ƒë·ª©ng t√™n bao nhi√™u phi·∫øu "DANG_THUE"
  const sql = `
    SELECT 
        kh.*, 
        lk.TenLoaiKhach,
        (
            SELECT COUNT(*) 
            FROM ct_phieuthue ct 
            JOIN phieuthue pt ON ct.SoPhieu = pt.SoPhieu 
            WHERE ct.MaKH = kh.MaKH AND pt.TrangThaiLuuTru = 'DANG_THUE'
        ) as DangThueCount
    FROM khachhang kh
    LEFT JOIN loaikhach lk ON kh.MaLoaiKhach = lk.MaLoaiKhach
    ORDER BY kh.HoTen ASC
  `;
  return db.promise().query(sql);
};

exports.update = (maKH, hoTen, cmnd, sdt, diaChi, maLoaiKhach) => {
  const sql = `UPDATE khachhang SET HoTen = ?, CMND = ?, SDT = ?, DiaChi = ?, MaLoaiKhach = ? WHERE MaKH = ?`;
  return db.promise().query(sql, [hoTen, cmnd, sdt, diaChi, maLoaiKhach, maKH]);
};

exports.delete = async (maKH) => {
    // // 1. X√≥a trong ct_phieuthue tr∆∞·ªõc (L·ªãch s·ª≠ l∆∞u tr√∫)
    // await db.promise().query("DELETE FROM ct_phieuthue WHERE MaKH = ?", [maKH]);
    // // 2. X√≥a kh√°ch h√†ng
    return db.promise().query("DELETE FROM khachhang WHERE MaKH = ?", [maKH]);
};
```

### backend\models\loaikhachModel.js
```js
// const db = require("../config/db");

// exports.getAll = () => {
//   const sql = `
//     SELECT MaLoaiKhach, TenLoaiKhach, HeSoPhuThu
//     FROM loaikhach
//   `;
//   return db.promise().query(sql);
// };
const db = require("../config/db");

exports.getAll = () => {
  const sql = "SELECT * FROM loaikhach";
  return db.promise().query(sql);
};

```

### backend\models\phieuthueModel.js
```js
const db = require("../config/db");

/* =========================
   PHI·∫æU THU√ä PH√íNG MODEL
   ========================= */

// 1Ô∏è‚É£ Th√™m kh√°ch h√†ng
exports.insertKhachHang = (data) => {
  const sql = `
    INSERT INTO khachhang 
    (MaKH, HoTen, MaLoaiKhach, CMND, DiaChi, SDT)
    VALUES (?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// 2Ô∏è‚É£ Th√™m phi·∫øu thu√™
exports.insertPhieuThue = (data) => {
  const sql = `
    INSERT INTO phieuthue
    (SoPhieu, MaPhong, TenPhong_LuuTru, NgayBatDauThue, NgayDuKienTra, TrangThaiLuuTru, GhiChu)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// 3Ô∏è‚É£ G·∫Øn kh√°ch v√†o phi·∫øu thu√™
exports.insertCTPhieuThue = (data) => {
  const sql = `
    INSERT INTO ct_phieuthue
    (SoPhieu, MaKH)
    VALUES (?, ?)
  `;
  return db.promise().query(sql, data);
};

// 4Ô∏è‚É£ C·∫≠p nh·∫≠t tr·∫°ng th√°i ph√≤ng
exports.updateTinhTrangPhong = (data) => {
  const sql = `
    UPDATE phong
    SET TinhTrang = ?
    WHERE MaPhong = ?
  `;
  return db.promise().query(sql, data);
};

// 5Ô∏è‚É£ L·∫•y danh s√°ch phi·∫øu thu√™
exports.getAll = () => {
  const sql = `
    SELECT 
      pt.SoPhieu,
      pt.MaPhong,
      COALESCE(pt.TenPhong_LuuTru, p.TenPhong) AS TenPhong,
      pt.NgayBatDauThue,
      pt.NgayDuKienTra,
      pt.TrangThaiLuuTru,
      pt.GhiChu,
      COALESCE(hd.TrangThaiThanhToan, 'CHUA_THANH_TOAN') AS TrangThaiThanhToan,
      kh.HoTen,
      kh.MaKH,
      kh.MaLoaiKhach,
      kh.DiaChi,
      lk.TenLoaiKhach,
      kh.CMND,
      kh.SDT
    FROM phieuthue pt
    JOIN phong p ON pt.MaPhong = p.MaPhong
    JOIN ct_phieuthue ct ON pt.SoPhieu = ct.SoPhieu
    JOIN khachhang kh ON ct.MaKH = kh.MaKH
    JOIN loaikhach lk ON kh.MaLoaiKhach = lk.MaLoaiKhach
    LEFT JOIN hoadon hd ON pt.SoPhieu = hd.SoPhieu 
    ORDER BY pt.NgayBatDauThue DESC
  `;
  return db.promise().query(sql);
};

// 6Ô∏è‚É£ C·∫≠p nh·∫≠t phi·∫øu thu√™
exports.updatePhieu = (soPhieu, ngayDuKienTra, ghiChu) => {
  const sql = `UPDATE phieuthue SET NgayDuKienTra = ?, GhiChu = ? WHERE SoPhieu = ?`;
  return db.promise().query(sql, [ngayDuKienTra, ghiChu, soPhieu]);
};

// 7Ô∏è‚É£ C·∫≠p nh·∫≠t th√¥ng tin kh√°ch h√†ng
exports.updateKhachHang = (maKH, hoTen, cmnd, sdt, diaChi, maLoaiKhach) => {
  const sql = `UPDATE khachhang SET HoTen = ?, CMND = ?, SDT = ?, DiaChi = ?, MaLoaiKhach = ? WHERE MaKH = ?`;
  return db.promise().query(sql, [hoTen, cmnd, sdt, diaChi, maLoaiKhach, maKH]);
};

```

### backend\models\phongModel.js
```js
const db = require("../config/db");

exports.getAll = () => {
  const sql = `
    SELECT 
        p.*, 
        lp.TenLoaiPhong, 
        lp.DonGia,
        pt.NgayBatDauThue,
        pt.NgayDuKienTra,
        (SELECT COUNT(*) FROM phieuthue WHERE MaPhong = p.MaPhong) AS CoLichSu,
        (SELECT kh.HoTen FROM khachhang kh JOIN ct_phieuthue ct ON kh.MaKH = ct.MaKH WHERE ct.SoPhieu = pt.SoPhieu LIMIT 1) AS TenKhach,
        (SELECT kh.SDT FROM khachhang kh JOIN ct_phieuthue ct ON kh.MaKH = ct.MaKH WHERE ct.SoPhieu = pt.SoPhieu LIMIT 1) AS SDTKhach
    FROM PHONG p
    JOIN LOAIPHONG lp ON p.MaLoaiPhong = lp.MaLoaiPhong
    LEFT JOIN PHIEUTHUE pt ON p.MaPhong = pt.MaPhong AND pt.TrangThaiLuuTru = 'DANG_THUE'
  `;
  return db.promise().query(sql);
};

exports.create = (data) => {
  const sql = `
    INSERT INTO PHONG (MaPhong, TenPhong, MaLoaiPhong, TinhTrang, GhiChu)
    VALUES (?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// C·∫≠p nh·∫≠t th√¥ng tin ph√≤ng (kh√¥ng bao g·ªìm t√™n ph√≤ng)
exports.updateInfo = (tenPhong, maLoaiPhong, ghiChu, maPhong) => {
  const sql = `UPDATE PHONG SET TenPhong = ?, MaLoaiPhong = ?, GhiChu = ? WHERE MaPhong = ?`;
  return db.promise().query(sql, [tenPhong, maLoaiPhong, ghiChu, maPhong]);
};

// H√†m ri√™ng ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i (D√πng cho B·∫£o tr√¨)
exports.updateStatus = (tinhTrang, maPhong) => {
  const sql = `UPDATE PHONG SET TinhTrang = ? WHERE MaPhong = ?`;
  return db.promise().query(sql, [tinhTrang, maPhong]);
};

exports.findByMaPhong = (MaPhong) => {
  const sql = `SELECT 1 FROM PHONG WHERE MaPhong = ? LIMIT 1`;
  return db.promise().query(sql, [MaPhong]);
};

exports.delete = (id) => {
  const sql = `DELETE FROM PHONG WHERE MaPhong = ?`;
  return db.promise().query(sql, [id]);
};

```

### backend\models\User.js
```js
// backend/models/User.js
const db = require("../config/db");

const User = {
  // ========== CALLBACK APIs (gi·ªØ t∆∞∆°ng th√≠ch v·ªõi authRoutes hi·ªán t·∫°i) ==========
  findByUsername: (username, callback) => {
    const sql = "SELECT * FROM Users WHERE Username = ?";
    db.query(sql, [username], callback);
  },

  create: (userData, callback) => {
    const sql =
      "INSERT INTO Users (Username, Password, HoTen, VaiTro) VALUES (?, ?, ?, ?)";
    db.query(
      sql,
      [userData.username, userData.password, userData.hoTen, userData.vaiTro],
      callback
    );
  },

  getAll: (callback) => {
    const sql = "SELECT MaNV, Username, HoTen, VaiTro, NgayTao FROM Users";
    db.query(sql, callback);
  },

  // ========== PROMISE APIs (m·ªõi - d√πng cho controllers qu·∫£n l√Ω nh√¢n vi√™n) ==========
  getAllAsync: async () => {
    const [rows] = await db
      .promise()
      .query("SELECT MaNV, Username, HoTen, VaiTro, NgayTao FROM Users");
    return rows;
  },

  findByIdAsync: async (id) => {
    const [rows] = await db
      .promise()
      .query("SELECT MaNV, Username, HoTen, VaiTro, NgayTao FROM Users WHERE MaNV = ?", [id]);
    return rows[0] || null;
  },

  existsUsernameAsync: async (username) => {
    const [rows] = await db
      .promise()
      .query("SELECT 1 FROM Users WHERE Username = ? LIMIT 1", [username]);
    return rows.length > 0;
  },

  updateInfoAsync: async (id, { hoTen, vaiTro }) => {
    const sql = "UPDATE Users SET HoTen = ?, VaiTro = ? WHERE MaNV = ?";
    const [result] = await db.promise().query(sql, [hoTen, vaiTro, id]);
    return result;
  },

  updatePasswordAsync: async (id, hashedPassword) => {
    const sql = "UPDATE Users SET Password = ? WHERE MaNV = ?";
    const [result] = await db.promise().query(sql, [hashedPassword, id]);
    return result;
  },

  deleteByIdAsync: async (id) => {
    const [result] = await db.promise().query("DELETE FROM Users WHERE MaNV = ?", [id]);
    return result;
  },
};

module.exports = User;

```

### backend\routes\authRoutes.js
```js
// backend/routes/authRoutes.js
const express = require("express");
const router = express.Router();
const jwt = require("jsonwebtoken");
const bcrypt = require("bcryptjs");
const db = require("../config/db");

const SALT_ROUNDS = Number(process.env.SALT_ROUNDS || 10);

const isBcryptHash = (s) => typeof s === "string" && /^\$2[aby]\$\d{2}\$/.test(s);

const queryAsync = (sql, params) =>
  new Promise((resolve, reject) => {
    db.query(sql, params, (err, results) => (err ? reject(err) : resolve(results)));
  });

router.post("/login", async (req, res) => {
  try {
    const username = String(req.body?.username || "").trim();
    const password = String(req.body?.password || "");

    if (!username || !password) {
      return res.status(400).json({ message: "Thi·∫øu username/password" });
    }

    const results = await queryAsync("SELECT * FROM users WHERE Username = ? LIMIT 1", [username]);
    if (!results || results.length === 0) {
      return res.status(401).json({ message: "Sai username ho·∫∑c m·∫≠t kh·∫©u" });
    }

    const user = results[0];
    const dbPass = user.Password;

    let ok = false;

    if (isBcryptHash(dbPass)) {
      ok = await bcrypt.compare(password, dbPass);
    } else {
      // ‚úÖ legacy/plaintext -> cho login n·∫øu kh·ªõp, r·ªìi t·ª± hash l·∫°i
      ok = password === String(dbPass || "");
      if (ok) {
        const newHash = await bcrypt.hash(password, SALT_ROUNDS);
        await queryAsync("UPDATE users SET Password = ? WHERE MaNV = ?", [newHash, user.MaNV]);
      }
    }

    if (!ok) return res.status(401).json({ message: "Sai m·∫≠t kh·∫©u" });

    const payload = {
      id: user.MaNV,
      username: user.Username,
      hoTen: user.HoTen,
      vaiTro: user.VaiTro,
    };

    const token = jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: "7d" });

    return res.json({
      token,
      user: payload,
    });
  } catch (err) {
    console.error("LOGIN_ERR:", err);
    return res.status(500).json({ message: "L·ªói ƒëƒÉng nh·∫≠p", error: err.message });
  }
});

module.exports = router;
```

### backend\routes\baocaoRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/baocaoController");
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
router.use(auth, allow("Admin"));

// API: L·∫•y d·ªØ li·ªáu Live ƒë·ªÉ preview
router.get("/doanhthu", controller.getDoanhThuThang); 

// --- API: L∆ØU B√ÅO C√ÅO  ---
router.post("/save", controller.saveReport);          

// --- API: L·∫§Y DANH S√ÅCH B√ÅO C√ÅO ƒê√É L∆ØU ---
router.get("/list", controller.getSavedReportsList);  

// --- API: XEM CHI TI·∫æT 1 B√ÅO C√ÅO ---
router.get("/detail/:id", controller.getReportDetail);

// --- API: X√ìA B√ÅO C√ÅO ---
router.delete("/:id", controller.deleteReport);

module.exports = router;
```

### backend\routes\chatbot.routes.js
```js
const express = require("express");
const router = express.Router();
const { askDatabase } = require("../services/chatbot.service");

router.post("/", async (req, res) => {
  try {
    const { question } = req.body;
    const answer = await askDatabase(question);
    res.json({ answer });
  } catch (err) {
    console.error(err);
    res.status(500).json({ message: "L·ªói chatbot" });
  }
});

module.exports = router;

```

### backend\routes\dashboardRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/dashboardController");
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");

router.get("/stats", auth, allow("Admin","User"), controller.getDashboardStats);

module.exports = router;
```

### backend\routes\hoadonRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/hoadonController");
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
router.use(auth);

// C√°c route cho H√ìA ƒê∆†N

// L·∫•y t·∫•t c·∫£ h√≥a ƒë∆°n
router.get("/", allow("Admin","User"), controller.getAllHoaDon);

// Xem tr∆∞·ªõc h√≥a ƒë∆°n theo s·ªë phi·∫øu thu√™
router.get("/preview/:soPhieu", allow("Admin","User"), controller.previewHoaDon);

// L·∫•y chi ti·∫øt h√≥a ƒë∆°n theo s·ªë h√≥a ƒë∆°n
router.get("/:soHoaDon", allow("Admin","User"), controller.getHoaDonDetail);

// T·∫°o v√† thanh to√°n h√≥a ƒë∆°n
router.post("/pay", allow("Admin","User"), controller.createAndPay);

// X√≥a h√≥a ƒë∆°n
router.delete("/:soHoaDon", allow("Admin"), controller.deleteHoaDon);

module.exports = router;
```

### backend\routes\khachhangRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/khachhangController");
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
router.use(auth);

router.get("/", allow("Admin","User"), controller.getAllCustomers);
router.put("/:id", allow("Admin","User"), controller.updateCustomer);
router.delete("/:id", allow("Admin"), controller.deleteCustomer);

module.exports = router;
```

### backend\routes\loaikhachRoutes.js
```js
const express = require("express");
const router = express.Router();
const loaikhachController = require("../controllers/loaikhachController");

router.get("/", loaikhachController.getAllLoaiKhach);

module.exports = router;

```

### backend\routes\loaiphongRoutes.js
```js
const express = require("express");
const router = express.Router();
const db = require("../config/db");

// GET t·∫•t c·∫£ lo·∫°i ph√≤ng
router.get("/", async (req, res) => {
  try {
    const [rows] = await db
      .promise()
      .query("SELECT MaLoaiPhong, TenLoaiPhong, DonGia FROM loaiphong");

    res.json(rows);
  } catch (err) {
    console.error("‚ùå L·ªói l·∫•y lo·∫°i ph√≤ng:", err);
    res.status(500).json({ message: "L·ªói server" });
  }
});

module.exports = router;

```

### backend\routes\phieuthueRoutes.js
```js
const express = require("express");
const router = express.Router();
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
router.use(auth);

// ‚úÖ Khai b√°o bi·∫øn l√† "controller"
const controller = require("../controllers/phieuthueController");

// L·∫•y danh s√°ch
router.get("/", allow("Admin","User"), controller.getAllPhieuThue);

// T·∫°o m·ªõi
router.post("/", allow("Admin","User"), controller.createPhieuThue);

// C·∫≠p nh·∫≠t (S·ª≠a)
router.put("/:soPhieu", allow("Admin","User"), controller.updatePhieuThue);

// Tr·∫£ ph√≤ng
router.put("/:soPhieu/checkout", allow("Admin","User"), controller.checkOut);

// H·ªßy phi·∫øu
router.put("/:soPhieu/huy", allow("Admin","User"), controller.huyPhieu);

// X√≥a phi·∫øu
router.delete("/:id", allow("Admin"), controller.deletePhieu);

module.exports = router;
```

### backend\routes\phongRoutes.js
```js
const express = require("express");
const router = express.Router();

const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");

const {
  getAllRooms,
  getRoomById,
  createRoom,
  updateRoom,
  deleteRoom,
  toggleMaintenance,
  toggleBusinessStatus,
} = require("../controllers/phongController");

router.use(auth);

router.get("/", allow("Admin", "User"), getAllRooms);
router.get("/:id", allow("Admin", "User"), getRoomById);

router.post("/", allow("Admin"), createRoom);
router.put("/:id", allow("Admin"), updateRoom);
router.delete("/:id", allow("Admin"), deleteRoom);

router.put("/:id/maintenance", allow("Admin"), toggleMaintenance);
router.put("/:id/business", allow("Admin"), toggleBusinessStatus);

module.exports = router;

```

### backend\routes\quidinhRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/quidinhController");
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
router.use(auth, allow("Admin"));

// Lo·∫°i ph√≤ng
router.get("/loaiphong", controller.getLoaiPhong);
router.post("/loaiphong", controller.createLoaiPhong);
router.put("/loaiphong/:id", controller.updateLoaiPhong);
router.delete("/loaiphong/:id", controller.deleteLoaiPhong);

// Lo·∫°i kh√°ch
router.get("/loaikhach", controller.getLoaiKhach);
router.post("/loaikhach", controller.createLoaiKhach);
router.put("/loaikhach/:id", controller.updateLoaiKhach);
router.delete("/loaikhach/:id", controller.deleteLoaiKhach);

// Ph·ª• thu
router.get("/phuthu", controller.getPhuThu);
router.post("/phuthu", controller.updatePhuThu);
router.delete("/phuthu/:id", controller.deletePhuThu);

// Tham s·ªë
router.get("/thamso", controller.getThamSo);
router.put("/thamso", controller.updateThamSo);

module.exports = router;
```

### backend\routes\thamSoRoutes.js
```js
const express = require("express");
const router = express.Router();
const db = require("../config/db");

// L·∫•y s·ªë kh√°ch t·ªëi ƒëa
router.get("/sokhachMax", (req, res) => {
  const sql = "SELECT SoKhachToiDa FROM thamso LIMIT 1";
  db.query(sql, (err, result) => {
    if (err) return res.status(500).json({ message: "L·ªói DB" });

    res.json({ soKhachToiDa: result[0].SoKhachToiDa });
  });
});

module.exports = router;

```

### backend\routes\userRoutes.js
```js
// backend/routes/userRoutes.js
const express = require("express");
const router = express.Router();
const auth = require("../middleware/authMiddleware");
const allow = require("../middleware/roleMiddleware");
const controller = require("../controllers/userController");

router.use(auth, allow("Admin"));

router.get("/", controller.getAllUsers);
router.post("/", controller.createUser);
router.put("/:id", controller.updateUser);
router.delete("/:id", controller.deleteUser);

module.exports = router;
```

### backend\services\api.js
```js
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:9999/api",
});

api.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;

```

### backend\services\chatbot.service.js
```js
require("dotenv").config();
const mysql = require("mysql2/promise");
const OpenAI = require("openai");

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// Pool MySQL READ ONLY
const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER, // chatbot
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 5,
});

/**
 * Ki·ªÉm tra SQL an to√†n (CH·ªà SELECT)
 */
function isSafeSQL(sql) {
  if (!sql) return false;

  const cleaned = sql
    .replace(/```sql/gi, "")
    .replace(/```/g, "")
    .replace(/--.*$/gm, "")
    .trim()
    .toLowerCase();

  // ch·ªâ cho ph√©p SELECT
  if (!cleaned.startsWith("select")) return false;

  // ch·∫∑n c√¢u nguy hi·ªÉm
  const forbidden = /(insert|update|delete|drop|alter|truncate|create)/i;
  return !forbidden.test(cleaned);
}
function isMeaningfulQuestion(text) {
  const cleaned = text.toLowerCase().trim();

  // 1. Qu√° ng·∫Øn
  if (cleaned.length < 3) return false;

  // 2. C√°c pattern linh tinh / small talk
  const smallTalkPatterns = [
    // ti·∫øng Anh
    /^(hi|hello|hey|alo)+$/,
    /^(ok|okay|test)+$/,

    // c∆∞·ªùi
    /^(ha|he|hi)+$/,
    /^(haha|hehe|hihi)+$/,

    // ti·∫øng Vi·ªát x√£ giao
    /^(·ª´|uh|·ªù|∆°|d·∫°|·∫°)+$/,
    /^(ch√†o|xin ch√†o)+$/,
    /^(c·∫£m ∆°n|thanks)+$/,
    /^(v√¢ng|ƒë√∫ng r·ªìi)+$/,

    // k√Ω t·ª± v√¥ nghƒ©a
    /^[a-z]{1,2}$/,
    /^[0-9]{1,2}$/,
    /^.{1,2}$/,
  ];

  if (smallTalkPatterns.some((p) => p.test(cleaned))) {
    return false;
  }

  // 3. Ph·∫£i ch·ª©a √≠t nh·∫•t 1 t·ª´ kh√≥a nghi·ªáp v·ª•
  const businessKeywords = [
    "ph√≤ng",
    "phieu",
    "phi·∫øu",
    "thu√™",
    "tr·∫£",
    "h√≥a ƒë∆°n",
    "ho√° ƒë∆°n",
    "doanh thu",
    "b√°o c√°o",
    "gi√°",
    "lo·∫°i",
    "ƒë·∫∑t",
    "kh√°ch",
    "ng√†y",
    "h√¥m nay",
    "th√°ng",
    "nƒÉm",
  ];

  return businessKeywords.some((kw) => cleaned.includes(kw));
}

async function askDatabase(question) {
  if (!isMeaningfulQuestion(question)) {
    return "üòÑ B·∫°n c·∫ßn h·ªó tr·ª£ th√¥ng tin g√¨ v·ªÅ ph√≤ng, h√≥a ƒë∆°n ho·∫∑c ƒë·∫∑t ph√≤ng kh√¥ng?";
  }
  // 1. AI sinh SQL
  const completion = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    temperature: 0,
    messages: [
      {
        role: "system",
        content: `
B·∫°n l√† AI cho h·ªá th·ªëng qu·∫£n l√Ω kh√°ch s·∫°n.
B·∫°n PH·∫¢I sinh c√¢u l·ªánh SQL SELECT d·ª±a CH√çNH X√ÅC tr√™n schema sau.
TUY·ªÜT ƒê·ªêI kh√¥ng ƒë∆∞·ª£c ƒëo√°n b·∫£ng ho·∫∑c c·ªôt kh√¥ng t·ªìn t·∫°i.

===== DATABASE: quanlykhachsan =====

B·∫£ng phong(
  MaPhong,
  TenPhong,
  MaLoaiPhong,
  TinhTrang
)
TinhTrang g·ªìm:
- 'Tr·ªëng'
- 'ƒê√£ thu√™'
- 'Ng∆∞ng kinh doanh'

B·∫£ng loaiphong(
  MaLoaiPhong,
  TenLoaiPhong,
  DonGia
)

B·∫£ng phieuthue(
  SoPhieu,
  MaPhong,
  NgayBatDauThue,
  NgayDuKienTra,
  TrangThaiLuuTru
)

TrangThaiLuuTru g·ªìm:
- 'DANG_THUE'
- 'DA_TRA_PHONG'
- 'DA_HUY'
- 'DA_THANH_TOAN'

B·∫£ng khachhang(
  MaKH,
  HoTen,
  CMND,
  SDT
)

B·∫£ng hoadon(
  SoHoaDon,
  NgayLap,
  TenKhachHangCoQuan,
  TriGia,
  TrangThaiThanhToan
)

B·∫£ng ct_hoadon(
  SoHoaDon,
  MaPhong,
  SoNgayThue,
  DonGia,
  SoKhach,
  PhuThu,
  ThanhTien
)

B·∫£ng baocao(
  MaBaoCao,
  TenBaoCao,
  Thang,
  Nam
)

B·∫£ng ct_baocao(
  MaBaoCao,
  MaLoaiPhong,
  TenLoaiPhong,
  DoanhThu,
  TiLe
)

===== NGHI·ªÜP V·ª§ ƒê∆Ø·ª¢C PH√âP =====

1. Ph√≤ng tr·ªëng:
- L·∫•y t·ª´ b·∫£ng phong
- ƒêi·ªÅu ki·ªán: TinhTrang = 'Tr·ªëng'

2. Gi√° ph√≤ng:
- Join phong.MaLoaiPhong = loaiphong.MaLoaiPhong

3. Danh s√°ch h√≥a ƒë∆°n:
- L·∫•y t·ª´ b·∫£ng hoadon

4. Doanh thu:
- Doanh thu = SUM(TriGia) t·ª´ b·∫£ng hoadon
- Doanh thu h√¥m nay: NgayLap = CURDATE()
- Doanh thu th√°ng: MONTH(NgayLap) & YEAR(NgayLap)
- Doanh thu nƒÉm: YEAR(NgayLap)

5. B√°o c√°o doanh thu theo lo·∫°i ph√≤ng:
- L·∫•y t·ª´ ct_baocao
- Join v·ªõi baocao qua MaBaoCao
- C√≥ th·ªÉ l·ªçc theo Thang, Nam

===== QUY T·∫ÆC B·∫ÆT BU·ªòC =====
- CH·ªà sinh SQL SELECT
- KH√îNG INSERT / UPDATE / DELETE
- KH√îNG DROP / ALTER / TRUNCATE
- KH√îNG d√πng b·∫£ng ngo√†i schema
- KH√îNG gi·∫£i th√≠ch
- CH·ªà TR·∫¢ V·ªÄ SQL THU·∫¶N

        `,
      },
      {
        role: "user",
        content: question,
      },
    ],
  });

  // üëâ L√ÄM S·∫†CH SQL (QUAN TR·ªåNG)
  let sql = completion.choices[0].message.content;
  sql = sql
    .replace(/```sql/gi, "")
    .replace(/```/g, "")
    .trim();

  // üëâ KI·ªÇM TRA AN TO√ÄN
  if (!isSafeSQL(sql)) {
    return "‚ùå C√¢u h·ªèi kh√¥ng h·ª£p l·ªá ho·∫∑c v∆∞·ª£t quy·ªÅn truy c·∫≠p.";
  }

  // 2. Ch·∫°y SQL
  const [rows] = await pool.query(sql);

  // 3. AI di·ªÖn gi·∫£i k·∫øt qu·∫£
  const explain = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    temperature: 0.3,
    messages: [
      {
        role: "system",
        content: `
B·∫°n l√† nh√¢n vi√™n l·ªÖ t√¢n tr·∫£ l·ªùi qua chatbot.
- Tr·∫£ l·ªùi NG·∫ÆN G·ªåN
- K·∫øt qu·∫£ tr·∫£ v·ªÅ c√≥ ng√†y th√¨ c·ªông th√™m 1 ng√†y (do ch√™nh l·ªách m√∫i gi·ªù)
- Ng√†y th√°ng ƒë·ªãnh d·∫°ng DD/MM/YYYY
- Chia d√≤ng r√µ r√†ng
- KH√îNG d√πng vƒÉn phong email
- KH√îNG k√Ω t√™n
- B·∫°n ch·ªâ tr·∫£ l·ªùi d·ª±a tr√™n D·ªÆ LI·ªÜU ƒë∆∞·ª£c cung c·∫•p.
- N·∫øu c√¢u giao ti·∫øp b√¨nh th∆∞·ªùng th√¨ tr·∫£ l·ªùi l·ªãch s·ª±, th√¢n thi·ªán.
- N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu, b·∫°n n√≥i "R·∫•t ti·∫øc, kh√¥ng t√¨m th·∫•y th√¥ng tin ph√π h·ª£p."
- Ph√π h·ª£p giao di·ªán chat
`,
      },
      {
        role: "user",
        content: `D·ªØ li·ªáu: ${JSON.stringify(
          rows
        )}\nH√£y tr·∫£ l·ªùi kh√°ch b·∫±ng ti·∫øng Vi·ªát.`,
      },
    ],
  });

  return explain.choices[0].message.content;
}

module.exports = { askDatabase };

```

### frontend\eslint.config.js
```js
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

```

### frontend\vite.config.js
```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})

```

### frontend\src\App.jsx
```jsx
// src/App.jsx
import {
  BrowserRouter as Router,
  Routes,
  Route,
  Navigate,
} from "react-router-dom";
import Login from "./pages/Login";
import Dashboard from "./pages/Dashboard";
import RoomManagement from "./pages/RoomManagement";
import Navbar from "./components/Navbar";
import Sidebar from "./components/Sidebar";
import { useState } from "react";
import BookingManagement from "./pages/BookingManagement";
import InvoiceManagement from "./pages/InvoiceManagement";
import RoomSearch from "./pages/RoomSearch";
import ReportManagement from "./pages/ReportManagement";
import Settings from "./pages/Settings";
import CustomerManagement from "./pages/CustomerManagement";
import StaffManagement from "./pages/StaffManagement";
import ChatBot from "./components/ChatBot";

function PrivateLayout({ children }) {
  const token = localStorage.getItem("token");

  if (!token) return <Navigate to="/login" replace />;

  return (
    <div style={styles.app}>
      <Navbar />
      <div style={styles.main}>
        <SidebarWrapper />
        <div style={styles.content}>{children}</div>
      </div>

      {/* ‚úÖ CHATBOT G·∫ÆN ·ªû ƒê√ÇY */}
      <ChatBot />
    </div>
  );
}

function RequireRole({ allow, children }) {
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const role = user?.vaiTro; // 'Admin' | 'User'

  if (!role) return <Navigate to="/login" replace />;

  if (!allow.includes(role)) return <Navigate to="/" replace />;

  return children;
}

function SidebarWrapper() {
  const [activeMenu, setActiveMenu] = useState("dashboard");
  return <Sidebar activeMenu={activeMenu} setActiveMenu={setActiveMenu} />;
}

function App() {
  return (
    <Router>
      <Routes>
        {/* PUBLIC */}
        <Route path="/login" element={<Login />} />

        {/* PRIVATE ROUTES */}
        <Route
          path="/"
          element={
            <PrivateLayout>
              <Dashboard />
            </PrivateLayout>
          }
        />

        <Route
          path="/rooms"
          element={
            <PrivateLayout>
              <RoomManagement />
            </PrivateLayout>
          }
        />

        <Route
          path="/phieuthue"
          element={
            <PrivateLayout>
              <BookingManagement />
            </PrivateLayout>
          }
        />

        <Route
          path="/invoice"
          element={
            <PrivateLayout>
              <InvoiceManagement />
            </PrivateLayout>
          }
        />

        <Route
          path="/room-search"
          element={
            <PrivateLayout>
              <RoomSearch />
            </PrivateLayout>
          }
        />

        <Route
          path="/report"
          element={
            <PrivateLayout>
              <RequireRole allow={["Admin"]}>
                <ReportManagement />
              </RequireRole>
            </PrivateLayout>
          }
        />

        <Route
          path="/settings"
          element={
            <PrivateLayout>
              <RequireRole allow={["Admin"]}>
                <Settings />
              </RequireRole>
            </PrivateLayout>
          }
        />

        <Route
          path="/customers"
          element={
            <PrivateLayout>
              <CustomerManagement />
            </PrivateLayout>
          }
        />

        <Route
          path="/staff"
          element={
            <PrivateLayout>
              <RequireRole allow={["Admin"]}>
                <StaffManagement />
              </RequireRole>
            </PrivateLayout>
          }
        />
      </Routes>
    </Router>
  );
}

const styles = {
  app: {
    display: "flex",
    flexDirection: "column",
    height: "100vh",
  },
  main: {
    display: "flex",
    flex: 1,
    overflow: "hidden",
  },
  content: {
    flex: 1,
    padding: "1rem",
    backgroundColor: "#F5F8FF",
    overflow: "auto",
  },
};

export default App;

```

### frontend\src\main.jsx
```jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

```

### frontend\src\components\ChatBot.jsx
```jsx
import { useState, useRef, useEffect } from "react";
import "./ChatBot.css";

export default function ChatBot() {
  const [messages, setMessages] = useState([
    {
      from: "bot",
      text: "Xin ch√†o qu√Ω kh√°ch üëã T√¥i c√≥ th·ªÉ h·ªó tr·ª£ g√¨ cho b·∫°n?",
    },
  ]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const [isOpen, setIsOpen] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim()) return;

    const userMsg = { from: "user", text: input };
    setMessages((prev) => [...prev, userMsg]);
    setInput("");
    setLoading(true);

    try {
      const res = await fetch("http://localhost:9999/api/chatbot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: input }),
      });
      const data = await res.json();
      setMessages((prev) => [...prev, { from: "bot", text: data.answer }]);
    } catch {
      setMessages((prev) => [
        ...prev,
        { from: "bot", text: "‚ùå H·ªá th·ªëng ƒëang b·∫≠n, vui l√≤ng th·ª≠ l·∫°i." },
      ]);
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      {/* Floating Button */}
      {!isOpen && (
        <button
          className="chatbot-toggle"
          onClick={() => setIsOpen(true)}
          aria-label="M·ªü chat"
        >
          <svg
            width="28"
            height="28"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
          >
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
        </button>
      )}

      {/* Chat Window */}
      {isOpen && (
        <div className="chatbot-container">
          <div className="chatbot-header">
            <div className="chatbot-header-content">
              <div className="chatbot-avatar">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
                </svg>
              </div>
              <div>
                <h3>Tr·ª£ L√Ω Th√¥ng Minh :3</h3>
                <span className="status-indicator">
                  <span className="status-dot"></span>
                  ƒêang ho·∫°t ƒë·ªông
                </span>
              </div>
            </div>
            <button
              className="chatbot-close"
              onClick={() => setIsOpen(false)}
              aria-label="ƒê√≥ng chat"
            >
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
              >
                <path d="M18 6L6 18M6 6l12 12" />
              </svg>
            </button>
          </div>

          <div className="chatbot-messages">
            {messages.map((msg, i) => (
              <div key={i} className={`chatbot-message-wrapper ${msg.from}`}>
                {msg.from === "bot" && (
                  <div className="message-avatar bot-avatar">ü§ñ</div>
                )}
                <div className={`chatbot-message ${msg.from}`}>{msg.text}</div>
                {msg.from === "user" && (
                  <div className="message-avatar user-avatar">üë§</div>
                )}
              </div>
            ))}
            {loading && (
              <div className="chatbot-message-wrapper bot">
                <div className="message-avatar bot-avatar">ü§ñ</div>
                <div className="chatbot-message bot typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>

          <div className="chatbot-input">
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              placeholder="Nh·∫≠p tin nh·∫Øn..."
              onKeyDown={(e) => e.key === "Enter" && sendMessage()}
              disabled={loading}
            />
            <button
              onClick={sendMessage}
              disabled={loading || !input.trim()}
              aria-label="G·ª≠i tin nh·∫Øn"
            >
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
              </svg>
            </button>
          </div>
        </div>
      )}
    </>
  );
}

```

### frontend\src\components\Navbar.jsx
```jsx
import React from "react";

const Navbar = () => {
  // L·∫•y th√¥ng tin user t·ª´ localStorage
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  // Map vai tr√≤ sang ti·∫øng Vi·ªát
  const roleDisplay = {
    Admin: "Qu·∫£n tr·ªã vi√™n",
    QuanLy: "Qu·∫£n l√Ω",
    LeTan: "L·ªÖ t√¢n",
    BanGiamDoc: "Ban gi√°m ƒë·ªëc",
  };

  return (
    <nav style={styles.navbar}>
      <h2 style={styles.title}>üè® Qu·∫£n L√Ω Kh√°ch S·∫°n</h2>

      <div style={styles.userInfo}>
        <span style={styles.userName}>üë§ {user.hoTen || "User"}</span>
        <span style={styles.role}>
          {roleDisplay[user.vaiTro] || user.vaiTro}
        </span>
        <button
          style={styles.logoutBtn}
          onClick={() => {
            if (window.confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?")) {
              localStorage.clear();
              window.location.href = "/login";
            }
          }}
        >
          ƒêƒÉng xu·∫•t
        </button>
      </div>
    </nav>
  );
};

const styles = {
  navbar: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    padding: "1rem 2rem",
    backgroundColor: "#1F2A40",
    color: "white",
  },
  title: {
    margin: 0,
    fontSize: "1.5rem",
  },
  userInfo: {
    display: "flex",
    alignItems: "center",
    gap: "1rem",
  },
  userName: {
    fontWeight: 600,
    fontSize: "0.95rem",
  },
  role: {
    padding: "0.3rem 0.8rem",
    backgroundColor: "rgba(255,255,255,0.2)",
    borderRadius: "6px",
    fontSize: "0.85rem",
  },
  logoutBtn: {
    padding: "0.5rem 1rem",
    backgroundColor: "#FF6B6B",
    color: "white",
    border: "none",
    borderRadius: "6px",
    cursor: "pointer",
    fontWeight: 600,
  },
};

export default Navbar;

```

### frontend\src\components\Sidebar.jsx
```jsx
// src/components/Sidebar.jsx
import React from "react";
import { useNavigate } from "react-router-dom";

const Sidebar = ({ activeMenu, setActiveMenu }) => {
  const navigate = useNavigate();

  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const role = user?.vaiTro; // 'Admin' | 'User'
  const isAdmin = role === "Admin";

  const menuItems = [
    { id: "dashboard", icon: "üìä", label: "T·ªïng quan", path: "/" },
    { id: "room-search", icon: "üîç", label: "Tra c·ª©u ph√≤ng", path: "/room-search" },
    { id: "rooms", icon: "üõèÔ∏è", label: "Danh m·ª•c ph√≤ng", path: "/rooms" },
    { id: "booking", icon: "üìù", label: "Thu√™ ph√≤ng", path: "/phieuthue" },
    { id: "customers", icon: "üë•", label: "Kh√°ch h√†ng", path: "/customers" },
    { id: "invoice", icon: "üíµ", label: "H√≥a ƒë∆°n", path: "/invoice" },

    ...(isAdmin
      ? [
          { id: "staff", icon: "üßë‚Äçüíº", label: "Qu·∫£n l√Ω nh√¢n vi√™n", path: "/staff" },
          { id: "report", icon: "üìà", label: "B√°o c√°o doanh thu", path: "/report" },
          { id: "settings", icon: "‚öôÔ∏è", label: "Qui ƒë·ªãnh", path: "/settings" },
        ]
      : []),
  ];

  return (
    <div style={styles.sidebar}>
      {menuItems.map((item) => (
        <div
          key={item.id}
          style={{
            ...styles.menuItem,
            backgroundColor: activeMenu === item.id ? "#3A7DFF" : "transparent",
          }}
          onClick={() => {
            setActiveMenu(item.id);
            navigate(item.path); // üëâ ƒëi·ªÅu h∆∞·ªõng route
          }}
        >
          <span style={styles.icon}>{item.icon}</span>
          <span>{item.label}</span>
        </div>
      ))}
    </div>
  );
};

const styles = {
  sidebar: {
    width: "250px",
    backgroundColor: "#1F2A40",
    color: "white",
    minHeight: "100vh",
    padding: "1rem 0",
  },
  menuItem: {
    display: "flex",
    alignItems: "center",
    padding: "1rem 1.5rem",
    cursor: "pointer",
    borderRadius: "8px",
    margin: "0.3rem 0.5rem",
    transition: "0.3s",
  },
  icon: {
    marginRight: "1rem",
    fontSize: "1.2rem",
  },
};

export default Sidebar;

```

### frontend\src\pages\BookingManagement.jsx
```jsx
//frontend/src/pages/BookingManagement.jsx
import React, { useEffect, useState } from "react";
import api from "../services/api";

/* =====================
   STATE M·∫™U
===================== */
const emptyForm = {
  MaPhong: "",
  NgayBatDauThue: "",
  NgayDuKienTra: "",
  GhiChu: "",
};

const emptyKhach = {
  HoTen: "",
  MaLoaiKhach: "",
  CMND: "",
  DiaChi: "",
  SDT: "",
};

const BookingManagement = () => {
  // ‚úÖ ROLE CHECK (·∫©n n√∫t theo vai tr√≤)
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const isAdmin = user?.vaiTro === "Admin";

  // --- STATE ---
  const [bookings, setBookings] = useState([]);
  const [rooms, setRooms] = useState([]);
  const [guestTypes, setGuestTypes] = useState([]);
  const [soKhachToiDa, setSoKhachToiDa] = useState(1);

  // B·ªô l·ªçc Tab
  const [filterStatus, setFilterStatus] = useState("ALL");
  // B·ªô l·ªçc T√¨m ki·∫øm
  const [searchTerm, setSearchTerm] = useState("");

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalMode, setModalMode] = useState("create");
  const [loading, setLoading] = useState(false);

  const [form, setForm] = useState(emptyForm);
  const [khachList, setKhachList] = useState([{ ...emptyKhach }]);
  const [selectedPhieu, setSelectedPhieu] = useState(null);

  // B·ªô l·ªçc Ng√†y
  const [filterDateFrom, setFilterDateFrom] = useState("");
  const [filterDateTo, setFilterDateTo] = useState("");

  // L∆∞u s·ªë l∆∞·ª£ng kh√°ch l√∫c m·ªõi m·ªü form
  const [initialGuestCount, setInitialGuestCount] = useState(0);

  // H√≥a ƒë∆°n
  const [isCheckoutModalOpen, setIsCheckoutModalOpen] = useState(false);
  const [billPreview, setBillPreview] = useState(null);
  const [tienKhachDua, setTienKhachDua] = useState("");

  /* =====================
      LOAD DATA
  ===================== */
  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      const [bRes, rRes, gRes, maxRes] = await Promise.all([
        api.get("/phieuthue"),
        api.get("/phong"),
        api.get("/loaikhach"),
        api.get("/thamso/sokhachMax"),
      ]);
      setBookings(bRes.data);
      setRooms(rRes.data.filter((r) => r.TinhTrang === "Tr·ªëng"));
      setGuestTypes(gRes.data);
      setSoKhachToiDa(maxRes.data.soKhachToiDa);
    } catch (error) {
      console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error);
    }
  };

  const formatInputDate = (dateStr) => {
    if (!dateStr) return "";
    const d = new Date(dateStr);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    return `${year}-${month}-${day}`;
  };

  /* =====================
      HELPER X·ª¨ L√ù D·ªÆ LI·ªÜU & L·ªåC
  ===================== */
  const processBookings = () => {
    // 1. GOM NH√ìM D·ªÆ LI·ªÜU
    const map = {};
    bookings.forEach((b) => {
      if (!map[b.SoPhieu]) {
        map[b.SoPhieu] = {
          ...b,
          khachListDetail: [
            {
              MaKH: b.MaKH,
              HoTen: b.HoTen,
              CMND: b.CMND,
              SDT: b.SDT,
              DiaChi: b.DiaChi,
              MaLoaiKhach: b.MaLoaiKhach || "",
            },
          ],
          khachListNames: [b.HoTen],
        };
      } else {
        if (!map[b.SoPhieu].khachListDetail.find((k) => k.MaKH === b.MaKH)) {
          map[b.SoPhieu].khachListDetail.push({
            MaKH: b.MaKH,
            HoTen: b.HoTen,
            CMND: b.CMND,
            SDT: b.SDT,
            DiaChi: b.DiaChi,
            MaLoaiKhach: b.MaLoaiKhach || "",
          });
          map[b.SoPhieu].khachListNames.push(b.HoTen);
        }
      }
    });

    let result = Object.values(map);

    // 2. S·∫ÆP X·∫æP
    result.sort((a, b) => new Date(b.NgayBatDauThue) - new Date(a.NgayBatDauThue));

    // 3. L·ªåC: T√åM KI·∫æM
    if (searchTerm) {
      const lowerTerm = searchTerm.toLowerCase();
      result = result.filter(
        (b) =>
          String(b.SoPhieu).toLowerCase().includes(lowerTerm) ||
          String(b.TenPhong).toLowerCase().includes(lowerTerm) ||
          b.khachListNames.some((name) => String(name).toLowerCase().includes(lowerTerm))
      );
    }

    // 4. L·ªåC: THEO TAB
    if (filterStatus === "DANG_THUE") {
      result = result.filter((b) => b.TrangThaiLuuTru === "DANG_THUE");
    } else if (filterStatus === "DA_TRA_PHONG") {
      result = result.filter(
        (b) => b.TrangThaiLuuTru === "DA_TRA_PHONG" || b.TrangThaiLuuTru === "DA_THANH_TOAN"
      );
    } else if (filterStatus === "DA_HUY") {
      result = result.filter((b) => b.TrangThaiLuuTru === "DA_HUY");
    }

    // 5. L·ªåC: THEO NG√ÄY
    if (filterDateFrom) {
      result = result.filter((b) => formatInputDate(b.NgayBatDauThue) >= filterDateFrom);
    }
    if (filterDateTo) {
      result = result.filter((b) => formatInputDate(b.NgayBatDauThue) <= filterDateTo);
    }

    return result;
  };

  const formatDate = (dateStr) => {
    if (!dateStr) return "";
    const date = new Date(dateStr);
    const day = String(date.getDate()).padStart(2, "0");
    const month = String(date.getMonth() + 1).padStart(2, "0");
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
  };

  const renderTrangThai = (trangThai) => {
    const statusMap = {
      DANG_THUE: { icon: "üü¢", text: "ƒêang thu√™", color: "#10b981" },
      DA_TRA_PHONG: { icon: "‚úÖ", text: "ƒê√£ tr·∫£ ph√≤ng", color: "#3b82f6" },
      DA_THANH_TOAN: { icon: "üí∞", text: "ƒê√£ thanh to√°n", color: "#2563eb" },
      DA_HUY: { icon: "üî¥", text: "ƒê√£ h·ªßy", color: "#ef4444" },
    };
    const status = statusMap[trangThai] || statusMap.DANG_THUE;

    return (
      <span
        style={{
          ...styles.statusBadge,
          background: `${status.color}20`,
          color: status.color,
          border: `1px solid ${status.color}40`,
        }}
      >
        {status.icon} {status.text}
      </span>
    );
  };

  /* =====================
      HANDLER MODAL & FORM
  ===================== */
  const openModalCreate = () => {
    setModalMode("create");
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const day = String(today.getDate()).padStart(2, "0");
    const todayStr = `${year}-${month}-${day}`;

    setForm({
      ...emptyForm,
      NgayBatDauThue: todayStr,
    });
    setKhachList([{ ...emptyKhach }]);
    setIsModalOpen(true);
  };

  const openModalEdit = (booking) => {
    setModalMode("edit");
    setSelectedPhieu(booking.SoPhieu);

    setForm({
      MaPhong: booking.MaPhong,
      NgayBatDauThue: formatInputDate(booking.NgayBatDauThue),
      NgayDuKienTra: formatInputDate(booking.NgayDuKienTra),
      GhiChu: booking.GhiChu || "",
    });

    const details = booking.khachListDetail.map((k) => ({ ...k }));
    setKhachList(details);
    setInitialGuestCount(details.length);
    setIsModalOpen(true);
  };

  const openModalView = (booking) => {
    setModalMode("view");
    setForm({
      MaPhong: booking.TenPhong,
      NgayBatDauThue: formatInputDate(booking.NgayBatDauThue),
      NgayDuKienTra: formatInputDate(booking.NgayDuKienTra),
      GhiChu: booking.GhiChu || "Kh√¥ng c√≥ ghi ch√∫",
    });
    setKhachList(booking.khachListDetail);
    setIsModalOpen(true);
  };

  const closeModal = () => setIsModalOpen(false);

  const handleFormChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });

  const handleKhachChange = (index, field, value) => {
    const newList = [...khachList];
    newList[index][field] = value;
    setKhachList(newList);
  };

  // ‚úÖ DELETE: ch·ªâ Admin ƒë∆∞·ª£c x√≥a
  const handleDelete = async (soPhieu) => {
    if (!isAdmin) {
      alert("‚ùå B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a phi·∫øu thu√™!");
      return;
    }

    if (
      !window.confirm(
        `‚ö†Ô∏è C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phi·∫øu thu√™ ${soPhieu}?\nD·ªØ li·ªáu kh√°ch h√†ng trong phi·∫øu n√†y c≈©ng s·∫Ω b·ªã x√≥a.`
      )
    ) {
      return;
    }

    try {
      setLoading(true);
      await api.delete(`/phieuthue/${soPhieu}`);
      alert("‚úÖ X√≥a phi·∫øu thu√™ th√†nh c√¥ng!");
      fetchData();
    } catch (error) {
      const msg = error.response?.data?.message || "L·ªói khi x√≥a phi·∫øu.";
      alert("‚ùå " + msg);
    } finally {
      setLoading(false);
    }
  };

  const addKhach = () => {
    if (khachList.length >= soKhachToiDa) return;
    setKhachList([...khachList, { ...emptyKhach }]);
  };

  const removeKhach = (index) => {
    if (khachList.length === 1) return;
    setKhachList(khachList.filter((_, i) => i !== index));
  };

  const handleSubmit = async () => {
    if (modalMode === "view") {
      closeModal();
      return;
    }

    // Validate
    for (let i = 0; i < khachList.length; i++) {
      const k = khachList[i];
      if (!k.HoTen || !k.HoTen.trim()) {
        alert(`‚ùå Kh√°ch h√†ng #${i + 1} ch∆∞a nh·∫≠p t√™n!`);
        return;
      }
      if (!k.MaLoaiKhach) {
        alert(`‚ùå Kh√°ch h√†ng #${i + 1} ch∆∞a ch·ªçn Lo·∫°i kh√°ch!`);
        return;
      }
    }

    const ngayDen = new Date(form.NgayBatDauThue);
    const ngayTra = new Date(form.NgayDuKienTra);

    if (ngayTra <= ngayDen) {
      return alert("‚ùå Ng√†y d·ª± ki·∫øn tr·∫£ ph·∫£i SAU ng√†y b·∫Øt ƒë·∫ßu thu√™!");
    }

    const currentCount = khachList.length;
    if (modalMode === "create") {
      if (currentCount > soKhachToiDa) {
        alert(`‚ùå Quy ƒë·ªãnh hi·ªán t·∫°i ch·ªâ cho ph√©p t·ªëi ƒëa ${soKhachToiDa} kh√°ch/ph√≤ng.`);
        return;
      }
    } else if (modalMode === "edit") {
      if (currentCount > initialGuestCount && currentCount > soKhachToiDa) {
        alert(`‚ùå Kh√¥ng th·ªÉ th√™m ng∆∞·ªùi! Quy ƒë·ªãnh t·ªëi ƒëa ${soKhachToiDa} kh√°ch.`);
        return;
      }
    }

    setLoading(true);
    try {
      if (modalMode === "create") {
        await api.post("/phieuthue", { ...form, danhSachKhach: khachList });
        alert("‚úÖ L·∫≠p phi·∫øu thu√™ th√†nh c√¥ng");
      } else if (modalMode === "edit") {
        await api.put(`/phieuthue/${selectedPhieu}`, {
          NgayDuKienTra: form.NgayDuKienTra,
          GhiChu: form.GhiChu,
          danhSachKhach: khachList,
        });
        alert("‚úÖ C·∫≠p nh·∫≠t phi·∫øu th√†nh c√¥ng");
      }
      closeModal();
      fetchData();
    } catch (err) {
      alert("‚ùå " + (err.response?.data?.message || "L·ªói x·ª≠ l√Ω"));
    } finally {
      setLoading(false);
    }
  };

  const handleAction = async (action, booking) => {
    const msg = `X√°c nh·∫≠n H·ª¶Y phi·∫øu ${booking.SoPhieu}?`;
    if (!window.confirm(msg)) return;
    try {
      await api.put(`/phieuthue/${booking.SoPhieu}/huy`);
      alert("‚úÖ Thao t√°c th√†nh c√¥ng!");
      fetchData();
    } catch (err) {
      alert("‚ùå L·ªói: " + (err.response?.data?.message || err.message));
    }
  };

  const handleCheckoutClick = async (booking) => {
    try {
      const res = await api.get(`/hoadon/preview/${booking.SoPhieu}`);
      setBillPreview(res.data);
      setTienKhachDua("");
      setIsCheckoutModalOpen(true);
    } catch (err) {
      alert("L·ªói t√≠nh ti·ªÅn: " + (err.response?.data?.message || err.message));
    }
  };

  const handleConfirmPayment = async () => {
    if (!billPreview) return;
    const tienDua = Number(tienKhachDua);
    if (tienDua < billPreview.ThanhTien) {
      alert("‚ö†Ô∏è Ti·ªÅn kh√°ch ƒë∆∞a ch∆∞a ƒë·ªß!");
      return;
    }

    try {
      setLoading(true);
      await api.post("/hoadon/pay", {
        soPhieu: billPreview.SoPhieu,
        tienKhachDua: tienDua,
      });
      alert("‚úÖ Thanh to√°n & Tr·∫£ ph√≤ng th√†nh c√¥ng!");
      setIsCheckoutModalOpen(false);
      fetchData();
    } catch (err) {
      alert("‚ùå L·ªói thanh to√°n: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  /* =====================
      RENDER
  ===================== */
  return (
    <div style={styles.wrapper}>
      <div style={styles.container}>
        <div style={styles.header}>
          <div>
            <h1 style={styles.title}>üìã Qu·∫£n l√Ω phi·∫øu thu√™ ph√≤ng</h1>
            <p style={styles.subtitle}>Qu·∫£n l√Ω v√† theo d√µi c√°c phi·∫øu thu√™ ph√≤ng kh√°ch s·∫°n</p>
          </div>
          <button style={styles.addBtn} onClick={openModalCreate}>
            <span style={styles.btnIcon}>+</span>
            <span>T·∫°o phi·∫øu thu√™ m·ªõi</span>
          </button>
        </div>

        {/* TOOLBAR */}
        <div style={{ display: "flex", flexDirection: "column", gap: "15px", marginBottom: "20px" }}>
          {/* Tabs */}
          <div style={{ display: "flex", gap: "10px" }}>
            {[
              { key: "ALL", label: "T·∫•t c·∫£" },
              { key: "DANG_THUE", label: "üü¢ ƒêang ·ªü" },
              { key: "DA_TRA_PHONG", label: "‚úÖ ƒê√£ tr·∫£" },
              { key: "DA_HUY", label: "üî¥ ƒê√£ h·ªßy" },
            ].map((tab) => (
              <button
                key={tab.key}
                onClick={() => setFilterStatus(tab.key)}
                style={{
                  padding: "8px 16px",
                  borderRadius: "8px",
                  border: "none",
                  cursor: "pointer",
                  fontWeight: "600",
                  background: filterStatus === tab.key ? "#3b82f6" : "#fff",
                  color: filterStatus === tab.key ? "#fff" : "#64748b",
                  boxShadow:
                    filterStatus === tab.key
                      ? "0 2px 5px rgba(59, 130, 246, 0.3)"
                      : "0 1px 2px rgba(0,0,0,0.05)",
                  transition: "all 0.2s",
                }}
              >
                {tab.label}
              </button>
            ))}
          </div>

          {/* Date + Search */}
          <div
            style={{
              display: "flex",
              gap: "10px",
              flexWrap: "wrap",
              alignItems: "center",
              background: "#fff",
              padding: "10px",
              borderRadius: "12px",
              boxShadow: "0 2px 5px rgba(0,0,0,0.05)",
            }}
          >
            <div style={{ display: "flex", alignItems: "center", gap: "5px" }}>
              <span style={{ fontSize: "14px", fontWeight: 600, color: "#64748b" }}>T·ª´ ng√†y:</span>
              <input
                type="date"
                value={filterDateFrom}
                onChange={(e) => setFilterDateFrom(e.target.value)}
                style={styles.inputSearch}
              />
            </div>

            <div style={{ display: "flex", alignItems: "center", gap: "5px" }}>
              <span style={{ fontSize: "14px", fontWeight: 600, color: "#64748b" }}>ƒê·∫øn ng√†y:</span>
              <input
                type="date"
                value={filterDateTo}
                onChange={(e) => setFilterDateTo(e.target.value)}
                style={styles.inputSearch}
              />
            </div>

            <div style={{ flex: 1 }} />

            <input
              type="text"
              placeholder="üîç T√¨m phi·∫øu, ph√≤ng, kh√°ch..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              style={{ ...styles.inputSearch, width: "300px" }}
            />

            {(filterDateFrom || filterDateTo || searchTerm) && (
              <button
                onClick={() => {
                  setFilterDateFrom("");
                  setFilterDateTo("");
                  setSearchTerm("");
                }}
                style={{
                  background: "#f1f5f9",
                  border: "none",
                  padding: "8px 12px",
                  borderRadius: "6px",
                  cursor: "pointer",
                  color: "#64748b",
                }}
                title="X√≥a b·ªô l·ªçc"
              >
                üîÑ
              </button>
            )}
          </div>
        </div>

        {/* TABLE */}
        <div style={styles.tableContainer}>
          <table style={styles.table}>
            <thead>
              <tr style={styles.tableHeader}>
                <th style={styles.th}>S·ªë phi·∫øu</th>
                <th style={styles.th}>Ph√≤ng</th>
                <th style={styles.th}>Kh√°ch h√†ng</th>
                <th style={styles.th}>Ng√†y thu√™</th>
                <th style={styles.th}>Ng√†y tr·∫£ d·ª± ki·∫øn</th>
                <th style={styles.th}>Tr·∫°ng th√°i</th>
                <th style={styles.th}>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              {processBookings().map((b, idx) => {
                const trangThai = b.TrangThaiLuuTru || "DANG_THUE";
                const isDangThue = trangThai === "DANG_THUE";

                return (
                  <tr
                    key={b.SoPhieu}
                    style={{
                      ...styles.tableRow,
                      background: idx % 2 === 0 ? "#f8fafc" : "#ffffff",
                    }}
                  >
                    <td style={styles.td}>
                      <span style={styles.badge}>{b.SoPhieu}</span>
                    </td>
                    <td style={styles.td}>
                      <strong style={styles.roomName}>{b.TenPhong}</strong>
                    </td>
                    <td style={styles.td}>
                      <div>
                        {b.khachListNames.map((name, i) => (
                          <div key={i} style={{ marginBottom: 4 }}>
                            {name}
                          </div>
                        ))}
                        <span
                          style={{
                            color: "#94a3b8",
                            fontSize: 12,
                            fontWeight: 600,
                            marginTop: 4,
                            display: "block",
                          }}
                        >
                          ({b.khachListNames.length} kh√°ch)
                        </span>
                      </div>
                    </td>
                    <td style={styles.td}>
                      <span style={styles.date}>{formatDate(b.NgayBatDauThue)}</span>
                    </td>
                    <td style={styles.td}>
                      <span style={styles.date}>{formatDate(b.NgayDuKienTra)}</span>
                    </td>
                    <td style={styles.td}>{renderTrangThai(trangThai)}</td>
                    <td style={styles.tdActions}>
                      <div style={styles.actionButtons}>
                        <button style={styles.actionBtn} onClick={() => openModalView(b)} title="Xem chi ti·∫øt">
                          Xem
                        </button>

                        {isDangThue && (
                          <button style={styles.actionBtn} onClick={() => openModalEdit(b)} title="S·ª≠a phi·∫øu">
                            S·ª≠a
                          </button>
                        )}

                        {isDangThue && (
                          <button
                            style={{
                              ...styles.actionBtn,
                              background: "#dbeafe",
                              color: "#2563eb",
                              borderColor: "#bfdbfe",
                            }}
                            onClick={() => handleCheckoutClick(b)}
                            title="Tr·∫£ ph√≤ng & Thanh to√°n"
                          >
                            üíµ Tr·∫£ ph√≤ng
                          </button>
                        )}

                        {isDangThue && (
                          <button
                            style={{
                              ...styles.actionBtn,
                              background: "#fee2e2",
                              color: "#ef4444",
                              borderColor: "#fecaca",
                            }}
                            onClick={() => handleAction("cancel", b)}
                            title="H·ªßy phi·∫øu"
                          >
                            H·ªßy
                          </button>
                        )}

                        {/* ‚úÖ CH·ªà ADMIN M·ªöI TH·∫§Y N√öT X√ìA */}
                        {!isDangThue && isAdmin && (
                          <button
                            style={{
                              ...styles.actionBtn,
                              borderColor: "#ef4444",
                              color: "#ef4444",
                              background: "#fee2e2",
                            }}
                            onClick={() => handleDelete(b.SoPhieu)}
                            title="X√≥a phi·∫øu thu√™"
                          >
                            üóëÔ∏è X√≥a
                          </button>
                        )}
                      </div>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>

        {/* MODAL EDIT/CREATE/VIEW */}
        {isModalOpen && (
          <div style={styles.overlay} onClick={closeModal}>
            <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
              <div style={styles.modalHeader}>
                <h2 style={styles.modalTitle}>
                  {modalMode === "create" && "‚ú® T·∫°o phi·∫øu thu√™ ph√≤ng m·ªõi"}
                  {modalMode === "edit" && "‚úèÔ∏è S·ª≠a th√¥ng tin phi·∫øu thu√™"}
                  {modalMode === "view" && "‚ÑπÔ∏è Chi ti·∫øt phi·∫øu thu√™"}
                </h2>
                <button style={styles.closeBtn} onClick={closeModal}>
                  ‚úï
                </button>
              </div>

              <div style={styles.form}>
                <div style={styles.formGroup}>
                  <label style={styles.label}>Ph√≤ng</label>
                  {modalMode === "create" ? (
                    <select name="MaPhong" onChange={handleFormChange} style={styles.select} value={form.MaPhong}>
                      <option value="">-- Ch·ªçn ph√≤ng tr·ªëng --</option>
                      {rooms.map((r) => (
                        <option key={r.MaPhong} value={r.MaPhong}>
                          üö™ {r.TenPhong}
                        </option>
                      ))}
                    </select>
                  ) : (
                    <input style={{ ...styles.input, background: "#f3f4f6" }} value={form.MaPhong} disabled />
                  )}
                </div>

                <div style={styles.dateGroup}>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>Ng√†y b·∫Øt ƒë·∫ßu thu√™</label>
                    <input
                      type="date"
                      name="NgayBatDauThue"
                      value={form.NgayBatDauThue}
                      onChange={handleFormChange}
                      style={styles.input}
                      disabled={modalMode !== "create"}
                    />
                  </div>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>Ng√†y tr·∫£ d·ª± ki·∫øn</label>
                    <input
                      type="date"
                      name="NgayDuKienTra"
                      value={form.NgayDuKienTra}
                      onChange={handleFormChange}
                      style={styles.input}
                      disabled={modalMode === "view"}
                    />
                  </div>
                </div>

                <div style={styles.formGroup}>
                  <label style={styles.label}>Ghi ch√∫</label>
                  <input
                    type="text"
                    name="GhiChu"
                    value={form.GhiChu}
                    onChange={handleFormChange}
                    style={styles.input}
                    placeholder="Ghi ch√∫ th√™m..."
                    disabled={modalMode === "view"}
                  />
                </div>

                <div style={styles.guestSection}>
                  <div style={styles.guestHeader}>
                    <h4 style={styles.guestTitle}>üë• Danh s√°ch kh√°ch</h4>
                    <span style={styles.guestLimit}>
                      {khachList.length} / {soKhachToiDa} kh√°ch
                    </span>
                  </div>

                  {khachList.map((k, index) => (
                    <div key={index} style={styles.khachBox}>
                      <div style={styles.khachHeader}>
                        <span style={styles.khachNumber}>Kh√°ch #{index + 1}</span>
                        {modalMode !== "view" && khachList.length > 1 && (
                          <button style={styles.removeBtn} onClick={() => removeKhach(index)}>
                            üóëÔ∏è X√≥a
                          </button>
                        )}
                      </div>

                      <div style={styles.khachGrid}>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>H·ªç t√™n *</label>
                          <input
                            placeholder="Nh·∫≠p h·ªç t√™n"
                            value={k.HoTen}
                            onChange={(e) => handleKhachChange(index, "HoTen", e.target.value)}
                            style={styles.input}
                            disabled={modalMode === "view"}
                          />
                        </div>

                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>Lo·∫°i kh√°ch *</label>
                          {modalMode === "create" || modalMode === "edit" ? (
                            <select
                              value={k.MaLoaiKhach}
                              onChange={(e) => handleKhachChange(index, "MaLoaiKhach", e.target.value)}
                              style={styles.select}
                            >
                              <option value="">-- Ch·ªçn lo·∫°i --</option>
                              {guestTypes.map((g) => (
                                <option key={g.MaLoaiKhach} value={g.MaLoaiKhach}>
                                  {g.TenLoaiKhach}
                                </option>
                              ))}
                            </select>
                          ) : (
                            <input
                              style={{ ...styles.input, background: "#f3f4f6" }}
                              value={guestTypes.find((g) => g.MaLoaiKhach === k.MaLoaiKhach)?.TenLoaiKhach || k.MaLoaiKhach}
                              disabled
                            />
                          )}
                        </div>

                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>CCCD/CMND *</label>
                          <input
                            placeholder="S·ªë CCCD"
                            value={k.CMND}
                            onChange={(e) => handleKhachChange(index, "CMND", e.target.value)}
                            style={styles.input}
                            disabled={modalMode === "view"}
                          />
                        </div>

                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>ƒê·ªãa ch·ªâ</label>
                          <input
                            placeholder="ƒê·ªãa ch·ªâ li√™n h·ªá"
                            value={k.DiaChi}
                            onChange={(e) => handleKhachChange(index, "DiaChi", e.target.value)}
                            style={styles.input}
                            disabled={modalMode === "view"}
                          />
                        </div>

                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>S·ªë ƒëi·ªán tho·∫°i</label>
                          <input
                            placeholder="S·ªë ƒëi·ªán tho·∫°i"
                            value={k.SDT}
                            onChange={(e) => handleKhachChange(index, "SDT", e.target.value)}
                            style={styles.input}
                            disabled={modalMode === "view"}
                          />
                        </div>
                      </div>
                    </div>
                  ))}

                  {modalMode !== "view" && (
                    <button
                      onClick={addKhach}
                      disabled={khachList.length >= soKhachToiDa}
                      style={{
                        ...styles.addGuestBtn,
                        ...(khachList.length >= soKhachToiDa ? styles.addGuestBtnDisabled : {}),
                      }}
                    >
                      ‚ûï Th√™m kh√°ch h√†ng
                    </button>
                  )}
                </div>
              </div>

              <div style={styles.actions}>
                <button style={styles.cancelBtn} onClick={closeModal}>
                  {modalMode === "view" ? "ƒê√≥ng" : "H·ªßy b·ªè"}
                </button>
                {modalMode !== "view" && (
                  <button style={styles.submitBtn} onClick={handleSubmit} disabled={loading}>
                    {loading ? "‚è≥ ƒêang l∆∞u..." : "üíæ L∆∞u thay ƒë·ªïi"}
                  </button>
                )}
              </div>
            </div>
          </div>
        )}

        {/* CHECKOUT MODAL */}
        {isCheckoutModalOpen && billPreview && (
          <div style={styles.overlay} onClick={() => setIsCheckoutModalOpen(false)}>
            <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
              <div
                style={{
                  ...styles.modalHeader,
                  background: "#f8fafc",
                  borderBottom: "1px solid #e2e8f0",
                }}
              >
                <h2
                  style={{
                    ...styles.modalTitle,
                    color: "#1e293b",
                    fontSize: "20px",
                    display: "flex",
                    alignItems: "center",
                    gap: "10px",
                  }}
                >
                  üßæ H√≥a ƒê∆°n Thanh To√°n
                </h2>
                <button style={styles.closeBtn} onClick={() => setIsCheckoutModalOpen(false)}>
                  ‚úï
                </button>
              </div>

              <div style={{ padding: "24px" }}>
                <div
                  style={{
                    background: "#fff",
                    borderRadius: "8px",
                    marginBottom: "20px",
                    border: "1px solid #e2e8f0",
                    display: "grid",
                    gridTemplateColumns: "1.5fr 1fr",
                    overflow: "hidden",
                  }}
                >
                  <div style={{ padding: "16px", borderRight: "1px solid #e2e8f0" }}>
                    <div style={{ fontSize: "13px", color: "#64748b", marginBottom: "4px" }}>
                      Ph√≤ng & Lo·∫°i ph√≤ng
                    </div>
                    <div style={{ fontSize: "18px", fontWeight: "bold", color: "#2563eb" }}>
                      {billPreview.TenPhong}
                      <span
                        style={{
                          fontSize: "14px",
                          fontWeight: "normal",
                          color: "#475569",
                          marginLeft: "8px",
                        }}
                      >
                        ({billPreview.TenLoaiPhong})
                      </span>
                    </div>
                    <div style={{ fontSize: "13px", color: "#64748b", marginTop: "8px" }}>Kh√°ch ƒë·∫°i di·ªán</div>
                    <div style={{ fontWeight: "600", color: "#334155" }}>{billPreview.TenKhachDaiDien}</div>
                  </div>
                  <div style={{ padding: "16px", background: "#f8fafc" }}>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "8px" }}>
                      <span style={{ color: "#64748b", fontSize: "13px" }}>S·ªë phi·∫øu:</span>
                      <strong style={{ color: "#334155" }}>{billPreview.SoPhieu}</strong>
                    </div>
                    <div style={{ display: "flex", justifyContent: "space-between" }}>
                      <span style={{ color: "#64748b", fontSize: "13px" }}>Ng√†y l·∫≠p:</span>
                      <strong style={{ color: "#334155" }}>{new Date().toLocaleDateString("vi-VN")}</strong>
                    </div>
                  </div>
                </div>

                <table style={{ width: "100%", marginBottom: "24px", borderCollapse: "collapse", fontSize: "14px" }}>
                  <thead>
                    <tr
                      style={{
                        background: "#f1f5f9",
                        color: "#475569",
                        textTransform: "uppercase",
                        fontSize: "11px",
                        letterSpacing: "0.5px",
                      }}
                    >
                      <th style={{ padding: "12px", textAlign: "left" }}>Kho·∫£n m·ª•c</th>
                      <th style={{ padding: "12px", textAlign: "right" }}>Chi ti·∫øt</th>
                      <th style={{ padding: "12px", textAlign: "right" }}>Th√†nh ti·ªÅn</th>
                    </tr>
                  </thead>
                  <tbody style={{ borderTop: "1px solid #e2e8f0" }}>
                    {(() => {
                      const tienPhong = billPreview.DonGia * billPreview.SoNgay;
                      const tienPhuThu = tienPhong * billPreview.TiLePhuThu;
                      const tienKhachNN = (tienPhong + tienPhuThu) * (billPreview.HeSoKhach - 1);
                      const khachVuot = billPreview.SoKhach - (billPreview.SoKhachKhongTinhPhuThu || 2);

                      return (
                        <>
                          <tr>
                            <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>
                              <strong>Ti·ªÅn thu√™ ph√≤ng</strong>
                              <div style={{ fontSize: "12px", color: "#64748b", marginTop: "2px" }}>
                                ƒê∆°n gi√°: {Number(billPreview.DonGia).toLocaleString()} ƒë/ng√†y
                              </div>
                            </td>
                            <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                              {billPreview.SoNgay} ng√†y
                            </td>
                            <td
                              style={{
                                padding: "12px",
                                textAlign: "right",
                                fontWeight: "bold",
                                color: "#334155",
                                borderBottom: "1px dashed #e2e8f0",
                              }}
                            >
                              {Number(tienPhong).toLocaleString()}
                            </td>
                          </tr>

                          {billPreview.TiLePhuThu > 0 && (
                            <tr style={{ color: "#d97706", background: "#fffbeb" }}>
                              <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>
                                Ph·ª• thu qu√° t·∫£i (v∆∞·ª£t {khachVuot} kh√°ch)
                              </td>
                              <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                                +{billPreview.TiLePhuThu * 100}%
                              </td>
                              <td
                                style={{
                                  padding: "12px",
                                  textAlign: "right",
                                  fontWeight: "bold",
                                  borderBottom: "1px dashed #e2e8f0",
                                }}
                              >
                                {Number(tienPhuThu).toLocaleString()}
                              </td>
                            </tr>
                          )}

                          {billPreview.HeSoKhach > 1 && (
                            <tr style={{ color: "#059669", background: "#f0fdf4" }}>
                              <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>
                                Ph·ª• thu kh√°ch n∆∞·ªõc ngo√†i
                              </td>
                              <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                                <div style={{ fontWeight: "bold" }}>x {Number(billPreview.HeSoKhach - 1)}</div>
                                <div style={{ fontSize: "11px", fontStyle: "italic", opacity: 0.8, marginTop: "2px" }}>
                                  (T√≠nh th√™m {(billPreview.HeSoKhach - 1) * 100}% tr√™n t·ªïng ti·ªÅn ph√≤ng & ph·ª• thu)
                                </div>
                              </td>
                              <td
                                style={{
                                  padding: "12px",
                                  textAlign: "right",
                                  fontWeight: "bold",
                                  borderBottom: "1px dashed #e2e8f0",
                                }}
                              >
                                {Number(tienKhachNN).toLocaleString()}
                              </td>
                            </tr>
                          )}

                          <tr style={{ borderTop: "2px solid #334155", background: "#fff" }}>
                            <td
                              style={{
                                padding: "16px 12px",
                                fontWeight: "bold",
                                fontSize: "15px",
                                color: "#dc2626",
                              }}
                              colSpan={2}
                            >
                              T·ªîNG TI·ªÄN PH·∫¢I TR·∫¢
                            </td>
                            <td
                              style={{
                                padding: "16px 12px",
                                textAlign: "right",
                                fontWeight: "bold",
                                fontSize: "18px",
                                color: "#dc2626",
                              }}
                            >
                              {Number(billPreview.ThanhTien).toLocaleString()} VND
                            </td>
                          </tr>
                        </>
                      );
                    })()}
                  </tbody>
                </table>

                <div
                  style={{
                    background: "#f0f9ff",
                    padding: "20px",
                    borderRadius: "12px",
                    border: "1px solid #bae6fd",
                    marginBottom: "24px",
                  }}
                >
                  <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                    <label style={{ fontSize: "15px", fontWeight: "bold", color: "#0369a1" }}>üíµ KH√ÅCH ƒê∆ØA:</label>

                    <div style={{ position: "relative", width: "200px" }}>
                      <input
                        type="text"
                        autoFocus
                        placeholder="0"
                        style={{
                          width: "100%",
                          padding: "10px 50px 10px 15px",
                          borderRadius: "8px",
                          border: "2px solid #0ea5e9",
                          fontSize: "18px",
                          fontWeight: "bold",
                          textAlign: "right",
                          color: "#0284c7",
                          outline: "none",
                          boxSizing: "border-box",
                          background: "#fff",
                        }}
                        value={tienKhachDua ? Number(tienKhachDua).toLocaleString("en-US") : ""}
                        onChange={(e) => {
                          const rawValue = e.target.value.replace(/,/g, "");
                          if (!isNaN(rawValue)) setTienKhachDua(rawValue);
                        }}
                      />
                      <span
                        style={{
                          position: "absolute",
                          right: "12px",
                          top: "50%",
                          transform: "translateY(-50%)",
                          fontWeight: "bold",
                          color: "#94a3b8",
                          pointerEvents: "none",
                          fontSize: "14px",
                        }}
                      >
                        VND
                      </span>
                    </div>
                  </div>

                  <div
                    style={{
                      marginTop: "15px",
                      paddingTop: "15px",
                      borderTop: "1px dashed #cbd5e1",
                      display: "flex",
                      justifyContent: "space-between",
                      alignItems: "center",
                    }}
                  >
                    <span style={{ fontSize: "14px", fontWeight: "600", color: "#475569" }}>Ti·ªÅn th·ª´a tr·∫£ l·∫°i:</span>
                    <span
                      style={{
                        fontSize: "18px",
                        fontWeight: "bold",
                        color: Number(tienKhachDua) - billPreview.ThanhTien < 0 ? "#ef4444" : "#16a34a",
                      }}
                    >
                      {tienKhachDua ? (Number(tienKhachDua) - billPreview.ThanhTien).toLocaleString() : 0} VND
                    </span>
                  </div>
                </div>

                <div style={{ display: "flex", justifyContent: "flex-end", gap: "12px" }}>
                  <button
                    style={{
                      padding: "10px 20px",
                      background: "#fff",
                      color: "#64748b",
                      border: "1px solid #cbd5e1",
                      borderRadius: "8px",
                      fontWeight: "600",
                      cursor: "pointer",
                      fontSize: "14px",
                    }}
                    onClick={() => setIsCheckoutModalOpen(false)}
                  >
                    H·ªßy b·ªè
                  </button>
                  <button
                    style={{
                      padding: "10px 24px",
                      background: "#2563eb",
                      color: "#fff",
                      border: "none",
                      borderRadius: "8px",
                      fontWeight: "bold",
                      cursor: Number(tienKhachDua) < billPreview.ThanhTien ? "not-allowed" : "pointer",
                      opacity: Number(tienKhachDua) < billPreview.ThanhTien ? 0.6 : 1,
                      boxShadow: "0 4px 6px -1px rgba(37, 99, 235, 0.4)",
                      fontSize: "14px",
                    }}
                    onClick={handleConfirmPayment}
                    disabled={Number(tienKhachDua) < billPreview.ThanhTien}
                  >
                    ‚úÖ Ho√†n th√†nh thanh to√°n
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

/* =====================
          STYLE
===================== */
const styles = {
  wrapper: {
    minHeight: "100vh",
    background: "linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%)",
    padding: "32px 16px",
  },
  container: {
    maxWidth: 1200,
    margin: "0 auto",
  },
  header: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 32,
    background: "rgba(255,255,255,0.95)",
    padding: 24,
    borderRadius: 16,
    boxShadow: "0 4px 20px rgba(0,0,0,0.08)",
  },
  title: {
    margin: 0,
    fontSize: 32,
    fontWeight: 700,
    color: "#2d3748",
  },
  subtitle: {
    margin: "8px 0 0 0",
    color: "#64748b",
    fontSize: 14,
  },
  addBtn: {
    display: "flex",
    alignItems: "center",
    gap: 8,
    padding: "12px 24px",
    background: "#4299e1",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 15,
    fontWeight: 600,
    cursor: "pointer",
    boxShadow: "0 4px 12px rgba(66, 153, 225, 0.3)",
    transition: "all 0.3s ease",
  },
  btnIcon: {
    fontSize: 20,
    fontWeight: 700,
  },
  tableContainer: {
    background: "#fff",
    borderRadius: 16,
    overflow: "hidden",
    boxShadow: "0 4px 20px rgba(0,0,0,0.08)",
  },
  table: {
    width: "100%",
    borderCollapse: "collapse",
  },
  tableHeader: {
    background: "#718096",
  },
  th: {
    padding: "16px 20px",
    textAlign: "left",
    color: "#fff",
    fontWeight: 600,
    fontSize: 14,
    textTransform: "uppercase",
    letterSpacing: "0.5px",
  },
  tableRow: {
    transition: "all 0.2s ease",
    cursor: "pointer",
  },
  td: {
    padding: "16px 20px",
    fontSize: 14,
    color: "#334155",
    borderBottom: "1px solid #e2e8f0",
  },
  badge: {
    background: "#4a5568",
    color: "#fff",
    padding: "4px 12px",
    borderRadius: 20,
    fontSize: 13,
    fontWeight: 600,
  },
  roomName: {
    color: "#2d3748",
    fontWeight: 600,
  },
  date: {
    color: "#64748b",
    fontSize: 13,
  },
  statusBadge: {
    padding: "6px 12px",
    borderRadius: 20,
    fontSize: 12,
    fontWeight: 600,
    display: "inline-block",
    whiteSpace: "nowrap",
  },
  tdActions: {
    padding: "16px 20px",
    fontSize: 14,
    color: "#334155",
    borderBottom: "1px solid #e2e8f0",
  },
  actionButtons: {
    display: "flex",
    gap: 6,
    justifyContent: "center",
    flexWrap: "wrap",
  },
  actionBtn: {
    background: "#fff",
    border: "1px solid #e2e8f0",
    borderRadius: 6,
    padding: "6px 12px",
    fontSize: 13,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    whiteSpace: "nowrap",
  },
  overlay: {
    position: "fixed",
    inset: 0,
    background: "rgba(0,0,0,.6)",
    backdropFilter: "blur(4px)",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    zIndex: 1000,
  },
  modal: {
    background: "#fff",
    borderRadius: 20,
    width: "90%",
    maxWidth: 700,
    maxHeight: "90vh",
    overflowY: "auto",
    boxShadow: "0 20px 60px rgba(0,0,0,0.3)",
  },
  modalHeader: {
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    padding: "24px 28px",
    borderBottom: "2px solid #e2e8f0",
    background: "#f7fafc",
    position: "relative",
  },
  modalTitle: {
    margin: 0,
    fontSize: 24,
    fontWeight: 700,
    color: "#2d3748",
  },
  closeBtn: {
    position: "absolute",
    right: "28px",
    background: "transparent",
    border: "none",
    fontSize: 24,
    color: "#64748b",
    cursor: "pointer",
    width: 32,
    height: 32,
    borderRadius: "50%",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    transition: "all 0.2s ease",
  },
  form: {
    padding: "28px",
  },
  formGroup: {
    marginBottom: 20,
  },
  label: {
    display: "block",
    marginBottom: 8,
    fontSize: 14,
    fontWeight: 600,
    color: "#1e293b",
  },
  labelSmall: {
    display: "block",
    marginBottom: 6,
    fontSize: 13,
    fontWeight: 600,
    color: "#475569",
  },
  input: {
    width: "100%",
    padding: "12px 16px",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    transition: "all 0.2s ease",
    outline: "none",
    boxSizing: "border-box",
  },
  select: {
    width: "100%",
    padding: "12px 16px",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    transition: "all 0.2s ease",
    outline: "none",
    background: "#fff",
    cursor: "pointer",
    boxSizing: "border-box",
  },
  dateGroup: {
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: 16,
  },
  guestSection: {
    marginTop: 24,
    padding: 20,
    background: "#f8fafc",
    borderRadius: 12,
  },
  guestHeader: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 16,
  },
  guestTitle: {
    margin: 0,
    fontSize: 18,
    fontWeight: 700,
    color: "#1e293b",
  },
  guestLimit: {
    background: "#4a5568",
    color: "#fff",
    padding: "4px 12px",
    borderRadius: 20,
    fontSize: 12,
    fontWeight: 600,
  },
  khachBox: {
    background: "#fff",
    border: "2px solid #e2e8f0",
    padding: 20,
    borderRadius: 12,
    marginBottom: 16,
    boxShadow: "0 2px 8px rgba(0,0,0,0.05)",
  },
  khachHeader: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 16,
    paddingBottom: 12,
    borderBottom: "2px solid #e2e8f0",
  },
  khachNumber: {
    fontSize: 14,
    fontWeight: 700,
    color: "#4a5568",
  },
  removeBtn: {
    background: "#e53e3e",
    color: "#fff",
    border: "none",
    padding: "6px 12px",
    borderRadius: 8,
    fontSize: 12,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  khachGrid: {
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: 12,
  },
  addGuestBtn: {
    width: "100%",
    padding: "12px",
    background: "#48bb78",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  addGuestBtnDisabled: {
    background: "#cbd5e1",
    cursor: "not-allowed",
    opacity: 0.6,
  },
  actions: {
    display: "flex",
    justifyContent: "flex-end",
    gap: 12,
    padding: "24px 28px",
    borderTop: "2px solid #e2e8f0",
    background: "#f8fafc",
  },
  cancelBtn: {
    padding: "12px 24px",
    background: "#fff",
    color: "#64748b",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  submitBtn: {
    padding: "12px 24px",
    background: "#4299e1",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    boxShadow: "0 4px 12px rgba(66, 153, 225, 0.3)",
    transition: "all 0.2s ease",
  },
  inputSearch: {
    padding: "8px 12px",
    borderRadius: "6px",
    border: "1px solid #e2e8f0",
    outline: "none",
    fontSize: "14px",
    color: "#334155",
  },
};

export default BookingManagement;

```

### frontend\src\pages\CustomerManagement.jsx
```jsx
//frontend/src/pages/CustomerManagement.jsx
import React, { useState, useEffect, useMemo } from "react";
import api from "../services/api";

const CustomerManagement = () => {
  const user = useMemo(() => JSON.parse(localStorage.getItem("user") || "{}"), []);
  const isAdmin = user?.vaiTro === "Admin";

  const [customers, setCustomers] = useState([]);
  const [customerTypes, setCustomerTypes] = useState([]);
  const [loading, setLoading] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");

  // Modal Edit
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingCustomer, setEditingCustomer] = useState(null);
  const [form, setForm] = useState({});

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const [cusRes, typeRes] = await Promise.all([
        api.get("/khachhang"),
        api.get("/loaikhach"),
      ]);
      setCustomers(cusRes.data || []);
      setCustomerTypes(typeRes.data || []);
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // --- X√ìA: ch·ªâ Admin ---
  const handleDelete = async (customer) => {
    if (!isAdmin) return; // ch·∫∑n an to√†n

    const confirmMsg = `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng: ${customer.HoTen}?`;
    if (!window.confirm(confirmMsg)) return;

    try {
      setLoading(true);
      await api.delete(`/khachhang/${customer.MaKH}`);
      alert("‚úÖ ƒê√£ x√≥a kh√°ch h√†ng th√†nh c√¥ng!");
      fetchData();
    } catch (err) {
      const msg = err.response?.data?.message || "Kh√¥ng th·ªÉ x√≥a kh√°ch h√†ng n√†y.";
      alert(msg);
    } finally {
      setLoading(false);
    }
  };

  // --- S·ª¨A: ch·ªâ Admin ---
  const openEditModal = (cus) => {
    if (!isAdmin) return; // ch·∫∑n an to√†n

    setEditingCustomer(cus);
    setForm({
      HoTen: cus.HoTen,
      CMND: cus.CMND,
      SDT: cus.SDT,
      DiaChi: cus.DiaChi,
      MaLoaiKhach: cus.MaLoaiKhach,
    });
    setIsModalOpen(true);
  };

  const handleUpdate = async () => {
    if (!isAdmin) return; // ch·∫∑n an to√†n
    if (!form.HoTen || !form.CMND) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß t√™n v√† CMND");

    try {
      await api.put(`/khachhang/${editingCustomer.MaKH}`, form);
      alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
      setIsModalOpen(false);
      fetchData();
    } catch (err) {
      alert("‚ùå L·ªói: " + (err.response?.data?.message || err.message));
    }
  };

  // --- FILTER ---
  const filteredCustomers = customers.filter((c) => {
    const term = searchTerm.toLowerCase();
    return (
      (c.HoTen || "").toLowerCase().includes(term) ||
      (c.CMND || "").toLowerCase().includes(term) ||
      (c.SDT && c.SDT.includes(term))
    );
  });

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>üë• Qu·∫£n l√Ω Kh√°ch H√†ng</h1>
          <p style={styles.subtitle}>Danh s√°ch kh√°ch h√†ng ƒë√£ t·ª´ng l∆∞u tr√∫ t·∫°i kh√°ch s·∫°n</p>
        </div>

        <div style={{ position: "relative" }}>
          <input
            type="text"
            placeholder="üîç T√¨m t√™n, CMND, SƒêT..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            style={styles.searchInput}
          />
          {searchTerm && (
            <button onClick={() => setSearchTerm("")} style={styles.clearSearchBtn}>
              ‚úï
            </button>
          )}
        </div>
      </div>

      <div style={styles.tableCard}>
        {loading ? (
          <p style={{ padding: "20px", textAlign: "center" }}>‚è≥ ƒêang t·∫£i...</p>
        ) : (
          <table style={styles.table}>
            <thead>
              <tr style={styles.tableHeader}>
                <th style={styles.th}>H·ªç T√™n</th>
                <th style={styles.th}>Lo·∫°i Kh√°ch</th>
                <th style={styles.th}>CMND/CCCD</th>
                <th style={styles.th}>Li√™n h·ªá</th>
                <th style={{ ...styles.th, textAlign: "center" }}>Tr·∫°ng th√°i</th>

                {/* ‚úÖ ch·ªâ Admin m·ªõi th·∫•y c·ªôt thao t√°c */}
                {isAdmin && <th style={{ ...styles.th, textAlign: "center" }}>Thao t√°c</th>}
              </tr>
            </thead>

            <tbody>
              {filteredCustomers.length === 0 ? (
                <tr>
                  <td
                    colSpan={isAdmin ? 6 : 5}
                    style={{ padding: "30px", textAlign: "center", color: "#64748b" }}
                  >
                    Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng.
                  </td>
                </tr>
              ) : (
                filteredCustomers.map((cus, idx) => (
                  <tr
                    key={cus.MaKH}
                    style={{ ...styles.tr, background: idx % 2 === 0 ? "#f8fafc" : "#ffffff" }}
                  >
                    <td style={{ ...styles.td, fontWeight: "bold", color: "#334155" }}>{cus.HoTen}</td>
                    <td style={styles.td}>
                      <span
                        style={{
                          padding: "4px 10px",
                          borderRadius: "6px",
                          fontSize: "12px",
                          fontWeight: "600",
                          background: cus.MaLoaiKhach === "NN" ? "#dbeafe" : "#f1f5f9",
                          color: cus.MaLoaiKhach === "NN" ? "#1d4ed8" : "#475569",
                        }}
                      >
                        {cus.TenLoaiKhach || cus.MaLoaiKhach}
                      </span>
                    </td>
                    <td style={styles.td}>
                      <span style={styles.codeBadge}>{cus.CMND}</span>
                    </td>
                    <td style={styles.td}>
                      <div style={{ fontSize: "13px" }}>üìû {cus.SDT || "---"}</div>
                      <div style={{ fontSize: "12px", color: "#64748b" }}>üìç {cus.DiaChi || "---"}</div>
                    </td>
                    <td style={{ ...styles.td, textAlign: "center" }}>
                      {cus.DangThueCount > 0 ? (
                        <span style={styles.activeBadge}>üü¢ ƒêang ·ªü ({cus.DangThueCount})</span>
                      ) : (
                        <span style={{ color: "#94a3b8", fontSize: "12px" }}>L·ªãch s·ª≠ c≈©</span>
                      )}
                    </td>

                    {/* ‚úÖ ch·ªâ Admin m·ªõi render n√∫t */}
                    {isAdmin && (
                      <td style={{ ...styles.td, textAlign: "center" }}>
                        <div style={{ display: "flex", justifyContent: "center", gap: "8px" }}>
                          <button style={styles.btnEdit} onClick={() => openEditModal(cus)}>
                            ‚úèÔ∏è S·ª≠a
                          </button>
                          <button style={styles.btnDelete} onClick={() => handleDelete(cus)}>
                            üóëÔ∏è X√≥a
                          </button>
                        </div>
                      </td>
                    )}
                  </tr>
                ))
              )}
            </tbody>
          </table>
        )}
      </div>

      {/* ‚úÖ Modal ch·ªâ Admin m·ªõi ƒë∆∞·ª£c m·ªü (ƒë√£ ch·∫∑n ·ªü openEditModal, nh∆∞ng th√™m l·ªõp b·∫£o v·ªá) */}
      {isAdmin && isModalOpen && (
        <div style={styles.overlay} onClick={() => setIsModalOpen(false)}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <h2 style={styles.modalTitle}>‚úèÔ∏è C·∫≠p nh·∫≠t th√¥ng tin kh√°ch</h2>

            <div style={{ display: "flex", flexDirection: "column", gap: "15px" }}>
              <div style={styles.formGroup}>
                <label style={styles.label}>H·ªç t√™n</label>
                <input
                  style={styles.input}
                  value={form.HoTen || ""}
                  onChange={(e) => setForm({ ...form, HoTen: e.target.value })}
                />
              </div>

              <div style={{ display: "flex", gap: "15px" }}>
                <div style={{ ...styles.formGroup, flex: 1 }}>
                  <label style={styles.label}>CMND/CCCD</label>
                  <input
                    style={styles.input}
                    value={form.CMND || ""}
                    onChange={(e) => setForm({ ...form, CMND: e.target.value })}
                  />
                </div>

                <div style={{ ...styles.formGroup, flex: 1 }}>
                  <label style={styles.label}>Lo·∫°i kh√°ch</label>
                  <select
                    style={styles.select}
                    value={form.MaLoaiKhach || ""}
                    onChange={(e) => setForm({ ...form, MaLoaiKhach: e.target.value })}
                  >
                    {customerTypes.map((t) => (
                      <option key={t.MaLoaiKhach} value={t.MaLoaiKhach}>
                        {t.TenLoaiKhach}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              <div style={styles.formGroup}>
                <label style={styles.label}>S·ªë ƒëi·ªán tho·∫°i</label>
                <input
                  style={styles.input}
                  value={form.SDT || ""}
                  onChange={(e) => setForm({ ...form, SDT: e.target.value })}
                />
              </div>

              <div style={styles.formGroup}>
                <label style={styles.label}>ƒê·ªãa ch·ªâ</label>
                <input
                  style={styles.input}
                  value={form.DiaChi || ""}
                  onChange={(e) => setForm({ ...form, DiaChi: e.target.value })}
                />
              </div>
            </div>

            <div style={styles.modalActions}>
              <button style={styles.cancelBtn} onClick={() => setIsModalOpen(false)}>
                H·ªßy
              </button>
              <button style={styles.saveBtn} onClick={handleUpdate}>
                L∆∞u thay ƒë·ªïi
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

const styles = {
  wrapper: { width: "100%", maxWidth: "1400px", margin: "0 auto", padding: "2rem" },
  headerRow: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "2rem" },
  title: { fontSize: "2rem", fontWeight: 700, color: "#1F2A40", marginBottom: "0.5rem" },
  subtitle: { color: "#64748b", fontSize: "0.95rem" },
  searchInput: { padding: "0.7rem 1rem", borderRadius: "8px", border: "1px solid #e2e8f0", fontSize: "0.95rem", width: "280px", outline: "none" },
  clearSearchBtn: { position: 'absolute', right: '10px', top: '50%', transform: 'translateY(-50%)', background: 'transparent', border: 'none', color: '#94a3b8', cursor: 'pointer', fontWeight: 'bold' },
  tableCard: { background: "white", borderRadius: "16px", boxShadow: "0 4px 6px -1px rgba(0,0,0,0.1)", overflowX: "auto", border: "1px solid #e2e8f0" },
  table: { width: "100%", borderCollapse: "collapse", fontSize: "0.95rem" },
  th: { padding: "16px 24px", backgroundColor: "#f8fafc", borderBottom: "2px solid #e2e8f0", fontWeight: 600, color: "#475569", textAlign: "left", textTransform: "uppercase", fontSize: "0.8rem" },
  tr: { borderBottom: "1px solid #f1f5f9", transition: 'background 0.2s' },
  td: { padding: "16px 24px", verticalAlign: "middle" },
  codeBadge: { fontFamily: 'monospace', background: '#f1f5f9', padding: '2px 6px', borderRadius: '4px', color: '#64748b', fontSize: '0.85rem' },
  activeBadge: { background: '#dcfce7', color: '#166534', padding: '4px 10px', borderRadius: '20px', fontSize: '12px', fontWeight: 'bold' },
  
  btnEdit: { background: "#e0f2fe", color: "#0284c7", border: "1px solid #bae6fd", padding: "6px 12px", borderRadius: "6px", cursor: "pointer", fontSize: "13px", fontWeight: 700 },
  btnDelete: { background: "#fee2e2", color: "#ef4444", border: "1px solid #fecaca", padding: "6px 12px", borderRadius: "6px", cursor: "pointer", fontSize: "13px", fontWeight: 700 },

  overlay: { position: "fixed", inset: 0, backgroundColor: "rgba(0,0,0,0.5)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 999 },
  modal: { width: "100%", maxWidth: "500px", background: "white", padding: "30px", borderRadius: "16px", boxShadow: "0 20px 40px rgba(0,0,0,0.2)" },
  modalTitle: { margin: '0 0 20px 0', fontSize: '1.5rem', color: '#1e293b' },
  formGroup: { marginBottom: '10px' },
  label: { display: 'block', marginBottom: '5px', fontWeight: '600', fontSize: '14px', color: '#334155' },
  input: { width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1', outline: 'none', boxSizing: 'border-box' },
  select: { width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1', outline: 'none', background: 'white' },
  modalActions: { display: 'flex', justifyContent: 'flex-end', gap: '10px', marginTop: '20px' },
  cancelBtn: { padding: '10px 20px', background: '#f1f5f9', border: '1px solid #cbd5e1', borderRadius: '8px', cursor: 'pointer', fontWeight: '600', color: '#64748b' },
  saveBtn: { padding: '10px 20px', background: '#3b82f6', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: '600', color: 'white' }
};

export default CustomerManagement;
```

### frontend\src\pages\Dashboard.jsx
```jsx
import React, { useEffect, useState } from "react";
import api from "../services/api";
import { useNavigate } from "react-router-dom";

const Dashboard = () => {
  const navigate = useNavigate();
  const [stats, setStats] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStats = async () => {
      try {
        const res = await api.get("/dashboard/stats");
        setStats(res.data);
      } catch (err) {
        console.error("L·ªói t·∫£i dashboard:", err);
      } finally {
        setLoading(false);
      }
    };
    fetchStats();
  }, []);

  if (loading) return <div style={{padding: '40px', textAlign: 'center', color: '#64748b'}}>‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ªïng quan...</div>;
  if (!stats) return null;

  // T√≠nh t·ªïng s·ªë ph√≤ng ƒë·ªÉ t√≠nh % cho thanh tr·∫°ng th√°i
  const totalRooms = stats.rooms['Tr·ªëng'] + stats.rooms['ƒê√£ thu√™'] + stats.rooms['B·∫£o tr√¨'] + stats.rooms['Ng∆∞ng kinh doanh'];
  
  // H√†m t√≠nh %
  const getPercent = (val) => totalRooms > 0 ? ((val / totalRooms) * 100).toFixed(1) + "%" : "0%";

  return (
    <div style={styles.wrapper}>
      <h1 style={styles.pageTitle}>üìä T·ªïng quan h·ªá th·ªëng</h1>
      <p style={styles.subTitle}>C·∫≠p nh·∫≠t t√¨nh h√¨nh kinh doanh m·ªõi nh·∫•t h√¥m nay.</p>

      {/* --- PH·∫¶N 1: C√ÅC TH·∫∫ TH·ªêNG K√ä (CARDS) --- */}
      <div style={styles.cardGrid}>
        
        {/* Card 1: Doanh thu th√°ng */}
        <div style={{...styles.statCard, borderLeft: '4px solid #2563eb'}}>
          <div style={styles.cardIconBoxBlue}>üí∞</div>
          <div>
            <p style={styles.cardLabel}>Doanh thu th√°ng n√†y</p>
            <h3 style={{...styles.cardValue, color: '#2563eb'}}>
                {Number(stats.revenue.month).toLocaleString()} ƒë
            </h3>
            <p style={styles.cardSub}>H√¥m nay: <span style={{fontWeight: 'bold'}}>{Number(stats.revenue.today).toLocaleString()} ƒë</span></p>
          </div>
        </div>

        {/* Card 2: Ph√≤ng ƒëang thu√™ */}
        <div style={{...styles.statCard, borderLeft: '4px solid #dc2626'}}>
          <div style={styles.cardIconBoxRed}>üîë</div>
          <div>
            <p style={styles.cardLabel}>Ph√≤ng ƒëang c√≥ kh√°ch</p>
            <h3 style={{...styles.cardValue, color: '#dc2626'}}>
                {stats.rooms['ƒê√£ thu√™']} <span style={styles.unit}>ph√≤ng</span>
            </h3>
            <p style={styles.cardSub}>Chi·∫øm {getPercent(stats.rooms['ƒê√£ thu√™'])} t·ªïng s·ªë ph√≤ng</p>
          </div>
        </div>

        {/* Card 3: Ph√≤ng tr·ªëng */}
        <div style={{...styles.statCard, borderLeft: '4px solid #10b981'}}>
          <div style={styles.cardIconBoxGreen}>üõèÔ∏è</div>
          <div>
            <p style={styles.cardLabel}>Ph√≤ng tr·ªëng hi·ªán t·∫°i</p>
            <h3 style={{...styles.cardValue, color: '#10b981'}}>
                {stats.rooms['Tr·ªëng']} <span style={styles.unit}>ph√≤ng</span>
            </h3>
            <p style={styles.cardSub}>S·∫µn s√†ng ƒë√≥n kh√°ch</p>
          </div>
        </div>

        {/* Card 4: Kh√°ch h√†ng */}
        <div style={{...styles.statCard, borderLeft: '4px solid #f59e0b'}}>
          <div style={styles.cardIconBoxOrange}>üë•</div>
          <div>
            <p style={styles.cardLabel}>T·ªïng kh√°ch h√†ng</p>
            <h3 style={{...styles.cardValue, color: '#d97706'}}>
                {stats.totalCustomers} <span style={styles.unit}>ng∆∞·ªùi</span>
            </h3>
            <p style={styles.cardSub}>ƒê√£ l∆∞u tr·ªØ trong h·ªá th·ªëng</p>
          </div>
        </div>
      </div>

      {/* --- PH·∫¶N 2: CHI TI·∫æT (Chia 2 c·ªôt) --- */}
      <div style={styles.detailGrid}>
        
        {/* C·ªòT TR√ÅI: T√åNH TR·∫†NG PH√íNG (D·∫°ng thanh ti·∫øn tr√¨nh) */}
        <div style={styles.sectionCard}>
            <h3 style={styles.sectionTitle}>üè® T√¨nh tr·∫°ng ph√≤ng ({totalRooms} ph√≤ng)</h3>
            <div style={{marginTop: '20px', display: 'flex', flexDirection: 'column', gap: '20px'}}>
                
                <div style={styles.progressItem}>
                    <div style={styles.progressHeader}>
                        <span style={{color: '#10b981', fontWeight: 'bold'}}>S·∫µn s√†ng ƒë√≥n kh√°ch (Tr·ªëng)</span>
                        <span style={{fontWeight: 'bold'}}>{stats.rooms['Tr·ªëng']} ph√≤ng</span>
                    </div>
                    <div style={styles.progressBarBg}>
                        <div style={{...styles.progressBarFill, width: getPercent(stats.rooms['Tr·ªëng']), background: '#10b981'}}></div>
                    </div>
                </div>

                <div style={styles.progressItem}>
                    <div style={styles.progressHeader}>
                        <span style={{color: '#dc2626', fontWeight: 'bold'}}>ƒêang c√≥ kh√°ch (ƒê√£ thu√™)</span>
                        <span style={{fontWeight: 'bold'}}>{stats.rooms['ƒê√£ thu√™']} ph√≤ng</span>
                    </div>
                    <div style={styles.progressBarBg}>
                        <div style={{...styles.progressBarFill, width: getPercent(stats.rooms['ƒê√£ thu√™']), background: '#dc2626'}}></div>
                    </div>
                </div>

                <div style={styles.progressItem}>
                    <div style={styles.progressHeader}>
                        <span style={{color: '#f59e0b', fontWeight: 'bold'}}>ƒêang b·∫£o tr√¨ / Ng∆∞ng KD</span>
                        <span style={{fontWeight: 'bold'}}>{stats.rooms['B·∫£o tr√¨'] + stats.rooms['Ng∆∞ng kinh doanh']} ph√≤ng</span>
                    </div>
                    <div style={styles.progressBarBg}>
                        <div style={{...styles.progressBarFill, width: getPercent(stats.rooms['B·∫£o tr√¨'] + stats.rooms['Ng∆∞ng kinh doanh']), background: '#f59e0b'}}></div>
                    </div>
                </div>

                <div style={{marginTop: '20px', textAlign: 'center'}}>
                    <button style={styles.btnAction} onClick={() => navigate('/phieuthue')}>
                        üìù L·∫≠p phi·∫øu thu√™ ngay
                    </button>
                </div>
            </div>
        </div>

        {/* C·ªòT PH·∫¢I: H√ìA ƒê∆†N G·∫¶N ƒê√ÇY */}
        <div style={styles.sectionCard}>
            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px'}}>
                <h3 style={styles.sectionTitle}>üßæ H√≥a ƒë∆°n m·ªõi nh·∫•t</h3>
                <button style={styles.linkBtn} onClick={() => navigate('/invoice')}>Xem t·∫•t c·∫£</button>
            </div>
            
            <div style={styles.recentList}>
                {stats.recentInvoices.length === 0 ? (
                    <p style={{textAlign: 'center', color: '#94a3b8', fontStyle: 'italic', padding: '20px'}}>Ch∆∞a c√≥ h√≥a ƒë∆°n n√†o.</p>
                ) : (
                    <table style={{width: '100%', borderCollapse: 'collapse', fontSize: '14px'}}>
                        <thead>
                            <tr style={{textAlign: 'left', color: '#64748b', fontSize: '12px', borderBottom: '1px solid #e2e8f0'}}>
                                <th style={{padding: '8px'}}>S·ªë Hƒê</th>
                                <th style={{padding: '8px'}}>Kh√°ch h√†ng</th>
                                <th style={{padding: '8px', textAlign: 'right'}}>Tr·ªã gi√°</th>
                            </tr>
                        </thead>
                        <tbody>
                            {stats.recentInvoices.map((inv) => (
                                <tr key={inv.SoHoaDon} style={{borderBottom: '1px dashed #f1f5f9'}}>
                                    <td style={{padding: '12px 8px', color: '#334155', fontWeight: 'bold', fontSize: '13px'}}>{inv.SoHoaDon}</td>
                                    <td style={{padding: '12px 8px', color: '#475569'}}>
                                        <div style={{fontWeight: '600'}}>{inv.TenKhachHangCoQuan}</div>
                                        <div style={{fontSize: '11px', color: '#94a3b8'}}>{new Date(inv.NgayLap).toLocaleDateString('vi-VN')}</div>
                                    </td>
                                    <td style={{padding: '12px 8px', textAlign: 'right', fontWeight: 'bold', color: '#2563eb'}}>
                                        {Number(inv.TriGia).toLocaleString()}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                )}
            </div>
        </div>

      </div>
    </div>
  );
};

// --- STYLES ---
const styles = {
  wrapper: { padding: "2rem 3rem", background: "#F5F8FF", minHeight: "100vh" },
  pageTitle: { fontSize: "2rem", fontWeight: "800", color: "#1e293b", margin: 0 },
  subTitle: { color: "#64748b", marginTop: "5px", marginBottom: "30px", fontSize: "1rem" },

  // Grid
  cardGrid: { display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(240px, 1fr))", gap: "20px", marginBottom: "30px" },
  
  // Card
  statCard: { background: "white", padding: "25px", borderRadius: "16px", boxShadow: "0 4px 20px rgba(0,0,0,0.03)", display: "flex", alignItems: "center", gap: "20px", transition: "transform 0.2s" },
  
  // Icons
  cardIconBoxBlue: { width: "50px", height: "50px", borderRadius: "12px", background: "#dbeafe", color: "#2563eb", display: "flex", justifyContent: "center", alignItems: "center", fontSize: "24px" },
  cardIconBoxRed: { width: "50px", height: "50px", borderRadius: "12px", background: "#fee2e2", color: "#dc2626", display: "flex", justifyContent: "center", alignItems: "center", fontSize: "24px" },
  cardIconBoxGreen: { width: "50px", height: "50px", borderRadius: "12px", background: "#d1fae5", color: "#059669", display: "flex", justifyContent: "center", alignItems: "center", fontSize: "24px" },
  cardIconBoxOrange: { width: "50px", height: "50px", borderRadius: "12px", background: "#fef3c7", color: "#d97706", display: "flex", justifyContent: "center", alignItems: "center", fontSize: "24px" },

  cardLabel: { margin: 0, fontSize: "14px", color: "#64748b", fontWeight: "600" },
  cardValue: { margin: "5px 0", fontSize: "24px", fontWeight: "800" },
  unit: { fontSize: "14px", fontWeight: "normal", color: "#94a3b8" },
  cardSub: { margin: 0, fontSize: "12px", color: "#64748b" },

  // Detail Section
  detailGrid: { display: "grid", gridTemplateColumns: "1.5fr 1fr", gap: "25px" },
  sectionCard: { background: "white", padding: "25px", borderRadius: "16px", boxShadow: "0 4px 20px rgba(0,0,0,0.03)", display: 'flex', flexDirection: 'column' },
  sectionTitle: { margin: 0, fontSize: "18px", color: "#1e293b", fontWeight: "700" },

  // Progress Bar
  progressItem: { marginBottom: "10px" },
  progressHeader: { display: "flex", justifyContent: "space-between", marginBottom: "8px", fontSize: "14px", color: "#334155" },
  progressBarBg: { width: "100%", height: "10px", background: "#f1f5f9", borderRadius: "5px", overflow: "hidden" },
  progressBarFill: { height: "100%", borderRadius: "5px", transition: "width 0.5s ease-in-out" },

  btnAction: { padding: "10px 24px", background: "#3b82f6", color: "white", border: "none", borderRadius: "8px", fontWeight: "600", cursor: "pointer", boxShadow: "0 4px 6px rgba(59, 130, 246, 0.3)" },
  linkBtn: { background: 'transparent', border: 'none', color: '#2563eb', cursor: 'pointer', fontWeight: '600', fontSize: '13px' },
  recentList: { marginTop: '10px' }
};

export default Dashboard;
```

### frontend\src\pages\InvoiceManagement.jsx
```jsx
//frontend/src/pages/InvoiceManagement.jsx
import React, { useEffect, useState } from "react";
import api from "../services/api";

const getCurrentUser = () => {
  try {
    return JSON.parse(localStorage.getItem("user") || "{}");
  } catch {
    return {};
  }
};

const InvoiceManagement = () => {
  // ‚úÖ Role check
  const user = getCurrentUser();
  const isAdmin = user?.vaiTro === "Admin";

  const [invoices, setInvoices] = useState([]);
  const [loading, setLoading] = useState(false);
  const [selectedInvoice, setSelectedInvoice] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  // --- STATE CHO B·ªò L·ªåC ---
  const [searchTerm, setSearchTerm] = useState("");
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");

  useEffect(() => {
    fetchInvoices();
  }, []);

  const fetchInvoices = async () => {
    try {
      setLoading(true);
      const res = await api.get("/hoadon");
      setInvoices(res.data);
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // --- LOGIC L·ªåC D·ªÆ LI·ªÜU ---
  const filteredInvoices = invoices.filter((inv) => {
    // 1. L·ªçc theo t·ª´ kh√≥a (S·ªë Hƒê, Ph√≤ng, Kh√°ch, SƒêT)
    const term = searchTerm.toLowerCase();
    const matchesSearch =
      (inv.SoHoaDon || "").toLowerCase().includes(term) ||
      (inv.TenPhong_LuuTru || "").toLowerCase().includes(term) ||
      (inv.TenKhachHangCoQuan || "").toLowerCase().includes(term) ||
      (inv.SDT || "").includes(term);

    // 2. L·ªçc theo ng√†y
    let matchesDate = true;
    const invDate = new Date(inv.NgayLap).setHours(0, 0, 0, 0);

    if (startDate) {
      const start = new Date(startDate).setHours(0, 0, 0, 0);
      if (invDate < start) matchesDate = false;
    }
    if (endDate) {
      const end = new Date(endDate).setHours(0, 0, 0, 0);
      if (invDate > end) matchesDate = false;
    }

    return matchesSearch && matchesDate;
  });

  // T√≠nh t·ªïng tr·ªã gi√° c√°c h√≥a ƒë∆°n ƒëang hi·ªÉn th·ªã
  const totalFilteredValue = filteredInvoices.reduce(
    (sum, inv) => sum + Number(inv.TriGia || 0),
    0
  );

  const handleViewDetail = async (soHoaDon) => {
    try {
      const res = await api.get(`/hoadon/${soHoaDon}`);
      setSelectedInvoice(res.data);
      setIsModalOpen(true);
    } catch (err) {
      alert("Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt h√≥a ƒë∆°n");
    }
  };

  const handleDelete = async (soHoaDon) => {
    // ‚úÖ ch·∫∑n UI n·∫øu kh√¥ng ph·∫£i Admin (ph√≤ng tr∆∞·ªùng h·ª£p g·ªçi nh·∫ßm)
    if (!isAdmin) {
      alert("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a h√≥a ƒë∆°n.");
      return;
    }

    if (
      !window.confirm(
        `‚ö†Ô∏è C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a vƒ©nh vi·ªÖn h√≥a ƒë∆°n ${soHoaDon}?\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!`
      )
    ) {
      return;
    }

    try {
      setLoading(true);
      await api.delete(`/hoadon/${soHoaDon}`);
      alert("‚úÖ ƒê√£ x√≥a h√≥a ƒë∆°n th√†nh c√¥ng!");
      fetchInvoices();
    } catch (err) {
      console.error(err);
      alert("‚ùå L·ªói: " + (err.response?.data?.message || "Kh√¥ng th·ªÉ x√≥a h√≥a ƒë∆°n"));
    } finally {
      setLoading(false);
    }
  };

  // H√†m in h√≥a ƒë∆°n (Gi·ªØ nguy√™n logic c≈©)
  const handlePrint = () => {
    const printContent = document.getElementById("invoice-print-section");
    const windowUrl = "about:blank";
    const windowName = "Print" + new Date().getTime();
    const printWindow = window.open(
      windowUrl,
      windowName,
      "left=50000,top=50000,width=0,height=0"
    );

    const printStyles = `
        <style>
            body { font-family: 'Times New Roman', Times, serif; padding: 20px; color: #000; }
            .header-print { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
            .header-print h1 { margin: 0; font-size: 24px; text-transform: uppercase; }
            .header-print p { margin: 5px 0; font-size: 14px; }
            .info-grid { display: grid; grid-template-columns: 1fr 1fr; margin-bottom: 20px; font-size: 14px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
            th { border-bottom: 1px solid #000; padding: 8px; text-align: left; font-weight: bold; }
            td { border-bottom: 1px dashed #ccc; padding: 8px; }
            .text-right { text-align: right; }
            .total-row td { border-top: 2px solid #000; border-bottom: none; font-weight: bold; font-size: 16px; padding-top: 15px; }
            .footer-print { margin-top: 40px; text-align: center; font-size: 14px; display: flex; justify-content: space-between; padding: 0 50px; }
        </style>
    `;

    printWindow.document.write(`
        <html>
            <head><title>In H√≥a ƒê∆°n</title>${printStyles}</head>
            <body>
                <div class="header-print">
                    <h1>Kh√°ch S·∫°n SE104</h1>
                    <p>ƒê·ªãa ch·ªâ: Khu ph·ªë 6, Linh Trung, Th·ªß ƒê·ª©c, TP.HCM</p>
                    <p>Hotline: 0909 123 456</p>
                </div>
                ${printContent.innerHTML}
                <div class="footer-print">
                    <div><p>Kh√°ch h√†ng</p><p style="margin-top: 40px; font-style: italic;">(K√Ω t√™n)</p></div>
                    <div><p>Ng∆∞·ªùi l·∫≠p phi·∫øu</p><p style="margin-top: 40px; font-style: italic;">(K√Ω t√™n)</p></div>
                </div>
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.focus();
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 250);
  };

  return (
    <div style={styles.wrapper}>
      <h1 style={styles.title}>üßæ Qu·∫£n l√Ω H√≥a ƒë∆°n & Doanh thu</h1>

      {/* --- C√îNG C·ª§ T√åM KI·∫æM & L·ªåC --- */}
      <div style={styles.filterCard}>
        <div style={{ display: "flex", gap: "15px", alignItems: "center", flexWrap: "wrap" }}>
          {/* √î t√¨m ki·∫øm */}
          <div style={{ flex: 1, minWidth: "250px" }}>
            <div style={{ position: "relative" }}>
              <input
                type="text"
                placeholder="üîç T√¨m s·ªë Hƒê, ph√≤ng, kh√°ch h√†ng..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                style={styles.searchInput}
              />
              {searchTerm && (
                <button onClick={() => setSearchTerm("")} style={styles.clearSearchBtn}>
                  ‚úï
                </button>
              )}
            </div>
          </div>

          {/* B·ªô l·ªçc ng√†y */}
          <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
            <div style={styles.dateGroup}>
              <span style={{ fontSize: "13px", color: "#64748b", fontWeight: 600 }}>T·ª´:</span>
              <input
                type="date"
                value={startDate}
                onChange={(e) => setStartDate(e.target.value)}
                style={styles.dateInput}
              />
            </div>
            <div style={styles.dateGroup}>
              <span style={{ fontSize: "13px", color: "#64748b", fontWeight: 600 }}>ƒê·∫øn:</span>
              <input
                type="date"
                value={endDate}
                onChange={(e) => setEndDate(e.target.value)}
                style={styles.dateInput}
              />
            </div>
            {(startDate || endDate) && (
              <button
                onClick={() => {
                  setStartDate("");
                  setEndDate("");
                }}
                style={styles.resetDateBtn}
                title="X√≥a l·ªçc ng√†y"
              >
                üîÑ
              </button>
            )}
          </div>
        </div>

        {/* Th·ªëng k√™ nhanh k·∫øt qu·∫£ l·ªçc */}
        <div style={styles.summaryBar}>
          <span>
            Hi·ªÉn th·ªã: <strong>{filteredInvoices.length}</strong> h√≥a ƒë∆°n
          </span>
          <span style={{ marginLeft: "auto" }}>
            T·ªïng tr·ªã gi√°:{" "}
            <strong style={{ color: "#2563eb", fontSize: "1.1em" }}>
              {totalFilteredValue.toLocaleString()} ƒë
            </strong>
          </span>
        </div>
      </div>

      {/* --- B·∫¢NG D·ªÆ LI·ªÜU --- */}
      <div style={styles.tableCard}>
        {loading ? (
          <p style={{ padding: "20px", textAlign: "center" }}>‚è≥ ƒêang t·∫£i...</p>
        ) : (
          <table style={styles.table}>
            <thead>
              <tr style={styles.tableHeader}>
                <th style={styles.th}>S·ªë H√≥a ƒê∆°n</th>
                <th style={styles.th}>Ph√≤ng</th>
                <th style={styles.th}>Kh√°ch h√†ng</th>
                <th style={styles.th}>Li√™n h·ªá (SƒêT)</th>
                <th style={styles.th}>Ng√†y l·∫≠p</th>
                <th style={{ ...styles.th, textAlign: "right" }}>Tr·ªã gi√°</th>
                <th style={{ ...styles.th, textAlign: "center" }}>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              {filteredInvoices.length === 0 ? (
                <tr>
                  <td colSpan="7" style={{ padding: "30px", textAlign: "center", color: "#64748b" }}>
                    üîç Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n n√†o ph√π h·ª£p.
                  </td>
                </tr>
              ) : (
                filteredInvoices.map((inv, idx) => (
                  <tr
                    key={inv.SoHoaDon}
                    style={{ ...styles.tr, background: idx % 2 === 0 ? "#f8fafc" : "#ffffff" }}
                  >
                    <td style={styles.td}>
                      <span style={styles.badge}>{inv.SoHoaDon}</span>
                    </td>
                    <td style={styles.td}>
                      <strong>{inv.TenPhong_LuuTru || "Ph√≤ng c≈©"}</strong>
                    </td>
                    <td style={styles.td}>
                      <div style={{ fontWeight: "600", color: "#334155" }}>{inv.TenKhachHangCoQuan}</div>
                    </td>
                    <td style={styles.td}>
                      <div style={{ display: "flex", flexDirection: "column" }}>
                        <span style={{ fontWeight: "bold", color: "#059669", fontSize: "13px" }}>
                          üìû {inv.SDT || "---"}
                        </span>
                        <span style={{ fontSize: "11px", color: "#94a3b8", marginTop: "2px" }}>
                          üìç {inv.DiaChi || "---"}
                        </span>
                      </div>
                    </td>
                    <td style={styles.td}>{new Date(inv.NgayLap).toLocaleDateString("vi-VN")}</td>
                    <td style={{ ...styles.td, textAlign: "right", fontWeight: "bold", color: "#2563eb" }}>
                      {Number(inv.TriGia).toLocaleString()} ƒë
                    </td>
                    <td style={{ ...styles.td, textAlign: "center" }}>
                      <div style={{ display: "flex", justifyContent: "center", gap: "8px" }}>
                        <button
                          style={styles.viewBtn}
                          onClick={() => handleViewDetail(inv.SoHoaDon)}
                          title="Xem chi ti·∫øt"
                        >
                          üëÅÔ∏è Xem
                        </button>

                        {/* ‚úÖ CH·ªà ADMIN M·ªöI TH·∫§Y N√öT X√ìA */}
                        {isAdmin && (
                          <button
                            style={styles.deleteBtn}
                            onClick={() => handleDelete(inv.SoHoaDon)}
                            title="X√≥a h√≥a ƒë∆°n"
                          >
                            üóëÔ∏è X√≥a
                          </button>
                        )}
                      </div>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        )}
      </div>

      {/* --- MODAL XEM CHI TI·∫æT (Gi·ªØ nguy√™n) --- */}
      {isModalOpen && selectedInvoice && (
        <div style={styles.overlay} onClick={() => setIsModalOpen(false)}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <div
              style={{
                ...styles.modalHeader,
                background: "#f8fafc",
                borderBottom: "1px solid #e2e8f0",
              }}
            >
              <h2 style={{ ...styles.modalTitle, color: "#1e293b", fontSize: "20px" }}>
                üìÑ Chi Ti·∫øt H√≥a ƒê∆°n
              </h2>
              <button style={styles.closeBtn} onClick={() => setIsModalOpen(false)}>
                ‚úï
              </button>
            </div>

            <div style={{ padding: "24px" }}>
              <div id="invoice-print-section">
                {/* Th√¥ng tin chung */}
                <div
                  style={{
                    background: "#fff",
                    borderRadius: "8px",
                    marginBottom: "20px",
                    border: "1px solid #e2e8f0",
                    display: "grid",
                    gridTemplateColumns: "1.5fr 1fr",
                  }}
                >
                  <div style={{ padding: "16px", borderRight: "1px solid #e2e8f0" }}>
                    <div style={{ fontSize: "13px", color: "#64748b" }}>Ph√≤ng & Lo·∫°i</div>
                    <div style={{ fontSize: "18px", fontWeight: "bold", color: "#2563eb" }}>
                      {selectedInvoice.TenPhong_LuuTru}
                      {selectedInvoice.TenLoaiPhong && (
                        <span style={{ fontSize: "14px", color: "#475569", fontWeight: "normal" }}>
                          {" "}
                          - {selectedInvoice.TenLoaiPhong}
                        </span>
                      )}
                    </div>
                    <div style={{ fontSize: "13px", color: "#64748b", marginTop: "8px" }}>Kh√°ch h√†ng</div>
                    <div style={{ fontWeight: "600", color: "#334155" }}>
                      {selectedInvoice.TenKhachHangCoQuan}
                    </div>
                  </div>
                  <div style={{ padding: "16px", background: "#f8fafc" }}>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "5px" }}>
                      <span style={{ color: "#64748b", fontSize: "13px" }}>S·ªë Hƒê:</span>
                      <strong>{selectedInvoice.SoHoaDon}</strong>
                    </div>
                    <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "5px" }}>
                      <span style={{ color: "#64748b", fontSize: "13px" }}>Ng√†y l·∫≠p:</span>
                      <strong>{new Date(selectedInvoice.NgayLap).toLocaleDateString("vi-VN")}</strong>
                    </div>
                    <div style={{ display: "flex", justifyContent: "space-between" }}>
                      <span style={{ color: "#64748b", fontSize: "13px" }}>ƒê·ªãa ch·ªâ:</span>
                      <span style={{ textAlign: "right", fontSize: "13px" }}>
                        {selectedInvoice.DiaChi || "---"}
                      </span>
                    </div>
                  </div>
                </div>

                {/* B·∫£ng t√≠nh ti·ªÅn */}
                <table style={{ width: "100%", marginBottom: "20px", borderCollapse: "collapse", fontSize: "14px" }}>
                  <thead>
                    <tr style={{ background: "#f1f5f9", color: "#475569", textTransform: "uppercase", fontSize: "11px" }}>
                      <th style={{ padding: "10px", textAlign: "left" }}>Kho·∫£n m·ª•c</th>
                      <th style={{ padding: "10px", textAlign: "right" }}>Chi ti·∫øt</th>
                      <th style={{ padding: "10px", textAlign: "right" }} className="text-right">
                        Th√†nh ti·ªÅn
                      </th>
                    </tr>
                  </thead>
                  <tbody style={{ borderTop: "1px solid #e2e8f0" }}>
                    <tr>
                      <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>
                        <strong>Ti·ªÅn thu√™ ph√≤ng</strong>
                        <div style={{ fontSize: "12px", color: "#64748b" }}>
                          ƒê∆°n gi√°: {Number(selectedInvoice.DonGia).toLocaleString()} ƒë
                        </div>
                      </td>
                      <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                        {selectedInvoice.SoNgayThue} ng√†y
                      </td>
                      <td
                        style={{
                          padding: "12px",
                          textAlign: "right",
                          fontWeight: "bold",
                          borderBottom: "1px dashed #e2e8f0",
                        }}
                        className="text-right"
                      >
                        {Number(selectedInvoice.DonGia * selectedInvoice.SoNgayThue).toLocaleString()}
                      </td>
                    </tr>

                    {selectedInvoice.PhuThu > 0 && (
                      <tr style={{ color: "#d97706" }}>
                        <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>
                          Ph·ª• thu qu√° t·∫£i (v∆∞·ª£t {selectedInvoice.SoKhach - 2} kh√°ch)
                        </td>
                        <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                          +{selectedInvoice.PhuThu * 100}%
                        </td>
                        <td style={{ padding: "12px", textAlign: "right", fontStyle: "italic", borderBottom: "1px dashed #e2e8f0" }} className="text-right">
                          {Number((selectedInvoice.DonGia * selectedInvoice.SoNgayThue) * selectedInvoice.PhuThu).toLocaleString()}
                        </td>
                      </tr>
                    )}

                    {selectedInvoice.KhachNuocNgoai === 1 && (
                      <tr style={{ color: "#059669" }}>
                        <td style={{ padding: "12px", borderBottom: "1px dashed #e2e8f0" }}>Ph·ª• thu kh√°ch n∆∞·ªõc ngo√†i</td>
                        <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>x 1.5</td>
                        <td style={{ padding: "12px", textAlign: "right", borderBottom: "1px dashed #e2e8f0" }}>
                          {Number(selectedInvoice.TriGia - (selectedInvoice.TriGia / 1.5)).toLocaleString()}
                        </td>
                      </tr>
                    )}

                    <tr style={{ borderTop: "2px solid #334155" }} className="total-row">
                      <td style={{ padding: "15px", fontWeight: "bold", color: "#dc2626", fontSize: "16px" }} colSpan={2}>
                        T·ªîNG TI·ªÄN
                      </td>
                      <td style={{ padding: "15px", textAlign: "right", fontWeight: "bold", color: "#dc2626", fontSize: "18px" }} className="text-right">
                        {Number(selectedInvoice.TriGia).toLocaleString()} VND
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div style={{ display: "flex", justifyContent: "flex-end", gap: "10px" }}>
                <button style={styles.cancelBtn} onClick={() => setIsModalOpen(false)}>
                  ƒê√≥ng
                </button>
                <button style={styles.printBtn} onClick={handlePrint}>
                  üñ®Ô∏è In H√≥a ƒê∆°n
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ===== CSS STYLES =====
const styles = {
  wrapper: { padding: "2rem 3rem", background: "#F5F8FF", minHeight: "100vh" },
  title: { fontSize: "2rem", fontWeight: "700", color: "#1F2A40", marginBottom: "1.5rem" },

  filterCard: {
    background: "white",
    padding: "15px 20px",
    borderRadius: "12px",
    boxShadow: "0 4px 6px -1px rgba(0,0,0,0.05)",
    marginBottom: "20px",
    border: "1px solid #e2e8f0",
  },
  searchInput: {
    width: "100%",
    padding: "10px 40px 10px 15px",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "0.95rem",
    outline: "none",
    transition: "border 0.2s",
  },
  clearSearchBtn: {
    position: "absolute",
    right: "10px",
    top: "50%",
    transform: "translateY(-50%)",
    background: "transparent",
    border: "none",
    color: "#94a3b8",
    cursor: "pointer",
    fontWeight: "bold",
  },
  dateGroup: {
    display: "flex",
    alignItems: "center",
    gap: "8px",
    background: "#f8fafc",
    padding: "6px 12px",
    borderRadius: "8px",
    border: "1px solid #e2e8f0",
  },
  dateInput: { border: "none", background: "transparent", outline: "none", fontSize: "13px", color: "#334155" },
  resetDateBtn: {
    background: "#e2e8f0",
    border: "none",
    borderRadius: "6px",
    width: "30px",
    height: "30px",
    cursor: "pointer",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
  },
  summaryBar: {
    marginTop: "15px",
    paddingTop: "10px",
    borderTop: "1px dashed #e2e8f0",
    display: "flex",
    justifyContent: "space-between",
    fontSize: "14px",
    color: "#475569",
  },

  tableCard: { background: "white", borderRadius: "16px", boxShadow: "0 4px 20px rgba(0,0,0,0.05)", overflow: "hidden" },
  table: { width: "100%", borderCollapse: "collapse" },
  tableHeader: { background: "#718096" },
  th: { padding: "16px 24px", textAlign: "left", color: "#fff", fontWeight: "600", fontSize: "14px", textTransform: "uppercase", letterSpacing: "0.5px" },
  td: { padding: "16px 24px", borderBottom: "1px solid #f1f5f9", color: "#334155", fontSize: "14px" },
  tr: { transition: "0.2s" },
  badge: { background: "#e2e8f0", padding: "4px 8px", borderRadius: "6px", fontSize: "0.85rem", fontWeight: "600", color: "#475569" },

  viewBtn: {
    display: "inline-flex",
    alignItems: "center",
    gap: "6px",
    padding: "8px 12px",
    background: "#e0f2fe",
    color: "#0284c7",
    border: "1px solid #bae6fd",
    borderRadius: "8px",
    cursor: "pointer",
    fontSize: "13px",
    fontWeight: "700",
    transition: "all 0.2s ease",
    boxShadow: "0 2px 4px rgba(0,0,0,0.05)",
  },
  deleteBtn: {
    display: "inline-flex",
    alignItems: "center",
    gap: "6px",
    padding: "8px 12px",
    background: "#fee2e2",
    color: "#ef4444",
    border: "1px solid #fecaca",
    borderRadius: "8px",
    cursor: "pointer",
    fontSize: "13px",
    fontWeight: "700",
    transition: "all 0.2s ease",
    boxShadow: "0 2px 4px rgba(0,0,0,0.05)",
    marginLeft: "0",
  },
  printBtn: { padding: "10px 24px", background: "#3b82f6", color: "white", border: "none", borderRadius: 8, cursor: "pointer", fontWeight: "600", boxShadow: "0 4px 6px rgba(59, 130, 246, 0.4)" },

  overlay: { position: "fixed", inset: 0, background: "rgba(0,0,0,.6)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 1000, backdropFilter: "blur(4px)" },
  modal: { background: "#fff", borderRadius: 20, width: "90%", maxWidth: 650, maxHeight: "90vh", overflowY: "auto", boxShadow: "0 20px 60px rgba(0,0,0,0.3)" },
  modalHeader: { display: "flex", justifyContent: "space-between", padding: "20px 24px", alignItems: "center" },
  modalTitle: { margin: 0, fontSize: 24, fontWeight: 700 },
  closeBtn: { background: "transparent", border: "none", fontSize: 24, cursor: "pointer", color: "#64748b" },
  cancelBtn: { padding: "10px 24px", background: "#f1f5f9", color: "#475569", border: "none", borderRadius: 8, cursor: "pointer", fontWeight: "600" },
};

export default InvoiceManagement;

```

### frontend\src\pages\Login.jsx
```jsx
import React, { useState } from "react";
import { useNavigate } from "react-router-dom";
import api from "../services/api";

const Login = () => {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    try {
      const response = await api.post("/auth/login", { username, password });

      // L∆∞u token v√†o localStorage
      localStorage.setItem("token", response.data.token);
      localStorage.setItem("user", JSON.stringify(response.data.user));

      alert("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
      navigate("/"); // Chuy·ªÉn v·ªÅ trang ch·ªß
    } catch (err) {
      console.error("‚ùå L·ªói ƒëƒÉng nh·∫≠p:", err);
      setError(err.response?.data?.error || "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={styles.container}>
      <div style={styles.card}>
        <h1 style={styles.title}>ƒêƒÉng nh·∫≠p</h1>
        <p style={styles.subtitle}>H·ªá th·ªëng qu·∫£n l√Ω kh√°ch s·∫°n</p>

        <form onSubmit={handleSubmit} style={styles.form}>
          <div style={styles.formGroup}>
            <label style={styles.label}>T√™n ƒëƒÉng nh·∫≠p</label>
            <input
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              style={styles.input}
              placeholder="Nh·∫≠p username"
              required
            />
          </div>

          <div style={styles.formGroup}>
            <label style={styles.label}>M·∫≠t kh·∫©u</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              style={styles.input}
              placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
              required
            />
          </div>

          {error && <p style={styles.error}>{error}</p>}

          <button type="submit" style={styles.button} disabled={loading}>
            {loading ? "ƒêang ƒëƒÉng nh·∫≠p..." : "ƒêƒÉng nh·∫≠p"}
          </button>
        </form>
      </div>
    </div>
  );
};

const styles = {
  container: {
    minHeight: "100vh",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
  },
  card: {
    background: "white",
    padding: "3rem",
    borderRadius: "16px",
    boxShadow: "0 20px 60px rgba(0,0,0,0.3)",
    width: "100%",
    maxWidth: "420px",
  },
  title: {
    fontSize: "2rem",
    fontWeight: 700,
    textAlign: "center",
    color: "#1F2A40",
    marginBottom: "0.5rem",
  },
  subtitle: {
    textAlign: "center",
    color: "#6B7280",
    marginBottom: "2rem",
  },
  form: {
    display: "flex",
    flexDirection: "column",
    gap: "1.5rem",
  },
  formGroup: {
    display: "flex",
    flexDirection: "column",
    gap: "0.5rem",
  },
  label: {
    fontWeight: 600,
    color: "#374151",
  },
  input: {
    padding: "0.75rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "1rem",
  },
  button: {
    padding: "0.75rem",
    background: "#3A7DFF",
    color: "white",
    border: "none",
    borderRadius: "8px",
    fontSize: "1rem",
    fontWeight: 600,
    cursor: "pointer",
    marginTop: "1rem",
  },
  error: {
    color: "#EF4444",
    fontSize: "0.875rem",
    textAlign: "center",
  },
};

export default Login;

```

### frontend\src\pages\ReportManagement.jsx
```jsx
import React, { useState, useEffect, useCallback } from "react";
import api from "../services/api";
import { Navigate } from "react-router-dom";

const ReportManagement = () => {
  // ‚úÖ CH·∫∂N USER NGAY TR√äN ƒê·∫¶U (tr∆∞·ªõc m·ªçi hook)
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  if (user?.vaiTro !== "Admin") return <Navigate to="/" replace />;

  const [activeTab, setActiveTab] = useState("create"); // 'create' | 'saved'

  // --- STATE TAB 1: L·∫¨P B√ÅO C√ÅO (CREATE) ---
  const [reportType, setReportType] = useState("month");
  const [month, setMonth] = useState(new Date().getMonth() + 1);
  const [year, setYear] = useState(new Date().getFullYear());
  const [liveData, setLiveData] = useState(null);
  const [liveTotal, setLiveTotal] = useState(0);

  // --- STATE TAB 2: QU·∫¢N L√ù ƒê√É L∆ØU (SAVED) ---
  const [savedReports, setSavedReports] = useState([]);
  const [selectedReport, setSelectedReport] = useState(null);
  const [detailData, setDetailData] = useState(null);
  const [detailTotal, setDetailTotal] = useState(0);

  // --- B·ªò L·ªåC CHO DANH S√ÅCH L·ªäCH S·ª¨ ---
  const [filterType, setFilterType] = useState("month"); // 'month' | 'year'
  const [filterSavedMonth, setFilterSavedMonth] = useState("ALL");
  const [filterSavedYear, setFilterSavedYear] = useState(new Date().getFullYear());

  const [loading, setLoading] = useState(false);

  // --- HELPER: HI·ªÇN TH·ªä TH·ªúI GIAN TH√îNG MINH ---
  const renderTimeText = (rptMonth, rptYear) => {
    if (!rptMonth || rptMonth === "ALL") return `(S·ªë li·ªáu c·∫£ nƒÉm t√†i ch√≠nh ${rptYear})`;

    const today = new Date();
    const currentMonth = today.getMonth() + 1;
    const currentYear = today.getFullYear();

    const m = Number(rptMonth);
    const y = Number(rptYear);
    const fmt = (d) => String(d).padStart(2, "0");

    if (m === currentMonth && y === currentYear) {
      const currentDay = today.getDate();
      return `(S·ªë li·ªáu t√≠nh ƒë·∫øn ng√†y: ${fmt(currentDay)}/${fmt(m)}/${y})`;
    }

    const lastDay = new Date(y, m, 0).getDate();
    return `(T·ª´ ng√†y 01/${fmt(m)}/${y} ƒë·∫øn ng√†y ${lastDay}/${fmt(m)}/${y})`;
  };

  // --- CH·ª®C NƒÇNG IN ·∫§N ---
  const handlePrint = (title, timeText, data, total) => {
    const printWindow = window.open("", "", "height=600,width=800");
    if (!printWindow) {
      alert("Tr√¨nh duy·ªát ƒë√£ ch·∫∑n c·ª≠a s·ªï in. H√£y cho ph√©p pop-up ƒë·ªÉ in b√°o c√°o.");
      return;
    }

    const safeData = Array.isArray(data) ? data : [];

    const htmlContent = `
      <html>
        <head>
          <title>In B√°o C√°o</title>
          <style>
            body { font-family: 'Times New Roman', serif; padding: 20px; }
            .header { text-align: center; margin-bottom: 30px; }
            .header h1 { margin: 0; text-transform: uppercase; font-size: 24px; }
            .header p { margin: 5px 0; font-style: italic; color: #555; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #000; padding: 10px; text-align: center; font-size: 14px; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .text-right { text-align: right; padding-right: 15px; }
            .text-left { text-align: left; padding-left: 15px; }
            .total-row { font-weight: bold; font-size: 16px; background-color: #fafafa; }
            .footer { margin-top: 50px; display: flex; justify-content: space-between; text-align: center; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${title}</h1>
            <p>${timeText}</p>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width: 10%">STT</th>
                <th style="width: 40%">Lo·∫°i Ph√≤ng</th>
                <th style="width: 30%">Doanh Thu</th>
                <th style="width: 20%">T·ª∑ L·ªá</th>
              </tr>
            </thead>
            <tbody>
              ${safeData
                .map((item, index) => {
                  const doanhThu = Number(item?.DoanhThu || 0);
                  const percent = total > 0 ? ((doanhThu / total) * 100).toFixed(2) : 0;
                  return `
                    <tr>
                      <td>${index + 1}</td>
                      <td class="text-left">${item?.TenLoaiPhong || item?.MaLoaiPhong || ""}</td>
                      <td class="text-right">${doanhThu.toLocaleString("vi-VN")} ƒë</td>
                      <td>${percent}%</td>
                    </tr>
                  `;
                })
                .join("")}
              <tr class="total-row">
                <td colspan="2">T·ªîNG C·ªòNG</td>
                <td class="text-right">${Number(total || 0).toLocaleString("vi-VN")} ƒë</td>
                <td>100%</td>
              </tr>
            </tbody>
          </table>
          <div class="footer">
             <div style="width: 40%">
                <p>Ng∆∞·ªùi l·∫≠p bi·ªÉu</p>
                <p style="margin-top: 60px; font-style: italic;">(K√Ω v√† ghi r√µ h·ªç t√™n)</p>
             </div>
             <div style="width: 40%">
                <p>Ng√†y ...... th√°ng ...... nƒÉm ......</p>
                <p>Gi√°m ƒë·ªëc</p>
                <p style="margin-top: 60px; font-style: italic;">(K√Ω v√† ƒë√≥ng d·∫•u)</p>
             </div>
          </div>
        </body>
      </html>
    `;

    printWindow.document.write(htmlContent);
    printWindow.document.close();
    printWindow.focus();

    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 500);
  };

  // --- API HANDLERS (TAB 1: CREATE) ---
  const handlePreview = async () => {
    setLoading(true);
    try {
      const y = Number(year);
      const m = Number(month);

      let url = `/baocao/doanhthu?nam=${y}`;
      if (reportType === "month") url += `&thang=${m}`;

      const res = await api.get(url);
      const data = Array.isArray(res.data) ? res.data : [];

      setLiveTotal(data.reduce((sum, item) => sum + Number(item?.DoanhThu || 0), 0));
      setLiveData(data);
    } catch (err) {
      alert("L·ªói: " + (err?.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  const fetchSavedReports = useCallback(async () => {
    try {
      const y = Number(filterSavedYear);

      let url = `/baocao/list?nam=${y}`;
      if (filterType === "year") {
        url += `&type=year`;
      } else {
        url += `&type=month`;
        if (filterSavedMonth !== "ALL") url += `&thang=${Number(filterSavedMonth)}`;
      }

      const res = await api.get(url);
      setSavedReports(Array.isArray(res.data) ? res.data : []);
    } catch (err) {
      console.error(err);
    }
  }, [filterSavedYear, filterSavedMonth, filterType]);

  const handleSave = async () => {
    if (!liveData) return;
    if (!window.confirm("L∆∞u b√°o c√°o n√†y l·∫°i?")) return;

    try {
      const payload = {
        thang: reportType === "month" ? Number(month) : "ALL",
        nam: Number(year),
      };
      await api.post("/baocao/save", payload);

      alert("‚úÖ L∆∞u th√†nh c√¥ng!");
      setLiveData(null);
      setLiveTotal(0);

      // n·∫øu ƒëang ·ªü tab saved th√¨ refresh
      fetchSavedReports();
    } catch (err) {
      alert("L·ªói l∆∞u: " + (err?.response?.data?.message || err.message));
    }
  };

  // T·ª± ƒë·ªông t·∫£i l·∫°i khi ƒë·ªïi Tab ho·∫∑c ƒë·ªïi b·ªô l·ªçc
  useEffect(() => {
    if (activeTab === "saved") fetchSavedReports();
  }, [activeTab, fetchSavedReports]);

  const handleViewDetail = async (report) => {
    setLoading(true);
    try {
      const res = await api.get(`/baocao/detail/${report.MaBaoCao}`);
      const data = Array.isArray(res.data) ? res.data : [];

      setDetailData(data);
      setDetailTotal(data.reduce((sum, item) => sum + Number(item?.DoanhThu || 0), 0));
      setSelectedReport(report);
    } catch (err) {
      alert("L·ªói t·∫£i chi ti·∫øt: " + (err?.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (!window.confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a vƒ©nh vi·ªÖn b√°o c√°o n√†y?")) return;

    try {
      await api.delete(`/baocao/${id}`);
      alert("‚úÖ ƒê√£ x√≥a!");
      fetchSavedReports();

      if (selectedReport?.MaBaoCao === id) {
        setSelectedReport(null);
        setDetailData(null);
        setDetailTotal(0);
      }
    } catch (err) {
      alert("L·ªói x√≥a: " + (err?.response?.data?.message || err.message));
    }
  };

  // --- RENDER B·∫¢NG D·ªÆ LI·ªÜU ---
  const renderTable = (data, total) => (
    <div style={styles.tableCard}>
      <table style={styles.table}>
        <thead>
          <tr style={styles.tableHeader}>
            <th style={styles.th}>STT</th>
            <th style={styles.th}>Lo·∫°i Ph√≤ng</th>
            <th style={{ ...styles.th, textAlign: "right" }}>Doanh Thu</th>
            <th style={{ ...styles.th, textAlign: "right" }}>T·ª∑ L·ªá</th>
          </tr>
        </thead>
        <tbody>
          {data.map((item, index) => {
            const doanhThu = Number(item?.DoanhThu || 0);
            const percent = total > 0 ? ((doanhThu / total) * 100).toFixed(2) : 0;
            return (
              <tr key={index} style={{ borderBottom: "1px solid #f1f5f9" }}>
                <td style={styles.td}>{index + 1}</td>
                <td style={{ ...styles.td, fontWeight: "600" }}>
                  {item.TenLoaiPhong || item.MaLoaiPhong}
                </td>
                <td style={{ ...styles.td, textAlign: "right", color: "#2563eb", fontWeight: "bold" }}>
                  {doanhThu.toLocaleString("vi-VN")} ƒë
                </td>
                <td style={{ ...styles.td, textAlign: "right" }}>{percent}%</td>
              </tr>
            );
          })}
          <tr style={{ background: "#f8fafc", borderTop: "2px solid #334155" }}>
            <td colSpan={2} style={{ padding: "15px", fontWeight: "bold" }}>
              T·ªîNG C·ªòNG
            </td>
            <td
              style={{
                padding: "15px",
                textAlign: "right",
                fontWeight: "bold",
                color: "#dc2626",
                fontSize: "18px",
              }}
            >
              {Number(total || 0).toLocaleString("vi-VN")} ƒë
            </td>
            <td style={{ padding: "15px", textAlign: "right", fontWeight: "bold" }}>100%</td>
          </tr>
        </tbody>
      </table>
    </div>
  );

  return (
    <div style={styles.wrapper}>
      <h1 style={styles.title}>üìà B√°o c√°o doanh thu</h1>

      {/* TABS */}
      <div style={styles.tabContainer}>
        <button
          style={activeTab === "create" ? styles.tabActive : styles.tab}
          onClick={() => setActiveTab("create")}
        >
          üìù L·∫≠p b√°o c√°o m·ªõi
        </button>
        <button
          style={activeTab === "saved" ? styles.tabActive : styles.tab}
          onClick={() => setActiveTab("saved")}
        >
          üìÇ Danh s√°ch ƒë√£ l∆∞u
        </button>
      </div>

      {/* --- CONTENT TAB 1: L·∫¨P B√ÅO C√ÅO --- */}
      {activeTab === "create" && (
        <div style={{ animation: "fadeIn 0.3s" }}>
          <div style={styles.filterCard}>
            <div style={{ display: "flex", gap: "20px", marginBottom: "15px" }}>
              <label style={styles.radioLabel}>
                <input
                  type="radio"
                  checked={reportType === "month"}
                  onChange={() => setReportType("month")}
                />{" "}
                Theo Th√°ng
              </label>
              <label style={styles.radioLabel}>
                <input
                  type="radio"
                  checked={reportType === "year"}
                  onChange={() => setReportType("year")}
                />{" "}
                Theo NƒÉm
              </label>
            </div>

            <div style={styles.filterRow}>
              {reportType === "month" && (
                <select
                  value={month}
                  onChange={(e) => setMonth(Number(e.target.value))}
                  style={styles.select}
                >
                  {Array.from({ length: 12 }, (_, i) => i + 1).map((m) => (
                    <option key={m} value={m}>
                      Th√°ng {m}
                    </option>
                  ))}
                </select>
              )}

              <input
                type="number"
                value={year}
                onChange={(e) => setYear(Number(e.target.value))}
                style={styles.input}
                placeholder="NƒÉm"
              />

              <button onClick={handlePreview} style={styles.btnPrimary} disabled={loading}>
                {loading ? "..." : "Xem tr∆∞·ªõc"}
              </button>
            </div>
          </div>

          {liveData && (
            <div>
              <div style={styles.resultHeader}>
                <div>
                  <h3 style={{ margin: 0, color: "#1e293b" }}>K·∫æT QU·∫¢ T·∫†M T√çNH</h3>
                  <p style={styles.timeText}>
                    {renderTimeText(reportType === "month" ? month : "ALL", year)}
                  </p>
                </div>

                <div style={{ display: "flex", gap: "10px" }}>
                  <button
                    onClick={() =>
                      handlePrint(
                        `B√°o c√°o doanh thu (T·∫°m t√≠nh)`,
                        renderTimeText(reportType === "month" ? month : "ALL", year),
                        liveData,
                        liveTotal
                      )
                    }
                    style={styles.btnPrint}
                  >
                    üñ®Ô∏è In B√°o C√°o
                  </button>

                  <button onClick={handleSave} style={styles.btnSuccess}>
                    üíæ L∆∞u v√†o h·ªá th·ªëng
                  </button>
                </div>
              </div>

              {renderTable(liveData, liveTotal)}
            </div>
          )}
        </div>
      )}

      {/* --- CONTENT TAB 2: DANH S√ÅCH ƒê√É L∆ØU --- */}
      {activeTab === "saved" && (
        <div style={{ display: "flex", gap: "20px", animation: "fadeIn 0.3s" }}>
          {/* SIDEBAR: B·ªò L·ªåC + DANH S√ÅCH */}
          <div
            style={{
              width: "350px",
              background: "white",
              borderRadius: "12px",
              boxShadow: "0 4px 6px rgba(0,0,0,0.05)",
              maxHeight: "80vh",
              display: "flex",
              flexDirection: "column",
            }}
          >
            <div style={{ padding: "15px", borderBottom: "1px solid #e2e8f0" }}>
              <div style={{ fontWeight: "bold", color: "#334155", marginBottom: "10px" }}>
                L·ªãch s·ª≠ b√°o c√°o
              </div>

              <div style={{ display: "flex", gap: "15px", marginBottom: "10px", fontSize: "13px" }}>
                <label style={{ cursor: "pointer", display: "flex", alignItems: "center", gap: "4px" }}>
                  <input type="radio" checked={filterType === "month"} onChange={() => setFilterType("month")} /> Theo Th√°ng
                </label>
                <label style={{ cursor: "pointer", display: "flex", alignItems: "center", gap: "4px" }}>
                  <input type="radio" checked={filterType === "year"} onChange={() => setFilterType("year")} /> Theo NƒÉm
                </label>
              </div>

              <div style={{ display: "flex", gap: "8px" }}>
                {filterType === "month" && (
                  <select
                    value={filterSavedMonth}
                    onChange={(e) => setFilterSavedMonth(e.target.value)}
                    style={{ ...styles.selectSmall, flex: 1 }}
                  >
                    <option value="ALL">T·∫•t c·∫£ th√°ng</option>
                    {Array.from({ length: 12 }, (_, i) => i + 1).map((m) => (
                      <option key={m} value={m}>
                        Th√°ng {m}
                      </option>
                    ))}
                  </select>
                )}

                <input
                  type="number"
                  value={filterSavedYear}
                  onChange={(e) => setFilterSavedYear(Number(e.target.value))}
                  placeholder="NƒÉm"
                  style={{
                    ...styles.inputSmall,
                    flex: filterType === "year" ? 1 : "unset",
                    width: filterType === "year" ? "100%" : "80px",
                  }}
                />
              </div>
            </div>

            <div style={{ overflowY: "auto", flex: 1 }}>
              {savedReports.length === 0 ? (
                <div style={{ padding: "30px", textAlign: "center", color: "#94a3b8", fontSize: "13px" }}>
                  Kh√¥ng t√¨m th·∫•y b√°o c√°o n√†o.
                </div>
              ) : (
                savedReports.map((rpt) => (
                  <div
                    key={rpt.MaBaoCao}
                    onClick={() => handleViewDetail(rpt)}
                    style={{
                      padding: "15px",
                      borderBottom: "1px solid #f1f5f9",
                      cursor: "pointer",
                      background: selectedReport?.MaBaoCao === rpt.MaBaoCao ? "#eff6ff" : "white",
                      transition: "0.2s",
                    }}
                  >
                    <div style={{ fontWeight: "600", color: "#1e293b", marginBottom: "6px", fontSize: "14px" }}>
                      {rpt.TenBaoCao}
                    </div>

                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                      <div style={{ display: "flex", flexDirection: "column" }}>
                        <span style={{ fontSize: "12px", color: "#64748b", fontWeight: "500" }}>
                          üìÖ {new Date(rpt.NgayTao).toLocaleDateString("vi-VN")}
                        </span>
                        <span style={{ fontSize: "11px", color: "#94a3b8", fontStyle: "italic", marginTop: "2px" }}>
                          ‚è∞ L·∫≠p l√∫c:{" "}
                          {new Date(rpt.NgayTao).toLocaleTimeString("vi-VN", { hour: "2-digit", minute: "2-digit", second: "2-digit" })}
                        </span>
                      </div>

                      <span
                        onClick={(e) => {
                          e.stopPropagation();
                          handleDelete(rpt.MaBaoCao);
                        }}
                        style={styles.deleteIcon}
                        title="X√≥a b√°o c√°o n√†y"
                      >
                        ‚úï X√≥a
                      </span>
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>

          {/* MAIN: CHI TI·∫æT B√ÅO C√ÅO */}
          <div style={{ flex: 1 }}>
            {selectedReport && detailData ? (
              <div style={{ background: "white", padding: "20px", borderRadius: "12px", boxShadow: "0 4px 6px rgba(0,0,0,0.05)" }}>
                <div style={styles.resultHeader}>
                  <div>
                    <h2 style={{ margin: "0 0 5px 0", color: "#1e293b", fontSize: "1.5rem" }}>
                      {selectedReport.TenBaoCao}
                    </h2>
                    <p style={styles.timeText}>{renderTimeText(selectedReport.Thang, selectedReport.Nam)}</p>
                  </div>

                  <button
                    onClick={() =>
                      handlePrint(
                        selectedReport.TenBaoCao,
                        renderTimeText(selectedReport.Thang, selectedReport.Nam),
                        detailData,
                        detailTotal
                      )
                    }
                    style={styles.btnPrint}
                  >
                    üñ®Ô∏è In B√°o C√°o
                  </button>
                </div>

                {loading ? <p>‚è≥ ƒêang t·∫£i...</p> : renderTable(detailData, detailTotal)}
              </div>
            ) : (
              <div
                style={{
                  height: "100%",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  color: "#94a3b8",
                  border: "2px dashed #e2e8f0",
                  borderRadius: "12px",
                  padding: "24px",
                }}
              >
                Ch·ªçn m·ªôt b√°o c√°o b√™n tr√°i ƒë·ªÉ xem chi ti·∫øt
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

// --- CSS STYLES ---
const styles = {
  wrapper: { padding: "2rem 3rem", background: "#F5F8FF", minHeight: "100vh" },
  title: { fontSize: "2rem", fontWeight: "700", color: "#1F2A40", marginBottom: "1.5rem" },

  tabContainer: { display: "flex", gap: "10px", marginBottom: "20px", borderBottom: "2px solid #e2e8f0" },
  tab: { padding: "10px 20px", border: "none", background: "transparent", cursor: "pointer", color: "#64748b", fontWeight: "600", fontSize: "15px" },
  tabActive: {
    padding: "10px 20px",
    border: "none",
    background: "transparent",
    cursor: "pointer",
    color: "#3b82f6",
    fontWeight: "bold",
    fontSize: "15px",
    borderBottom: "3px solid #3b82f6",
    marginBottom: "-2px",
  },

  filterCard: { background: "white", padding: "20px", borderRadius: "12px", boxShadow: "0 4px 6px -1px rgba(0,0,0,0.05)", marginBottom: "20px" },
  filterRow: { display: "flex", gap: "10px" },
  radioLabel: { cursor: "pointer", fontWeight: "600", display: "flex", alignItems: "center", gap: "5px" },
  select: { padding: "10px", borderRadius: "8px", border: "1px solid #cbd5e1" },
  input: { padding: "10px", borderRadius: "8px", border: "1px solid #cbd5e1", width: "100px" },

  selectSmall: { padding: "6px 10px", borderRadius: "6px", border: "1px solid #cbd5e1", fontSize: "13px", outline: "none" },
  inputSmall: { padding: "6px 10px", borderRadius: "6px", border: "1px solid #cbd5e1", fontSize: "13px", outline: "none" },

  btnPrimary: { padding: "10px 20px", background: "#3A7DFF", color: "white", border: "none", borderRadius: "8px", fontWeight: "600", cursor: "pointer" },
  btnSuccess: { padding: "8px 16px", background: "#10b981", color: "white", border: "none", borderRadius: "8px", fontWeight: "600", cursor: "pointer" },
  btnPrint: { padding: "8px 16px", background: "#64748b", color: "white", border: "none", borderRadius: "8px", fontWeight: "600", cursor: "pointer" },

  deleteIcon: { color: "#ef4444", fontWeight: "bold", cursor: "pointer", padding: "2px 6px", borderRadius: "4px", fontSize: "12px", background: "#fee2e2" },

  resultHeader: { display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: "20px", borderBottom: "2px solid #e2e8f0", paddingBottom: "15px" },
  timeText: { margin: "5px 0 0 0", color: "#64748b", fontStyle: "italic", fontSize: "14px" },

  tableCard: { background: "white", borderRadius: "12px", overflow: "hidden", border: "1px solid #e2e8f0" },
  table: { width: "100%", borderCollapse: "collapse" },
  tableHeader: { background: "#f1f5f9" },
  th: { padding: "12px 16px", textAlign: "left", fontSize: "13px", color: "#475569", textTransform: "uppercase" },
  td: { padding: "12px 16px", fontSize: "14px", color: "#334155" },
};

export default ReportManagement;

```

### frontend\src\pages\RoomManagement.jsx
```jsx
import React, { useState, useEffect } from "react";
import api from "../services/api";

const emptyForm = {
  maPhong: "",
  tenPhong: "",
  loaiPhong: "",
  tinhTrang: "Tr·ªëng",
  ghiChu: "",
};

const generateRoomCode = (tenPhong) => {
  if (!/ph√≤ng/i.test(tenPhong)) return null;
  const numbers = tenPhong.match(/\d+/g);
  if (!numbers) return null;
  return "P" + numbers.join("");
};

const RoomManagement = () => {
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const isAdmin = user?.vaiTro === "Admin";

  const [rooms, setRooms] = useState([]);
  const [roomTypes, setRoomTypes] = useState([]);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [mode, setMode] = useState("add");
  const [form, setForm] = useState(emptyForm);
  const [editingId, setEditingId] = useState(null);
  const [errors, setErrors] = useState({});
  const [loading, setLoading] = useState(false);

  const [searchTerm, setSearchTerm] = useState("");
  const [filterStatus, setFilterStatus] = useState("ALL");

  const isRented = form.tinhTrang === "ƒê√£ thu√™";

  useEffect(() => {
    fetchRooms();
    fetchRoomTypes();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const fetchRooms = async () => {
    try {
      setLoading(true);
      const response = await api.get("/phong");
      setRooms(response.data);
    } catch (error) {
      console.error("‚ùå L·ªói khi t·∫£i danh s√°ch ph√≤ng:", error);
      alert("Kh√¥ng th·ªÉ t·∫£i danh s√°ch ph√≤ng");
    } finally {
      setLoading(false);
    }
  };

  const fetchRoomTypes = async () => {
    try {
      const response = await api.get("/loaiphong");
      setRoomTypes(response.data);
    } catch (error) {
      console.error("‚ùå L·ªói khi t·∫£i lo·∫°i ph√≤ng:", error);
    }
  };

  // ====== GUARD: User kh√¥ng ƒë∆∞·ª£c thao t√°c ======
  const denyIfNotAdmin = () => {
    if (!isAdmin) {
      alert("B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán ch·ª©c nƒÉng n√†y.");
      return true;
    }
    return false;
  };

  const openAddModal = () => {
    if (denyIfNotAdmin()) return;
    setMode("add");
    setForm(emptyForm);
    setErrors({});
    setEditingId(null);
    setIsModalOpen(true);
  };

  const openEditModal = (room) => {
    if (denyIfNotAdmin()) return;
    setMode("edit");
    setForm({
      maPhong: room.MaPhong,
      tenPhong: room.TenPhong,
      loaiPhong: room.MaLoaiPhong,
      tinhTrang: room.TinhTrang,
      ghiChu: room.GhiChu || "",
    });
    setEditingId(room.MaPhong);
    setErrors({});
    setIsModalOpen(true);
  };

  const closeModal = () => setIsModalOpen(false);
  const handleChange = (e) =>
    setForm((prev) => ({ ...prev, [e.target.name]: e.target.value }));

  const validate = () => {
    const errs = {};
    if (!form.tenPhong.trim()) errs.tenPhong = "T√™n ph√≤ng kh√¥ng ƒë∆∞·ª£c tr·ªëng";
    if (!form.loaiPhong) errs.loaiPhong = "Ch·ªçn lo·∫°i ph√≤ng";
    setErrors(errs);
    return Object.keys(errs).length === 0;
  };

  const handleSubmit = async (e) => {
    if (e?.preventDefault) e.preventDefault();
    if (denyIfNotAdmin()) return;

    if (!validate()) return;

    setLoading(true);
    try {
      if (mode === "add") {
        const generatedCode = generateRoomCode(form.tenPhong);
        if (!generatedCode) {
          alert("T√™n ph√≤ng ph·∫£i c√≥ ch·ªØ 'Ph√≤ng' v√† s·ªë. VD: Ph√≤ng 101");
          setLoading(false);
          return;
        }
        const payload = {
          MaPhong: generatedCode,
          TenPhong: form.tenPhong,
          MaLoaiPhong: form.loaiPhong,
          TinhTrang: "Tr·ªëng",
          GhiChu: form.ghiChu,
        };
        await api.post("/phong", payload);
        alert("‚úÖ Th√™m ph√≤ng th√†nh c√¥ng!");
      } else {
        const payload = {
          TenPhong: form.tenPhong,
          MaLoaiPhong: form.loaiPhong,
          GhiChu: form.ghiChu,
        };
        await api.put(`/phong/${editingId}`, payload);
        alert("‚úÖ C·∫≠p nh·∫≠t ph√≤ng th√†nh c√¥ng!");
      }
      await fetchRooms();
      setIsModalOpen(false);
    } catch (error) {
      console.error("‚ùå L·ªói khi l∆∞u ph√≤ng:", error);
      const msg =
        error.response?.data?.message ||
        "Kh√¥ng th·ªÉ l∆∞u ph√≤ng. Vui l√≤ng th·ª≠ l·∫°i.";
      alert("‚ùå " + msg);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (denyIfNotAdmin()) return;

    if (
      !window.confirm(
        `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA ph√≤ng ${id}?\n(L∆∞u √Ω: N·∫øu ph√≤ng ƒë√£ t·ª´ng c√≥ kh√°ch thu√™, h·ªá th·ªëng s·∫Ω ch·∫∑n thao t√°c n√†y)`
      )
    )
      return;

    try {
      await api.delete(`/phong/${id}`);
      alert("‚úÖ X√≥a ph√≤ng th√†nh c√¥ng!");
      fetchRooms();
    } catch (error) {
      console.error("‚ùå L·ªói khi x√≥a ph√≤ng:", error);
      const msg = error.response?.data?.message || "Kh√¥ng th·ªÉ x√≥a ph√≤ng n√†y.";
      alert("‚ùå " + msg);
    }
  };

  const handleMaintenance = async (room) => {
    if (denyIfNotAdmin()) return;

    const isMaintenance = room.TinhTrang === "B·∫£o tr√¨";
    const newStatus = isMaintenance ? "Tr·ªëng" : "B·∫£o tr√¨";
    const actionText = isMaintenance ? "Ho√†n t·∫•t b·∫£o tr√¨" : "ƒê∆∞a v√†o b·∫£o tr√¨";
    if (!window.confirm(`B·∫°n mu·ªën ${actionText} cho ph√≤ng ${room.TenPhong}?`))
      return;

    try {
      await api.put(`/phong/${room.MaPhong}/maintenance`, { status: newStatus });
      alert("‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!");
      fetchRooms();
    } catch (error) {
      alert(
        "‚ùå L·ªói: " +
          (error.response?.data?.message || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i")
      );
    }
  };

  const handleBusinessStatus = async (room, action) => {
    if (denyIfNotAdmin()) return;

    const msg =
      action === "stop"
        ? `Ng∆∞ng kinh doanh ph√≤ng ${room.TenPhong}? (Ph√≤ng s·∫Ω kh√¥ng th·ªÉ ch·ªçn ƒë·ªÉ thu√™)`
        : `K√≠ch ho·∫°t l·∫°i ph√≤ng ${room.TenPhong}?`;
    if (!window.confirm(msg)) return;

    try {
      await api.put(`/phong/${room.MaPhong}/business`, { action });
      alert("‚úÖ Th√†nh c√¥ng!");
      fetchRooms();
    } catch (error) {
      alert("‚ùå L·ªói: " + (error.response?.data?.message || "L·ªói c·∫≠p nh·∫≠t"));
    }
  };

  const filteredRooms = rooms.filter((room) => {
    if (filterStatus !== "ALL" && room.TinhTrang !== filterStatus) return false;
    if (!searchTerm) return true;
    const lowerTerm = searchTerm.toLowerCase();
    return (
      room.TenPhong.toLowerCase().includes(lowerTerm) ||
      room.MaPhong.toLowerCase().includes(lowerTerm) ||
      (room.TenLoaiPhong &&
        room.TenLoaiPhong.toLowerCase().includes(lowerTerm)) ||
      (room.GhiChu && room.GhiChu.toLowerCase().includes(lowerTerm)) ||
      room.TinhTrang.toLowerCase().includes(lowerTerm)
    );
  });

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>Danh m·ª•c ph√≤ng</h1>
          <p style={styles.subtitle}>
            Qu·∫£n l√Ω th√¥ng tin ph√≤ng, lo·∫°i ph√≤ng v√† t√¨nh tr·∫°ng ph√≤ng.
          </p>
        </div>

        <div style={{ display: "flex", gap: "10px", alignItems: "center" }}>
          <select
            value={filterStatus}
            onChange={(e) => setFilterStatus(e.target.value)}
            style={styles.filterSelect}
          >
            <option value="ALL">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="Tr·ªëng">Ph√≤ng Tr·ªëng</option>
            <option value="ƒê√£ thu√™">ƒêang c√≥ kh√°ch</option>
            <option value="B·∫£o tr√¨">ƒêang b·∫£o tr√¨</option>
            <option value="Ng∆∞ng kinh doanh">Ng∆∞ng kinh doanh</option>
          </select>

          <div style={{ position: "relative" }}>
            <input
              type="text"
              placeholder="üîç T√¨m t√™n, lo·∫°i..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              style={styles.searchInput}
            />
            {searchTerm && (
              <button
                onClick={() => setSearchTerm("")}
                style={styles.clearSearchBtn}
                title="X√≥a t√¨m ki·∫øm"
              >
                ‚úï
              </button>
            )}
          </div>

          {isAdmin && (
            <button style={styles.addButton} onClick={openAddModal}>
              + Th√™m ph√≤ng
            </button>
          )}
        </div>
      </div>

      {loading && <p style={{ textAlign: "center" }}>‚è≥ ƒêang t·∫£i...</p>}

      <div style={styles.tableCard}>
        <table style={styles.table}>
          <thead>
            <tr>
              <th style={styles.th}>M√£ ph√≤ng</th>
              <th style={styles.th}>T√™n ph√≤ng</th>
              <th style={styles.th}>Lo·∫°i</th>
              <th style={styles.th}>ƒê∆°n gi√°</th>
              <th style={{ ...styles.th, textAlign: "center" }}>T√¨nh tr·∫°ng</th>
              <th style={styles.th}>Ghi ch√∫</th>
              {isAdmin && (
                <th style={{ ...styles.th, textAlign: "center" }}>H√†nh ƒë·ªông</th>
              )}
            </tr>
          </thead>

          <tbody>
            {filteredRooms.length === 0 ? (
              <tr>
                <td
                  colSpan={isAdmin ? 7 : 6}
                  style={{
                    textAlign: "center",
                    padding: "30px",
                    color: "#666",
                  }}
                >
                  <div style={{ fontSize: "40px", marginBottom: "10px" }}>
                    üîç
                  </div>
                  Kh√¥ng t√¨m th·∫•y ph√≤ng n√†o ph√π h·ª£p.
                </td>
              </tr>
            ) : (
              filteredRooms.map((room) => {
                const isRoomStopped = room.TinhTrang === "Ng∆∞ng kinh doanh";
                const isOccupied = room.TinhTrang === "ƒê√£ thu√™";
                const isMaintenance = room.TinhTrang === "B·∫£o tr√¨";
                const isTypeStopped = room.TrangThaiLoaiPhong === 0;

                return (
                  <tr
                    key={room.MaPhong}
                    style={{
                      ...styles.tr,
                      backgroundColor: isTypeStopped ? "#F3F4F6" : "white",
                      opacity: isTypeStopped ? 0.8 : 1,
                    }}
                  >
                    <td style={styles.td}>{room.MaPhong}</td>
                    <td style={styles.td}>{room.TenPhong}</td>
                    <td style={styles.td}>
                      <div
                        style={{
                          display: "flex",
                          alignItems: "center",
                          gap: "6px",
                        }}
                      >
                        <span
                          style={loaiPhongBadgeStyle(
                            room.TenLoaiPhong || room.MaLoaiPhong
                          )}
                        >
                          {room.TenLoaiPhong || room.MaLoaiPhong}
                        </span>
                        {isTypeStopped && (
                          <span
                            style={{
                              fontSize: "10px",
                              background: "#374151",
                              color: "white",
                              padding: "2px 6px",
                              borderRadius: "4px",
                            }}
                          >
                            ‚õî Lo·∫°i ƒë√£ ng∆∞ng
                          </span>
                        )}
                      </div>
                    </td>

                    <td style={styles.td}>
                      {room.DonGia
                        ? Number(room.DonGia).toLocaleString("vi-VN", {
                            minimumFractionDigits: 0,
                          }) + " VND"
                        : "-"}
                    </td>

                    <td style={{ ...styles.td, textAlign: "center" }}>
                      <span style={statusBadgeStyle(room.TinhTrang)}>
                        {room.TinhTrang}
                      </span>
                    </td>

                    <td style={styles.td}>{room.GhiChu}</td>

                    {/* ‚úÖ Admin-only: c·ªôt h√†nh ƒë·ªông */}
                    {isAdmin && (
                      <td
                        style={{
                          ...styles.td,
                          textAlign: "center",
                          minWidth: "240px",
                        }}
                      >
                        <div style={styles.actionGrid}>
                          <button
                            style={styles.btnEdit}
                            onClick={() => openEditModal(room)}
                            title="S·ª≠a th√¥ng tin"
                          >
                            S·ª≠a
                          </button>

                          {isMaintenance ? (
                            <button
                              style={styles.btnFinish}
                              onClick={() => handleMaintenance(room)}
                            >
                              Xong
                            </button>
                          ) : (
                            <button
                              style={
                                isOccupied || isRoomStopped
                                  ? styles.btnDisabled
                                  : styles.btnMaintenance
                              }
                              onClick={() =>
                                !(isOccupied || isRoomStopped) &&
                                handleMaintenance(room)
                              }
                              disabled={isOccupied || isRoomStopped}
                              title={isOccupied ? "ƒêang c√≥ kh√°ch" : "B·∫£o tr√¨ ph√≤ng"}
                            >
                              B·∫£o tr√¨
                            </button>
                          )}

                          {isRoomStopped ? (
                            <button
                              style={styles.btnActive}
                              onClick={() => handleBusinessStatus(room, "active")}
                            >
                              K√≠ch ho·∫°t
                            </button>
                          ) : (
                            <button
                              style={isOccupied ? styles.btnDisabled : styles.btnStop}
                              onClick={() =>
                                !isOccupied && handleBusinessStatus(room, "stop")
                              }
                              disabled={isOccupied}
                              title={isOccupied ? "ƒêang c√≥ kh√°ch" : "Ng∆∞ng kinh doanh"}
                            >
                              Ng∆∞ng KD
                            </button>
                          )}

                          <button
                            style={isOccupied ? styles.btnDisabled : styles.btnDelete}
                            onClick={() => !isOccupied && handleDelete(room.MaPhong)}
                            disabled={isOccupied}
                            title="X√≥a ph√≤ng"
                          >
                            X√≥a
                          </button>
                        </div>
                      </td>
                    )}
                  </tr>
                );
              })
            )}
          </tbody>
        </table>
      </div>

      {/* ‚úÖ Admin-only: modal */}
      {isAdmin && isModalOpen && (
        <div style={styles.modalOverlay} onClick={closeModal}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <h2 style={styles.modalTitle}>
              {mode === "add" ? "Th√™m ph√≤ng" : "S·ª≠a ph√≤ng"}
            </h2>
            <div style={styles.form}>
              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>T√™n ph√≤ng</label>
                  <input
                    name="tenPhong"
                    value={form.tenPhong}
                    onChange={handleChange}
                    disabled={mode === "edit" && isRented}
                    style={{
                      ...styles.input,
                      backgroundColor:
                        mode === "edit" && isRented ? "#f3f4f6" : "white",
                      cursor:
                        mode === "edit" && isRented
                          ? "not-allowed"
                          : "text",
                    }}
                  />
                  {mode === "add" && (
                    <p
                      style={{
                        fontSize: "0.75rem",
                        color: "#6B7280",
                        marginTop: "0.25rem",
                      }}
                    >
                      VD: Nh·∫≠p "Ph√≤ng 101" ‚Üí M√£ ph√≤ng s·∫Ω t·ª± t·∫°o l√† P101
                    </p>
                  )}
                  {mode === "edit" && isRented && (
                    <p
                      style={{
                        fontSize: "0.75rem",
                        color: "#EF4444",
                        marginTop: "0.25rem",
                      }}
                    >
                      üîí Ph√≤ng ƒëang thu√™, kh√¥ng th·ªÉ s·ª≠a T√™n ph√≤ng.
                    </p>
                  )}
                  {errors.tenPhong && (
                    <span style={styles.errorText}>{errors.tenPhong}</span>
                  )}
                </div>
              </div>

              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>Lo·∫°i ph√≤ng</label>
                  <select
                    name="loaiPhong"
                    value={form.loaiPhong}
                    onChange={handleChange}
                    disabled={isRented}
                    style={{
                      ...styles.input,
                      backgroundColor: isRented ? "#f3f4f6" : "white",
                      cursor: isRented ? "not-allowed" : "pointer",
                    }}
                  >
                    <option value="">-- Ch·ªçn lo·∫°i ph√≤ng --</option>
                    {roomTypes.map((type) => (
                      <option key={type.MaLoaiPhong} value={type.MaLoaiPhong}>
                        {type.TenLoaiPhong} -{" "}
                        {Number(type.DonGia).toLocaleString("vi-VN")} VND
                      </option>
                    ))}
                  </select>
                  {isRented && (
                    <p
                      style={{
                        fontSize: "0.75rem",
                        color: "#EF4444",
                        marginTop: "0.25rem",
                      }}
                    >
                      üîí Ph√≤ng ƒëang thu√™, kh√¥ng th·ªÉ ƒë·ªïi Lo·∫°i ph√≤ng.
                    </p>
                  )}
                  {errors.loaiPhong && (
                    <span style={styles.errorText}>{errors.loaiPhong}</span>
                  )}
                </div>
              </div>

              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>Ghi ch√∫</label>
                  <input
                    name="ghiChu"
                    value={form.ghiChu}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder="Ghi ch√∫ th√™m..."
                  />
                </div>
              </div>

              <div style={styles.modalActions}>
                <button
                  type="button"
                  onClick={closeModal}
                  style={styles.cancelButton}
                  disabled={loading}
                >
                  H·ªßy
                </button>
                <button
                  type="button"
                  onClick={handleSubmit}
                  style={styles.saveButton}
                  disabled={loading}
                >
                  {loading
                    ? "‚è≥ ƒêang l∆∞u..."
                    : mode === "add"
                    ? "L∆∞u"
                    : "C·∫≠p nh·∫≠t"}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ===== STYLES M·ªöI CHO 4 N√öT =====
const styles = {
  wrapper: {
    width: "100%",
    maxWidth: "1400px",
    margin: "0 auto",
    padding: "2rem 2rem 3rem",
  },
  headerRow: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: "1.5rem",
  },
  title: { fontSize: "2rem", fontWeight: 700, color: "#1F2A40" },
  subtitle: { marginTop: "0.3rem", color: "#6B7280" },
  searchInput: {
    padding: "0.6rem 1rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "0.95rem",
    width: "220px",
    outline: "none",
  },
  filterSelect: {
    padding: "0.6rem 1rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "0.95rem",
    outline: "none",
    cursor: "pointer",
    backgroundColor: "white",
  },
  clearSearchBtn: {
    position: "absolute",
    right: "10px",
    top: "50%",
    transform: "translateY(-50%)",
    background: "transparent",
    border: "none",
    color: "#999",
    cursor: "pointer",
    fontWeight: "bold",
  },
  addButton: {
    padding: "0.6rem 1.4rem",
    backgroundColor: "#3A7DFF",
    color: "white",
    borderRadius: "8px",
    border: "none",
    cursor: "pointer",
    fontWeight: 600,
    boxShadow: "0 5px 14px rgba(58, 125, 255, 0.35)",
    whiteSpace: "nowrap",
  },
  tableCard: {
    background: "white",
    borderRadius: "16px",
    boxShadow: "0 8px 20px rgba(15, 23, 42, 0.08)",
    padding: "1.5rem",
    overflowX: "auto",
  },
  table: { width: "100%", borderCollapse: "collapse", fontSize: "0.95rem" },
  th: {
    padding: "12px 16px",
    backgroundColor: "#F9FAFB",
    borderBottom: "2px solid #E5E7EB",
    fontWeight: 600,
    color: "#374151",
    textAlign: "left",
  },
  tr: { borderBottom: "1px solid #E5E7EB", transition: "0.2s" },
  td: { padding: "12px 16px", verticalAlign: "middle" },

  actionGrid: {
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: "6px",
  },
  btnEdit: {
    background: "#3A7DFF",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnMaintenance: {
    background: "#F59E0B",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnFinish: {
    background: "#10B981",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnStop: {
    background: "#374151",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnActive: {
    background: "#059669",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnDelete: {
    background: "#EF4444",
    color: "white",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.75rem",
    fontWeight: 600,
  },
  btnDisabled: {
    background: "#E5E7EB",
    color: "#9CA3AF",
    padding: "6px",
    borderRadius: "4px",
    border: "none",
    cursor: "not-allowed",
    fontSize: "0.75rem",
    fontWeight: 600,
  },

  modalOverlay: {
    position: "fixed",
    inset: 0,
    backgroundColor: "rgba(0,0,0,0.35)",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    zIndex: 999,
  },
  modal: {
    width: "100%",
    maxWidth: "680px",
    background: "white",
    padding: "2rem",
    borderRadius: "16px",
    boxShadow: "0 20px 40px rgba(0,0,0,0.2)",
  },
  modalTitle: {
    fontSize: "1.4rem",
    marginBottom: "1rem",
    fontWeight: 700,
    color: "#1F2A40",
  },
  form: { display: "flex", flexDirection: "column", gap: "1rem" },
  formRow: { display: "flex", gap: "1rem" },
  formGroup: {
    flex: 1,
    display: "flex",
    flexDirection: "column",
    gap: "0.3rem",
  },
  input: {
    padding: "0.55rem 0.75rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "0.95rem",
  },
  errorText: { color: "#EF4444", fontSize: "0.8rem", marginTop: "0.2rem" },
  modalActions: {
    display: "flex",
    justifyContent: "flex-end",
    gap: "0.8rem",
    marginTop: "1rem",
  },
  cancelButton: {
    padding: "0.5rem 1.2rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    background: "white",
    cursor: "pointer",
  },
  saveButton: {
    padding: "0.5rem 1.4rem",
    borderRadius: "8px",
    border: "none",
    background: "#3A7DFF",
    color: "white",
    cursor: "pointer",
    fontWeight: 600,
  },
};

const loaiPhongBadgeStyle = (loai) => {
  const colors = {
    A: { bg: "#DBEAFE", color: "#1D4ED8" },
    "Lo·∫°i A": { bg: "#DBEAFE", color: "#1D4ED8" },
    B: { bg: "#FEF3C7", color: "#D97706" },
    "Lo·∫°i B": { bg: "#FEF3C7", color: "#D97706" },
    C: { bg: "#FEE2E2", color: "#DC2626" },
    "Lo·∫°i C": { bg: "#FEE2E2", color: "#DC2626" },
    D: { bg: "#E9D5FF", color: "#7C3AED" },
    "Lo·∫°i D": { bg: "#E9D5FF", color: "#7C3AED" },
  };
  const style = colors[loai] || { bg: "#E0EAFF", color: "#1E40AF" };
  return {
    display: "inline-block",
    padding: "4px 12px",
    borderRadius: "8px",
    fontWeight: 600,
    fontSize: "0.85rem",
    backgroundColor: style.bg,
    color: style.color,
    minWidth: "36px",
    textAlign: "center",
  };
};

const statusBadgeStyle = (status) => {
  let bg = "#E5E7EB";
  let color = "#374151";
  if (status === "Tr·ªëng") {
    bg = "#D1FAE5";
    color = "#059669";
  } else if (status === "ƒê√£ thu√™") {
    bg = "#FEE2E2";
    color = "#DC2626";
  } else if (status === "B·∫£o tr√¨") {
    bg = "#fed7aa";
    color = "#c2410c";
  } else if (status === "Ng∆∞ng kinh doanh") {
    bg = "#4b5563";
    color = "#ffffff";
  }
  return {
    display: "inline-block",
    padding: "4px 12px",
    borderRadius: "10px",
    fontWeight: 600,
    fontSize: "0.85rem",
    backgroundColor: bg,
    color,
    minWidth: "80px",
  };
};

export default RoomManagement;
```

### frontend\src\pages\RoomSearch.jsx
```jsx
import React, { useState, useEffect } from "react";
import api from "../services/api";

const RoomSearch = () => {
  const [rooms, setRooms] = useState([]);
  const [loading, setLoading] = useState(false);
  
  const [searchTerm, setSearchTerm] = useState("");
  const [filterStatus, setFilterStatus] = useState("ALL");

  useEffect(() => {
    fetchRooms();
  }, []);

  const fetchRooms = async () => {
    try {
      setLoading(true);
      const response = await api.get("/phong");
      setRooms(response.data);
    } catch (error) {
      console.error("‚ùå L·ªói khi t·∫£i danh s√°ch ph√≤ng:", error);
    } finally {
      setLoading(false);
    }
  };

  // Helper format ng√†y
  const formatDate = (dateStr) => {
      if (!dateStr) return "";
      const d = new Date(dateStr);
      return `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()}`;
  };

  const filteredRooms = rooms.filter((room) => {
    if (filterStatus !== "ALL" && room.TinhTrang !== filterStatus) return false;
    if (!searchTerm) return true;
    const lowerTerm = searchTerm.toLowerCase();
    return (
      room.TenPhong.toLowerCase().includes(lowerTerm) ||
      room.MaPhong.toLowerCase().includes(lowerTerm) ||
      (room.TenLoaiPhong && room.TenLoaiPhong.toLowerCase().includes(lowerTerm)) ||
      (room.TenKhach && room.TenKhach.toLowerCase().includes(lowerTerm)) 
    );
  });

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>üîç Tra c·ª©u ph√≤ng</h1>
          <p style={styles.subtitle}>
            Tra c·ª©u nhanh th√¥ng tin, kh√°ch ƒëang ·ªü v√† t√¨nh tr·∫°ng ph√≤ng.
          </p>
        </div>
        
        <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
            <div style={styles.quickStats}>
                <span style={{color: '#059669'}}>Tr·ªëng: <b>{rooms.filter(r => r.TinhTrang === 'Tr·ªëng').length}</b></span>
                <span style={{color: '#DC2626'}}>ƒêang ·ªü: <b>{rooms.filter(r => r.TinhTrang === 'ƒê√£ thu√™').length}</b></span>
            </div>

            <select
                value={filterStatus}
                onChange={(e) => setFilterStatus(e.target.value)}
                style={styles.filterSelect}
            >
                <option value="ALL">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                <option value="Tr·ªëng">Ph√≤ng Tr·ªëng</option>
                <option value="ƒê√£ thu√™">ƒêang c√≥ kh√°ch</option>
                <option value="B·∫£o tr√¨">ƒêang b·∫£o tr√¨</option>
            </select>

            <div style={{position: 'relative'}}>
                <input 
                    type="text" 
                    placeholder="T√¨m ph√≤ng, t√™n kh√°ch..." 
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    style={styles.searchInput}
                />
                {searchTerm && <button onClick={() => setSearchTerm("")} style={styles.clearSearchBtn}>‚úï</button>}
            </div>
        </div>
      </div>

      {loading && <p style={{ textAlign: "center", color: '#64748b' }}>‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</p>}

      <div style={styles.tableCard}>
        <table style={styles.table}>
          <thead>
            <tr>
              <th style={styles.th}>Ph√≤ng</th>
              <th style={styles.th}>Lo·∫°i & Gi√°</th>
              <th style={styles.th}>Kh√°ch ƒëang ·ªü</th>
              <th style={styles.th}>Th·ªùi gian l∆∞u tr√∫</th>
              <th style={{ ...styles.th, textAlign: "center" }}>T√¨nh tr·∫°ng</th>
              <th style={styles.th}>Ghi ch√∫</th>
            </tr>
          </thead>

          <tbody>
            {filteredRooms.length === 0 ? (
                <tr>
                    <td colSpan="6" style={{textAlign: 'center', padding: '40px', color: '#94a3b8'}}>
                        Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.
                    </td>
                </tr>
            ) : filteredRooms.map((room, idx) => {
              const isOccupied = room.TinhTrang === 'ƒê√£ thu√™';
              // ‚úÖ KI·ªÇM TRA LO·∫†I PH√íNG C√ì B·ªä NG∆ØNG KH√îNG
              // Backend tr·∫£ v·ªÅ TrangThaiLoaiPhong: 1 (Active) ho·∫∑c 0 (Inactive)
              const isTypeInactive = room.TrangThaiLoaiPhong === 0; 
              
              return (
                <tr 
                    key={room.MaPhong} 
                    style={{
                        ...styles.tr,
                        // N·∫øu lo·∫°i ph√≤ng b·ªã ng∆∞ng -> N·ªÅn x√°m, m·ªù ƒëi
                        backgroundColor: isTypeInactive ? '#f3f4f6' : (idx % 2 === 0 ? '#ffffff' : '#f8fafc'),
                        opacity: isTypeInactive ? 0.7 : 1,
                    }}
                >
                  <td style={styles.td}>
                      <div style={{fontWeight: 'bold', color: '#1e293b', fontSize: '1rem'}}>
                          {room.TenPhong}
                      </div>
                      <span style={styles.codeBadge}>{room.MaPhong}</span>
                  </td>

                  <td style={styles.td}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '5px'}}>
                        <span style={loaiPhongBadgeStyle(room.TenLoaiPhong || room.MaLoaiPhong)}>
                        {room.TenLoaiPhong || room.MaLoaiPhong}
                        </span>
                        {/* ‚úÖ HI·ªÇN TH·ªä C·∫¢NH B√ÅO N·∫æU LO·∫†I PH√íNG B·ªä NG∆ØNG */}
                        {isTypeInactive && (
                            <span style={{fontSize: '10px', background: '#374151', color: 'white', padding: '2px 6px', borderRadius: '4px'}}>
                                ‚õî Ng∆∞ng KD
                            </span>
                        )}
                    </div>
                    
                    <div style={{marginTop: '4px', fontSize: '0.85rem', color: '#64748b'}}>
                        {Number(room.DonGia).toLocaleString("vi-VN")} ƒë
                    </div>
                  </td>

                  {/* TH√îNG TIN KH√ÅCH H√ÄNG */}
                  <td style={styles.td}>
                    {isOccupied && room.TenKhach ? (
                        <div>
                            <div style={{fontWeight: '600', color: '#334155'}}>üë§ {room.TenKhach}</div>
                            <div style={{fontSize: '0.85rem', color: '#059669'}}>üìû {room.SDTKhach}</div>
                        </div>
                    ) : (
                        <span style={{color: '#cbd5e1'}}>---</span>
                    )}
                  </td>

                  {/* TH√îNG TIN NG√ÄY */}
                  <td style={styles.td}>
                    {isOccupied && room.NgayBatDauThue ? (
                        <div style={{fontSize: '0.9rem'}}>
                            <div style={{color: '#2563eb'}}>In: {formatDate(room.NgayBatDauThue)}</div>
                            <div style={{color: '#d97706'}}>Out: {formatDate(room.NgayDuKienTra)}</div>
                        </div>
                    ) : (
                        <span style={{color: '#cbd5e1'}}>---</span>
                    )}
                  </td>

                  <td style={{ ...styles.td, textAlign: "center" }}>
                    {/* N·∫øu lo·∫°i ph√≤ng Ng∆∞ng KD nh∆∞ng ph√≤ng ƒëang tr·ªëng -> Hi·ªán tr·∫°ng th√°i ƒë·∫∑c bi·ªát */}
                    {isTypeInactive && !isOccupied ? (
                        <span style={styles.inactiveBadge}>‚õî T·∫°m ng∆∞ng</span>
                    ) : (
                        <span style={statusBadgeStyle(room.TinhTrang)}>
                            {room.TinhTrang}
                        </span>
                    )}
                  </td>

                  <td style={{...styles.td, color: '#64748b', fontStyle: 'italic', fontSize: '0.85rem'}}>
                    {room.GhiChu || ""}
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>
    </div>
  );
};

// Styles
const styles = {
  wrapper: { width: "100%", maxWidth: "1400px", margin: "0 auto", padding: "2rem" },
  headerRow: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "2rem" },
  title: { fontSize: "2rem", fontWeight: 700, color: "#1F2A40", marginBottom: "0.5rem" },
  subtitle: { color: "#64748b", fontSize: "0.95rem" },
  quickStats: { display: 'flex', gap: '15px', marginRight: '10px', fontSize: '0.9rem', background: '#fff', padding: '8px 16px', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.05)' },
  searchInput: { padding: "0.7rem 1rem", borderRadius: "8px", border: "1px solid #e2e8f0", fontSize: "0.95rem", width: "240px", outline: "none" },
  filterSelect: { padding: "0.7rem 1rem", borderRadius: "8px", border: "1px solid #e2e8f0", fontSize: "0.95rem", outline: "none", cursor: "pointer", backgroundColor: "white" },
  clearSearchBtn: { position: 'absolute', right: '10px', top: '50%', transform: 'translateY(-50%)', background: 'transparent', border: 'none', color: '#94a3b8', cursor: 'pointer', fontWeight: 'bold' },
  tableCard: { background: "white", borderRadius: "16px", boxShadow: "0 4px 6px -1px rgba(0,0,0,0.1)", padding: "0", overflowX: "auto", border: "1px solid #e2e8f0" },
  table: { width: "100%", borderCollapse: "collapse", fontSize: "0.95rem" },
  th: { padding: "16px 24px", backgroundColor: "#f8fafc", borderBottom: "2px solid #e2e8f0", fontWeight: 600, color: "#475569", textAlign: "left", textTransform: "uppercase", fontSize: "0.8rem", letterSpacing: "0.05em" },
  tr: { borderBottom: "1px solid #f1f5f9", transition: 'background 0.2s' },
  td: { padding: "16px 24px", verticalAlign: "middle" },
  codeBadge: { fontFamily: 'monospace', background: '#f1f5f9', padding: '2px 6px', borderRadius: '4px', color: '#64748b', fontSize: '0.8rem', marginLeft: '0px' },
  
  // Style cho badge tr·∫°ng th√°i ng∆∞ng
  inactiveBadge: {
      display: "inline-block", padding: "6px 12px", borderRadius: "20px", fontWeight: 600, fontSize: "0.8rem", 
      backgroundColor: "#e5e7eb", color: "#6b7280", minWidth: "90px", textAlign: 'center', border: '1px solid #d1d5db'
  }
};

const loaiPhongBadgeStyle = (loai) => {
  const colors = { A: { bg: "#DBEAFE", color: "#1D4ED8" }, B: { bg: "#FEF3C7", color: "#D97706" }, C: { bg: "#FEE2E2", color: "#DC2626" }, D: { bg: "#E9D5FF", color: "#7C3AED" } };
  const style = colors[loai?.[0]] || { bg: "#E0EAFF", color: "#1E40AF" }; 
  return { display: "inline-block", padding: "4px 10px", borderRadius: "6px", fontWeight: 600, fontSize: "0.8rem", backgroundColor: style.bg, color: style.color };
};

const statusBadgeStyle = (status) => {
  let bg = "#f3f4f6"; let color = "#374151";
  if (status === "Tr·ªëng") { bg = "#dcfce7"; color = "#166534"; }
  else if (status === "ƒê√£ thu√™") { bg = "#fee2e2"; color = "#991b1b"; }
  else if (status === "B·∫£o tr√¨") { bg = "#ffedd5"; color = "#9a3412"; }
  return { display: "inline-block", padding: "6px 12px", borderRadius: "20px", fontWeight: 600, fontSize: "0.8rem", backgroundColor: bg, color: color, minWidth: "90px", textAlign: 'center' };
};

export default RoomSearch;
```

### frontend\src\pages\Settings.jsx
```jsx
import React, { useState, useEffect, useCallback } from "react";
import api from "../services/api";
import { Navigate } from "react-router-dom";

const Settings = () => {
  // ‚úÖ Role check (KH√îNG return tr∆∞·ªõc hook)
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const isAdmin = user?.vaiTro === "Admin";

  const [activeTab, setActiveTab] = useState("loaiphong");

  const [loaiPhongs, setLoaiPhongs] = useState([]);
  const [loaiKhachs, setLoaiKhachs] = useState([]);
  const [phuThus, setPhuThus] = useState([]);
  const [thamSo, setThamSo] = useState({
    SoKhachToiDa: 0,
    SoKhachKhongTinhPhuThu: 0,
  });

  const [loading, setLoading] = useState(false);

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingItem, setEditingItem] = useState(null);
  const [form, setForm] = useState({});

  // ‚úÖ ƒê√≥ng modal + reset khi ƒë·ªïi tab
  useEffect(() => {
    setIsModalOpen(false);
    setEditingItem(null);
    setForm({});
  }, [activeTab]);

  const formatCurrency = (value) => {
    if (value === null || value === undefined || value === "") return "";
    const n = Number(value);
    if (Number.isNaN(n)) return "";
    // ƒë·ªÉ d√πng d·∫•u ph·∫©y (,) ƒë√∫ng logic replace(/,/g,'')
    return n.toLocaleString("en-US");
  };

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      if (activeTab === "loaiphong") {
        const res = await api.get("/quidinh/loaiphong");
        setLoaiPhongs(Array.isArray(res.data) ? res.data : []);
      } else if (activeTab === "loaikhach") {
        const res = await api.get("/quidinh/loaikhach");
        setLoaiKhachs(Array.isArray(res.data) ? res.data : []);
      } else if (activeTab === "phuthu") {
        const res = await api.get("/quidinh/phuthu");
        setPhuThus(Array.isArray(res.data) ? res.data : []);
      } else if (activeTab === "thamso") {
        const res = await api.get("/quidinh/thamso");
        setThamSo({
          SoKhachToiDa: Number(res.data?.SoKhachToiDa ?? 0),
          SoKhachKhongTinhPhuThu: Number(res.data?.SoKhachKhongTinhPhuThu ?? 0),
        });
      }
    } catch (err) {
      console.error(err);
      alert("‚ùå L·ªói t·∫£i d·ªØ li·ªáu: " + (err?.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  }, [activeTab]);

  useEffect(() => {
    if (isAdmin) fetchData();
  }, [fetchData, isAdmin]);

  const handleDelete = async (id, type) => {
    if (!window.confirm("‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA Vƒ®NH VI·ªÑN m·ª•c n√†y?")) return;
    try {
      await api.delete(`/quidinh/${type}/${id}`);
      alert("‚úÖ ƒê√£ x√≥a th√†nh c√¥ng!");
      fetchData();
    } catch (err) {
      const msg = err?.response?.data?.message || err.message;
      alert("‚ùå " + msg);
    }
  };

  const handleSave = async () => {
    try {
      if (activeTab === "loaiphong") {
        const rawPrice = form.DonGia ? String(form.DonGia).replace(/,/g, "") : "0";
        const payload = {
          maLoai: (form.MaLoaiPhong || "").trim(),
          tenLoai: (form.TenLoaiPhong || "").trim(),
          donGia: Number(rawPrice),
        };

        if (!payload.maLoai || !payload.tenLoai) {
          alert("‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß M√£ lo·∫°i v√† T√™n lo·∫°i ph√≤ng.");
          return;
        }

        if (editingItem) {
          await api.put(`/quidinh/loaiphong/${editingItem.MaLoaiPhong}`, payload);
        } else {
          await api.post(`/quidinh/loaiphong`, payload);
        }
      } else if (activeTab === "loaikhach") {
        const payload = {
          maLoai: (form.MaLoaiKhach || "").trim(),
          tenLoai: (form.TenLoaiKhach || "").trim(),
          heSo: Number(form.HeSoPhuThu),
        };

        if (!payload.maLoai || !payload.tenLoai) {
          alert("‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß M√£ lo·∫°i v√† T√™n lo·∫°i kh√°ch.");
          return;
        }
        if (Number.isNaN(payload.heSo)) {
          alert("‚ùå H·ªá s·ªë ph·ª• thu kh√¥ng h·ª£p l·ªá.");
          return;
        }

        if (editingItem) {
          await api.put(`/quidinh/loaikhach/${editingItem.MaLoaiKhach}`, payload);
        } else {
          await api.post(`/quidinh/loaikhach`, payload);
        }
      } else if (activeTab === "phuthu") {
        const payload = {
          khachThu: Number(form.KhachThu),
          tiLe: Number(form.TiLePhuThu),
        };

        if (!Number.isInteger(payload.khachThu) || payload.khachThu <= 0) {
          alert("‚ùå 'Kh√°ch d∆∞ th·ª©' ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng.");
          return;
        }
        if (Number.isNaN(payload.tiLe) || payload.tiLe < 0) {
          alert("‚ùå 'T·ªâ l·ªá ph·ª• thu' kh√¥ng h·ª£p l·ªá.");
          return;
        }

        // ‚úÖ N·∫øu backend b·∫°n c√≥ PUT th√¨ d√πng; n·∫øu ch∆∞a c√≥ th√¨ b·∫°n c√≥ th·ªÉ ƒë·ªïi l·∫°i ch·ªâ POST
        if (editingItem) {
          await api.put(`/quidinh/phuthu/${editingItem.KhachThu}`, payload);
        } else {
          await api.post(`/quidinh/phuthu`, payload);
        }
      }

      alert("‚úÖ L∆∞u d·ªØ li·ªáu th√†nh c√¥ng!");
      setIsModalOpen(false);
      setEditingItem(null);
      setForm({});
      fetchData();
    } catch (err) {
      alert("‚ùå L·ªói: " + (err?.response?.data?.message || err.message));
    }
  };

  const handleSaveThamSo = async () => {
    try {
      const payload = {
        SoKhachToiDa: Number(thamSo.SoKhachToiDa),
        SoKhachKhongTinhPhuThu: Number(thamSo.SoKhachKhongTinhPhuThu),
      };

      if (Number.isNaN(payload.SoKhachToiDa) || payload.SoKhachToiDa <= 0) {
        alert("‚ùå S·ªë kh√°ch t·ªëi ƒëa ph·∫£i l√† s·ªë > 0.");
        return;
      }
      if (
        Number.isNaN(payload.SoKhachKhongTinhPhuThu) ||
        payload.SoKhachKhongTinhPhuThu < 0
      ) {
        alert("‚ùå S·ªë kh√°ch ti√™u chu·∫©n kh√¥ng h·ª£p l·ªá.");
        return;
      }
      if (payload.SoKhachKhongTinhPhuThu > payload.SoKhachToiDa) {
        alert("‚ùå S·ªë kh√°ch ti√™u chu·∫©n kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n s·ªë kh√°ch t·ªëi ƒëa.");
        return;
      }

      await api.put(`/quidinh/thamso`, payload);
      alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t tham s·ªë h·ªá th·ªëng!");
      fetchData();
    } catch (err) {
      alert("‚ùå L·ªói c·∫≠p nh·∫≠t tham s·ªë: " + (err?.response?.data?.message || err.message));
    }
  };

  const openModal = (item) => {
    setEditingItem(item);

    if (item) {
      setForm({ ...item });
    } else {
      if (activeTab === "loaiphong") setForm({ MaLoaiPhong: "", TenLoaiPhong: "", DonGia: "" });
      if (activeTab === "loaikhach") setForm({ MaLoaiKhach: "", TenLoaiKhach: "", HeSoPhuThu: 1.0 });
      if (activeTab === "phuthu") setForm({ KhachThu: "", TiLePhuThu: 0.25 });
    }

    setIsModalOpen(true);
  };

  const renderActions = (item, id, type) => {
    return (
      <div style={{ display: "flex", gap: "8px", justifyContent: "center" }}>
        <button style={styles.btnEdit} onClick={() => openModal(item)} title="S·ª≠a th√¥ng tin">
          ‚úèÔ∏è S·ª≠a
        </button>
        <button style={styles.btnDelete} onClick={() => handleDelete(id, type)} title="X√≥a m·ª•c n√†y">
          üóëÔ∏è X√≥a
        </button>
      </div>
    );
  };

  // ‚úÖ Redirect staff/user
  if (!isAdmin) return <Navigate to="/" replace />;

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>‚öôÔ∏è C·∫•u h√¨nh quy ƒë·ªãnh</h1>
          <p style={styles.subtitle}>Qu·∫£n l√Ω danh m·ª•c ph√≤ng, kh√°ch v√† tham s·ªë h·ªá th·ªëng.</p>
        </div>
      </div>

      <div style={styles.tabContainer}>
        {["loaiphong", "loaikhach", "phuthu", "thamso"].map((tab) => (
          <button
            key={tab}
            style={activeTab === tab ? styles.tabActive : styles.tab}
            onClick={() => setActiveTab(tab)}
          >
            {tab === "loaiphong" && "üè® Lo·∫°i Ph√≤ng"}
            {tab === "loaikhach" && "üë• Lo·∫°i Kh√°ch"}
            {tab === "phuthu" && "üí∞ Ph·ª• Thu"}
            {tab === "thamso" && "üõ†Ô∏è Tham S·ªë"}
          </button>
        ))}
      </div>

      {loading && <p style={{ textAlign: "center", color: "#64748b" }}>‚è≥ ƒêang t·∫£i...</p>}

      <div style={styles.content}>
        {/* --- LO·∫†I PH√íNG --- */}
        {activeTab === "loaiphong" && (
          <div>
            <div style={{ display: "flex", justifyContent: "flex-end", marginBottom: "20px" }}>
              <button style={styles.btnAdd} onClick={() => openModal(null)}>
                + Th√™m Lo·∫°i Ph√≤ng
              </button>
            </div>

            <div style={styles.card}>
              <table style={styles.table}>
                <thead>
                  <tr style={styles.tableHeader}>
                    <th style={styles.th}>M√£ Lo·∫°i</th>
                    <th style={styles.th}>T√™n Lo·∫°i Ph√≤ng</th>
                    <th style={{ ...styles.th, textAlign: "right" }}>ƒê∆°n Gi√°</th>
                    <th style={{ ...styles.th, textAlign: "center", width: "180px" }}>H√†nh ƒë·ªông</th>
                  </tr>
                </thead>
                <tbody>
                  {loaiPhongs.map((item, idx) => (
                    <tr
                      key={item.MaLoaiPhong}
                      style={{
                        borderBottom: "1px solid #f1f5f9",
                        background: idx % 2 === 0 ? "#fff" : "#f8fafc",
                      }}
                    >
                      <td style={styles.td}>
                        <span style={styles.codeBadge}>{item.MaLoaiPhong}</span>
                      </td>
                      <td style={{ ...styles.td, fontWeight: "600" }}>{item.TenLoaiPhong}</td>
                      <td style={{ ...styles.td, textAlign: "right", fontWeight: "bold", color: "#2563eb" }}>
                        {formatCurrency(item.DonGia)}{" "}
                        <span style={{ fontSize: "0.8em", color: "#64748b" }}>VND</span>
                      </td>
                      <td style={{ ...styles.td, textAlign: "center" }}>
                        {renderActions(item, item.MaLoaiPhong, "loaiphong")}
                      </td>
                    </tr>
                  ))}
                  {loaiPhongs.length === 0 && !loading && (
                    <tr>
                      <td colSpan={4} style={{ padding: 24, textAlign: "center", color: "#94a3b8" }}>
                        Ch∆∞a c√≥ d·ªØ li·ªáu.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* --- LO·∫†I KH√ÅCH --- */}
        {activeTab === "loaikhach" && (
          <div>
            <div style={{ display: "flex", justifyContent: "flex-end", marginBottom: "20px" }}>
              <button style={styles.btnAdd} onClick={() => openModal(null)}>
                + Th√™m Lo·∫°i Kh√°ch
              </button>
            </div>

            <div style={styles.card}>
              <table style={styles.table}>
                <thead>
                  <tr style={styles.tableHeader}>
                    <th style={styles.th}>M√£ Lo·∫°i</th>
                    <th style={styles.th}>T√™n Lo·∫°i Kh√°ch</th>
                    <th style={{ ...styles.th, textAlign: "right" }}>H·ªá S·ªë Ph·ª• Thu</th>
                    <th style={{ ...styles.th, textAlign: "center", width: "180px" }}>H√†nh ƒë·ªông</th>
                  </tr>
                </thead>
                <tbody>
                  {loaiKhachs.map((item, idx) => (
                    <tr
                      key={item.MaLoaiKhach}
                      style={{
                        borderBottom: "1px solid #f1f5f9",
                        background: idx % 2 === 0 ? "#fff" : "#f8fafc",
                      }}
                    >
                      <td style={styles.td}>
                        <span style={styles.codeBadge}>{item.MaLoaiKhach}</span>
                      </td>
                      <td style={{ ...styles.td, fontWeight: "600" }}>{item.TenLoaiKhach}</td>
                      <td style={{ ...styles.td, textAlign: "right", fontWeight: "bold" }}>x {item.HeSoPhuThu}</td>
                      <td style={{ ...styles.td, textAlign: "center" }}>
                        {renderActions(item, item.MaLoaiKhach, "loaikhach")}
                      </td>
                    </tr>
                  ))}
                  {loaiKhachs.length === 0 && !loading && (
                    <tr>
                      <td colSpan={4} style={{ padding: 24, textAlign: "center", color: "#94a3b8" }}>
                        Ch∆∞a c√≥ d·ªØ li·ªáu.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* --- PH·ª§ THU --- */}
        {activeTab === "phuthu" && (
          <div>
            <div style={{ display: "flex", justifyContent: "flex-end", marginBottom: "20px" }}>
              <button style={styles.btnAdd} onClick={() => openModal(null)}>
                + Th√™m M·ªëc Ph·ª• Thu
              </button>
            </div>

            <div style={styles.card}>
              <table style={styles.table}>
                <thead>
                  <tr style={styles.tableHeader}>
                    <th style={styles.th}>Kh√°ch D∆∞ Th·ª©...</th>
                    <th style={{ ...styles.th, textAlign: "right" }}>T·ªâ L·ªá Ph·ª• Thu</th>
                    <th style={{ ...styles.th, textAlign: "center", width: "180px" }}>H√†nh ƒë·ªông</th>
                  </tr>
                </thead>
                <tbody>
                  {phuThus.map((item, idx) => (
                    <tr
                      key={item.KhachThu}
                      style={{
                        borderBottom: "1px solid #f1f5f9",
                        background: idx % 2 === 0 ? "#fff" : "#f8fafc",
                      }}
                    >
                      <td style={styles.td}>
                        <strong>Kh√°ch th·ª© {item.KhachThu}</strong>
                      </td>
                      <td style={{ ...styles.td, textAlign: "right", fontWeight: "bold", color: "#d97706" }}>
                        {Number(item.TiLePhuThu || 0) * 100}%
                      </td>
                      <td style={{ ...styles.td, textAlign: "center" }}>
                        {renderActions(item, item.KhachThu, "phuthu")}
                      </td>
                    </tr>
                  ))}
                  {phuThus.length === 0 && !loading && (
                    <tr>
                      <td colSpan={3} style={{ padding: 24, textAlign: "center", color: "#94a3b8" }}>
                        Ch∆∞a c√≥ d·ªØ li·ªáu.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* --- THAM S·ªê --- */}
        {activeTab === "thamso" && (
          <div style={styles.card}>
            <div style={{ padding: "40px", maxWidth: "650px", margin: "0 auto" }}>
              <div style={{ textAlign: "center", marginBottom: "30px" }}>
                <h3 style={{ fontSize: "1.5rem", marginBottom: "10px", color: "#1e293b" }}>Quy ƒë·ªãnh chung</h3>
                <p style={{ color: "#64748b" }}>C·∫•u h√¨nh c√°c tham s·ªë c·ªët l√µi cho vi·ªác thu√™ ph√≤ng</p>
              </div>

              <div style={styles.paramItem}>
                <div style={{ flex: 1 }}>
                  <label style={styles.label}>S·ªë kh√°ch t·ªëi ƒëa trong 1 ph√≤ng</label>
                  <p style={styles.desc}>Gi·ªõi h·∫°n s·ªë ng∆∞·ªùi (bao g·ªìm c·∫£ tr·∫ª em) ƒë∆∞·ª£c ph√©p ·ªü.</p>
                </div>
                <input
                  type="number"
                  style={styles.inputLarge}
                  value={thamSo.SoKhachToiDa}
                  onChange={(e) => setThamSo({ ...thamSo, SoKhachToiDa: Number(e.target.value) })}
                />
              </div>

              <div style={styles.paramItem}>
                <div style={{ flex: 1 }}>
                  <label style={styles.label}>S·ªë kh√°ch ti√™u chu·∫©n</label>
                  <p style={styles.desc}>S·ªë l∆∞·ª£ng kh√°ch t·ªëi ƒëa kh√¥ng b·ªã t√≠nh ph·ª• thu.</p>
                </div>
                <input
                  type="number"
                  style={styles.inputLarge}
                  value={thamSo.SoKhachKhongTinhPhuThu}
                  onChange={(e) => setThamSo({ ...thamSo, SoKhachKhongTinhPhuThu: Number(e.target.value) })}
                />
              </div>

              <div style={{ textAlign: "right", marginTop: "40px", paddingTop: "20px", borderTop: "1px solid #e2e8f0" }}>
                <button style={styles.btnSave} onClick={handleSaveThamSo}>
                  üíæ L∆∞u Thay ƒê·ªïi
                </button>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* MODAL */}
      {isModalOpen && (
        <div style={styles.overlay} onClick={() => setIsModalOpen(false)}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <div style={styles.modalHeader}>
              <h2 style={{ margin: 0, fontSize: "1.25rem", color: "#1e293b" }}>
                {editingItem ? "‚úèÔ∏è C·∫≠p nh·∫≠t th√¥ng tin" : "‚ú® Th√™m m·ªõi"}
              </h2>
              <button onClick={() => setIsModalOpen(false)} style={styles.closeBtn}>
                ‚úï
              </button>
            </div>

            <div style={{ padding: "24px" }}>
              {activeTab === "loaiphong" && (
                <>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>M√£ Lo·∫°i (A, B, C...):</label>
                    <input
                      style={styles.inputModal}
                      disabled={!!editingItem}
                      value={form.MaLoaiPhong || ""}
                      onChange={(e) => setForm({ ...form, MaLoaiPhong: e.target.value.toUpperCase() })}
                    />
                  </div>

                  <div style={styles.formGroup}>
                    <label style={styles.label}>T√™n Lo·∫°i:</label>
                    <input
                      style={styles.inputModal}
                      value={form.TenLoaiPhong || ""}
                      onChange={(e) => setForm({ ...form, TenLoaiPhong: e.target.value })}
                    />
                  </div>

                  <div style={styles.formGroup}>
                    <label style={styles.label}>ƒê∆°n Gi√° (VND):</label>
                    <input
                      type="text"
                      style={styles.inputModal}
                      value={formatCurrency(form.DonGia)}
                      onChange={(e) => {
                        const raw = e.target.value.replace(/,/g, "");
                        if (raw === "" || !Number.isNaN(Number(raw))) setForm({ ...form, DonGia: raw });
                      }}
                    />
                  </div>
                </>
              )}

              {activeTab === "loaikhach" && (
                <>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>M√£ Lo·∫°i (NN, ND...):</label>
                    <input
                      style={styles.inputModal}
                      disabled={!!editingItem}
                      value={form.MaLoaiKhach || ""}
                      onChange={(e) => setForm({ ...form, MaLoaiKhach: e.target.value.toUpperCase() })}
                    />
                  </div>

                  <div style={styles.formGroup}>
                    <label style={styles.label}>T√™n Lo·∫°i:</label>
                    <input
                      style={styles.inputModal}
                      value={form.TenLoaiKhach || ""}
                      onChange={(e) => setForm({ ...form, TenLoaiKhach: e.target.value })}
                    />
                  </div>

                  <div style={styles.formGroup}>
                    <label style={styles.label}>H·ªá s·ªë ph·ª• thu:</label>
                    <input
                      type="number"
                      step="0.1"
                      style={styles.inputModal}
                      value={form.HeSoPhuThu ?? ""}
                      onChange={(e) => setForm({ ...form, HeSoPhuThu: Number(e.target.value) })}
                    />
                  </div>
                </>
              )}

              {activeTab === "phuthu" && (
                <>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>Kh√°ch d∆∞ th·ª©:</label>
                    <input
                      type="number"
                      style={styles.inputModal}
                      disabled={!!editingItem} // ‚úÖ tr√°nh ƒë·ªïi kh√≥a ch√≠nh khi s·ª≠a
                      value={form.KhachThu ?? ""}
                      onChange={(e) => setForm({ ...form, KhachThu: Number(e.target.value) })}
                    />
                  </div>

                  <div style={styles.formGroup}>
                    <label style={styles.label}>T·ªâ l·ªá (VD: 0.25 = 25%):</label>
                    <input
                      type="number"
                      step="0.01"
                      style={styles.inputModal}
                      value={form.TiLePhuThu ?? ""}
                      onChange={(e) => setForm({ ...form, TiLePhuThu: Number(e.target.value) })}
                    />
                  </div>
                </>
              )}

              <div style={{ textAlign: "right", marginTop: 30, display: "flex", justifyContent: "flex-end", gap: "12px" }}>
                <button style={styles.btnCancel} onClick={() => setIsModalOpen(false)}>
                  H·ªßy b·ªè
                </button>
                <button style={styles.btnSaveModal} onClick={handleSave}>
                  L∆∞u th√¥ng tin
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// --- STYLES ---
const styles = {
  wrapper: { width: "100%", maxWidth: "1200px", margin: "0 auto", padding: "2rem" },
  headerRow: { marginBottom: "2rem" },
  title: { fontSize: "2rem", fontWeight: 800, color: "#1e293b", marginBottom: "0.5rem" },
  subtitle: { color: "#64748b", fontSize: "1rem" },

  content: { marginTop: "10px" },

  tabContainer: { display: "flex", borderBottom: "2px solid #e2e8f0", marginBottom: "25px", gap: "20px" },
  tab: {
    padding: "12px 10px",
    background: "transparent",
    border: "none",
    cursor: "pointer",
    fontSize: "1rem",
    color: "#64748b",
    fontWeight: "600",
    transition: "0.2s",
    borderBottom: "3px solid transparent",
  },
  tabActive: {
    padding: "12px 10px",
    background: "transparent",
    border: "none",
    cursor: "pointer",
    fontSize: "1rem",
    color: "#3b82f6",
    fontWeight: "bold",
    borderBottom: "3px solid #3b82f6",
  },

  card: {
    background: "white",
    borderRadius: "16px",
    boxShadow: "0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)",
    overflow: "hidden",
    border: "1px solid #e2e8f0",
  },

  table: { width: "100%", borderCollapse: "collapse", fontSize: "0.95rem" },
  tableHeader: { backgroundColor: "#f8fafc", textTransform: "uppercase", fontSize: "0.8rem", letterSpacing: "0.5px" },
  th: { padding: "16px 24px", fontWeight: 600, color: "#475569", textAlign: "left", borderBottom: "1px solid #e2e8f0" },
  td: { padding: "16px 24px", verticalAlign: "middle", color: "#334155" },

  codeBadge: {
    fontFamily: "monospace",
    background: "#e2e8f0",
    padding: "4px 8px",
    borderRadius: "6px",
    fontSize: "0.9rem",
    fontWeight: "bold",
    color: "#475569",
  },

  btnAdd: {
    padding: "10px 20px",
    backgroundColor: "#3b82f6",
    color: "white",
    borderRadius: "8px",
    border: "none",
    cursor: "pointer",
    fontWeight: 600,
    fontSize: "0.95rem",
    boxShadow: "0 4px 10px rgba(59, 130, 246, 0.3)",
    transition: "all 0.2s",
    display: "flex",
    alignItems: "center",
    gap: "5px",
  },

  btnEdit: {
    background: "#e0f2fe",
    color: "#0284c7",
    border: "1px solid #bae6fd",
    padding: "6px 14px",
    borderRadius: "8px",
    cursor: "pointer",
    fontSize: "0.85rem",
    fontWeight: 700,
    transition: "all 0.2s",
    display: "flex",
    alignItems: "center",
    gap: "5px",
  },

  btnDelete: {
    background: "#fee2e2",
    color: "#ef4444",
    border: "1px solid #fecaca",
    padding: "6px 14px",
    borderRadius: "8px",
    cursor: "pointer",
    fontSize: "0.85rem",
    fontWeight: 700,
    transition: "all 0.2s",
    display: "flex",
    alignItems: "center",
    gap: "5px",
  },

  paramItem: { display: "flex", alignItems: "center", gap: "20px", padding: "20px 0", borderBottom: "1px dashed #e2e8f0" },
  desc: { fontSize: "0.85rem", color: "#94a3b8", margin: "4px 0 0 0" },
  inputLarge: {
    width: "80px",
    padding: "10px",
    borderRadius: "8px",
    border: "2px solid #e2e8f0",
    fontSize: "1.2rem",
    textAlign: "center",
    outline: "none",
    color: "#334155",
    fontWeight: "bold",
  },
  btnSave: {
    padding: "12px 30px",
    background: "#2563eb",
    color: "white",
    border: "none",
    borderRadius: "8px",
    fontSize: "1rem",
    fontWeight: "bold",
    cursor: "pointer",
    boxShadow: "0 4px 6px rgba(37, 99, 235, 0.3)",
  },

  overlay: {
    position: "fixed",
    inset: 0,
    backgroundColor: "rgba(0,0,0,0.5)",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    zIndex: 999,
    backdropFilter: "blur(2px)",
  },
  modal: { width: "100%", maxWidth: "500px", background: "white", borderRadius: "16px", boxShadow: "0 20px 25px -5px rgba(0,0,0,0.1)", overflow: "hidden" },
  modalHeader: { padding: "20px 24px", background: "#f8fafc", borderBottom: "1px solid #e2e8f0", display: "flex", justifyContent: "space-between", alignItems: "center" },
  closeBtn: { background: "transparent", border: "none", fontSize: "20px", cursor: "pointer", color: "#64748b" },

  formGroup: { marginBottom: "20px" },
  label: { display: "block", marginBottom: "8px", fontSize: "0.9rem", fontWeight: "600", color: "#334155" },
  inputModal: { width: "100%", padding: "12px", borderRadius: "8px", border: "1px solid #cbd5e1", outline: "none", boxSizing: "border-box", fontSize: "1rem", transition: "border 0.2s" },

  btnSaveModal: { padding: "10px 24px", background: "#3b82f6", color: "white", border: "none", borderRadius: "8px", fontSize: "0.95rem", fontWeight: "bold", cursor: "pointer" },
  btnCancel: { padding: "10px 24px", background: "#f1f5f9", color: "#64748b", border: "1px solid #cbd5e1", borderRadius: "8px", fontSize: "0.95rem", fontWeight: "600", cursor: "pointer" },
};

export default Settings;
```

### frontend\src\pages\StaffManagement.jsx
```jsx
import React, { useCallback, useEffect, useMemo, useState } from "react";
import { Navigate } from "react-router-dom";
import api from "../services/api";

// ===== Helpers =====
const pick = (obj, keys, fallback = "") => {
  for (const k of keys) {
    if (obj && obj[k] !== undefined && obj[k] !== null && obj[k] !== "") return obj[k];
  }
  return fallback;
};

const normalizeUser = (u) => {
  const id = pick(u, ["MaNV", "id", "ID", "userId"]);
  const username = pick(u, ["Username", "username", "TenDangNhap"]);
  const hoTen = pick(u, ["HoTen", "hoTen", "fullName", "TenNV"]);
  const vaiTro = pick(u, ["VaiTro", "vaiTro", "role"], "User");
  const ngayTao = pick(u, ["NgayTao", "createdAt", "ngayTao"]);
  return { raw: u, id, username, hoTen, vaiTro, ngayTao };
};

const formatDateTimeVN = (value) => {
  if (!value) return "-";
  const d = new Date(value);
  if (Number.isNaN(d.getTime())) return "-";
  return (
    d.toLocaleDateString("vi-VN") +
    " " +
    d.toLocaleTimeString("vi-VN", { hour: "2-digit", minute: "2-digit" })
  );
};

const emptyForm = {
  username: "",
  password: "",
  hoTen: "",
  vaiTro: "User",
};

const StaffManagement = () => {
  // ‚úÖ Role check (KH√îNG return tr∆∞·ªõc hook)
  const user = JSON.parse(localStorage.getItem("user") || "{}");
  const isAdmin = user?.vaiTro === "Admin";

  const [staff, setStaff] = useState([]);
  const [loading, setLoading] = useState(false);

  // Search + Filter
  const [searchTerm, setSearchTerm] = useState("");
  const [roleFilter, setRoleFilter] = useState("ALL"); // ALL | Admin | User

  // Modal state
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [mode, setMode] = useState("add"); // add | edit
  const [editing, setEditing] = useState(null); // normalized user
  const [form, setForm] = useState(emptyForm);
  const [saving, setSaving] = useState(false);
  const [errors, setErrors] = useState({});

  // ========= API call with fallback =========
  const apiGetWithFallback = useCallback(async (primary, fallback) => {
    try {
      return await api.get(primary);
    } catch (err) {
      const status = err?.response?.status;
      if (status === 404 && fallback) return await api.get(fallback);
      throw err;
    }
  }, []);

  const apiPutWithFallback = useCallback(async (primary, fallback, payload) => {
    try {
      return await api.put(primary, payload);
    } catch (err) {
      const status = err?.response?.status;
      if (status === 404 && fallback) return await api.put(fallback, payload);
      throw err;
    }
  }, []);

  const apiDeleteWithFallback = useCallback(async (primary, fallback) => {
    try {
      return await api.delete(primary);
    } catch (err) {
      const status = err?.response?.status;
      if (status === 404 && fallback) return await api.delete(fallback);
      throw err;
    }
  }, []);

  const apiPostWithFallback = useCallback(async (primary, fallback, payload) => {
    try {
      return await api.post(primary, payload);
    } catch (err) {
      const status = err?.response?.status;
      if (status === 404 && fallback) return await api.post(fallback, payload);
      throw err;
    }
  }, []);

  // ========= Fetch list =========
  const fetchStaff = useCallback(async () => {
    setLoading(true);
    try {
      // ∆∞u ti√™n /users, fallback /staff
      const res = await apiGetWithFallback("/users", "/staff");
      const list = Array.isArray(res.data) ? res.data : [];
      setStaff(list.map(normalizeUser));
    } catch (e) {
      console.error(e);
      alert("‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch nh√¢n vi√™n: " + (e?.response?.data?.message || e.message));
    } finally {
      setLoading(false);
    }
  }, [apiGetWithFallback]);

  useEffect(() => {
    if (isAdmin) fetchStaff();
  }, [fetchStaff, isAdmin]);

  // ========= Modal handlers =========
  const openAddModal = () => {
    setMode("add");
    setEditing(null);
    setForm(emptyForm);
    setErrors({});
    setIsModalOpen(true);
  };

  const openEditModal = (row) => {
    setMode("edit");
    setEditing(row);
    setForm({
      username: row.username || "",
      password: "", // edit: password optional
      hoTen: row.hoTen || "",
      vaiTro: row.vaiTro || "User",
    });
    setErrors({});
    setIsModalOpen(true);
  };

  const closeModal = () => {
    if (saving) return;
    setIsModalOpen(false);
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  // ========= Validate =========
  const validate = () => {
    const errs = {};
    if (!form.username.trim()) errs.username = "Username kh√¥ng ƒë∆∞·ª£c tr·ªëng";
    if (!form.hoTen.trim()) errs.hoTen = "H·ªç t√™n kh√¥ng ƒë∆∞·ª£c tr·ªëng";
    if (!form.vaiTro) errs.vaiTro = "Ch·ªçn vai tr√≤";

    if (mode === "add") {
      if (!form.password || form.password.length < 6) errs.password = "M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±";
    } else {
      // edit: n·∫øu nh·∫≠p m·∫≠t kh·∫©u m·ªõi th√¨ c≈©ng ph·∫£i >= 6
      if (form.password && form.password.length < 6) errs.password = "M·∫≠t kh·∫©u m·ªõi t·ªëi thi·ªÉu 6 k√Ω t·ª±";
    }

    setErrors(errs);
    return Object.keys(errs).length === 0;
  };

  // ========= Save (add/edit) =========
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validate()) return;

    setSaving(true);
    try {
      if (mode === "add") {
        // ‚úÖ ƒë√∫ng v·ªõi authRoutes.js b·∫°n g·ª≠i: POST /auth/create {username,password,hoTen,vaiTro}
        const payload = {
          username: form.username.trim(),
          password: form.password,
          hoTen: form.hoTen.trim(),
          vaiTro: form.vaiTro,
        };

        await apiPostWithFallback("/auth/create", "/users", payload);
        alert("‚úÖ T·∫°o nh√¢n vi√™n th√†nh c√¥ng!");
      } else {
        // update (ƒë·∫∑t theo pattern ph·ªï bi·∫øn)
        // payload update: cho ph√©p s·ª≠a username/hoTen/vaiTro, password n·∫øu c√≥ nh·∫≠p
        const payload = {
          username: form.username.trim(),
          hoTen: form.hoTen.trim(),
          vaiTro: form.vaiTro,
          ...(form.password ? { password: form.password } : {}),
        };

        const id = editing?.id;
        if (!id) {
          alert("‚ùå Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c m√£ nh√¢n vi√™n ƒë·ªÉ c·∫≠p nh·∫≠t.");
          return;
        }

        await apiPutWithFallback(`/users/${id}`, `/staff/${id}`, payload);
        alert("‚úÖ C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng!");
      }

      setIsModalOpen(false);
      fetchStaff();
    } catch (err) {
      console.error(err);
      const msg = err?.response?.data?.message || err?.response?.data?.error || err.message;
      alert("‚ùå " + msg);
    } finally {
      setSaving(false);
    }
  };

  // ========= Delete =========
  const handleDelete = async (row) => {
    const id = row?.id;
    if (!id) return alert("‚ùå Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c m√£ nh√¢n vi√™n ƒë·ªÉ x√≥a.");

    if (!window.confirm(`B·∫°n ch·∫Øc ch·∫Øn mu·ªën X√ìA nh√¢n vi√™n "${row.hoTen}" (ID: ${id})?`)) return;

    try {
      await apiDeleteWithFallback(`/users/${id}`, `/staff/${id}`);
      alert("‚úÖ ƒê√£ x√≥a nh√¢n vi√™n!");
      fetchStaff();
    } catch (err) {
      const msg = err?.response?.data?.message || err.message;
      alert("‚ùå " + msg);
    }
  };

  // ========= Filtered list =========
  const filteredStaff = useMemo(() => {
    const term = searchTerm.trim().toLowerCase();

    return staff.filter((s) => {
      if (roleFilter !== "ALL" && String(s.vaiTro) !== roleFilter) return false;
      if (!term) return true;

      return (
        String(s.id).toLowerCase().includes(term) ||
        String(s.username).toLowerCase().includes(term) ||
        String(s.hoTen).toLowerCase().includes(term) ||
        String(s.vaiTro).toLowerCase().includes(term)
      );
    });
  }, [staff, searchTerm, roleFilter]);

  // ========= Guard =========
  if (!isAdmin) return <Navigate to="/" replace />;

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>üë• Qu·∫£n l√Ω nh√¢n vi√™n</h1>
          <p style={styles.subtitle}>
            T·∫°o t√†i kho·∫£n nh√¢n vi√™n (User) v√† qu·∫£n tr·ªã (Admin). Ch·ªâ Admin ƒë∆∞·ª£c truy c·∫≠p trang n√†y.
          </p>
        </div>

        <div style={{ display: "flex", gap: 10, alignItems: "center" }}>
          <select value={roleFilter} onChange={(e) => setRoleFilter(e.target.value)} style={styles.select}>
            <option value="ALL">T·∫•t c·∫£ vai tr√≤</option>
            <option value="Admin">Admin</option>
            <option value="User">User</option>
          </select>

          <div style={{ position: "relative" }}>
            <input
              style={styles.searchInput}
              placeholder="üîç T√¨m theo m√£, h·ªç t√™n, username..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
            {searchTerm && (
              <button
                style={styles.clearBtn}
                title="X√≥a t√¨m ki·∫øm"
                onClick={() => setSearchTerm("")}
              >
                ‚úï
              </button>
            )}
          </div>

          <button style={styles.btnPrimary} onClick={openAddModal}>
            + Th√™m nh√¢n vi√™n
          </button>
        </div>
      </div>

      <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 12 }}>
        <div style={{ color: "#64748b", fontSize: 14 }}>
          T·ªïng: <b>{filteredStaff.length}</b> nh√¢n vi√™n
        </div>
        <button style={styles.btnGhost} onClick={fetchStaff} disabled={loading}>
          {loading ? "‚è≥ ƒêang t·∫£i..." : "‚Üª T·∫£i l·∫°i"}
        </button>
      </div>

      <div style={styles.tableCard}>
        <table style={styles.table}>
          <thead>
            <tr>
              <th style={styles.th}>M√£</th>
              <th style={styles.th}>H·ªç t√™n</th>
              <th style={styles.th}>Username</th>
              <th style={styles.th}>Vai tr√≤</th>
              <th style={styles.th}>Ng√†y t·∫°o</th>
              <th style={{ ...styles.th, textAlign: "center", width: 220 }}>H√†nh ƒë·ªông</th>
            </tr>
          </thead>

          <tbody>
            {loading ? (
              <tr>
                <td colSpan={6} style={{ padding: 24, textAlign: "center", color: "#64748b" }}>
                  ‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...
                </td>
              </tr>
            ) : filteredStaff.length === 0 ? (
              <tr>
                <td colSpan={6} style={{ padding: 28, textAlign: "center", color: "#64748b" }}>
                  <div style={{ fontSize: 40, marginBottom: 8 }}>üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                  Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n ph√π h·ª£p.
                </td>
              </tr>
            ) : (
              filteredStaff.map((s) => (
                <tr key={s.id} style={styles.tr}>
                  <td style={styles.td}>
                    <span style={styles.codeBadge}>{s.id}</span>
                  </td>
                  <td style={{ ...styles.td, fontWeight: 700, color: "#0f172a" }}>{s.hoTen}</td>
                  <td style={styles.td}>{s.username}</td>
                  <td style={styles.td}>
                    <span style={roleBadgeStyle(s.vaiTro)}>{s.vaiTro}</span>
                  </td>
                  <td style={styles.td}>{formatDateTimeVN(s.ngayTao)}</td>
                  <td style={{ ...styles.td, textAlign: "center" }}>
                    <div style={styles.actionRow}>
                      <button style={styles.btnEdit} onClick={() => openEditModal(s)}>
                        ‚úèÔ∏è S·ª≠a
                      </button>
                      <button style={styles.btnDelete} onClick={() => handleDelete(s)}>
                        üóëÔ∏è X√≥a
                      </button>
                    </div>
                  </td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>

      {/* ===== MODAL ===== */}
      {isModalOpen && (
        <div style={styles.overlay} onClick={closeModal}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <div style={styles.modalHeader}>
              <h2 style={styles.modalTitle}>
                {mode === "add" ? "‚ú® Th√™m nh√¢n vi√™n" : "‚úèÔ∏è C·∫≠p nh·∫≠t nh√¢n vi√™n"}
              </h2>
              <button style={styles.closeBtn} onClick={closeModal} disabled={saving}>
                ‚úï
              </button>
            </div>

            <form style={{ padding: 20 }} onSubmit={handleSubmit}>
              <div style={styles.formGrid}>
                <div style={styles.formGroup}>
                  <label style={styles.label}>Username</label>
                  <input
                    name="username"
                    value={form.username}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder="VD: nhanvien01"
                    disabled={saving}
                  />
                  {errors.username && <div style={styles.errorText}>{errors.username}</div>}
                </div>

                <div style={styles.formGroup}>
                  <label style={styles.label}>Vai tr√≤</label>
                  <select
                    name="vaiTro"
                    value={form.vaiTro}
                    onChange={handleChange}
                    style={styles.input}
                    disabled={saving}
                  >
                    <option value="User">User (Nh√¢n vi√™n)</option>
                    <option value="Admin">Admin (Ch·ªß kh√°ch s·∫°n)</option>
                  </select>
                  {errors.vaiTro && <div style={styles.errorText}>{errors.vaiTro}</div>}
                </div>

                <div style={styles.formGroup}>
                  <label style={styles.label}>H·ªç t√™n</label>
                  <input
                    name="hoTen"
                    value={form.hoTen}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder="VD: Nguy·ªÖn VƒÉn A"
                    disabled={saving}
                  />
                  {errors.hoTen && <div style={styles.errorText}>{errors.hoTen}</div>}
                </div>

                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    M·∫≠t kh·∫©u {mode === "edit" ? <span style={{ color: "#64748b" }}>(b·ªè tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)</span> : null}
                  </label>
                  <input
                    name="password"
                    type="password"
                    value={form.password}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder={mode === "add" ? "T·ªëi thi·ªÉu 6 k√Ω t·ª±" : "Nh·∫≠p ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u"}
                    disabled={saving}
                  />
                  {errors.password && <div style={styles.errorText}>{errors.password}</div>}
                </div>
              </div>

              <div style={styles.modalActions}>
                <button type="button" style={styles.btnCancel} onClick={closeModal} disabled={saving}>
                  H·ªßy
                </button>
                <button type="submit" style={styles.btnSave} disabled={saving}>
                  {saving ? "‚è≥ ƒêang l∆∞u..." : mode === "add" ? "T·∫°o nh√¢n vi√™n" : "C·∫≠p nh·∫≠t"}
                </button>
              </div>

              <div style={styles.hintBox}>
                <b>L∆∞u √Ω:</b> Trang n√†y d√πng endpoint ∆∞u ti√™n <code>/users</code> (list/update/delete) v√†{" "}
                <code>/auth/create</code> (create). N·∫øu backend b·∫°n ƒëang d√πng <code>/staff</code> th√¨ file n√†y t·ª± fallback.
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

// ===== Styles =====
const styles = {
  wrapper: { width: "100%", maxWidth: 1400, margin: "0 auto", padding: "2rem 2rem 3rem" },

  headerRow: { display: "flex", justifyContent: "space-between", alignItems: "flex-start", gap: 16, marginBottom: 18 },
  title: { margin: 0, fontSize: "2rem", fontWeight: 800, color: "#0f172a" },
  subtitle: { marginTop: 6, color: "#64748b" },

  select: {
    padding: "0.6rem 0.9rem",
    borderRadius: 10,
    border: "1px solid #e2e8f0",
    background: "white",
    cursor: "pointer",
    outline: "none",
    fontWeight: 600,
    color: "#334155",
  },

  searchInput: {
    width: 280,
    padding: "0.6rem 2.0rem 0.6rem 0.9rem",
    borderRadius: 10,
    border: "1px solid #e2e8f0",
    outline: "none",
    fontSize: 14,
  },
  clearBtn: {
    position: "absolute",
    right: 8,
    top: "50%",
    transform: "translateY(-50%)",
    border: "none",
    background: "transparent",
    cursor: "pointer",
    color: "#94a3b8",
    fontWeight: 900,
  },

  btnPrimary: {
    padding: "0.6rem 1.2rem",
    borderRadius: 10,
    border: "none",
    background: "#3A7DFF",
    color: "white",
    cursor: "pointer",
    fontWeight: 700,
    boxShadow: "0 10px 18px rgba(58,125,255,0.25)",
    whiteSpace: "nowrap",
  },

  btnGhost: {
    padding: "0.55rem 0.95rem",
    borderRadius: 10,
    border: "1px solid #e2e8f0",
    background: "white",
    cursor: "pointer",
    fontWeight: 700,
    color: "#334155",
  },

  tableCard: {
    background: "white",
    borderRadius: 16,
    boxShadow: "0 10px 22px rgba(15, 23, 42, 0.08)",
    border: "1px solid #eef2ff",
    overflowX: "auto",
  },

  table: { width: "100%", borderCollapse: "collapse", fontSize: 14 },
  th: {
    padding: "14px 16px",
    background: "#f8fafc",
    borderBottom: "1px solid #e2e8f0",
    textAlign: "left",
    color: "#475569",
    fontWeight: 800,
    textTransform: "uppercase",
    letterSpacing: 0.4,
    fontSize: 12,
  },
  tr: { borderBottom: "1px solid #f1f5f9" },
  td: { padding: "14px 16px", color: "#334155", verticalAlign: "middle" },

  codeBadge: {
    display: "inline-block",
    padding: "4px 10px",
    borderRadius: 999,
    background: "#eef2ff",
    color: "#3730a3",
    fontWeight: 900,
    fontFamily: "monospace",
    fontSize: 13,
  },

  actionRow: { display: "flex", gap: 10, justifyContent: "center" },

  btnEdit: {
    padding: "7px 12px",
    borderRadius: 10,
    border: "1px solid #bae6fd",
    background: "#e0f2fe",
    color: "#0284c7",
    cursor: "pointer",
    fontWeight: 800,
  },

  btnDelete: {
    padding: "7px 12px",
    borderRadius: 10,
    border: "1px solid #fecaca",
    background: "#fee2e2",
    color: "#ef4444",
    cursor: "pointer",
    fontWeight: 800,
  },

  // Modal
  overlay: {
    position: "fixed",
    inset: 0,
    background: "rgba(0,0,0,0.45)",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    zIndex: 999,
    padding: 14,
    backdropFilter: "blur(2px)",
  },
  modal: {
    width: "100%",
    maxWidth: 720,
    background: "white",
    borderRadius: 16,
    boxShadow: "0 25px 50px rgba(0,0,0,0.25)",
    overflow: "hidden",
  },
  modalHeader: {
    padding: "16px 20px",
    borderBottom: "1px solid #e2e8f0",
    background: "#f8fafc",
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
  },
  modalTitle: { margin: 0, fontSize: 18, fontWeight: 900, color: "#0f172a" },
  closeBtn: {
    border: "none",
    background: "transparent",
    cursor: "pointer",
    fontSize: 18,
    color: "#64748b",
    fontWeight: 900,
  },

  formGrid: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 },
  formGroup: { display: "flex", flexDirection: "column", gap: 6 },
  label: { fontSize: 13, fontWeight: 800, color: "#334155" },
  input: {
    padding: "0.7rem 0.85rem",
    borderRadius: 10,
    border: "1px solid #e2e8f0",
    outline: "none",
    fontSize: 14,
  },
  errorText: { color: "#ef4444", fontSize: 12, fontWeight: 700 },

  modalActions: { marginTop: 18, display: "flex", justifyContent: "flex-end", gap: 10 },
  btnCancel: {
    padding: "0.7rem 1.1rem",
    borderRadius: 10,
    border: "1px solid #e2e8f0",
    background: "white",
    cursor: "pointer",
    fontWeight: 900,
    color: "#334155",
  },
  btnSave: {
    padding: "0.7rem 1.1rem",
    borderRadius: 10,
    border: "none",
    background: "#3A7DFF",
    color: "white",
    cursor: "pointer",
    fontWeight: 900,
    boxShadow: "0 10px 18px rgba(58,125,255,0.25)",
  },

  hintBox: {
    marginTop: 14,
    padding: 12,
    background: "#f1f5f9",
    border: "1px dashed #cbd5e1",
    borderRadius: 12,
    color: "#475569",
    fontSize: 13,
    lineHeight: 1.5,
  },
};

const roleBadgeStyle = (role) => {
  const isAdmin = role === "Admin";
  return {
    display: "inline-block",
    padding: "4px 10px",
    borderRadius: 999,
    fontWeight: 900,
    fontSize: 12,
    background: isAdmin ? "#ede9fe" : "#dcfce7",
    color: isAdmin ? "#6d28d9" : "#15803d",
    border: isAdmin ? "1px solid #ddd6fe" : "1px solid #bbf7d0",
  };
};

export default StaffManagement;
```

### frontend\src\services\api.js
```js
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:9999/api",
  headers: { "Content-Type": "application/json" },
});

// ‚úÖ G·∫Øn token cho m·ªçi request
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) config.headers.Authorization = `Bearer ${token}`;
    return config;
  },
  (error) => Promise.reject(error)
);

// ‚úÖ N·∫øu token h·∫øt h·∫°n / kh√¥ng h·ª£p l·ªá
api.interceptors.response.use(
  (res) => res,
  (err) => {
    const status = err?.response?.status;
    if (status === 401 || status === 403) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
    }
    return Promise.reject(err);
  }
);

export default api;

```
