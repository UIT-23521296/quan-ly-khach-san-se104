# ==================================================
# Path: E:\Dai Hoc\Nam 3\Nhap mon CNPM\quan-ly-khach-san-se104
# Detected tech: docker, javascript, python, react, typescript
# ==================================================

## DIRECTORY STRUCTURE
```
quan-ly-khach-san-se104/
‚îú‚îÄ‚îÄ .git/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ phongController.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roleMiddleware.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonModel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachModel.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueModel.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ phongModel.js
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hoadonRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaikhachRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loaiphongRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phieuthueRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phongRoutes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ thamSoRoutes.js
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitkeep
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ createAdmin.js
‚îÇ   ‚îú‚îÄ‚îÄ package-lock.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vite.svg
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ react.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Sidebar.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InvoiceManagement.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RoomManagement.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ eslint.config.js
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ package-lock.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.js
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ source_dump.txt
```

## FILE CONTENTS

### backend\createAdmin.js
```js
// createAdmin.js
const bcrypt = require("bcryptjs");
const db = require("./config/db");

(async () => {
  const username = "admin";
  const password = "admin123";
  const hoTen = "Qu·∫£n Tr·ªã H·ªá Th·ªëng";
  const vaiTro = "Admin";

  const hashedPassword = await bcrypt.hash(password, 10);

  db.query(
    "INSERT INTO Users (Username, Password, HoTen, VaiTro) VALUES (?, ?, ?, ?)",
    [username, hashedPassword, hoTen, vaiTro],
    (err, result) => {
      if (err) {
        console.error("‚ùå L·ªói t·∫°o admin:", err);
        process.exit();
      }

      console.log("‚úÖ T·∫°o t√†i kho·∫£n admin th√†nh c√¥ng!");
      process.exit();
    }
  );
})();

```

### backend\server.js
```js
// backend/server.js
require("dotenv").config(); // ƒê·ªçc file .env

const express = require("express");
const cors = require("cors");

const app = express();
const PORT = process.env.PORT || 9999;

// Middleware
app.use(cors());
app.use(express.json());

// K·∫øt n·ªëi DB
require("./config/db");

// ==== ROUTES ====
const authRoutes = require("./routes/authRoutes");
const phongRoutes = require("./routes/phongRoutes");
const thamSoRoutes = require("./routes/thamSoRoutes");
const loaiphongRoutes = require("./routes/loaiphongRoutes");
const phieuthueRoutes = require("./routes/phieuthueRoutes");
const loaikhachRoutes = require("./routes/loaikhachRoutes");
const hoadonRoutes = require("./routes/hoadonRoutes");

// ==== S·ª¨ D·ª§NG ROUTES ====
app.use("/api/auth", authRoutes);
app.use("/api/phong", phongRoutes);
app.use("/api/thamso", thamSoRoutes);
app.use("/api/loaiphong", loaiphongRoutes);
app.use("/api/phieuthue", phieuthueRoutes);
app.use("/api/loaikhach", loaikhachRoutes);
app.use("/api/hoadon", hoadonRoutes);
// Test API
app.get("/api/test", (req, res) => {
  res.json({ message: "Backend ƒëang ch·∫°y!" });
});

// Start server
app.listen(PORT, () => {
  console.log(`üöÄ Server ch·∫°y t·∫°i http://localhost:${PORT}`);
});

```

### backend\config\db.js
```js
const mysql = require("mysql2");

const pool = mysql.createPool({
  host: process.env.DB_HOST || "localhost",
  user: process.env.DB_USER || "root",
  password: process.env.DB_PASS || "",
  database: process.env.DB_NAME || "quanlykhachsan",
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
});

pool.getConnection((err, conn) => {
  if (err) {
    console.error("‚ùå L·ªói k·∫øt n·ªëi MySQL:", err);
  } else {
    console.log("‚úÖ K·∫øt n·ªëi MySQL th√†nh c√¥ng!");
    conn.release();
  }
});

module.exports = pool;

```

### backend\controllers\hoadonController.js
```js
const db = require("../config/db");
const hoadonModel = require("../models/hoadonModel");
const { v4: uuidv4 } = require("uuid");

// --- H√ÄM LOGIC T√çNH TI·ªÄN TRUNG T√ÇM ---
const calculateBill = async (soPhieu) => {
    // 1. L·∫•y th√¥ng tin phi·∫øu, ph√≤ng, ƒë∆°n gi√°
    const sqlBase = `
        SELECT pt.SoPhieu, pt.MaPhong, pt.NgayBatDauThue, 
               p.TenPhong, lp.DonGia, lp.TenLoaiPhong,
               (SELECT HoTen FROM khachhang WHERE MaKH = (SELECT MaKH FROM ct_phieuthue WHERE SoPhieu = pt.SoPhieu LIMIT 1)) as TenKhachDaiDien,
               (SELECT DiaChi FROM khachhang WHERE MaKH = (SELECT MaKH FROM ct_phieuthue WHERE SoPhieu = pt.SoPhieu LIMIT 1)) as DiaChi
        FROM phieuthue pt
        JOIN phong p ON pt.MaPhong = p.MaPhong
        JOIN loaiphong lp ON p.MaLoaiPhong = lp.MaLoaiPhong
        WHERE pt.SoPhieu = ?
    `;
    const [rows] = await db.promise().query(sqlBase, [soPhieu]);
    if (rows.length === 0) throw new Error("Phi·∫øu thu√™ kh√¥ng t·ªìn t·∫°i");
    const data = rows[0];

    // 2. L·∫•y danh s√°ch kh√°ch ƒë·ªÉ ƒë·∫øm s·ªë l∆∞·ª£ng v√† check qu·ªëc t·ªãch
    const sqlKhach = `
        SELECT lk.MaLoaiKhach, lk.HeSoPhuThu 
        FROM ct_phieuthue ct
        JOIN khachhang kh ON ct.MaKH = kh.MaKH
        JOIN loaikhach lk ON kh.MaLoaiKhach = lk.MaLoaiKhach
        WHERE ct.SoPhieu = ?
    `;
    const [dsKhach] = await db.promise().query(sqlKhach, [soPhieu]);
    const soLuongKhach = dsKhach.length;

    // 3. X·ª≠ l√Ω logic t√≠nh s·ªë ng√†y (N·∫øu ƒëi trong ng√†y t√≠nh l√† 1 ng√†y)
    const ngayBatDau = new Date(data.NgayBatDauThue);
    const ngayKetThuc = new Date(); // T√≠nh ƒë·∫øn gi·ªù hi·ªán t·∫°i
    let soNgay = Math.ceil((ngayKetThuc - ngayBatDau) / (1000 * 60 * 60 * 24));
    if (soNgay <= 0) soNgay = 1;

    // 4. LOGIC LINH HO·∫†T:
    
    // A. H·ªá S·ªë Kh√°ch N∆∞·ªõc Ngo√†i (L·∫•y h·ªá s·ªë l·ªõn nh·∫•t trong ƒë√°m kh√°ch)
    // V√≠ d·ª•: C√≥ 1 kh√°ch NN (1.5) v√† 2 kh√°ch N·ªôi ƒë·ªãa (1.0) -> H·ªá s·ªë chung l√† 1.5
    let heSoKhach = 1.0;
    if (dsKhach.length > 0) {
        heSoKhach = Math.max(...dsKhach.map(k => k.HeSoPhuThu));
    }

    // B. Ph·ª• thu s·ªë l∆∞·ª£ng kh√°ch (Tra c·ª©u b·∫£ng tilephuthu)
    let tiLePhuThu = 0;
    // T√¨m t·ªâ l·ªá ·ª©ng v·ªõi s·ªë kh√°ch hi·ªán t·∫°i
    const [resTiLe] = await db.promise().query(
        "SELECT TiLePhuThu FROM tilephuthu WHERE KhachThu = ?", 
        [soLuongKhach]
    );

    if (resTiLe.length > 0) {
        tiLePhuThu = resTiLe[0].TiLePhuThu;
    } else {
        // Fallback: N·∫øu s·ªë kh√°ch l·ªõn h∆°n d·ªØ li·ªáu trong b·∫£ng (vd 5 kh√°ch), l·∫•y m·ª©c cao nh·∫•t
        const [maxTiLe] = await db.promise().query("SELECT TiLePhuThu FROM tilephuthu ORDER BY KhachThu DESC LIMIT 1");
        if (maxTiLe.length > 0 && soLuongKhach > 2) {
             tiLePhuThu = maxTiLe[0].TiLePhuThu; 
        }
    }

    // 5. T√çNH T·ªîNG TI·ªÄN
    // C√¥ng th·ª©c: (ƒê∆°n gi√° * S·ªë ng√†y * (1 + T·ªâ l·ªá ph·ª• thu)) * H·ªá s·ªë kh√°ch
    const donGia = parseFloat(data.DonGia);
    const thanhTien = (donGia * soNgay * (1 + tiLePhuThu)) * heSoKhach;

    return {
        ...data,
        SoNgay: soNgay,
        SoKhach: soLuongKhach,
        TiLePhuThu: tiLePhuThu,
        HeSoKhach: heSoKhach,
        ThanhTien: Math.round(thanhTien)
    };
};

// API 1: Preview h√≥a ƒë∆°n (ƒê·ªÉ hi·ªán l√™n Modal)
exports.previewHoaDon = async (req, res) => {
    try {
        const bill = await calculateBill(req.params.soPhieu);
        res.json(bill);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
};

// API 2: Thanh to√°n & L∆∞u DB
exports.createAndPay = async (req, res) => {
    const { soPhieu, tienKhachDua } = req.body; // Ch·ªâ c·∫ßn nh·∫≠n ti·ªÅn kh√°ch ƒë∆∞a
    const conn = await db.promise().getConnection();
    
    try {
        await conn.beginTransaction();

        // T√≠nh l·∫°i l·∫ßn cu·ªëi ƒë·ªÉ ch·ªët s·ªë li·ªáu
        const bill = await calculateBill(soPhieu);
        
        // T·∫°o m√£ h√≥a ƒë∆°n
        const soHoaDon = "HD" + Date.now();

        // 1. Insert H√≥a ƒê∆°n
        await conn.query(
            `INSERT INTO hoadon (SoHoaDon, NgayLap, TenKhachHangCoQuan, DiaChi, TriGia, SoPhieu, TrangThaiThanhToan)
             VALUES (?, NOW(), ?, ?, ?, ?, 'DA_THANH_TOAN')`,
            [soHoaDon, bill.TenKhachDaiDien, bill.DiaChi, bill.ThanhTien, soPhieu]
        );

        // 2. Insert Chi Ti·∫øt H√≥a ƒê∆°n
        const maCTHD = uuidv4();
        await conn.query(
            `INSERT INTO ct_hoadon (MaCTHD, SoHoaDon, MaPhong, SoNgayThue, DonGia, SoKhach, KhachNuocNgoai, PhuThu, ThanhTien)
             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,
            [
                maCTHD, 
                soHoaDon, 
                bill.MaPhong, 
                bill.SoNgay, 
                bill.DonGia, 
                bill.SoKhach, 
                bill.HeSoKhach > 1 ? 1 : 0, // 1 l√† c√≥ kh√°ch NN, 0 l√† kh√¥ng
                bill.TiLePhuThu, 
                bill.ThanhTien
            ]
        );

        // 3. Update Phi·∫øu Thu√™ -> ƒê√£ thanh to√°n, set ng√†y tr·∫£ th·ª±c t·∫ø l√† NOW()
        await conn.query(
            "UPDATE phieuthue SET TrangThaiLuuTru = 'DA_THANH_TOAN', NgayDuKienTra = NOW() WHERE SoPhieu = ?", 
            [soPhieu]
        );

        // 4. Update Ph√≤ng -> Tr·ªëng
        await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [bill.MaPhong]);

        await conn.commit();
        res.json({ message: "Thanh to√°n th√†nh c√¥ng!", soHoaDon });

    } catch (err) {
        await conn.rollback();
        res.status(500).json({ message: "L·ªói thanh to√°n: " + err.message });
    } finally {
        conn.release();
    }
};

// API 3: L·∫•y danh s√°ch h√≥a ƒë∆°n
exports.getAllHoaDon = async (req, res) => {
    try {
        const [rows] = await hoadonModel.getAll();
        res.json(rows);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
};

// API 4: L·∫•y chi ti·∫øt h√≥a ƒë∆°n theo S·ªë H√≥a ƒê∆°n
exports.getHoaDonDetail = async (req, res) => {
  try {
    const { soHoaDon } = req.params;
    const [rows] = await hoadonModel.getById(soHoaDon);
    
    if (rows.length === 0) {
      return res.status(404).json({ message: "Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n" });
    }
    
    res.json(rows[0]);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};
```

### backend\controllers\loaikhachController.js
```js
const loaikhachModel = require("../models/loaikhachModel");

exports.getAllLoaiKhach = async (req, res) => {
  try {
    const [rows] = await loaikhachModel.getAll();
    res.json(rows);
  } catch (err) {
    console.error("‚ùå L·ªói l·∫•y lo·∫°i kh√°ch:", err);
    res.status(500).json({ message: "Kh√¥ng l·∫•y ƒë∆∞·ª£c lo·∫°i kh√°ch" });
  }
};

```

### backend\controllers\phieuthueController.js
```js
const phieuThueModel = require("../models/phieuthueModel");
const db = require("../config/db");
const { v4: uuidv4 } = require("uuid");

// 1Ô∏è‚É£ T·∫†O PHI·∫æU
exports.createPhieuThue = async (req, res) => {
  const { MaPhong, NgayBatDauThue, NgayDuKienTra, GhiChu, danhSachKhach } = req.body;
  const conn = await db.promise().getConnection();

  try {
    await conn.beginTransaction();

    // --- B·ªî SUNG: L·∫•y t√™n ph√≤ng hi·ªán t·∫°i tr∆∞·ªõc khi t·∫°o phi·∫øu ---
    const [rooms] = await conn.query("SELECT TenPhong FROM phong WHERE MaPhong = ?", [MaPhong]);
    if (rooms.length === 0) {
        throw new Error("Ph√≤ng kh√¥ng t·ªìn t·∫°i!");
    }
    const tenPhongSnapshot = rooms[0].TenPhong; // ƒê√¢y l√† t√™n ph√≤ng t·∫°i th·ªùi ƒëi·ªÉm t·∫°o
    // ----------------------------------------------------------

    const SoPhieu = "PT" + Date.now();
    
    // S·ª¨A: Truy·ªÅn th√™m tenPhongSnapshot v√†o v·ªã tr√≠ tham s·ªë th·ª© 3
    await phieuThueModel.insertPhieuThue([
        SoPhieu, 
        MaPhong, 
        tenPhongSnapshot, // <--- L∆∞u t√™n ph√≤ng v√†o ƒë√¢y
        NgayBatDauThue, 
        NgayDuKienTra, 
        'DANG_THUE', 
        GhiChu || ''
    ]);

    // Insert Kh√°ch
    for (const k of danhSachKhach) {
      const MaKH = uuidv4();
      await phieuThueModel.insertKhachHang([MaKH, k.HoTen, k.MaLoaiKhach, k.CMND, k.DiaChi, k.SDT]);
      await phieuThueModel.insertCTPhieuThue([SoPhieu, MaKH]);
    }

    // C·∫≠p nh·∫≠t ph√≤ng -> ƒê√£ thu√™
    await conn.query("UPDATE phong SET TinhTrang = 'ƒê√£ thu√™' WHERE MaPhong = ?", [MaPhong]);

    await conn.commit();
    res.json({ message: "T·∫°o phi·∫øu th√†nh c√¥ng (ƒêang thu√™)", SoPhieu });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

// 2Ô∏è‚É£ S·ª¨A PHI·∫æU (Ch·ªâ s·ª≠a Ng√†y tr·∫£, Ghi ch√∫, Th√¥ng tin kh√°ch)
// =======================
exports.updatePhieuThue = async (req, res) => {
  const { soPhieu } = req.params;
  const { NgayDuKienTra, GhiChu, danhSachKhach } = req.body;
  
  try {
    // 1. C·∫≠p nh·∫≠t th√¥ng tin chung c·ªßa phi·∫øu
    await phieuThueModel.updatePhieu(soPhieu, NgayDuKienTra, GhiChu);

    // 2. --- X·ª¨ L√ù X√ìA KH√ÅCH H√ÄNG (M·ªöI) ---
    // L·∫•y danh s√°ch MaKH c·ªßa nh·ªØng ng∆∞·ªùi C√íN L·∫†I trong danh s√°ch (nh·ªØng ng∆∞·ªùi kh√¥ng b·ªã x√≥a)
    const currentMaKHs = danhSachKhach
        .filter(k => k.MaKH) // Ch·ªâ l·∫•y nh·ªØng ng∆∞·ªùi ƒë√£ c√≥ MaKH (kh√°ch c≈©)
        .map(k => k.MaKH);

    if (currentMaKHs.length > 0) {
        // X√≥a nh·ªØng kh√°ch trong DB m√† KH√îNG n·∫±m trong danh s√°ch g·ª≠i l√™n
        // (Nghƒ©a l√† h·ªç ƒë√£ b·ªã x√≥a ·ªü frontend)
        await db.promise().query(
            `DELETE FROM ct_phieuthue WHERE SoPhieu = ? AND MaKH NOT IN (?)`,
            [soPhieu, currentMaKHs]
        );
    } else {
        // N·∫øu danh s√°ch kh√°ch c≈© r·ªóng (nghƒ©a l√† x√≥a h·∫øt kh√°ch c≈©, ch·ªâ c√≤n kh√°ch m·ªõi ho·∫∑c kh√¥ng c√≤n ai)
        // Th√¨ x√≥a s·∫°ch li√™n k·∫øt c≈© c·ªßa phi·∫øu n√†y ƒëi
        await db.promise().query(
            `DELETE FROM ct_phieuthue WHERE SoPhieu = ?`,
            [soPhieu]
        );
    }

    // 3. --- C·∫¨P NH·∫¨T HO·∫∂C TH√äM M·ªöI ---
    if (danhSachKhach && danhSachKhach.length > 0) {
      for (const k of danhSachKhach) {
        if (k.MaKH) {
           // Kh√°ch c≈© -> C·∫≠p nh·∫≠t th√¥ng tin
           await phieuThueModel.updateKhachHang(k.MaKH, k.HoTen, k.CMND, k.SDT, k.DiaChi, k.MaLoaiKhach);
        } else {
           // Kh√°ch m·ªõi (Ch∆∞a c√≥ MaKH) -> T·∫°o m·ªõi & G·∫Øn v√†o phi·∫øu
           const newMaKH = uuidv4();
           await phieuThueModel.insertKhachHang([newMaKH, k.HoTen, k.MaLoaiKhach, k.CMND, k.DiaChi, k.SDT]);
           await phieuThueModel.insertCTPhieuThue([soPhieu, newMaKH]);
        }
      }
    }
    res.json({ message: "C·∫≠p nh·∫≠t phi·∫øu th√†nh c√¥ng" });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: "L·ªói c·∫≠p nh·∫≠t: " + error.message });
  }
};

// 3Ô∏è‚É£ TR·∫¢ PH√íNG (DANG_THUE -> DA_TRA_PHONG, Ph√≤ng -> Tr·ªëng)
exports.checkOut = async (req, res) => {
  const { soPhieu } = req.params;
  const conn = await db.promise().getConnection();
  try {
    await conn.beginTransaction();
    
    // Update phi·∫øu
    await conn.query("UPDATE phieuthue SET TrangThaiLuuTru = 'DA_TRA_PHONG' WHERE SoPhieu = ?", [soPhieu]);
    
    // Update ph√≤ng -> Tr·ªëng
    const [rows] = await conn.query("SELECT MaPhong FROM phieuthue WHERE SoPhieu = ?", [soPhieu]);
    if (rows.length > 0) {
      await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [rows[0].MaPhong]);
    }

    await conn.commit();
    res.json({ message: "Tr·∫£ ph√≤ng th√†nh c√¥ng" });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

// 4Ô∏è‚É£ H·ª¶Y PHI·∫æU (DANG_THUE -> DA_HUY, Ph√≤ng -> Tr·ªëng)
exports.huyPhieu = async (req, res) => {
  const { soPhieu } = req.params;
  const conn = await db.promise().getConnection();
  try {
    await conn.beginTransaction();

    await conn.query("UPDATE phieuthue SET TrangThaiLuuTru = 'DA_HUY' WHERE SoPhieu = ?", [soPhieu]);
    
    const [rows] = await conn.query("SELECT MaPhong FROM phieuthue WHERE SoPhieu = ?", [soPhieu]);
    if (rows.length > 0) {
      await conn.query("UPDATE phong SET TinhTrang = 'Tr·ªëng' WHERE MaPhong = ?", [rows[0].MaPhong]);
    }

    await conn.commit();
    res.json({ message: "ƒê√£ h·ªßy phi·∫øu" });
  } catch (error) {
    await conn.rollback();
    res.status(500).json({ message: error.message });
  } finally {
    conn.release();
  }
};

exports.getAllPhieuThue = async (req, res) => {
  try {
    const [rows] = await phieuThueModel.getAll();
    res.json(rows);
  } catch (error) {
    res.status(500).json({ message: "L·ªói server" });
  }
};
```

### backend\controllers\phongController.js
```js
const phongModel = require("../models/phongModel");
const db = require("../config/db");

exports.getAllRooms = async (req, res) => {
  try {
    const [rows] = await phongModel.getAll();
    res.json(rows);
  } catch (err) {
    res.status(500).json({ error: err });
  }
};

// 1Ô∏è‚É£ CREATE: M·∫∑c ƒë·ªãnh TinhTrang l√† 'Tr·ªëng'
exports.createRoom = async (req, res) => {
  const { TenPhong, MaLoaiPhong, GhiChu } = req.body; // B·ªè TinhTrang kh·ªèi req.body

  const soPhong = TenPhong?.match(/\d+/);
  if (!soPhong) return res.status(400).json({ message: "T√™n ph√≤ng ph·∫£i c√≥ s·ªë" });

  const MaPhong = "P" + soPhong[0];

  try {
    const [exist] = await phongModel.findByMaPhong(MaPhong);
    if (exist.length > 0) return res.status(400).json({ message: "Ph√≤ng ƒë√£ t·ªìn t·∫°i" });

    // ‚úÖ FORCE STATUS = 'Tr·ªëng'
    await phongModel.create([MaPhong, TenPhong, MaLoaiPhong, 'Tr·ªëng', GhiChu]);
    res.json({ message: "Th√™m ph√≤ng th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
};

// 2Ô∏è‚É£ UPDATE: Ch·ªâ s·ª≠a Lo·∫°i v√† Ghi ch√∫
exports.updateRoom = async (req, res) => {
  const { id } = req.params; // id l√† MaPhong
  const { TenPhong, MaLoaiPhong, GhiChu } = req.body; 
  
  try {
    // B∆Ø·ªöC 1: L·∫•y th√¥ng tin c≈© c·ªßa ph√≤ng ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i
    const [rows] = await db.promise().query("SELECT * FROM PHONG WHERE MaPhong = ?", [id]);
    
    if (rows.length === 0) {
        return res.status(404).json({ message: "Ph√≤ng kh√¥ng t·ªìn t·∫°i" });
    }
    const phongCu = rows[0];

    // B∆Ø·ªöC 2: Ki·ªÉm tra logic nghi·ªáp v·ª•
    // N·∫øu ph√≤ng ƒëang c√≥ kh√°ch ('ƒê√£ thu√™'), ki·ªÉm tra xem user c√≥ c·ªë s·ª≠a T√™n ho·∫∑c Lo·∫°i kh√¥ng
    if (phongCu.TinhTrang === 'ƒê√£ thu√™') {
        if (TenPhong !== phongCu.TenPhong) {
            return res.status(400).json({ message: "Ph√≤ng ƒëang c√≥ kh√°ch thu√™, KH√îNG ƒë∆∞·ª£c ƒë·ªïi T√™n ph√≤ng!" });
        }
        if (MaLoaiPhong !== phongCu.MaLoaiPhong) {
             return res.status(400).json({ message: "Ph√≤ng ƒëang c√≥ kh√°ch thu√™, KH√îNG ƒë∆∞·ª£c ƒë·ªïi Lo·∫°i ph√≤ng!" });
        }
    }

    // B∆Ø·ªöC 3: N·∫øu h·ª£p l·ªá (ho·∫∑c ch·ªâ s·ª≠a Ghi ch√∫), ti·∫øn h√†nh Update
    await phongModel.updateInfo(TenPhong, MaLoaiPhong, GhiChu, id);
    res.json({ message: "C·∫≠p nh·∫≠t th√¥ng tin ph√≤ng th√†nh c√¥ng" });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
};

// B·∫£o tr√¨ ph√≤ng
exports.toggleMaintenance = async (req, res) => {
  const { id } = req.params; // id l√† MaPhong
  const { status } = req.body; // 'B·∫£o tr√¨' ho·∫∑c 'Tr·ªëng'

  try {
    await phongModel.updateStatus(status, id);
    res.json({ message: `ƒê√£ chuy·ªÉn ph√≤ng sang tr·∫°ng th√°i: ${status}` });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// Ng∆∞ng / K√≠ch ho·∫°t kinh doanh
exports.toggleBusinessStatus = async (req, res) => {
  const { id } = req.params;
  const { action } = req.body; // 'stop' ho·∫∑c 'active'

  try {
    const newStatus = action === 'stop' ? 'Ng∆∞ng kinh doanh' : 'Tr·ªëng';
    await phongModel.updateStatus(newStatus, id);
    res.json({ message: "C·∫≠p nh·∫≠t tr·∫°ng th√°i kinh doanh th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// ‚úÖ TH√äM M·ªöI
exports.deleteRoom = async (req, res) => {
  const { id } = req.params;

  try {
    await phongModel.delete(id);
    res.json({ message: "X√≥a ph√≤ng th√†nh c√¥ng" });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

```

### backend\middleware\authMiddleware.js
```js
const jwt = require("jsonwebtoken");
require("dotenv").config();

module.exports = (req, res, next) => {
  const header = req.headers.authorization;
  if (!header) {
    return res.status(401).json({ error: "Thi·∫øu token" });
  }

  const token = header.split(" ")[1];

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded; // l∆∞u user v√†o req ƒë·ªÉ d√πng sau
    next();
  } catch (err) {
    return res.status(401).json({ error: "Token kh√¥ng h·ª£p l·ªá" });
  }
};

```

### backend\middleware\roleMiddleware.js
```js
module.exports = (...allowedRoles) => {
  return (req, res, next) => {
    if (!allowedRoles.includes(req.user.vaiTro)) {
      return res.status(403).json({ error: "Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p" });
    }
    next();
  };
};

```

### backend\models\hoadonModel.js
```js
const db = require("../config/db");


// --- H√ìA ƒê∆†N MODEL ---
exports.createHoaDon = (data) => {
  const sql = `
    INSERT INTO hoadon (SoHoaDon, NgayLap, TenKhachHangCoQuan, DiaChi, TriGia, SoPhieu, TrangThaiThanhToan)
    VALUES (?, NOW(), ?, ?, ?, ?, 'DA_THANH_TOAN')
  `;
  return db.promise().query(sql, data);
};

// --- CHI TI·∫æT H√ìA ƒê∆†N MODEL ---
exports.createCT_HoaDon = (data) => {
  const sql = `
    INSERT INTO ct_hoadon (MaCTHD, SoHoaDon, MaPhong, SoNgayThue, DonGia, SoKhach, KhachNuocNgoai, PhuThu, ThanhTien)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// --- TRUY V·∫§N H√ìA ƒê∆†N ---
exports.getById = (soHoaDon) => {
  const sql = `
    SELECT 
      hd.SoHoaDon, hd.NgayLap, hd.TenKhachHangCoQuan, hd.DiaChi, hd.TriGia,
      ct.SoNgayThue, ct.DonGia, ct.SoKhach, ct.KhachNuocNgoai, ct.PhuThu, ct.ThanhTien,
      pt.TenPhong_LuuTru, pt.SoPhieu, pt.NgayBatDauThue, pt.NgayDuKienTra,
      lp.TenLoaiPhong -- L·∫•y th√™m t√™n lo·∫°i ph√≤ng ƒë·ªÉ hi·ªÉn th·ªã cho ƒë·∫πp
    FROM hoadon hd
    JOIN ct_hoadon ct ON hd.SoHoaDon = ct.SoHoaDon
    JOIN phieuthue pt ON hd.SoPhieu = pt.SoPhieu
    JOIN phong p ON pt.MaPhong = p.MaPhong
    LEFT JOIN loaiphong lp ON p.MaLoaiPhong = lp.MaLoaiPhong
    WHERE hd.SoHoaDon = ?
  `;
  return db.promise().query(sql, [soHoaDon]);
};

// --- TRUY V·∫§N T·∫§T C·∫¢ H√ìA ƒê∆†N ---
exports.getAll = () => {
  const sql = `
    SELECT hd.*, pt.TenPhong_LuuTru,
      (SELECT kh.SDT FROM khachhang kh JOIN ct_phieuthue ct ON kh.MaKH = ct.MaKH WHERE ct.SoPhieu = hd.SoPhieu LIMIT 1) AS SDT
    FROM hoadon hd
    LEFT JOIN phieuthue pt ON hd.SoPhieu = pt.SoPhieu
    ORDER BY hd.NgayLap DESC
  `;
  return db.promise().query(sql);
};
```

### backend\models\loaikhachModel.js
```js
// const db = require("../config/db");

// exports.getAll = () => {
//   const sql = `
//     SELECT MaLoaiKhach, TenLoaiKhach, HeSoPhuThu
//     FROM loaikhach
//   `;
//   return db.promise().query(sql);
// };
const db = require("../config/db");

exports.getAll = () => {
  const sql = "SELECT * FROM loaikhach";
  return db.promise().query(sql);
};

```

### backend\models\phieuthueModel.js
```js
const db = require("../config/db");

/* =========================
   PHI·∫æU THU√ä PH√íNG MODEL
   ========================= */

// 1Ô∏è‚É£ Th√™m kh√°ch h√†ng
exports.insertKhachHang = (data) => {
  const sql = `
    INSERT INTO khachhang 
    (MaKH, HoTen, MaLoaiKhach, CMND, DiaChi, SDT)
    VALUES (?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// 2Ô∏è‚É£ Th√™m phi·∫øu thu√™
exports.insertPhieuThue = (data) => {
  const sql = `
    INSERT INTO phieuthue
    (SoPhieu, MaPhong, TenPhong_LuuTru, NgayBatDauThue, NgayDuKienTra, TrangThaiLuuTru, GhiChu)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// 3Ô∏è‚É£ G·∫Øn kh√°ch v√†o phi·∫øu thu√™
exports.insertCTPhieuThue = (data) => {
  const sql = `
    INSERT INTO ct_phieuthue
    (SoPhieu, MaKH)
    VALUES (?, ?)
  `;
  return db.promise().query(sql, data);
};

// 4Ô∏è‚É£ C·∫≠p nh·∫≠t tr·∫°ng th√°i ph√≤ng
exports.updateTinhTrangPhong = (data) => {
  const sql = `
    UPDATE phong
    SET TinhTrang = ?
    WHERE MaPhong = ?
  `;
  return db.promise().query(sql, data);
};

// 5Ô∏è‚É£ L·∫•y danh s√°ch phi·∫øu thu√™
exports.getAll = () => {
  const sql = `
    SELECT 
      pt.SoPhieu,
      pt.MaPhong,
      COALESCE(pt.TenPhong_LuuTru, p.TenPhong) AS TenPhong,
      pt.NgayBatDauThue,
      pt.NgayDuKienTra,
      pt.TrangThaiLuuTru,
      pt.GhiChu,
      COALESCE(hd.TrangThaiThanhToan, 'CHUA_THANH_TOAN') AS TrangThaiThanhToan,
      kh.HoTen,
      kh.MaKH,
      kh.MaLoaiKhach,
      kh.DiaChi,
      lk.TenLoaiKhach,
      kh.CMND,
      kh.SDT
    FROM phieuthue pt
    JOIN phong p ON pt.MaPhong = p.MaPhong
    JOIN ct_phieuthue ct ON pt.SoPhieu = ct.SoPhieu
    JOIN khachhang kh ON ct.MaKH = kh.MaKH
    JOIN loaikhach lk ON kh.MaLoaiKhach = lk.MaLoaiKhach
    LEFT JOIN hoadon hd ON pt.SoPhieu = hd.SoPhieu 
    ORDER BY pt.NgayBatDauThue DESC
  `;
  return db.promise().query(sql);
};

// 6Ô∏è‚É£ C·∫≠p nh·∫≠t phi·∫øu thu√™
exports.updatePhieu = (soPhieu, ngayDuKienTra, ghiChu) => {
  const sql = `UPDATE phieuthue SET NgayDuKienTra = ?, GhiChu = ? WHERE SoPhieu = ?`;
  return db.promise().query(sql, [ngayDuKienTra, ghiChu, soPhieu]);
};

// 7Ô∏è‚É£ C·∫≠p nh·∫≠t th√¥ng tin kh√°ch h√†ng
exports.updateKhachHang = (maKH, hoTen, cmnd, sdt, diaChi, maLoaiKhach) => {
  const sql = `UPDATE khachhang SET HoTen = ?, CMND = ?, SDT = ?, DiaChi = ?, MaLoaiKhach = ? WHERE MaKH = ?`;
  return db.promise().query(sql, [hoTen, cmnd, sdt, diaChi, maLoaiKhach, maKH]);
};

```

### backend\models\phongModel.js
```js
const db = require("../config/db");

exports.getAll = () => {
  const sql = `
    SELECT p.*, lp.TenLoaiPhong, lp.DonGia,
    (EXISTS (SELECT 1 FROM phieuthue pt WHERE pt.MaPhong = p.MaPhong)) as CoLichSu
    FROM PHONG p
    JOIN LOAIPHONG lp ON p.MaLoaiPhong = lp.MaLoaiPhong
  `;
  return db.promise().query(sql);
};

exports.create = (data) => {
  const sql = `
    INSERT INTO PHONG (MaPhong, TenPhong, MaLoaiPhong, TinhTrang, GhiChu)
    VALUES (?, ?, ?, ?, ?)
  `;
  return db.promise().query(sql, data);
};

// C·∫≠p nh·∫≠t th√¥ng tin ph√≤ng (kh√¥ng bao g·ªìm t√™n ph√≤ng)
exports.updateInfo = (tenPhong, maLoaiPhong, ghiChu, maPhong) => {
  const sql = `UPDATE PHONG SET TenPhong = ?, MaLoaiPhong = ?, GhiChu = ? WHERE MaPhong = ?`;
  return db.promise().query(sql, [tenPhong, maLoaiPhong, ghiChu, maPhong]);
};

// H√†m ri√™ng ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i (D√πng cho B·∫£o tr√¨)
exports.updateStatus = (tinhTrang, maPhong) => {
  const sql = `UPDATE PHONG SET TinhTrang = ? WHERE MaPhong = ?`;
  return db.promise().query(sql, [tinhTrang, maPhong]);
};

exports.findByMaPhong = (MaPhong) => {
  const sql = `SELECT 1 FROM PHONG WHERE MaPhong = ? LIMIT 1`;
  return db.promise().query(sql, [MaPhong]);
};

exports.delete = (id) => {
  const sql = `DELETE FROM PHONG WHERE MaPhong = ?`;
  return db.promise().query(sql, [id]);
};

```

### backend\models\User.js
```js
const db = require("../config/db");

const User = {
  // T√¨m user theo username
  findByUsername: (username, callback) => {
    const sql = "SELECT * FROM Users WHERE Username = ?";
    db.query(sql, [username], callback);
  },

  // T·∫°o user m·ªõi (Admin t·∫°o t√†i kho·∫£n)
  create: (userData, callback) => {
    const sql =
      "INSERT INTO Users (Username, Password, HoTen, VaiTro) VALUES (?, ?, ?, ?)";

    db.query(
      sql,
      [userData.username, userData.password, userData.hoTen, userData.vaiTro],
      callback
    );
  },

  // L·∫•y danh s√°ch user
  getAll: (callback) => {
    const sql = "SELECT MaNV, Username, HoTen, VaiTro, NgayTao FROM Users";
    db.query(sql, callback);
  },
};

module.exports = User;

```

### backend\routes\authRoutes.js
```js
const express = require("express");
const bcrypt = require("bcrypt");
const jwt = require("jsonwebtoken");
const User = require("../models/User");

const router = express.Router();

// ƒêƒÇNG NH·∫¨P
router.post("/login", (req, res) => {
  const { username, password } = req.body;

  User.findByUsername(username, async (err, results) => {
    if (err) return res.status(500).json({ error: "L·ªói server" });
    if (results.length === 0)
      return res.status(401).json({ error: "T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i" });

    const user = results[0];

    // So s√°nh m·∫≠t kh·∫©u ƒë√£ hash
    const match = await bcrypt.compare(password, user.Password);
    if (!match) return res.status(401).json({ error: "Sai m·∫≠t kh·∫©u" });

    // T·∫°o token
    const token = jwt.sign(
      {
        id: user.MaNV,
        username: user.Username,
        vaiTro: user.VaiTro,
      },
      process.env.JWT_SECRET,
      { expiresIn: "8h" }
    );

    return res.json({
      message: "ƒêƒÉng nh·∫≠p th√†nh c√¥ng",
      token,
      user: {
        id: user.MaNV,
        username: user.Username,
        hoTen: user.HoTen,
        vaiTro: user.VaiTro,
      },
    });
  });
});

// Admin t·∫°o user m·ªõi
router.post("/create", async (req, res) => {
  const { username, password, hoTen, vaiTro } = req.body;

  const hashed = await bcrypt.hash(password, Number(process.env.SALT_ROUNDS));

  User.create({ username, password: hashed, hoTen, vaiTro }, (err, result) => {
    if (err) return res.status(500).json({ error: err });
    res.json({ message: "T·∫°o user th√†nh c√¥ng" });
  });
});

module.exports = router;

```

### backend\routes\hoadonRoutes.js
```js
const express = require("express");
const router = express.Router();
const controller = require("../controllers/hoadonController");

// C√°c route cho H√ìA ƒê∆†N

// L·∫•y t·∫•t c·∫£ h√≥a ƒë∆°n
router.get("/", controller.getAllHoaDon);

// Xem tr∆∞·ªõc h√≥a ƒë∆°n theo s·ªë phi·∫øu thu√™
router.get("/preview/:soPhieu", controller.previewHoaDon);

// L·∫•y chi ti·∫øt h√≥a ƒë∆°n theo s·ªë h√≥a ƒë∆°n
router.get("/:soHoaDon", controller.getHoaDonDetail);

// T·∫°o v√† thanh to√°n h√≥a ƒë∆°n
router.post("/pay", controller.createAndPay);

module.exports = router;
```

### backend\routes\loaikhachRoutes.js
```js
const express = require("express");
const router = express.Router();
const loaikhachController = require("../controllers/loaikhachController");

router.get("/", loaikhachController.getAllLoaiKhach);

module.exports = router;

```

### backend\routes\loaiphongRoutes.js
```js
const express = require("express");
const router = express.Router();
const db = require("../config/db");

// GET t·∫•t c·∫£ lo·∫°i ph√≤ng
router.get("/", async (req, res) => {
  try {
    const [rows] = await db
      .promise()
      .query("SELECT MaLoaiPhong, TenLoaiPhong, DonGia FROM loaiphong");

    res.json(rows);
  } catch (err) {
    console.error("‚ùå L·ªói l·∫•y lo·∫°i ph√≤ng:", err);
    res.status(500).json({ message: "L·ªói server" });
  }
});

module.exports = router;

```

### backend\routes\phieuthueRoutes.js
```js
const express = require("express");
const router = express.Router();

// ‚úÖ Khai b√°o bi·∫øn l√† "controller"
const controller = require("../controllers/phieuthueController");

// L·∫•y danh s√°ch
router.get("/", controller.getAllPhieuThue);

// T·∫°o m·ªõi
router.post("/", controller.createPhieuThue);

// C·∫≠p nh·∫≠t (S·ª≠a)
router.put("/:soPhieu", controller.updatePhieuThue);

// Tr·∫£ ph√≤ng
router.put("/:soPhieu/checkout", controller.checkOut);

// H·ªßy phi·∫øu
router.put("/:soPhieu/huy", controller.huyPhieu);

module.exports = router;
```

### backend\routes\phongRoutes.js
```js
const express = require("express");
const router = express.Router();
const phongController = require("../controllers/phongController");

// L·∫•y danh s√°ch ph√≤ng
router.get("/", phongController.getAllRooms);

// Th√™m ph√≤ng
router.post("/", phongController.createRoom);

// C·∫≠p nh·∫≠t ph√≤ng
router.put("/:id", phongController.updateRoom);

// X√≥a ph√≤ng
router.delete("/:id", phongController.deleteRoom);

// Chuy·ªÉn tr·∫°ng th√°i ph√≤ng (B·∫£o tr√¨ / Tr·ªëng)
router.put("/:id/maintenance", phongController.toggleMaintenance);

// Ng∆∞ng / K√≠ch ho·∫°t kinh doanh
router.put("/:id/business", phongController.toggleBusinessStatus); 

module.exports = router;

```

### backend\routes\thamSoRoutes.js
```js
const express = require("express");
const router = express.Router();
const db = require("../config/db");

// L·∫•y s·ªë kh√°ch t·ªëi ƒëa
router.get("/sokhachMax", (req, res) => {
  const sql = "SELECT SoKhachToiDa FROM thamso LIMIT 1";
  db.query(sql, (err, result) => {
    if (err) return res.status(500).json({ message: "L·ªói DB" });

    res.json({ soKhachToiDa: result[0].SoKhachToiDa });
  });
});

module.exports = router;

```

### backend\services\api.js
```js
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:9999/api",
});

api.interceptors.request.use((config) => {
  const token = localStorage.getItem("token");
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;

```

### frontend\eslint.config.js
```js
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

```

### frontend\vite.config.js
```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})

```

### frontend\src\App.jsx
```jsx
// src/App.jsx
import {
  BrowserRouter as Router,
  Routes,
  Route,
  Navigate,
} from "react-router-dom";
import Login from "./pages/Login";
import Dashboard from "./pages/Dashboard";
import RoomManagement from "./pages/RoomManagement";
import Navbar from "./components/Navbar";
import Sidebar from "./components/Sidebar";
import { useState } from "react";
import BookingManagement from "./pages/BookingManagement";
import InvoiceManagement from "./pages/InvoiceManagement";

function PrivateLayout({ children }) {
  const token = localStorage.getItem("token");

  if (!token) return <Navigate to="/login" replace />;

  return (
    <div style={styles.app}>
      <Navbar />
      <div style={styles.main}>
        <SidebarWrapper />
        <div style={styles.content}>{children}</div>
      </div>
    </div>
  );
}

function SidebarWrapper() {
  const [activeMenu, setActiveMenu] = useState("dashboard");
  return <Sidebar activeMenu={activeMenu} setActiveMenu={setActiveMenu} />;
}

function App() {
  return (
    <Router>
      <Routes>
        {/* PUBLIC */}
        <Route path="/login" element={<Login />} />

        {/* PRIVATE ROUTES */}
        <Route
          path="/"
          element={
            <PrivateLayout>
              <Dashboard />
            </PrivateLayout>
          }
        />

        <Route
          path="/rooms"
          element={
            <PrivateLayout>
              <RoomManagement />
            </PrivateLayout>
          }
        />

        {/* C√°c trang c√≤n l·∫°i b·∫°n s·∫Ω th√™m sau */}
        <Route
          path="/phieuthue"
          element={
            <PrivateLayout>
              <BookingManagement />
            </PrivateLayout>
          }
        />

        <Route
          path="/invoice"
          element={
            <PrivateLayout>
              <InvoiceManagement />
            </PrivateLayout>
          }
        />
      </Routes>
    </Router>
  );
}

const styles = {
  app: {
    display: "flex",
    flexDirection: "column",
    height: "100vh",
  },
  main: {
    display: "flex",
    flex: 1,
    overflow: "hidden",
  },
  content: {
    flex: 1,
    padding: "1rem",
    backgroundColor: "#F5F8FF",
    overflow: "auto",
  },
};

export default App;

```

### frontend\src\main.jsx
```jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

```

### frontend\src\components\Navbar.jsx
```jsx
import React from "react";

const Navbar = () => {
  // L·∫•y th√¥ng tin user t·ª´ localStorage
  const user = JSON.parse(localStorage.getItem("user") || "{}");

  // Map vai tr√≤ sang ti·∫øng Vi·ªát
  const roleDisplay = {
    Admin: "Qu·∫£n tr·ªã vi√™n",
    QuanLy: "Qu·∫£n l√Ω",
    LeTan: "L·ªÖ t√¢n",
    BanGiamDoc: "Ban gi√°m ƒë·ªëc",
  };

  return (
    <nav style={styles.navbar}>
      <h2 style={styles.title}>üè® Qu·∫£n L√Ω Kh√°ch S·∫°n</h2>

      <div style={styles.userInfo}>
        <span style={styles.userName}>üë§ {user.hoTen || "User"}</span>
        <span style={styles.role}>
          {roleDisplay[user.vaiTro] || user.vaiTro}
        </span>
        <button
          style={styles.logoutBtn}
          onClick={() => {
            if (window.confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?")) {
              localStorage.clear();
              window.location.href = "/login";
            }
          }}
        >
          ƒêƒÉng xu·∫•t
        </button>
      </div>
    </nav>
  );
};

const styles = {
  navbar: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    padding: "1rem 2rem",
    backgroundColor: "#1F2A40",
    color: "white",
  },
  title: {
    margin: 0,
    fontSize: "1.5rem",
  },
  userInfo: {
    display: "flex",
    alignItems: "center",
    gap: "1rem",
  },
  userName: {
    fontWeight: 600,
    fontSize: "0.95rem",
  },
  role: {
    padding: "0.3rem 0.8rem",
    backgroundColor: "rgba(255,255,255,0.2)",
    borderRadius: "6px",
    fontSize: "0.85rem",
  },
  logoutBtn: {
    padding: "0.5rem 1rem",
    backgroundColor: "#FF6B6B",
    color: "white",
    border: "none",
    borderRadius: "6px",
    cursor: "pointer",
    fontWeight: 600,
  },
};

export default Navbar;

```

### frontend\src\components\Sidebar.jsx
```jsx
// src/components/Sidebar.jsx
import React from "react";
import { useNavigate } from "react-router-dom";

const Sidebar = ({ activeMenu, setActiveMenu }) => {
  const navigate = useNavigate();

  const menuItems = [
    { id: "dashboard", icon: "üìä", label: "T·ªïng quan", path: "/" },
    { id: "rooms", icon: "üõèÔ∏è", label: "Danh m·ª•c ph√≤ng", path: "/rooms" },
    { id: "booking", icon: "üìù", label: "Thu√™ ph√≤ng", path: "/phieuthue" },
    { id: "invoice", icon: "üíµ", label: "H√≥a ƒë∆°n", path: "/invoice" },
    { id: "report", icon: "üìà", label: "B√°o c√°o doanh thu", path: "/report" },
    { id: "settings", icon: "‚öôÔ∏è", label: "Qui ƒë·ªãnh", path: "/settings" },
  ];

  return (
    <div style={styles.sidebar}>
      {menuItems.map((item) => (
        <div
          key={item.id}
          style={{
            ...styles.menuItem,
            backgroundColor: activeMenu === item.id ? "#3A7DFF" : "transparent",
          }}
          onClick={() => {
            setActiveMenu(item.id);
            navigate(item.path); // üëâ ƒëi·ªÅu h∆∞·ªõng route
          }}
        >
          <span style={styles.icon}>{item.icon}</span>
          <span>{item.label}</span>
        </div>
      ))}
    </div>
  );
};

const styles = {
  sidebar: {
    width: "250px",
    backgroundColor: "#1F2A40",
    color: "white",
    minHeight: "100vh",
    padding: "1rem 0",
  },
  menuItem: {
    display: "flex",
    alignItems: "center",
    padding: "1rem 1.5rem",
    cursor: "pointer",
    borderRadius: "8px",
    margin: "0.3rem 0.5rem",
    transition: "0.3s",
  },
  icon: {
    marginRight: "1rem",
    fontSize: "1.2rem",
  },
};

export default Sidebar;

```

### frontend\src\pages\BookingManagement.jsx
```jsx
import React, { useEffect, useState } from "react";
import api from "../services/api";

/* =====================
   STATE M·∫™U
===================== */
const emptyForm = {
  MaPhong: "",
  NgayBatDauThue: "",
  NgayDuKienTra: "",
  GhiChu: "", 
};

const emptyKhach = {
  HoTen: "",
  MaLoaiKhach: "",
  CMND: "",
  DiaChi: "",
  SDT: "",
};

const BookingManagement = () => {
  // --- STATE ---
  const [bookings, setBookings] = useState([]);
  const [rooms, setRooms] = useState([]);
  const [guestTypes, setGuestTypes] = useState([]);
  const [soKhachToiDa, setSoKhachToiDa] = useState(1);

  // B·ªô l·ªçc Tab
  const [filterStatus, setFilterStatus] = useState('ALL'); 
  // ‚úÖ B·ªô l·ªçc T√¨m ki·∫øm
  const [searchTerm, setSearchTerm] = useState("");

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalMode, setModalMode] = useState("create"); 
  const [loading, setLoading] = useState(false);
  
  const [form, setForm] = useState(emptyForm);
  const [khachList, setKhachList] = useState([{ ...emptyKhach }]);
  const [selectedPhieu, setSelectedPhieu] = useState(null);

  // B·ªô l·ªçc Ng√†y
  const [filterDateFrom, setFilterDateFrom] = useState(""); // T·ª´ ng√†y
  const [filterDateTo, setFilterDateTo] = useState("");     // ƒê·∫øn ng√†y

  // ‚úÖ STATE M·ªöI: L∆∞u s·ªë l∆∞·ª£ng kh√°ch l√∫c m·ªõi m·ªü form 
  const [initialGuestCount, setInitialGuestCount] = useState(0);

  // H√≥a ƒë∆°n
  const [isCheckoutModalOpen, setIsCheckoutModalOpen] = useState(false);
  const [billPreview, setBillPreview] = useState(null);
  const [tienKhachDua, setTienKhachDua] = useState(""); // ƒê·ªÉ string r·ªóng ban ƒë·∫ßu cho d·ªÖ nh·∫≠p

  /* =====================
      LOAD DATA
  ===================== */
  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      const [bRes, rRes, gRes, maxRes] = await Promise.all([
        api.get("/phieuthue"),
        api.get("/phong"),
        api.get("/loaikhach"),
        api.get("/thamso/sokhachMax"),
      ]);
      setBookings(bRes.data);
      setRooms(rRes.data.filter((r) => r.TinhTrang === "Tr·ªëng"));
      setGuestTypes(gRes.data);
      setSoKhachToiDa(maxRes.data.soKhachToiDa);
    } catch (error) {
      console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error);
    }
  };

  const formatInputDate = (dateStr) => {
    if (!dateStr) return "";
    const d = new Date(dateStr);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    return `${year}-${month}-${day}`;
  };

  /* =====================
      HELPER X·ª¨ L√ù D·ªÆ LI·ªÜU & L·ªåC
  ===================== */
  const processBookings = () => {
    // 1. GOM NH√ìM D·ªÆ LI·ªÜU 
    const map = {};
    bookings.forEach((b) => {
      if (!map[b.SoPhieu]) {
        map[b.SoPhieu] = {
          ...b,
          khachListDetail: [{
            MaKH: b.MaKH, HoTen: b.HoTen, CMND: b.CMND, SDT: b.SDT, DiaChi: b.DiaChi, MaLoaiKhach: b.MaLoaiKhach || "" 
          }],
          khachListNames: [b.HoTen],
        };
      } else {
        if (!map[b.SoPhieu].khachListDetail.find(k => k.MaKH === b.MaKH)) {
          map[b.SoPhieu].khachListDetail.push({
            MaKH: b.MaKH, HoTen: b.HoTen, CMND: b.CMND, SDT: b.SDT, DiaChi: b.DiaChi, MaLoaiKhach: b.MaLoaiKhach || ""
          });
          map[b.SoPhieu].khachListNames.push(b.HoTen);
        }
      }
    });

    let result = Object.values(map);

    // 2. S·∫ÆP X·∫æP 
    result.sort((a, b) => new Date(b.NgayBatDauThue) - new Date(a.NgayBatDauThue));

    // 3. L·ªåC: T√åM KI·∫æM 
    if (searchTerm) {
      const lowerTerm = searchTerm.toLowerCase();
      result = result.filter(b => 
        b.SoPhieu.toLowerCase().includes(lowerTerm) ||
        b.TenPhong.toLowerCase().includes(lowerTerm) ||
        b.khachListNames.some(name => name.toLowerCase().includes(lowerTerm))
      );
    }

    // 4. L·ªåC: THEO TAB 
    if (filterStatus === 'DANG_THUE') {
      result = result.filter(b => b.TrangThaiLuuTru === 'DANG_THUE');
    } else if (filterStatus === 'DA_TRA_PHONG') {
      result = result.filter(b => b.TrangThaiLuuTru === 'DA_TRA_PHONG' || b.TrangThaiLuuTru === 'DA_THANH_TOAN');
    } else if (filterStatus === 'DA_HUY') {
      result = result.filter(b => b.TrangThaiLuuTru === 'DA_HUY');
    }

    // ‚úÖ 5. L·ªåC: THEO NG√ÄY 
    if (filterDateFrom) {
      result = result.filter(b => formatInputDate(b.NgayBatDauThue) >= filterDateFrom);
    }
    if (filterDateTo) {
      result = result.filter(b => formatInputDate(b.NgayBatDauThue) <= filterDateTo);
    }

    return result;
  };

  // C√°c h√†m formatDate, formatInputDate, renderTrangThai
  const formatDate = (dateStr) => {
    if (!dateStr) return "";
    const date = new Date(dateStr);
    const day = String(date.getDate()).padStart(2, "0");
    const month = String(date.getMonth() + 1).padStart(2, "0");
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
  };

  const renderTrangThai = (trangThai) => {
    const statusMap = {
      DANG_THUE: { icon: "üü¢", text: "ƒêang thu√™", color: "#10b981" },
      DA_TRA_PHONG: { icon: "‚úÖ", text: "ƒê√£ tr·∫£ ph√≤ng", color: "#3b82f6" },
      DA_THANH_TOAN: { icon: "üí∞", text: "ƒê√£ thanh to√°n", color: "#2563eb" },
      DA_HUY: { icon: "üî¥", text: "ƒê√£ h·ªßy", color: "#ef4444" },
    };
    const status = statusMap[trangThai] || statusMap.DANG_THUE;

    return (
      <span
        style={{
          ...styles.statusBadge,
          background: `${status.color}20`,
          color: status.color,
          border: `1px solid ${status.color}40`,
        }}
      >
        {status.icon} {status.text}
      </span>
    );
  };

  /* =====================
      HANDLER MODAL & FORM
  ===================== */
  const openModalCreate = () => {
    setModalMode("create");
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const day = String(today.getDate()).padStart(2, "0");
    const todayStr = `${year}-${month}-${day}`;

    setForm({
      ...emptyForm,
      NgayBatDauThue: todayStr, 
    });
    setKhachList([{ ...emptyKhach }]);
    setIsModalOpen(true);
  };

  const openModalEdit = (booking) => {
    setModalMode("edit");
    setSelectedPhieu(booking.SoPhieu);
    
    setForm({
      MaPhong: booking.MaPhong,
      NgayBatDauThue: formatInputDate(booking.NgayBatDauThue),
      NgayDuKienTra: formatInputDate(booking.NgayDuKienTra),
      GhiChu: booking.GhiChu || ""
    });

    const details = booking.khachListDetail.map(k => ({...k}));
    setKhachList(details);
    setInitialGuestCount(details.length);
    setIsModalOpen(true);
  };

  const openModalView = (booking) => {
    setModalMode("view");
    setForm({
      MaPhong: booking.TenPhong,
      NgayBatDauThue: formatInputDate(booking.NgayBatDauThue),
      NgayDuKienTra: formatInputDate(booking.NgayDuKienTra),
      GhiChu: booking.GhiChu || "Kh√¥ng c√≥ ghi ch√∫"
    });
    setKhachList(booking.khachListDetail);
    setIsModalOpen(true);
  };

  const closeModal = () => setIsModalOpen(false);

  const handleFormChange = (e) =>
    setForm({ ...form, [e.target.name]: e.target.value });

  const handleKhachChange = (index, field, value) => {
    const newList = [...khachList];
    newList[index][field] = value;
    setKhachList(newList);
  };

  const addKhach = () => {
    if (khachList.length >= soKhachToiDa) return;
    setKhachList([...khachList, { ...emptyKhach }]);
  };

  const removeKhach = (index) => {
    if (khachList.length === 1) return;
    setKhachList(khachList.filter((_, i) => i !== index));
  };

  const handleSubmit = async () => {
    if (modalMode === "view") {
        closeModal();
        return;
    }

    // Validate
    for (let i = 0; i < khachList.length; i++) {
        const k = khachList[i];
        if (!k.HoTen || !k.HoTen.trim()) {
            alert(`‚ùå Kh√°ch h√†ng #${i + 1} ch∆∞a nh·∫≠p t√™n!`);
            return;
        }
        if (!k.MaLoaiKhach) {
            alert(`‚ùå Kh√°ch h√†ng #${i + 1} ch∆∞a ch·ªçn Lo·∫°i kh√°ch!`);
            return;
        }
    }

    const currentCount = khachList.length;
    if (modalMode === "create") {
        if (currentCount > soKhachToiDa) {
            alert(`‚ùå Quy ƒë·ªãnh hi·ªán t·∫°i ch·ªâ cho ph√©p t·ªëi ƒëa ${soKhachToiDa} kh√°ch/ph√≤ng.`);
            return;
        }
    } else if (modalMode === "edit") {
        if (currentCount > initialGuestCount && currentCount > soKhachToiDa) {
             alert(`‚ùå Kh√¥ng th·ªÉ th√™m ng∆∞·ªùi! Quy ƒë·ªãnh t·ªëi ƒëa ${soKhachToiDa} kh√°ch.`);
             return;
        }
    }

    setLoading(true);
    try {
      if (modalMode === "create") {
        await api.post("/phieuthue", { ...form, danhSachKhach: khachList });
        alert("‚úÖ L·∫≠p phi·∫øu thu√™ th√†nh c√¥ng");
      } else if (modalMode === "edit") {
        await api.put(`/phieuthue/${selectedPhieu}`, {
            NgayDuKienTra: form.NgayDuKienTra,
            GhiChu: form.GhiChu,
            danhSachKhach: khachList
        });
        alert("‚úÖ C·∫≠p nh·∫≠t phi·∫øu th√†nh c√¥ng");
      }
      closeModal();
      fetchData();
    } catch (err) {
      alert("‚ùå " + (err.response?.data?.message || "L·ªói x·ª≠ l√Ω"));
    } finally {
      setLoading(false);
    }
  };

  const handleAction = async (action, booking) => {
      // Logic c≈© ch·ªâ d√πng cho H·ªßy phi·∫øu
      const msg = `X√°c nh·∫≠n H·ª¶Y phi·∫øu ${booking.SoPhieu}?`;
      if (!window.confirm(msg)) return;
      try {
          await api.put(`/phieuthue/${booking.SoPhieu}/huy`);
          alert("‚úÖ Thao t√°c th√†nh c√¥ng!");
          fetchData();
      } catch (err) {
          alert("‚ùå L·ªói: " + (err.response?.data?.message || err.message));
      }
  }

  // --- üî• LOGIC THANH TO√ÅN M·ªöI ---
  const handleCheckoutClick = async (booking) => {
    try {
        const res = await api.get(`/hoadon/preview/${booking.SoPhieu}`);
        setBillPreview(res.data);
        setTienKhachDua(""); 
        setIsCheckoutModalOpen(true);
    } catch (err) {
        alert("L·ªói t√≠nh ti·ªÅn: " + (err.response?.data?.message || err.message));
    }
  };

  const handleConfirmPayment = async () => {
    if (!billPreview) return;
    const tienDua = Number(tienKhachDua);
    if (tienDua < billPreview.ThanhTien) {
        alert("‚ö†Ô∏è Ti·ªÅn kh√°ch ƒë∆∞a ch∆∞a ƒë·ªß!");
        return;
    }

    try {
        setLoading(true);
        await api.post("/hoadon/pay", {
            soPhieu: billPreview.SoPhieu,
            tienKhachDua: tienDua
        });
        alert("‚úÖ Thanh to√°n & Tr·∫£ ph√≤ng th√†nh c√¥ng!");
        setIsCheckoutModalOpen(false);
        fetchData(); // Load l·∫°i d·ªØ li·ªáu b·∫£ng
    } catch (err) {
        alert("‚ùå L·ªói thanh to√°n: " + (err.response?.data?.message || err.message));
    } finally {
        setLoading(false);
    }
  };


  /* =====================
      RENDER
  ===================== */
  return (
    <div style={styles.wrapper}>
      <div style={styles.container}>
        <div style={styles.header}>
          <div>
            <h1 style={styles.title}>üìã Qu·∫£n l√Ω phi·∫øu thu√™ ph√≤ng</h1>
            <p style={styles.subtitle}>
              Qu·∫£n l√Ω v√† theo d√µi c√°c phi·∫øu thu√™ ph√≤ng kh√°ch s·∫°n
            </p>
          </div>
          <button style={styles.addBtn} onClick={openModalCreate}>
            <span style={styles.btnIcon}>+</span>
            <span>T·∫°o phi·∫øu thu√™ m·ªõi</span>
          </button>
        </div>

        {/* --- THANH C√îNG C·ª§ --- */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: '15px', marginBottom: '20px' }}>
          
          {/* Tab tr·∫°ng th√°i */}
          <div style={{ display: 'flex', gap: '10px' }}>
            {[
              { key: 'ALL', label: 'T·∫•t c·∫£' },
              { key: 'DANG_THUE', label: 'üü¢ ƒêang ·ªü' },
              { key: 'DA_TRA_PHONG', label: '‚úÖ ƒê√£ tr·∫£' },
              { key: 'DA_HUY', label: 'üî¥ ƒê√£ h·ªßy' },
            ].map(tab => (
              <button
                key={tab.key}
                onClick={() => setFilterStatus(tab.key)}
                style={{
                  padding: '8px 16px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontWeight: '600',
                  background: filterStatus === tab.key ? '#3b82f6' : '#fff',
                  color: filterStatus === tab.key ? '#fff' : '#64748b',
                  boxShadow: filterStatus === tab.key ? '0 2px 5px rgba(59, 130, 246, 0.3)' : '0 1px 2px rgba(0,0,0,0.05)',
                  transition: 'all 0.2s'
                }}
              >
                {tab.label}
              </button>
            ))}
          </div>

          {/* B·ªô l·ªçc ng√†y v√† T√¨m ki·∫øm */}
          <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap', alignItems: 'center', background: '#fff', padding: '10px', borderRadius: '12px', boxShadow: '0 2px 5px rgba(0,0,0,0.05)' }}>
            
            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
              <span style={{fontSize: '14px', fontWeight: 600, color: '#64748b'}}>T·ª´ ng√†y:</span>
              <input type="date" value={filterDateFrom} onChange={e => setFilterDateFrom(e.target.value)} style={styles.inputSearch} />
            </div>

            <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
              <span style={{fontSize: '14px', fontWeight: 600, color: '#64748b'}}>ƒê·∫øn ng√†y:</span>
              <input type="date" value={filterDateTo} onChange={e => setFilterDateTo(e.target.value)} style={styles.inputSearch} />
            </div>

            <div style={{flex: 1}}></div> 

            <input 
              type="text" 
              placeholder="üîç T√¨m phi·∫øu, ph√≤ng, kh√°ch..." 
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              style={{ ...styles.inputSearch, width: '300px' }}
            />
            
            {(filterDateFrom || filterDateTo || searchTerm) && (
              <button 
                onClick={() => { setFilterDateFrom(""); setFilterDateTo(""); setSearchTerm(""); }}
                style={{ background: '#f1f5f9', border: 'none', padding: '8px 12px', borderRadius: '6px', cursor: 'pointer', color: '#64748b' }}
                title="X√≥a b·ªô l·ªçc"
              >
                üîÑ
              </button>
            )}
          </div>
        </div>

        {/* TABLE */}
        <div style={styles.tableContainer}>
          <table style={styles.table}>
            <thead>
              <tr style={styles.tableHeader}>
                <th style={styles.th}>S·ªë phi·∫øu</th>
                <th style={styles.th}>Ph√≤ng</th>
                <th style={styles.th}>Kh√°ch h√†ng</th>
                <th style={styles.th}>Ng√†y thu√™</th>
                <th style={styles.th}>Ng√†y tr·∫£ d·ª± ki·∫øn</th>
                <th style={styles.th}>Tr·∫°ng th√°i</th>
                <th style={styles.th}>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              {processBookings().map((b, idx) => {
                const trangThai = b.TrangThaiLuuTru || "DANG_THUE";
                const isDangThue = trangThai === "DANG_THUE";

                return (
                  <tr key={b.SoPhieu} style={{ ...styles.tableRow, background: idx % 2 === 0 ? "#f8fafc" : "#ffffff" }}>
                    <td style={styles.td}><span style={styles.badge}>{b.SoPhieu}</span></td>
                    <td style={styles.td}><strong style={styles.roomName}>{b.TenPhong}</strong></td>
                    <td style={styles.td}>
                      <div>
                        {b.khachListNames.map((name, i) => (
                          <div key={i} style={{ marginBottom: 4 }}>{name}</div>
                        ))}
                        <span style={{ color: "#94a3b8", fontSize: 12, fontWeight: 600, marginTop: 4, display: "block" }}>
                          ({b.khachListNames.length} kh√°ch)
                        </span>
                      </div>
                    </td>
                    <td style={styles.td}><span style={styles.date}>{formatDate(b.NgayBatDauThue)}</span></td>
                    <td style={styles.td}><span style={styles.date}>{formatDate(b.NgayDuKienTra)}</span></td>
                    <td style={styles.td}>{renderTrangThai(trangThai)}</td>
                    <td style={styles.tdActions}>
                      <div style={styles.actionButtons}>
                        <button style={styles.actionBtn} onClick={() => openModalView(b)} title="Xem chi ti·∫øt">Xem</button>
                        {isDangThue && <button style={styles.actionBtn} onClick={() => openModalEdit(b)} title="S·ª≠a phi·∫øu">S·ª≠a</button>}

                        {/* --- N√öT TR·∫¢ PH√íNG (ƒê√É S·ª¨A LOGIC) --- */}
                        {isDangThue && (
                            <button
                            style={{ ...styles.actionBtn, background: "#dbeafe", color: "#2563eb", borderColor: "#bfdbfe" }}
                            onClick={() => handleCheckoutClick(b)}
                            title="Tr·∫£ ph√≤ng & Thanh to√°n"
                            >
                            üíµ Tr·∫£ ph√≤ng
                            </button>
                        )}

                        {isDangThue && (
                            <button
                            style={{ ...styles.actionBtn, background: "#fee2e2", color: "#ef4444", borderColor: "#fecaca" }}
                            onClick={() => handleAction('cancel', b)}
                            title="H·ªßy phi·∫øu"
                            >
                            H·ªßy
                            </button>
                        )}
                      </div>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>

        {/* MODAL EDIT/CREATE/VIEW (Gi·ªØ nguy√™n) */}
        {isModalOpen && (
          <div style={styles.overlay} onClick={closeModal}>
            <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
              <div style={styles.modalHeader}>
                <h2 style={styles.modalTitle}>
                    {modalMode === 'create' && "‚ú® T·∫°o phi·∫øu thu√™ ph√≤ng m·ªõi"}
                    {modalMode === 'edit' && "‚úèÔ∏è S·ª≠a th√¥ng tin phi·∫øu thu√™"}
                    {modalMode === 'view' && "‚ÑπÔ∏è Chi ti·∫øt phi·∫øu thu√™"}
                </h2>
                <button style={styles.closeBtn} onClick={closeModal}>‚úï</button>
              </div>

              <div style={styles.form}>
                <div style={styles.formGroup}>
                  <label style={styles.label}>Ph√≤ng</label>
                  {modalMode === 'create' ? (
                      <select name="MaPhong" onChange={handleFormChange} style={styles.select} value={form.MaPhong}>
                        <option value="">-- Ch·ªçn ph√≤ng tr·ªëng --</option>
                        {rooms.map((r) => (
                          <option key={r.MaPhong} value={r.MaPhong}>üö™ {r.TenPhong}</option>
                        ))}
                      </select>
                  ) : (
                      <input style={{...styles.input, background: '#f3f4f6'}} value={form.MaPhong} disabled />
                  )}
                </div>

                <div style={styles.dateGroup}>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>Ng√†y b·∫Øt ƒë·∫ßu thu√™</label>
                    <input type="date" name="NgayBatDauThue" value={form.NgayBatDauThue} onChange={handleFormChange} style={styles.input} disabled={modalMode !== 'create'} />
                  </div>
                  <div style={styles.formGroup}>
                    <label style={styles.label}>Ng√†y tr·∫£ d·ª± ki·∫øn</label>
                    <input type="date" name="NgayDuKienTra" value={form.NgayDuKienTra} onChange={handleFormChange} style={styles.input} disabled={modalMode === 'view'} />
                  </div>
                </div>

                <div style={styles.formGroup}>
                    <label style={styles.label}>Ghi ch√∫</label>
                    <input type="text" name="GhiChu" value={form.GhiChu} onChange={handleFormChange} style={styles.input} placeholder="Ghi ch√∫ th√™m..." disabled={modalMode === 'view'} />
                </div>

                <div style={styles.guestSection}>
                  <div style={styles.guestHeader}>
                    <h4 style={styles.guestTitle}>üë• Danh s√°ch kh√°ch</h4>
                    <span style={styles.guestLimit}>{khachList.length} / {soKhachToiDa} kh√°ch</span>
                  </div>

                  {khachList.map((k, index) => (
                    <div key={index} style={styles.khachBox}>
                      <div style={styles.khachHeader}>
                        <span style={styles.khachNumber}>Kh√°ch #{index + 1}</span>
                        {modalMode !== 'view' && khachList.length > 1 && (
                          <button style={styles.removeBtn} onClick={() => removeKhach(index)}>üóëÔ∏è X√≥a</button>
                        )}
                      </div>
                      <div style={styles.khachGrid}>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>H·ªç t√™n *</label>
                          <input placeholder="Nh·∫≠p h·ªç t√™n" value={k.HoTen} onChange={(e) => handleKhachChange(index, "HoTen", e.target.value)} style={styles.input} disabled={modalMode === 'view'} />
                        </div>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>Lo·∫°i kh√°ch *</label>
                          {modalMode === 'create' || modalMode == 'edit' ? (
                              <select value={k.MaLoaiKhach} onChange={(e) => handleKhachChange(index, "MaLoaiKhach", e.target.value)} style={styles.select}>
                                <option value="">-- Ch·ªçn lo·∫°i --</option>
                                {guestTypes.map((g) => (<option key={g.MaLoaiKhach} value={g.MaLoaiKhach}>{g.TenLoaiKhach}</option>))}
                              </select>
                          ) : (
                              <input style={{...styles.input, background: '#f3f4f6'}} value={guestTypes.find(g => g.MaLoaiKhach == k.MaLoaiKhach)?.TenLoaiKhach || k.MaLoaiKhach} disabled />
                          )}
                        </div>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>CCCD/CMND *</label>
                          <input placeholder="S·ªë CCCD" value={k.CMND} onChange={(e) => handleKhachChange(index, "CMND", e.target.value)} style={styles.input} disabled={modalMode === 'view'} />
                        </div>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>ƒê·ªãa ch·ªâ</label>
                          <input placeholder="ƒê·ªãa ch·ªâ li√™n h·ªá" value={k.DiaChi} onChange={(e) => handleKhachChange(index, "DiaChi", e.target.value)} style={styles.input} disabled={modalMode === 'view'} />
                        </div>
                        <div style={styles.formGroup}>
                          <label style={styles.labelSmall}>S·ªë ƒëi·ªán tho·∫°i</label>
                          <input placeholder="S·ªë ƒëi·ªán tho·∫°i" value={k.SDT} onChange={(e) => handleKhachChange(index, "SDT", e.target.value)} style={styles.input} disabled={modalMode === 'view'} />
                        </div>
                      </div>
                    </div>
                  ))}

                  {modalMode !== 'view' && (
                    <button onClick={addKhach} disabled={khachList.length >= soKhachToiDa}
                        style={{ ...styles.addGuestBtn, ...(khachList.length >= soKhachToiDa ? styles.addGuestBtnDisabled : {}) }}
                    >
                        ‚ûï Th√™m kh√°ch h√†ng
                    </button>
                  )}
                </div>
              </div>

              <div style={styles.actions}>
                <button style={styles.cancelBtn} onClick={closeModal}>{modalMode === 'view' ? "ƒê√≥ng" : "H·ªßy b·ªè"}</button>
                {modalMode !== 'view' && (
                    <button style={styles.submitBtn} onClick={handleSubmit} disabled={loading}>{loading ? "‚è≥ ƒêang l∆∞u..." : "üíæ L∆∞u thay ƒë·ªïi"}</button>
                )}
              </div>
            </div>
          </div>
        )}

        {/* =========================================
            MODAL THANH TO√ÅN (CHECKOUT) - ƒê√É C·∫¨P NH·∫¨T
          ========================================= */}
        {isCheckoutModalOpen && billPreview && (
            <div style={styles.overlay} onClick={() => setIsCheckoutModalOpen(false)}>
                <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
                    <div style={{...styles.modalHeader, background: '#f8fafc', borderBottom: '1px solid #e2e8f0'}}>
                        <h2 style={{...styles.modalTitle, color: '#1e293b', fontSize: '20px', display: 'flex', alignItems: 'center', gap: '10px'}}>
                            üßæ H√≥a ƒê∆°n Thanh To√°n
                        </h2>
                        <button style={styles.closeBtn} onClick={() => setIsCheckoutModalOpen(false)}>‚úï</button>
                    </div>
                    
                    <div style={{padding: '24px'}}>
                        {/* 1. Th√¥ng tin chung (ƒê√£ th√™m Lo·∫°i ph√≤ng) */}
                        <div style={{
                            background: '#fff', 
                            borderRadius: '8px', 
                            marginBottom: '20px', 
                            border: '1px solid #e2e8f0',
                            display: 'grid', 
                            gridTemplateColumns: '1.5fr 1fr',
                            overflow: 'hidden'
                        }}>
                            <div style={{padding: '16px', borderRight: '1px solid #e2e8f0'}}>
                                <div style={{fontSize: '13px', color: '#64748b', marginBottom: '4px'}}>Ph√≤ng & Lo·∫°i ph√≤ng</div>
                                <div style={{fontSize: '18px', fontWeight: 'bold', color: '#2563eb'}}>
                                    {billPreview.TenPhong} 
                                    <span style={{fontSize: '14px', fontWeight: 'normal', color: '#475569', marginLeft: '8px'}}>
                                        ({billPreview.TenLoaiPhong}) {/* <--- ƒê√£ th√™m lo·∫°i ph√≤ng */}
                                    </span>
                                </div>
                                <div style={{fontSize: '13px', color: '#64748b', marginTop: '8px'}}>Kh√°ch ƒë·∫°i di·ªán</div>
                                <div style={{fontWeight: '600', color: '#334155'}}>{billPreview.TenKhachDaiDien}</div>
                            </div>
                            <div style={{padding: '16px', background: '#f8fafc'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '8px'}}>
                                    <span style={{color: '#64748b', fontSize: '13px'}}>S·ªë phi·∫øu:</span>
                                    <strong style={{color: '#334155'}}>{billPreview.SoPhieu}</strong>
                                </div>
                                <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                    <span style={{color: '#64748b', fontSize: '13px'}}>Ng√†y l·∫≠p:</span>
                                    <strong style={{color: '#334155'}}>{new Date().toLocaleDateString('vi-VN')}</strong>
                                </div>
                            </div>
                        </div>

                        {/* 2. B·∫£ng chi ti·∫øt */}
                        <table style={{width: '100%', marginBottom: '24px', borderCollapse: 'collapse', fontSize: '14px'}}>
                            <thead>
                                <tr style={{background: '#f1f5f9', color: '#475569', textTransform: 'uppercase', fontSize: '11px', letterSpacing: '0.5px'}}>
                                    <th style={{padding: '12px', textAlign: 'left'}}>Kho·∫£n m·ª•c</th>
                                    <th style={{padding: '12px', textAlign: 'right'}}>Chi ti·∫øt</th>
                                    <th style={{padding: '12px', textAlign: 'right'}}>Th√†nh ti·ªÅn</th>
                                </tr>
                            </thead>
                            <tbody style={{borderTop: '1px solid #e2e8f0'}}>
                                <tr>
                                    <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>
                                        <strong>Ti·ªÅn thu√™ ph√≤ng</strong>
                                        <div style={{fontSize: '12px', color: '#64748b', marginTop: '2px'}}>
                                            ƒê∆°n gi√°: {Number(billPreview.DonGia).toLocaleString()} ƒë/ng√†y
                                        </div>
                                    </td>
                                    <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>
                                        {billPreview.SoNgay} ng√†y
                                    </td>
                                    <td style={{padding: '12px', textAlign: 'right', fontWeight: 'bold', color: '#334155', borderBottom: '1px dashed #e2e8f0'}}>
                                        {Number(billPreview.DonGia * billPreview.SoNgay).toLocaleString()}
                                    </td>
                                </tr>

                                {billPreview.TiLePhuThu > 0 && (
                                    <tr style={{color: '#d97706', background: '#fffbeb'}}>
                                        <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>Ph·ª• thu qu√° t·∫£i ({billPreview.SoKhach} kh√°ch)</td>
                                        <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>+{billPreview.TiLePhuThu * 100}%</td>
                                        <td style={{padding: '12px', textAlign: 'right', fontStyle: 'italic', borderBottom: '1px dashed #e2e8f0'}}>
                                            (H·ªá s·ªë {1 + billPreview.TiLePhuThu})
                                        </td>
                                    </tr>
                                )}

                                {billPreview.HeSoKhach > 1 && (
                                    <tr style={{color: '#059669', background: '#f0fdf4'}}>
                                        <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>H·ªá s·ªë kh√°ch n∆∞·ªõc ngo√†i</td>
                                        <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>x {billPreview.HeSoKhach}</td>
                                        <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}></td>
                                    </tr>
                                )}

                                <tr style={{borderTop: '2px solid #334155', background: '#fff'}}>
                                    <td style={{padding: '16px 12px', fontWeight: 'bold', fontSize: '15px', color: '#dc2626'}} colSpan={2}>
                                        T·ªîNG TI·ªÄN PH·∫¢I TR·∫¢
                                    </td>
                                    <td style={{padding: '16px 12px', textAlign: 'right', fontWeight: 'bold', fontSize: '18px', color: '#dc2626'}}>
                                        {Number(billPreview.ThanhTien).toLocaleString()} VND
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        {/* 3. Input Ti·ªÅn (Fix l·ªói VND nh·∫£y lung tung) */}
                        <div style={{
                            background: '#f0f9ff', 
                            padding: '20px', 
                            borderRadius: '12px', 
                            border: '1px solid #bae6fd',
                            marginBottom: '24px'
                        }}>
                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
                                <label style={{fontSize: '15px', fontWeight: 'bold', color: '#0369a1'}}>üíµ KH√ÅCH ƒê∆ØA:</label>
                                
                                {/* Wrapper input ƒë·ªÉ ƒë·ªãnh v·ªã ch·ªØ VND */}
                                <div style={{position: 'relative', width: '200px'}}>
                                    <input 
                                        type="number" 
                                        autoFocus
                                        placeholder="0"
                                        style={{
                                            width: '100%',
                                            padding: '10px 50px 10px 15px', // Padding ph·∫£i ch·ª´a ch·ªó cho ch·ªØ VND
                                            borderRadius: '8px', 
                                            border: '2px solid #0ea5e9', 
                                            fontSize: '18px', 
                                            fontWeight: 'bold', 
                                            textAlign: 'right', 
                                            color: '#0284c7', 
                                            outline: 'none',
                                            boxSizing: 'border-box',
                                            background: '#fff'
                                        }}
                                        value={tienKhachDua}
                                        onChange={(e) => setTienKhachDua(e.target.value)}
                                    />
                                    {/* Ch·ªØ VND tuy·ªát ƒë·ªëi theo khung cha */}
                                    <span style={{
                                        position: 'absolute', 
                                        right: '12px', // C√°ch l·ªÅ ph·∫£i 12px
                                        top: '50%', 
                                        transform: 'translateY(-50%)', // CƒÉn gi·ªØa d·ªçc
                                        fontWeight: 'bold', 
                                        color: '#94a3b8',
                                        pointerEvents: 'none', // Cho ph√©p b·∫•m xuy√™n qua v√†o input
                                        fontSize: '14px'
                                    }}>VND</span>
                                </div>
                            </div>

                            <div style={{marginTop: '15px', paddingTop: '15px', borderTop: '1px dashed #cbd5e1', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                <span style={{fontSize: '14px', fontWeight: '600', color: '#475569'}}>Ti·ªÅn th·ª´a tr·∫£ l·∫°i:</span>
                                <span style={{
                                    fontSize: '18px', 
                                    fontWeight: 'bold', 
                                    color: (Number(tienKhachDua) - billPreview.ThanhTien) < 0 ? '#ef4444' : '#16a34a'
                                }}>
                                    {tienKhachDua ? (Number(tienKhachDua) - billPreview.ThanhTien).toLocaleString() : 0} VND
                                </span>
                            </div>
                        </div>

                        {/* 4. Actions (N√∫t H·ªßy ƒë·∫πp h∆°n) */}
                        <div style={{display: 'flex', justifyContent: 'flex-end', gap: '12px'}}>
                            <button 
                                style={{
                                    padding: '10px 20px', 
                                    background: '#fff', 
                                    color: '#64748b', 
                                    border: '1px solid #cbd5e1', 
                                    borderRadius: '8px', 
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    fontSize: '14px',
                                    transition: 'all 0.2s'
                                }} 
                                onClick={() => setIsCheckoutModalOpen(false)}
                                onMouseOver={(e) => e.target.style.background = '#f1f5f9'}
                                onMouseOut={(e) => e.target.style.background = '#fff'}
                            >
                                H·ªßy b·ªè
                            </button>
                            <button 
                                style={{
                                    padding: '10px 24px', 
                                    background: '#2563eb', 
                                    color: '#fff', 
                                    border: 'none', 
                                    borderRadius: '8px', 
                                    fontWeight: 'bold', 
                                    cursor: (Number(tienKhachDua) < billPreview.ThanhTien) ? 'not-allowed' : 'pointer',
                                    opacity: (Number(tienKhachDua) < billPreview.ThanhTien) ? 0.6 : 1,
                                    boxShadow: '0 4px 6px -1px rgba(37, 99, 235, 0.4)',
                                    fontSize: '14px'
                                }} 
                                onClick={handleConfirmPayment}
                                disabled={Number(tienKhachDua) < billPreview.ThanhTien}
                            >
                                ‚úÖ Ho√†n th√†nh thanh to√°n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        )}

      </div>
    </div>
  );
};

/* =====================
          STYLE 
===================== */
const styles = {
  wrapper: {
    minHeight: "100vh",
    background: "linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%)",
    padding: "32px 16px",
  },
  container: {
    maxWidth: 1200,
    margin: "0 auto",
  },
  header: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 32,
    background: "rgba(255,255,255,0.95)",
    padding: 24,
    borderRadius: 16,
    boxShadow: "0 4px 20px rgba(0,0,0,0.08)",
  },
  title: {
    margin: 0,
    fontSize: 32,
    fontWeight: 700,
    color: "#2d3748",
  },
  subtitle: {
    margin: "8px 0 0 0",
    color: "#64748b",
    fontSize: 14,
  },
  addBtn: {
    display: "flex",
    alignItems: "center",
    gap: 8,
    padding: "12px 24px",
    background: "#4299e1",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 15,
    fontWeight: 600,
    cursor: "pointer",
    boxShadow: "0 4px 12px rgba(66, 153, 225, 0.3)",
    transition: "all 0.3s ease",
  },
  btnIcon: {
    fontSize: 20,
    fontWeight: 700,
  },
  tableContainer: {
    background: "#fff",
    borderRadius: 16,
    overflow: "hidden",
    boxShadow: "0 4px 20px rgba(0,0,0,0.08)",
  },
  table: {
    width: "100%",
    borderCollapse: "collapse",
  },
  tableHeader: {
    background: "#718096",
  },
  th: {
    padding: "16px 20px",
    textAlign: "left",
    color: "#fff",
    fontWeight: 600,
    fontSize: 14,
    textTransform: "uppercase",
    letterSpacing: "0.5px",
  },
  tableRow: {
    transition: "all 0.2s ease",
    cursor: "pointer",
  },
  td: {
    padding: "16px 20px",
    fontSize: 14,
    color: "#334155",
    borderBottom: "1px solid #e2e8f0",
  },
  badge: {
    background: "#4a5568",
    color: "#fff",
    padding: "4px 12px",
    borderRadius: 20,
    fontSize: 13,
    fontWeight: 600,
  },
  roomName: {
    color: "#2d3748",
    fontWeight: 600,
  },
  date: {
    color: "#64748b",
    fontSize: 13,
  },
  statusBadge: {
    padding: "6px 12px",
    borderRadius: 20,
    fontSize: 12,
    fontWeight: 600,
    display: "inline-block",
    whiteSpace: "nowrap",
  },
  tdActions: {
    padding: "16px 20px",
    fontSize: 14,
    color: "#334155",
    borderBottom: "1px solid #e2e8f0",
  },
  actionButtons: {
    display: "flex",
    gap: 6,
    justifyContent: "center",
    flexWrap: "wrap",
  },
  actionBtn: {
    background: "#fff",
    border: "1px solid #e2e8f0",
    borderRadius: 6,
    padding: "6px 12px",
    fontSize: 13,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    whiteSpace: "nowrap",
  },
  actionBtnDisabled: {
    opacity: 0.4,
    cursor: "not-allowed",
  },
  overlay: {
    position: "fixed",
    inset: 0,
    background: "rgba(0,0,0,.6)",
    backdropFilter: "blur(4px)",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    zIndex: 1000,
  },
  modal: {
    background: "#fff",
    borderRadius: 20,
    width: "90%",
    maxWidth: 700,
    maxHeight: "90vh",
    overflowY: "auto",
    boxShadow: "0 20px 60px rgba(0,0,0,0.3)",
  },
  modalHeader: {
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    padding: "24px 28px",
    borderBottom: "2px solid #e2e8f0",
    background: "#f7fafc",
    position: "relative",
  },
  modalTitle: {
    margin: 0,
    fontSize: 24,
    fontWeight: 700,
    color: "#2d3748",
  },
  closeBtn: {
    position: "absolute",
    right: "28px",
    background: "transparent",
    border: "none",
    fontSize: 24,
    color: "#64748b",
    cursor: "pointer",
    width: 32,
    height: 32,
    borderRadius: "50%",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    transition: "all 0.2s ease",
  },
  form: {
    padding: "28px",
  },
  formGroup: {
    marginBottom: 20,
  },
  label: {
    display: "block",
    marginBottom: 8,
    fontSize: 14,
    fontWeight: 600,
    color: "#1e293b",
  },
  labelSmall: {
    display: "block",
    marginBottom: 6,
    fontSize: 13,
    fontWeight: 600,
    color: "#475569",
  },
  input: {
    width: "100%",
    padding: "12px 16px",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    transition: "all 0.2s ease",
    outline: "none",
    boxSizing: "border-box",
  },
  select: {
    width: "100%",
    padding: "12px 16px",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    transition: "all 0.2s ease",
    outline: "none",
    background: "#fff",
    cursor: "pointer",
    boxSizing: "border-box",
  },
  dateGroup: {
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: 16,
  },
  guestSection: {
    marginTop: 24,
    padding: 20,
    background: "#f8fafc",
    borderRadius: 12,
  },
  guestHeader: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 16,
  },
  guestTitle: {
    margin: 0,
    fontSize: 18,
    fontWeight: 700,
    color: "#1e293b",
  },
  guestLimit: {
    background: "#4a5568",
    color: "#fff",
    padding: "4px 12px",
    borderRadius: 20,
    fontSize: 12,
    fontWeight: 600,
  },
  khachBox: {
    background: "#fff",
    border: "2px solid #e2e8f0",
    padding: 20,
    borderRadius: 12,
    marginBottom: 16,
    boxShadow: "0 2px 8px rgba(0,0,0,0.05)",
  },
  khachHeader: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: 16,
    paddingBottom: 12,
    borderBottom: "2px solid #e2e8f0",
  },
  khachNumber: {
    fontSize: 14,
    fontWeight: 700,
    color: "#4a5568",
  },
  removeBtn: {
    background: "#e53e3e",
    color: "#fff",
    border: "none",
    padding: "6px 12px",
    borderRadius: 8,
    fontSize: 12,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  khachGrid: {
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: 12,
  },
  addGuestBtn: {
    width: "100%",
    padding: "12px",
    background: "#48bb78",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  addGuestBtnDisabled: {
    background: "#cbd5e1",
    cursor: "not-allowed",
    opacity: 0.6,
  },
  actions: {
    display: "flex",
    justifyContent: "flex-end",
    gap: 12,
    padding: "24px 28px",
    borderTop: "2px solid #e2e8f0",
    background: "#f8fafc",
  },
  cancelBtn: {
    padding: "12px 24px",
    background: "#fff",
    color: "#64748b",
    border: "2px solid #e2e8f0",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    transition: "all 0.2s ease",
  },
  submitBtn: {
    padding: "12px 24px",
    background: "#4299e1",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    boxShadow: "0 4px 12px rgba(66, 153, 225, 0.3)",
    transition: "all 0.2s ease",
  },
  saveButton: { // Style m·ªõi d√πng cho n√∫t thanh to√°n
    padding: "12px 24px",
    color: "#fff",
    border: "none",
    borderRadius: 10,
    fontSize: 14,
    fontWeight: 600,
    cursor: "pointer",
    boxShadow: "0 4px 12px rgba(66, 153, 225, 0.3)",
    transition: "all 0.2s ease",
  },
  inputSearch: {
    padding: '8px 12px',
    borderRadius: '6px',
    border: '1px solid #e2e8f0',
    outline: 'none',
    fontSize: '14px',
    color: '#334155'
  },
};

export default BookingManagement;
```

### frontend\src\pages\Dashboard.jsx
```jsx
import React, { useState } from "react";

const Dashboard = () => {
  const [stats] = useState({
    totalRooms: 0,
    availableRooms: 0,
    occupiedRooms: 0,
    totalRevenue: 0,
  });

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>Dashboard - T·ªïng quan</h1>

      <div style={styles.statsGrid}>
        <div style={{ ...styles.card, backgroundColor: "#4A90E2" }}>
          <h3>T·ªïng s·ªë ph√≤ng</h3>
          <p style={styles.number}>{stats.totalRooms}</p>
        </div>

        <div style={{ ...styles.card, backgroundColor: "#7ED957" }}>
          <h3>Ph√≤ng tr·ªëng</h3>
          <p style={styles.number}>{stats.availableRooms}</p>
        </div>

        <div style={{ ...styles.card, backgroundColor: "#FF6B6B" }}>
          <h3>Ph√≤ng ƒë√£ thu√™</h3>
          <p style={styles.number}>{stats.occupiedRooms}</p>
        </div>

        <div style={{ ...styles.card, backgroundColor: "#FFC542" }}>
          <h3>Doanh thu th√°ng</h3>
          <p style={styles.number}>{stats.totalRevenue} VNƒê</p>
        </div>
      </div>
    </div>
  );
};

const styles = {
  container: {
    width: "100%",
    padding: "2rem 3rem",
    backgroundColor: "#F5F8FF",
  },
  title: {
    fontSize: "2.3rem",
    fontWeight: "700",
    color: "#1F2A40",
  },
  statsGrid: {
    width: "100%",
    display: "grid",
    gridTemplateColumns: "repeat(auto-fit, minmax(260px, 1fr))",
    gap: "1.5rem",
    marginTop: "2rem",
  },
  card: {
    padding: "2rem",
    borderRadius: "12px",
    color: "white",
    boxShadow: "0 4px 12px rgba(0,0,0,0.08)",
  },
  number: {
    fontSize: "2.5rem",
    marginTop: "1rem",
    fontWeight: "bold",
  },
};

export default Dashboard;

```

### frontend\src\pages\InvoiceManagement.jsx
```jsx
import React, { useEffect, useState } from "react";
import api from "../services/api";

const InvoiceManagement = () => {
  const [invoices, setInvoices] = useState([]);
  const [loading, setLoading] = useState(false);
  
  // State cho Modal xem chi ti·∫øt
  const [selectedInvoice, setSelectedInvoice] = useState(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  useEffect(() => {
    fetchInvoices();
  }, []);

  const fetchInvoices = async () => {
    try {
        setLoading(true);
        const res = await api.get("/hoadon");
        setInvoices(res.data);
    } catch (err) {
        console.error(err);
    } finally {
        setLoading(false);
    }
  };

  // H√†m x·ª≠ l√Ω khi b·∫•m n√∫t Xem
  const handleViewDetail = async (soHoaDon) => {
      try {
          const res = await api.get(`/hoadon/${soHoaDon}`);
          setSelectedInvoice(res.data);
          setIsModalOpen(true);
      } catch (err) {
          alert("Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt h√≥a ƒë∆°n");
      }
  };

  return (
    <div style={styles.wrapper}>
      <h1 style={styles.title}>üßæ Qu·∫£n l√Ω H√≥a ƒë∆°n & Doanh thu</h1>
      <div style={styles.tableCard}>
        {loading ? <p style={{padding: '20px'}}>‚è≥ ƒêang t·∫£i...</p> : (
        <table style={styles.table}>
            <thead>
                {/* üëá S·ª¨A ·ªû ƒê√ÇY: D√πng style.tableHeader gi·ªëng trang Phi·∫øu thu√™ */}
                <tr style={styles.tableHeader}>
                    <th style={styles.th}>S·ªë H√≥a ƒê∆°n</th>
                    <th style={styles.th}>Ph√≤ng</th>
                    <th style={styles.th}>Kh√°ch h√†ng</th>
                    <th style={styles.th}>Li√™n h·ªá (SƒêT)</th> 
                    <th style={styles.th}>Ng√†y l·∫≠p</th>
                    <th style={{...styles.th, textAlign: 'right'}}>Tr·ªã gi√°</th>
                    <th style={{...styles.th, textAlign: 'center'}}>Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
                {invoices.map((inv, idx) => (
                    <tr key={inv.SoHoaDon} style={{...styles.tr, background: idx % 2 === 0 ? "#f8fafc" : "#ffffff"}}>
                        <td style={styles.td}><span style={styles.badge}>{inv.SoHoaDon}</span></td>
                        <td style={styles.td}><strong>{inv.TenPhong_LuuTru || "Ph√≤ng c≈©"}</strong></td>
                        <td style={styles.td}><div style={{fontWeight: '600', color: '#334155'}}>{inv.TenKhachHangCoQuan}</div></td>
                        <td style={styles.td}>
                            <div style={{display: 'flex', flexDirection: 'column'}}>
                                <span style={{fontWeight: 'bold', color: '#059669', fontSize: '15px'}}>üìû {inv.SDT || "---"}</span>
                                <span style={{fontSize: '12px', color: '#94a3b8', marginTop: '4px'}}>üìç {inv.DiaChi || "---"}</span>
                            </div>
                        </td>
                        <td style={styles.td}>{new Date(inv.NgayLap).toLocaleDateString('vi-VN')}</td>
                        <td style={{...styles.td, textAlign: 'right', fontWeight: 'bold', color: '#2563eb'}}>
                            {Number(inv.TriGia).toLocaleString()} ƒë
                        </td>
                        <td style={{...styles.td, textAlign: 'center'}}>
                            <button 
                                style={styles.viewBtn} 
                                onClick={() => handleViewDetail(inv.SoHoaDon)}
                                title="Xem chi ti·∫øt"
                                onMouseOver={(e) => {
                                    e.currentTarget.style.background = '#bae6fd';
                                    e.currentTarget.style.transform = 'translateY(-2px)';
                                }}
                                onMouseOut={(e) => {
                                    e.currentTarget.style.background = '#e0f2fe';
                                    e.currentTarget.style.transform = 'translateY(0)';
                                }}
                            >
                                üëÅÔ∏è Xem
                            </button>
                        </td>
                    </tr>
                ))}
            </tbody>
        </table>
        )}
      </div>

      {/* --- MODAL XEM CHI TI·∫æT H√ìA ƒê∆†N (GI·ªÆ NGUY√äN) --- */}
      {isModalOpen && selectedInvoice && (
        <div style={styles.overlay} onClick={() => setIsModalOpen(false)}>
            <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
                <div style={{...styles.modalHeader, background: '#f8fafc', borderBottom: '1px solid #e2e8f0'}}>
                    <h2 style={{...styles.modalTitle, color: '#1e293b', fontSize: '20px'}}>
                        üìÑ Chi Ti·∫øt H√≥a ƒê∆°n
                    </h2>
                    <button style={styles.closeBtn} onClick={() => setIsModalOpen(false)}>‚úï</button>
                </div>
                
                <div style={{padding: '24px'}}>
                    {/* Th√¥ng tin chung */}
                    <div style={{background: '#fff', borderRadius: '8px', marginBottom: '20px', border: '1px solid #e2e8f0', display: 'grid', gridTemplateColumns: '1.5fr 1fr'}}>
                        <div style={{padding: '16px', borderRight: '1px solid #e2e8f0'}}>
                            <div style={{fontSize: '13px', color: '#64748b'}}>Ph√≤ng & Lo·∫°i</div>
                            <div style={{fontSize: '18px', fontWeight: 'bold', color: '#2563eb'}}>
                                {selectedInvoice.TenPhong_LuuTru} 
                                {selectedInvoice.TenLoaiPhong && <span style={{fontSize: '14px', color: '#475569', fontWeight: 'normal'}}> - {selectedInvoice.TenLoaiPhong}</span>}
                            </div>
                            <div style={{fontSize: '13px', color: '#64748b', marginTop: '8px'}}>Kh√°ch h√†ng</div>
                            <div style={{fontWeight: '600', color: '#334155'}}>{selectedInvoice.TenKhachHangCoQuan}</div>
                        </div>
                        <div style={{padding: '16px', background: '#f8fafc'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '5px'}}>
                                <span style={{color: '#64748b', fontSize: '13px'}}>S·ªë Hƒê:</span>
                                <strong>{selectedInvoice.SoHoaDon}</strong>
                            </div>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '5px'}}>
                                <span style={{color: '#64748b', fontSize: '13px'}}>Ng√†y l·∫≠p:</span>
                                <strong>{new Date(selectedInvoice.NgayLap).toLocaleDateString('vi-VN')}</strong>
                            </div>
                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                <span style={{color: '#64748b', fontSize: '13px'}}>ƒê·ªãa ch·ªâ:</span>
                                <span style={{textAlign: 'right', fontSize: '13px'}}>{selectedInvoice.DiaChi || '---'}</span>
                            </div>
                        </div>
                    </div>

                    {/* B·∫£ng t√≠nh ti·ªÅn */}
                    <table style={{width: '100%', marginBottom: '20px', borderCollapse: 'collapse', fontSize: '14px'}}>
                        <thead>
                            <tr style={{background: '#f1f5f9', color: '#475569', textTransform: 'uppercase', fontSize: '11px'}}>
                                <th style={{padding: '10px', textAlign: 'left'}}>Kho·∫£n m·ª•c</th>
                                <th style={{padding: '10px', textAlign: 'right'}}>Chi ti·∫øt</th>
                                <th style={{padding: '10px', textAlign: 'right'}}>Th√†nh ti·ªÅn</th>
                            </tr>
                        </thead>
                        <tbody style={{borderTop: '1px solid #e2e8f0'}}>
                            <tr>
                                <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>
                                    <strong>Ti·ªÅn thu√™ ph√≤ng</strong>
                                    <div style={{fontSize: '12px', color: '#64748b'}}>ƒê∆°n gi√°: {Number(selectedInvoice.DonGia).toLocaleString()} ƒë</div>
                                </td>
                                <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>
                                    {selectedInvoice.SoNgayThue} ng√†y
                                </td>
                                <td style={{padding: '12px', textAlign: 'right', fontWeight: 'bold', borderBottom: '1px dashed #e2e8f0'}}>
                                    {Number(selectedInvoice.DonGia * selectedInvoice.SoNgayThue).toLocaleString()}
                                </td>
                            </tr>
                            
                            {selectedInvoice.PhuThu > 0 && (
                                <tr style={{color: '#d97706', background: '#fffbeb'}}>
                                    <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>Ph·ª• thu qu√° t·∫£i ({selectedInvoice.SoKhach} kh√°ch)</td>
                                    <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>+{selectedInvoice.PhuThu * 100}%</td>
                                    <td style={{padding: '12px', textAlign: 'right', fontStyle: 'italic', borderBottom: '1px dashed #e2e8f0'}}>
                                        (H·ªá s·ªë {1 + selectedInvoice.PhuThu})
                                    </td>
                                </tr>
                            )}

                            {selectedInvoice.KhachNuocNgoai === 1 && (
                                <tr style={{color: '#059669', background: '#f0fdf4'}}>
                                    <td style={{padding: '12px', borderBottom: '1px dashed #e2e8f0'}}>H·ªá s·ªë kh√°ch n∆∞·ªõc ngo√†i</td>
                                    <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}>x 1.5</td>
                                    <td style={{padding: '12px', textAlign: 'right', borderBottom: '1px dashed #e2e8f0'}}></td>
                                </tr>
                            )}

                            <tr style={{borderTop: '2px solid #334155'}}>
                                <td style={{padding: '15px', fontWeight: 'bold', color: '#dc2626', fontSize: '16px'}} colSpan={2}>T·ªîNG TI·ªÄN</td>
                                <td style={{padding: '15px', textAlign: 'right', fontWeight: 'bold', color: '#dc2626', fontSize: '18px'}}>
                                    {Number(selectedInvoice.TriGia).toLocaleString()} VND
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div style={{textAlign: 'right'}}>
                        <button style={styles.cancelBtn} onClick={() => setIsModalOpen(false)}>ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        </div>
      )}
    </div>
  );
};

const styles = {
  wrapper: { padding: "2rem 3rem", background: "#F5F8FF", minHeight: "100vh" },
  title: { fontSize: "2rem", fontWeight: "700", color: "#1F2A40", marginBottom: "2rem" },
  tableCard: { background: "white", borderRadius: "16px", boxShadow: "0 4px 20px rgba(0,0,0,0.05)", overflow: "hidden" },
  table: { width: "100%", borderCollapse: "collapse" },
  
  // üëá S·ª¨A STYLE TABLE HEADER CHO GI·ªêNG TRANG PHI·∫æU THU√ä
  tableHeader: {
    background: "#718096", // M√†u x√°m ƒë·∫≠m
  },
  th: {
    padding: "16px 24px",
    textAlign: "left",
    color: "#fff", // Ch·ªØ tr·∫Øng
    fontWeight: "600",
    fontSize: "14px",
    textTransform: 'uppercase',
    letterSpacing: "0.5px"
  },
  // -----------------------------------------------------

  td: { padding: "16px 24px", borderBottom: "1px solid #f1f5f9", color: "#334155", fontSize: "14px" },
  tr: { transition: "0.2s" },
  badge: { background: "#e2e8f0", padding: "4px 8px", borderRadius: "6px", fontSize: "0.85rem", fontWeight: "600", color: "#475569" },
  
  viewBtn: {
      display: 'inline-flex',
      alignItems: 'center',
      gap: '6px',
      padding: '8px 16px',
      background: '#e0f2fe', 
      color: '#0284c7', 
      border: '1px solid #bae6fd', 
      borderRadius: '8px', 
      cursor: 'pointer',
      fontSize: '13px',
      fontWeight: '700',
      transition: 'all 0.2s ease',
      boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
  },
  
  overlay: { position: "fixed", inset: 0, background: "rgba(0,0,0,.6)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 1000, backdropFilter: "blur(4px)" },
  modal: { background: "#fff", borderRadius: 20, width: "90%", maxWidth: 650, maxHeight: "90vh", overflowY: "auto", boxShadow: "0 20px 60px rgba(0,0,0,0.3)" },
  modalHeader: { display: "flex", justifyContent: "space-between", padding: "20px 24px", alignItems: 'center' },
  modalTitle: { margin: 0, fontSize: 24, fontWeight: 700 },
  closeBtn: { background: "transparent", border: "none", fontSize: 24, cursor: "pointer", color: '#64748b' },
  cancelBtn: { padding: "10px 24px", background: "#f1f5f9", color: "#475569", border: "none", borderRadius: 8, cursor: 'pointer', fontWeight: '600' },
};

export default InvoiceManagement;
```

### frontend\src\pages\Login.jsx
```jsx
import React, { useState } from "react";
import { useNavigate } from "react-router-dom";
import api from "../services/api";

const Login = () => {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    try {
      const response = await api.post("/auth/login", { username, password });

      // L∆∞u token v√†o localStorage
      localStorage.setItem("token", response.data.token);
      localStorage.setItem("user", JSON.stringify(response.data.user));

      alert("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
      navigate("/"); // Chuy·ªÉn v·ªÅ trang ch·ªß
    } catch (err) {
      console.error("‚ùå L·ªói ƒëƒÉng nh·∫≠p:", err);
      setError(err.response?.data?.error || "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={styles.container}>
      <div style={styles.card}>
        <h1 style={styles.title}>ƒêƒÉng nh·∫≠p</h1>
        <p style={styles.subtitle}>H·ªá th·ªëng qu·∫£n l√Ω kh√°ch s·∫°n</p>

        <form onSubmit={handleSubmit} style={styles.form}>
          <div style={styles.formGroup}>
            <label style={styles.label}>T√™n ƒëƒÉng nh·∫≠p</label>
            <input
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              style={styles.input}
              placeholder="Nh·∫≠p username"
              required
            />
          </div>

          <div style={styles.formGroup}>
            <label style={styles.label}>M·∫≠t kh·∫©u</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              style={styles.input}
              placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
              required
            />
          </div>

          {error && <p style={styles.error}>{error}</p>}

          <button type="submit" style={styles.button} disabled={loading}>
            {loading ? "ƒêang ƒëƒÉng nh·∫≠p..." : "ƒêƒÉng nh·∫≠p"}
          </button>
        </form>
      </div>
    </div>
  );
};

const styles = {
  container: {
    minHeight: "100vh",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
  },
  card: {
    background: "white",
    padding: "3rem",
    borderRadius: "16px",
    boxShadow: "0 20px 60px rgba(0,0,0,0.3)",
    width: "100%",
    maxWidth: "420px",
  },
  title: {
    fontSize: "2rem",
    fontWeight: 700,
    textAlign: "center",
    color: "#1F2A40",
    marginBottom: "0.5rem",
  },
  subtitle: {
    textAlign: "center",
    color: "#6B7280",
    marginBottom: "2rem",
  },
  form: {
    display: "flex",
    flexDirection: "column",
    gap: "1.5rem",
  },
  formGroup: {
    display: "flex",
    flexDirection: "column",
    gap: "0.5rem",
  },
  label: {
    fontWeight: 600,
    color: "#374151",
  },
  input: {
    padding: "0.75rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "1rem",
  },
  button: {
    padding: "0.75rem",
    background: "#3A7DFF",
    color: "white",
    border: "none",
    borderRadius: "8px",
    fontSize: "1rem",
    fontWeight: 600,
    cursor: "pointer",
    marginTop: "1rem",
  },
  error: {
    color: "#EF4444",
    fontSize: "0.875rem",
    textAlign: "center",
  },
};

export default Login;

```

### frontend\src\pages\RoomManagement.jsx
```jsx
import React, { useState, useEffect } from "react";
import api from "../services/api";

const emptyForm = {
  maPhong: "",
  tenPhong: "",
  loaiPhong: "",
  tinhTrang: "Tr·ªëng", // M·∫∑c ƒë·ªãnh
  ghiChu: "",
};

const generateRoomCode = (tenPhong) => {
  if (!/ph√≤ng/i.test(tenPhong)) return null;
  const numbers = tenPhong.match(/\d+/g);
  if (!numbers) return null;
  return "P" + numbers.join("");
};

const RoomManagement = () => {
  const [rooms, setRooms] = useState([]);
  const [roomTypes, setRoomTypes] = useState([]);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [mode, setMode] = useState("add");
  const [form, setForm] = useState(emptyForm);
  const [editingId, setEditingId] = useState(null);
  const [errors, setErrors] = useState({});
  const [loading, setLoading] = useState(false);

  // ‚úÖ Bi·∫øn ki·ªÉm tra xem ph√≤ng ƒëang s·ª≠a c√≥ ph·∫£i l√† "ƒê√£ thu√™" kh√¥ng
  const isRented = form.tinhTrang === "ƒê√£ thu√™";

  useEffect(() => {
    fetchRooms();
    fetchRoomTypes();
  }, []);

  const fetchRooms = async () => {
    try {
      setLoading(true);
      const response = await api.get("/phong");
      setRooms(response.data);
    } catch (error) {
      console.error("‚ùå L·ªói khi t·∫£i danh s√°ch ph√≤ng:", error);
      alert("Kh√¥ng th·ªÉ t·∫£i danh s√°ch ph√≤ng");
    } finally {
      setLoading(false);
    }
  };

  const fetchRoomTypes = async () => {
    try {
      const response = await api.get("/loaiphong");
      setRoomTypes(response.data); 
    } catch (error) {
      console.error("‚ùå L·ªói khi t·∫£i lo·∫°i ph√≤ng:", error);
    }
  };

  const openAddModal = () => {
    setMode("add");
    setForm(emptyForm);
    setErrors({});
    setIsModalOpen(true);
  };

  const openEditModal = (room) => {
    setMode("edit");
    setForm({
      maPhong: room.MaPhong,
      tenPhong: room.TenPhong,
      loaiPhong: room.MaLoaiPhong,
      tinhTrang: room.TinhTrang,
      ghiChu: room.GhiChu || "",
    });
    setEditingId(room.MaPhong);
    setErrors({});
    setIsModalOpen(true);
  };

  const closeModal = () => setIsModalOpen(false);

  const handleChange = (e) =>
    setForm((prev) => ({ ...prev, [e.target.name]: e.target.value }));

  const validate = () => {
    const errs = {};
    if (!form.tenPhong.trim()) errs.tenPhong = "T√™n ph√≤ng kh√¥ng ƒë∆∞·ª£c tr·ªëng";
    if (!form.loaiPhong) errs.loaiPhong = "Ch·ªçn lo·∫°i ph√≤ng";
    setErrors(errs);
    return Object.keys(errs).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validate()) return;

    setLoading(true);

    try {
      if (mode === "add") {
        const generatedCode = generateRoomCode(form.tenPhong);
        if (!generatedCode) {
            alert("T√™n ph√≤ng ph·∫£i c√≥ ch·ªØ 'Ph√≤ng' v√† s·ªë. VD: Ph√≤ng 101");
            setLoading(false);
            return;
        }

        const payload = {
            MaPhong: generatedCode,
            TenPhong: form.tenPhong,
            MaLoaiPhong: form.loaiPhong,
            TinhTrang: 'Tr·ªëng', 
            GhiChu: form.ghiChu,
        };
        await api.post("/phong", payload);
        alert("‚úÖ Th√™m ph√≤ng th√†nh c√¥ng!");
      } else {
        // Khi s·ª≠a: G·ª≠i th√¥ng tin c·∫≠p nh·∫≠t
        const payload = {
            TenPhong: form.tenPhong,
            MaLoaiPhong: form.loaiPhong,
            GhiChu: form.ghiChu,
        };
        await api.put(`/phong/${editingId}`, payload);
        alert("‚úÖ C·∫≠p nh·∫≠t ph√≤ng th√†nh c√¥ng!");
      }

      fetchRooms();
      setIsModalOpen(false);
    } catch (error) {
      console.error("‚ùå L·ªói khi l∆∞u ph√≤ng:", error);
      const msg = error.response?.data?.message || "Kh√¥ng th·ªÉ l∆∞u ph√≤ng. Vui l√≤ng th·ª≠ l·∫°i.";
      alert("‚ùå " + msg);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (!window.confirm("‚ö†Ô∏è Ph√≤ng n√†y ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠. B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA vƒ©nh vi·ªÖn?")) return;
    try {
      await api.delete(`/phong/${id}`);
      alert("‚úÖ X√≥a ph√≤ng th√†nh c√¥ng!");
      fetchRooms();
    } catch (error) {
      console.error("‚ùå L·ªói khi x√≥a ph√≤ng:", error);
      alert("Kh√¥ng th·ªÉ x√≥a ph√≤ng: " + (error.response?.data?.error || ""));
    }
  };

  const handleMaintenance = async (room) => {
    const isMaintenance = room.TinhTrang === "B·∫£o tr√¨";
    const newStatus = isMaintenance ? "Tr·ªëng" : "B·∫£o tr√¨";
    const actionText = isMaintenance ? "Ho√†n t·∫•t b·∫£o tr√¨" : "ƒê∆∞a v√†o b·∫£o tr√¨";

    if (!window.confirm(`B·∫°n mu·ªën ${actionText} cho ph√≤ng ${room.TenPhong}?`)) return;

    try {
        await api.put(`/phong/${room.MaPhong}/maintenance`, { status: newStatus });
        alert("‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh c√¥ng!");
        fetchRooms();
    } catch (error) {
        alert("‚ùå L·ªói: " + (error.response?.data?.message || "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i"));
    }
  };

  const handleBusinessStatus = async (room, action) => {
      const msg = action === 'stop' 
        ? `Ng∆∞ng kinh doanh ph√≤ng ${room.TenPhong}? (Ph√≤ng s·∫Ω kh√¥ng th·ªÉ ch·ªçn ƒë·ªÉ thu√™)`
        : `K√≠ch ho·∫°t l·∫°i ph√≤ng ${room.TenPhong}?`;
      
      if(!window.confirm(msg)) return;

      try {
          await api.put(`/phong/${room.MaPhong}/business`, { action });
          alert("‚úÖ Th√†nh c√¥ng!");
          fetchRooms();
      } catch (error) {
          alert("‚ùå L·ªói: " + (error.response?.data?.message || "L·ªói c·∫≠p nh·∫≠t"));
      }
  }

  return (
    <div style={styles.wrapper}>
      <div style={styles.headerRow}>
        <div>
          <h1 style={styles.title}>Danh m·ª•c ph√≤ng</h1>
          <p style={styles.subtitle}>
            Qu·∫£n l√Ω th√¥ng tin ph√≤ng, lo·∫°i ph√≤ng v√† t√¨nh tr·∫°ng ph√≤ng.
          </p>
        </div>
        <button style={styles.addButton} onClick={openAddModal}>
           + Th√™m ph√≤ng
        </button>
      </div>

      {loading && <p style={{ textAlign: "center" }}>‚è≥ ƒêang t·∫£i...</p>}

      <div style={styles.tableCard}>
        <table style={styles.table}>
          <thead>
            <tr>
              <th style={styles.th}>M√£ ph√≤ng</th>
              <th style={styles.th}>T√™n ph√≤ng</th>
              <th style={styles.th}>Lo·∫°i</th>
              <th style={styles.th}>ƒê∆°n gi√°</th>
              <th style={{ ...styles.th, textAlign: "center" }}>T√¨nh tr·∫°ng</th>
              <th style={styles.th}>Ghi ch√∫</th>
              <th style={{ ...styles.th, textAlign: "center" }}>H√†nh ƒë·ªông</th>
            </tr>
          </thead>

          <tbody>
            {rooms.map((room) => {
              const isStopped = room.TinhTrang === 'Ng∆∞ng kinh doanh';
              const hasHistory = room.CoLichSu > 0; 

              return (
                <tr 
                    key={room.MaPhong} 
                    style={{
                        ...styles.tr,
                        backgroundColor: isStopped ? '#F3F4F6' : 'white',
                        opacity: isStopped ? 0.6 : 1
                    }}
                >
                  <td style={styles.td}>{room.MaPhong}</td>
                  <td style={styles.td}>{room.TenPhong}</td>

                  <td style={styles.td}>
                    <span
                      style={loaiPhongBadgeStyle(
                        room.TenLoaiPhong || room.MaLoaiPhong
                      )}
                    >
                      {room.TenLoaiPhong || room.MaLoaiPhong}
                    </span>
                  </td>

                  <td style={styles.td}>
                    {room.DonGia
                      ? Number(room.DonGia).toLocaleString("vi-VN", {
                          minimumFractionDigits: 0,
                        }) + " VND"
                      : "-"}
                  </td>

                  <td style={{ ...styles.td, textAlign: "center" }}>
                    <span style={statusBadgeStyle(room.TinhTrang)}>
                      {room.TinhTrang}
                    </span>
                  </td>

                  <td style={styles.td}>{room.GhiChu}</td>

                  <td style={{ ...styles.td, textAlign: "center" }}>
                    <div style={styles.actionRow}>
                      
                      {isStopped ? (
                          <button 
                            style={styles.activateBtn}
                            onClick={() => handleBusinessStatus(room, 'active')}
                            title="K√≠ch ho·∫°t l·∫°i ƒë·ªÉ ti·∫øp t·ª•c cho thu√™"
                          >
                            üîÑ K√≠ch ho·∫°t
                          </button>
                      ) : (
                          <>
                            <button
                              style={styles.editButton}
                              onClick={() => openEditModal(room)}
                            >
                              S·ª≠a
                            </button>

                            {(room.TinhTrang === "Tr·ªëng" || room.TinhTrang === "B·∫£o tr√¨") && (
                                <button
                                    style={room.TinhTrang === "B·∫£o tr√¨" ? styles.finishBtn : styles.maintenanceBtn}
                                    onClick={() => handleMaintenance(room)}
                                    title={room.TinhTrang === "B·∫£o tr√¨" ? "Ho√†n t·∫•t b·∫£o tr√¨" : "ƒê∆∞a v√†o b·∫£o tr√¨"}
                                >
                                    {room.TinhTrang === "B·∫£o tr√¨" ? "Xong" : "B·∫£o tr√¨"}
                                </button>
                            )}

                            {hasHistory ? (
                                <button 
                                    style={styles.stopBtn} 
                                    onClick={() => handleBusinessStatus(room, 'stop')}
                                    title="Ph√≤ng ƒë√£ c√≥ d·ªØ li·ªáu, ch·ªâ c√≥ th·ªÉ ng∆∞ng kinh doanh"
                                >
                                    ‚õî Ng∆∞ng KD
                                </button>
                            ) : (
                                <button
                                  style={styles.deleteButton}
                                  onClick={() => handleDelete(room.MaPhong)}
                                  title="Ph√≤ng ch∆∞a c√≥ d·ªØ li·ªáu, c√≥ th·ªÉ x√≥a vƒ©nh vi·ªÖn"
                                >
                                  Xo√°
                                </button>
                            )}
                          </>
                      )}

                    </div>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
      </div>

      {/* MODAL */}
      {isModalOpen && (
        <div style={styles.modalOverlay} onClick={closeModal}>
          <div style={styles.modal} onClick={(e) => e.stopPropagation()}>
            <h2 style={styles.modalTitle}>
              {mode === "add" ? "Th√™m ph√≤ng" : "S·ª≠a ph√≤ng"}
            </h2>

            <div style={styles.form}>
              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>T√™n ph√≤ng</label>
                  <input
                    name="tenPhong"
                    value={form.tenPhong}
                    onChange={handleChange}
                    // ‚úÖ Kh√≥a T√™n ph√≤ng n·∫øu ƒëang ·ªü ch·∫ø ƒë·ªô S·ª≠a V√Ä ph√≤ng ƒêang thu√™
                    disabled={mode === "edit" && isRented} 
                    style={{
                        ...styles.input,
                        backgroundColor: (mode === "edit" && isRented) ? "#f3f4f6" : "white",
                        cursor: (mode === "edit" && isRented) ? "not-allowed" : "text"
                    }}
                  />
                  {mode === "add" && (
                    <p style={{ fontSize: "0.75rem", color: "#6B7280", marginTop: "0.25rem" }}>
                        VD: Nh·∫≠p "Ph√≤ng 101" ‚Üí M√£ ph√≤ng s·∫Ω t·ª± t·∫°o l√† P101
                    </p>
                  )}
                  {/* Hi·ªÉn th·ªã c·∫£nh b√°o n·∫øu b·ªã kh√≥a */}
                  {mode === "edit" && isRented && (
                    <p style={{ fontSize: "0.75rem", color: "#EF4444", marginTop: "0.25rem" }}>
                        üîí Ph√≤ng ƒëang thu√™, kh√¥ng th·ªÉ s·ª≠a T√™n ph√≤ng.
                    </p>
                  )}
                  {errors.tenPhong && (
                    <span style={styles.errorText}>{errors.tenPhong}</span>
                  )}
                </div>
              </div>

              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>Lo·∫°i ph√≤ng</label>
                  <select
                    name="loaiPhong"
                    value={form.loaiPhong}
                    onChange={handleChange}
                    // ‚úÖ Kh√≥a Lo·∫°i ph√≤ng n·∫øu ph√≤ng ƒêang thu√™
                    disabled={isRented}
                    style={{
                        ...styles.input,
                        backgroundColor: isRented ? "#f3f4f6" : "white",
                        cursor: isRented ? "not-allowed" : "pointer"
                    }}
                  >
                    <option value="">-- Ch·ªçn lo·∫°i ph√≤ng --</option>
                    {roomTypes.map((type) => (
                      <option key={type.MaLoaiPhong} value={type.MaLoaiPhong}>
                        {type.TenLoaiPhong} -{" "}
                        {Number(type.DonGia).toLocaleString("vi-VN")} VND
                      </option>
                    ))}
                  </select>
                  {isRented && (
                    <p style={{ fontSize: "0.75rem", color: "#EF4444", marginTop: "0.25rem" }}>
                        üîí Ph√≤ng ƒëang thu√™, kh√¥ng th·ªÉ ƒë·ªïi Lo·∫°i ph√≤ng.
                    </p>
                  )}
                  {errors.loaiPhong && (
                    <span style={styles.errorText}>{errors.loaiPhong}</span>
                  )}
                </div>
              </div>

              <div style={styles.formRow}>
                <div style={styles.formGroup}>
                  <label>Ghi ch√∫</label>
                  {/* ‚úÖ Ghi ch√∫ lu√¥n cho ph√©p s·ª≠a */}
                  <input
                    name="ghiChu"
                    value={form.ghiChu}
                    onChange={handleChange}
                    style={styles.input}
                    placeholder="Ghi ch√∫ th√™m..."
                  />
                </div>
              </div>

              <div style={styles.modalActions}>
                <button
                  type="button"
                  onClick={closeModal}
                  style={styles.cancelButton}
                  disabled={loading}
                >
                  H·ªßy
                </button>
                <button
                  type="button"
                  onClick={handleSubmit}
                  style={styles.saveButton}
                  disabled={loading}
                >
                  {loading
                    ? "‚è≥ ƒêang l∆∞u..."
                    : mode === "add"
                    ? "L∆∞u"
                    : "C·∫≠p nh·∫≠t"}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// ===== STYLES =====
const styles = {
  wrapper: {
    width: "100%",
    maxWidth: "1400px",
    margin: "0 auto",
    padding: "2rem 2rem 3rem",
  },
  headerRow: {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    marginBottom: "1.5rem",
  },
  title: {
    fontSize: "2rem",
    fontWeight: 700,
    color: "#1F2A40",
  },
  subtitle: {
    marginTop: "0.3rem",
    color: "#6B7280",
  },
  addButton: {
    padding: "0.6rem 1.4rem",
    backgroundColor: "#3A7DFF",
    color: "white",
    borderRadius: "8px",
    border: "none",
    cursor: "pointer",
    fontWeight: 600,
    boxShadow: "0 5px 14px rgba(58, 125, 255, 0.35)",
  },
  tableCard: {
    background: "white",
    borderRadius: "16px",
    boxShadow: "0 8px 20px rgba(15, 23, 42, 0.08)",
    padding: "1.5rem",
    overflowX: "auto",
  },
  table: {
    width: "100%",
    borderCollapse: "collapse",
    fontSize: "0.95rem",
  },
  th: {
    padding: "12px 16px",
    backgroundColor: "#F9FAFB",
    borderBottom: "2px solid #E5E7EB",
    fontWeight: 600,
    color: "#374151",
    textAlign: "left",
  },
  tr: {
    borderBottom: "1px solid #E5E7EB",
    transition: '0.2s',
  },
  td: {
    padding: "12px 16px",
    verticalAlign: "middle",
  },
  actionRow: {
    display: "flex",
    justifyContent: "center",
    gap: "0.5rem",
  },
  editButton: {
    background: "#3A7DFF",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: 500,
  },
  deleteButton: {
    background: "#EF4444",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: 500,
  },
  maintenanceBtn: {
    background: "#F59E0B",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: 500,
  },
  finishBtn: {
    background: "#10B981",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: 500,
  },
  stopBtn: {
    background: "#374151",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: 500,
  },
  activateBtn: {
    background: "#059669",
    color: "white",
    padding: "6px 14px",
    borderRadius: "6px",
    border: "none",
    cursor: "pointer",
    fontSize: "0.875rem",
    fontWeight: "bold",
  },
  modalOverlay: {
    position: "fixed",
    inset: 0,
    backgroundColor: "rgba(0,0,0,0.35)",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    zIndex: 999,
  },
  modal: {
    width: "100%",
    maxWidth: "680px",
    background: "white",
    padding: "2rem",
    borderRadius: "16px",
    boxShadow: "0 20px 40px rgba(0,0,0,0.2)",
  },
  modalTitle: {
    fontSize: "1.4rem",
    marginBottom: "1rem",
    fontWeight: 700,
    color: "#1F2A40",
  },
  form: {
    display: "flex",
    flexDirection: "column",
    gap: "1rem",
  },
  formRow: {
    display: "flex",
    gap: "1rem",
  },
  formGroup: {
    flex: 1,
    display: "flex",
    flexDirection: "column",
    gap: "0.3rem",
  },
  input: {
    padding: "0.55rem 0.75rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    fontSize: "0.95rem",
  },
  errorText: {
    color: "#EF4444",
    fontSize: "0.8rem",
    marginTop: "0.2rem",
  },
  modalActions: {
    display: "flex",
    justifyContent: "flex-end",
    gap: "0.8rem",
    marginTop: "1rem",
  },
  cancelButton: {
    padding: "0.5rem 1.2rem",
    borderRadius: "8px",
    border: "1px solid #D1D5DB",
    background: "white",
    cursor: "pointer",
  },
  saveButton: {
    padding: "0.5rem 1.4rem",
    borderRadius: "8px",
    border: "none",
    background: "#3A7DFF",
    color: "white",
    cursor: "pointer",
    fontWeight: 600,
  },
};

const loaiPhongBadgeStyle = (loai) => {
  const colors = {
    A: { bg: "#DBEAFE", color: "#1D4ED8" },
    "Lo·∫°i A": { bg: "#DBEAFE", color: "#1D4ED8" },
    B: { bg: "#FEF3C7", color: "#D97706" },
    "Lo·∫°i B": { bg: "#FEF3C7", color: "#D97706" },
    C: { bg: "#FEE2E2", color: "#DC2626" },
    "Lo·∫°i C": { bg: "#FEE2E2", color: "#DC2626" },
    D: { bg: "#E9D5FF", color: "#7C3AED" },
    "Lo·∫°i D": { bg: "#E9D5FF", color: "#7C3AED" },
  };

  const style = colors[loai] || { bg: "#E0EAFF", color: "#1E40AF" };
  return {
    display: "inline-block",
    padding: "4px 12px",
    borderRadius: "8px",
    fontWeight: 600,
    fontSize: "0.85rem",
    backgroundColor: style.bg,
    color: style.color,
    minWidth: "36px",
    textAlign: "center",
  };
};

const statusBadgeStyle = (status) => {
  let bg = "#E5E7EB";
  let color = "#374151";
  if (status === "Tr·ªëng") {
    bg = "#D1FAE5";
    color = "#059669";
  } else if (status === "ƒê√£ thu√™") {
    bg = "#FEE2E2";
    color = "#DC2626";
  } else if (status === "ƒêang d·ªçn") {
    bg = "#FEF3C7";
    color = "#D97706";
  } else if (status === "B·∫£o tr√¨") {
    bg = "#fed7aa"; 
    color = "#c2410c";
  } else if (status === "Ng∆∞ng kinh doanh") {
    bg = "#4b5563"; 
    color = "#ffffff";
  }

  return {
    display: "inline-block",
    padding: "4px 12px",
    borderRadius: "10px",
    fontWeight: 600,
    fontSize: "0.85rem",
    backgroundColor: bg,
    color,
    minWidth: "80px",
  };
};

export default RoomManagement;
```

### frontend\src\services\api.js
```js
import axios from "axios";

const api = axios.create({
  baseURL: "http://localhost:9999/api",
  headers: {
    "Content-Type": "application/json",
  },
});

export default api;

```
